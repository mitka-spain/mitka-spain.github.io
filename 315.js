"use strict";(self.webpackChunkinqviz_excel=self.webpackChunkinqviz_excel||[]).push([[315],{49242:function(e,t,r){r.d(t,{gc:function(){return f},kq:function(){return c},ks:function(){return g},ov:function(){return h}});var a=r(13908),s=r(11141),i=r(52399),n=r(60619),o=r(31214);class l extends i.eq{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig((e=>this.formatMessages(e)),e,{...t,runType:"prompt"})}}class p extends l{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class m extends n.d{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new s.GU(t)}}class u extends p{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new a.J(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this(o.PromptTemplate.fromTemplate(e),t)}}class c extends p{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new a.xk(await this.prompt.format(e))}static fromTemplate(e){return new this(o.PromptTemplate.fromTemplate(e))}}class f extends p{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new a.gY(await this.prompt.format(e))}static fromTemplate(e){return new this(o.PromptTemplate.fromTemplate(e))}}class h extends p{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new a.jN(await this.prompt.format(e))}static fromTemplate(e){return new this(o.PromptTemplate.fromTemplate(e))}}function b(e){if("function"==typeof e.formatMessages||(0,a.QW)(e))return e;const t=(0,a.E1)(e);if("human"===t._getType())return c.fromTemplate(t.content);if("ai"===t._getType())return f.fromTemplate(t.content);if("system"===t._getType())return h.fromTemplate(t.content);if(a.J.isInstance(t))return u.fromTemplate(t.content,t.role);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}class g extends m{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)if(!(t instanceof a.ku))for(const r of t.inputVariables)e.add(r);const t=this.inputVariables,r=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),s=new Set([...r].filter((t=>!e.has(t))));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);const i=new Set([...e].filter((e=>!r.has(e))));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;const r=await Promise.all(e.content.map((async e=>{if("image_url"!==e.type||"string"==typeof e.image_url||!e.image_url?.url)return e;const r=e.image_url.url,a=o.PromptTemplate.fromTemplate(r),s=await a.format(t);return e.image_url.url=s,e})));return e.content=r,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const e of this.promptMessages)if(e instanceof a.ku)r.push(await this._parseImagePrompts(e,t));else{const a=e.inputVariables.reduce(((e,r)=>{if(!(r in t))throw new Error(`Missing value for input variable \`${r.toString()}\``);return e[r]=t[r],e}),{}),s=await e.formatMessages(a);r=r.concat(s)}return r}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new g(a)}static fromTemplate(e){const t=o.PromptTemplate.fromTemplate(e),r=new c({prompt:t});return this.fromMessages([r])}static fromMessages(e){const t=e.reduce(((e,t)=>e.concat(t instanceof g?t.promptMessages:[b(t)])),[]),r=e.reduce(((e,t)=>t instanceof g?Object.assign(e,t.partialVariables):e),Object.create(null)),s=new Set;for(const e of t)if(!(e instanceof a.ku))for(const t of e.inputVariables)t in r||s.add(t);return new g({inputVariables:[...s],promptMessages:t,partialVariables:r})}static fromPromptMessages(e){return this.fromMessages(e)}}},37315:function(e,t,r){r.d(t,{FewShotPromptTemplate:function(){return n}});var a=r(21307),s=r(87327),i=r(31214);r(49242);class n extends a.A{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new n(a)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map((e=>this.examplePrompt.format(e)))),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return(0,s.SM)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await i.PromptTemplate.deserialize(t);let a;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return a=e.examples,new n({inputVariables:e.input_variables,examplePrompt:r,examples:a,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}}}]);
//# sourceMappingURL=315.js.map