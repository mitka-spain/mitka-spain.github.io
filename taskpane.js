/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e,t,n={49418:function(e,t,n){"use strict";e=n.nmd(e);const r=(e=0)=>t=>`[${38+e};5;${t}m`,a=(e=0)=>(t,n,r)=>`[${38+e};2;${t};${n};${r}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[n,r]of Object.entries(t)){for(const[n,a]of Object.entries(r))t[n]={open:`[${a[0]}m`,close:`[${a[1]}m`},r[n]=t[n],e.set(a[0],a[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=r(),t.color.ansi16m=a(),t.bgColor.ansi256=r(10),t.bgColor.ansi16m=a(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:n}=t.groups;3===n.length&&(n=n.split("").map((e=>e+e)).join(""));const r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},18529:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Responder=void 0;var i=n(75485),s=n(46115),o=n(57459),u=n(35070),l=n(17636),c=n(40910),d=function(){function e(e){this._model=new l.ChatOpenAI({modelName:"gpt-3.5-turbo",temperature:0,modelKwargs:{seed:31216},openAIApiKey:e}),this._embeddings=new s.OpenAIEmbeddings({openAIApiKey:e})}return e.prototype.loadContext=function(t){return r(this,void 0,void 0,(function(){var n,r;return a(this,(function(a){switch(a.label){case 0:return[4,new i.RecursiveCharacterTextSplitter({chunkSize:2e3,chunkOverlap:0}).createDocuments([t])];case 1:return n=a.sent(),[4,o.MemoryVectorStore.fromDocuments(n,this._embeddings)];case 2:return r=a.sent().asRetriever(),this._chain=u.RetrievalQAChain.fromLLM(this._model,r,{prompt:c.PromptTemplate.fromTemplate(e.template)}),[2]}}))}))},e.prototype.response=function(e){return r(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return this._chain?[2,this._chain.call({query:e}).then((function(e){return JSON.parse(t.cleanupJson(e.text))}))]:[2,Promise.reject(Error("Response context not loaded"))]}))}))},e.prototype.cleanupJson=function(e){return e.replace("```json","").replace("```","")},e.template='You are a security engineer who knows the system pretty well.\nUse the following pieces of context to answer the question at the end, but do not mention the provided context in the answer.\nIf the context does not contain the answer don\'t try to make up an answer.\nProvide the answer as JSON with the following fields: \n- "answer" - short answer as "yes", "no", "not defined"\n- "explanation" - full answer without any mention of the provided context, provided in the form of product documentation\n  \nContext: {context}\nQuestion: {question}',e}();t.Responder=d},15797:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(18529);function s(){return document.getElementById("fileInput")}function o(){return document.getElementById("openAIKey")}function u(){return document.getElementById("btnStoreKey")}function l(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return e=o(),(t=e.value)?[4,OfficeRuntime.storage.setItem("openAIKey",t)]:[3,2];case 1:n.sent(),window.responder=new i.Responder(t),s().disabled=!1,e.placeholder="key is already stored",e.value="",n.label=2;case 2:return[2]}}))}))}function c(){var e=s(),t=new FileReader;t.onload=function(e){"load"===e.type&&window.responder.loadContext(t.result)},t.readAsText(e.files[0])}function d(){u().disabled=!o().value}r(void 0,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,Office.onReady()];case 1:return t.sent().host!==Office.HostType.Excel?[3,3]:(u().onclick=l,s().onchange=c,o().oninput=d,[4,OfficeRuntime.storage.getItem("openAIKey")]);case 2:(e=t.sent())&&(window.responder=new i.Responder(e),s().disabled=!1,o().placeholder="key is already stored"),t.label=3;case 3:return[2]}}))}))},67526:function(e,t){"use strict";t.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,i=o(e),s=i[0],u=i[1],l=new a(function(e,t,n){return 3*(t+n)/4-n}(0,s,u)),c=0,d=u>0?s-4:s;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;return 2===u&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[c++]=255&t),1===u&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t),l},t.fromByteArray=function(e){for(var t,r=e.length,a=r%3,i=[],s=16383,o=0,l=r-a;o<l;o+=s)i.push(u(e,o,o+s>l?l:o+s));return 1===a?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===a&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),i.join("")};for(var n=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=i[s],r[i.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,r){for(var a,i,s=[],o=t;o<r;o+=3)a=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[(i=a)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},7983:function(e){e.exports=function(e,t,n,r,a){var i,s;if(void 0===r)r=0;else if((r|=0)<0||r>=e.length)throw new RangeError("invalid lower bound");if(void 0===a)a=e.length-1;else if((a|=0)<r||a>=e.length)throw new RangeError("invalid upper bound");for(;r<=a;)if((s=+n(e[i=r+(a-r>>>1)],t,i,e))<0)r=i+1;else{if(!(s>0))return i;a=i-1}return~r}},12729:function(e){"use strict";const t=/[\p{Lu}]/u,n=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,a=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,s=new RegExp("^"+i.source),o=new RegExp(i.source+a.source,"gu"),u=new RegExp("\\d+"+a.source,"gu"),l=(e,a)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(a={pascalCase:!1,preserveConsecutiveUppercase:!1,...a},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const i=!1===a.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(a.locale),l=!1===a.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(a.locale);return 1===e.length?a.pascalCase?l(e):i(e):(e!==i(e)&&(e=((e,r,a)=>{let i=!1,s=!1,o=!1;for(let u=0;u<e.length;u++){const l=e[u];i&&t.test(l)?(e=e.slice(0,u)+"-"+e.slice(u),i=!1,o=s,s=!0,u++):s&&o&&n.test(l)?(e=e.slice(0,u-1)+"-"+e.slice(u-1),o=s,s=!1,i=!0):(i=r(l)===l&&a(l)!==l,o=s,s=a(l)===l&&r(l)!==l)}return e})(e,i,l)),e=e.replace(s,""),e=a.preserveConsecutiveUppercase?((e,t)=>(r.lastIndex=0,e.replace(r,(e=>t(e)))))(e,i):i(e),a.pascalCase&&(e=l(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,u.lastIndex=0,e.replace(o,((e,n)=>t(n))).replace(u,(e=>t(e)))))(e,l))};e.exports=l,e.exports.default=l},79478:function(e){"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},30228:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,r,i,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new a(r,i||e,s),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],o]:e._events[u].push(o):(e._events[u]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,a=[];if(0===this._eventsCount)return a;for(r in e=this._events)t.call(e,r)&&a.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,i=r.length,s=new Array(i);a<i;a++)s[a]=r[a].fn;return s},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,a,i,s){var o=n?n+e:e;if(!this._events[o])return!1;var u,l,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,a),!0;case 5:return c.fn.call(c.context,t,r,a,i),!0;case 6:return c.fn.call(c.context,t,r,a,i,s),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,a);break;default:if(!u)for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},o.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,a){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||s(this,i);else{for(var u=0,l=[],c=o.length;u<c;u++)(o[u].fn!==t||a&&!o[u].once||r&&o[u].context!==r)&&l.push(o[u]);l.length?this._events[i]=1===l.length?l[0]:l:s(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o},39046:function(e,t,n){"use strict";var r=n(14385),a=n.n(r),i=new URL(n(58394),n.b);a()(i)},14385:function(e){"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},92715:function(e,t,n){"use strict";var r=n(70248),a=n(79842);function i(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}e.exports.Type=n(35807),e.exports.Schema=n(54280),e.exports.FAILSAFE_SCHEMA=n(7942),e.exports.JSON_SCHEMA=n(14033),e.exports.CORE_SCHEMA=n(70856),e.exports.DEFAULT_SCHEMA=n(35706),e.exports.load=r.load,e.exports.loadAll=r.loadAll,e.exports.dump=a.dump,e.exports.YAMLException=n(42322),e.exports.types={binary:n(80435),float:n(78694),map:n(76706),null:n(67475),pairs:n(92145),set:n(86104),timestamp:n(86976),bool:n(20654),int:n(84697),merge:n(5895),omap:n(75071),seq:n(75979),str:n(3127)},e.exports.safeLoad=i("safeLoad","load"),e.exports.safeLoadAll=i("safeLoadAll","loadAll"),e.exports.safeDump=i("safeDump","dump")},71970:function(e){"use strict";function t(e){return null==e}e.exports.isNothing=t,e.exports.isObject=function(e){return"object"==typeof e&&null!==e},e.exports.toArray=function(e){return Array.isArray(e)?e:t(e)?[]:[e]},e.exports.repeat=function(e,t){var n,r="";for(n=0;n<t;n+=1)r+=e;return r},e.exports.isNegativeZero=function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},e.exports.extend=function(e,t){var n,r,a,i;if(t)for(n=0,r=(i=Object.keys(t)).length;n<r;n+=1)e[a=i[n]]=t[a];return e}},79842:function(e,t,n){"use strict";var r=n(71970),a=n(42322),i=n(35706),s=Object.prototype.toString,o=Object.prototype.hasOwnProperty,u=65279,l=9,c=10,d=13,p=32,h=33,f=34,m=35,g=37,b=38,y=39,v=42,_=44,w=45,P=58,O=61,A=62,C=63,T=64,I=91,E=93,x=96,j=123,M=124,k=125,S={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},R=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],N=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function L(e){var t,n,i;if(t=e.toString(16).toUpperCase(),e<=255)n="x",i=2;else if(e<=65535)n="u",i=4;else{if(!(e<=4294967295))throw new a("code point within a string may not be greater than 0xFFFFFFFF");n="U",i=8}return"\\"+n+r.repeat("0",i-t.length)+t}var D=2;function $(e){this.schema=e.schema||i,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=r.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var n,r,a,i,s,u,l;if(null===t)return{};for(n={},a=0,i=(r=Object.keys(t)).length;a<i;a+=1)s=r[a],u=String(t[s]),"!!"===s.slice(0,2)&&(s="tag:yaml.org,2002:"+s.slice(2)),(l=e.compiledTypeMap.fallback[s])&&o.call(l.styleAliases,u)&&(u=l.styleAliases[u]),n[s]=u;return n}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType='"'===e.quotingType?D:1,this.forceQuotes=e.forceQuotes||!1,this.replacer="function"==typeof e.replacer?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function F(e,t){for(var n,a=r.repeat(" ",t),i=0,s=-1,o="",u=e.length;i<u;)-1===(s=e.indexOf("\n",i))?(n=e.slice(i),i=u):(n=e.slice(i,s+1),i=s+1),n.length&&"\n"!==n&&(o+=a),o+=n;return o}function q(e,t){return"\n"+r.repeat(" ",e.indent*t)}function B(e){return e===p||e===l}function U(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&e!==u||65536<=e&&e<=1114111}function z(e){return U(e)&&e!==u&&e!==d&&e!==c}function V(e,t,n){var r=z(e),a=r&&!B(e);return(n?r:r&&e!==_&&e!==I&&e!==E&&e!==j&&e!==k)&&e!==m&&!(t===P&&!a)||z(t)&&!B(t)&&e===m||t===P&&a}function K(e,t){var n,r=e.charCodeAt(t);return r>=55296&&r<=56319&&t+1<e.length&&(n=e.charCodeAt(t+1))>=56320&&n<=57343?1024*(r-55296)+n-56320+65536:r}function Z(e){return/^\n* /.test(e)}var H=1,J=2,W=3,G=4,Q=5;function Y(e,t,n,r,i){e.dump=function(){if(0===t.length)return e.quotingType===D?'""':"''";if(!e.noCompatMode&&(-1!==R.indexOf(t)||N.test(t)))return e.quotingType===D?'"'+t+'"':"'"+t+"'";var s=e.indent*Math.max(1,n),o=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-s),l=r||e.flowLevel>-1&&n>=e.flowLevel;switch(function(e,t,n,r,a,i,s,o){var l,d,p=0,S=null,R=!1,N=!1,L=-1!==r,$=-1,F=U(d=K(e,0))&&d!==u&&!B(d)&&d!==w&&d!==C&&d!==P&&d!==_&&d!==I&&d!==E&&d!==j&&d!==k&&d!==m&&d!==b&&d!==v&&d!==h&&d!==M&&d!==O&&d!==A&&d!==y&&d!==f&&d!==g&&d!==T&&d!==x&&function(e){return!B(e)&&e!==P}(K(e,e.length-1));if(t||s)for(l=0;l<e.length;p>=65536?l+=2:l++){if(!U(p=K(e,l)))return Q;F=F&&V(p,S,o),S=p}else{for(l=0;l<e.length;p>=65536?l+=2:l++){if((p=K(e,l))===c)R=!0,L&&(N=N||l-$-1>r&&" "!==e[$+1],$=l);else if(!U(p))return Q;F=F&&V(p,S,o),S=p}N=N||L&&l-$-1>r&&" "!==e[$+1]}return R||N?n>9&&Z(e)?Q:s?i===D?Q:J:N?G:W:!F||s||a(e)?i===D?Q:J:H}(t,l,e.indent,o,(function(t){return function(e,t){var n,r;for(n=0,r=e.implicitTypes.length;n<r;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}(e,t)}),e.quotingType,e.forceQuotes&&!r,i)){case H:return t;case J:return"'"+t.replace(/'/g,"''")+"'";case W:return"|"+X(t,e.indent)+ee(F(t,s));case G:return">"+X(t,e.indent)+ee(F(function(e,t){for(var n,r,a,i=/(\n+)([^\n]*)/g,s=(a=-1!==(a=e.indexOf("\n"))?a:e.length,i.lastIndex=a,te(e.slice(0,a),t)),o="\n"===e[0]||" "===e[0];r=i.exec(e);){var u=r[1],l=r[2];n=" "===l[0],s+=u+(o||n||""===l?"":"\n")+te(l,t),o=n}return s}(t,o),s));case Q:return'"'+function(e){for(var t,n="",r=0,a=0;a<e.length;r>=65536?a+=2:a++)r=K(e,a),!(t=S[r])&&U(r)?(n+=e[a],r>=65536&&(n+=e[a+1])):n+=t||L(r);return n}(t)+'"';default:throw new a("impossible error: invalid scalar style")}}()}function X(e,t){var n=Z(e)?String(t):"",r="\n"===e[e.length-1];return n+(!r||"\n"!==e[e.length-2]&&"\n"!==e?r?"":"-":"+")+"\n"}function ee(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function te(e,t){if(""===e||" "===e[0])return e;for(var n,r,a=/ [^ ]/g,i=0,s=0,o=0,u="";n=a.exec(e);)(o=n.index)-i>t&&(r=s>i?s:o,u+="\n"+e.slice(i,r),i=r+1),s=o;return u+="\n",e.length-i>t&&s>i?u+=e.slice(i,s)+"\n"+e.slice(s+1):u+=e.slice(i),u.slice(1)}function ne(e,t,n,r){var a,i,s,o="",u=e.tag;for(a=0,i=n.length;a<i;a+=1)s=n[a],e.replacer&&(s=e.replacer.call(n,String(a),s)),(ae(e,t+1,s,!0,!0,!1,!0)||void 0===s&&ae(e,t+1,null,!0,!0,!1,!0))&&(r&&""===o||(o+=q(e,t)),e.dump&&c===e.dump.charCodeAt(0)?o+="-":o+="- ",o+=e.dump);e.tag=u,e.dump=o||"[]"}function re(e,t,n){var r,i,u,l,c,d;for(u=0,l=(i=n?e.explicitTypes:e.implicitTypes).length;u<l;u+=1)if(((c=i[u]).instanceOf||c.predicate)&&(!c.instanceOf||"object"==typeof t&&t instanceof c.instanceOf)&&(!c.predicate||c.predicate(t))){if(n?c.multi&&c.representName?e.tag=c.representName(t):e.tag=c.tag:e.tag="?",c.represent){if(d=e.styleMap[c.tag]||c.defaultStyle,"[object Function]"===s.call(c.represent))r=c.represent(t,d);else{if(!o.call(c.represent,d))throw new a("!<"+c.tag+'> tag resolver accepts not "'+d+'" style');r=c.represent[d](t,d)}e.dump=r}return!0}return!1}function ae(e,t,n,r,i,o,u){e.tag=null,e.dump=n,re(e,n,!1)||re(e,n,!0);var l,d=s.call(e.dump),p=r;r&&(r=e.flowLevel<0||e.flowLevel>t);var h,f,m="[object Object]"===d||"[object Array]"===d;if(m&&(f=-1!==(h=e.duplicates.indexOf(n))),(null!==e.tag&&"?"!==e.tag||f||2!==e.indent&&t>0)&&(i=!1),f&&e.usedDuplicates[h])e.dump="*ref_"+h;else{if(m&&f&&!e.usedDuplicates[h]&&(e.usedDuplicates[h]=!0),"[object Object]"===d)r&&0!==Object.keys(e.dump).length?(function(e,t,n,r){var i,s,o,u,l,d,p="",h=e.tag,f=Object.keys(n);if(!0===e.sortKeys)f.sort();else if("function"==typeof e.sortKeys)f.sort(e.sortKeys);else if(e.sortKeys)throw new a("sortKeys must be a boolean or a function");for(i=0,s=f.length;i<s;i+=1)d="",r&&""===p||(d+=q(e,t)),u=n[o=f[i]],e.replacer&&(u=e.replacer.call(n,o,u)),ae(e,t+1,o,!0,!0,!0)&&((l=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&c===e.dump.charCodeAt(0)?d+="?":d+="? "),d+=e.dump,l&&(d+=q(e,t)),ae(e,t+1,u,!0,l)&&(e.dump&&c===e.dump.charCodeAt(0)?d+=":":d+=": ",p+=d+=e.dump));e.tag=h,e.dump=p||"{}"}(e,t,e.dump,i),f&&(e.dump="&ref_"+h+e.dump)):(function(e,t,n){var r,a,i,s,o,u="",l=e.tag,c=Object.keys(n);for(r=0,a=c.length;r<a;r+=1)o="",""!==u&&(o+=", "),e.condenseFlow&&(o+='"'),s=n[i=c[r]],e.replacer&&(s=e.replacer.call(n,i,s)),ae(e,t,i,!1,!1)&&(e.dump.length>1024&&(o+="? "),o+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),ae(e,t,s,!1,!1)&&(u+=o+=e.dump));e.tag=l,e.dump="{"+u+"}"}(e,t,e.dump),f&&(e.dump="&ref_"+h+" "+e.dump));else if("[object Array]"===d)r&&0!==e.dump.length?(e.noArrayIndent&&!u&&t>0?ne(e,t-1,e.dump,i):ne(e,t,e.dump,i),f&&(e.dump="&ref_"+h+e.dump)):(function(e,t,n){var r,a,i,s="",o=e.tag;for(r=0,a=n.length;r<a;r+=1)i=n[r],e.replacer&&(i=e.replacer.call(n,String(r),i)),(ae(e,t,i,!1,!1)||void 0===i&&ae(e,t,null,!1,!1))&&(""!==s&&(s+=","+(e.condenseFlow?"":" ")),s+=e.dump);e.tag=o,e.dump="["+s+"]"}(e,t,e.dump),f&&(e.dump="&ref_"+h+" "+e.dump));else{if("[object String]"!==d){if("[object Undefined]"===d)return!1;if(e.skipInvalid)return!1;throw new a("unacceptable kind of an object to dump "+d)}"?"!==e.tag&&Y(e,e.dump,t,o,p)}null!==e.tag&&"?"!==e.tag&&(l=encodeURI("!"===e.tag[0]?e.tag.slice(1):e.tag).replace(/!/g,"%21"),l="!"===e.tag[0]?"!"+l:"tag:yaml.org,2002:"===l.slice(0,18)?"!!"+l.slice(18):"!<"+l+">",e.dump=l+" "+e.dump)}return!0}function ie(e,t){var n,r,a=[],i=[];for(se(e,a,i),n=0,r=i.length;n<r;n+=1)t.duplicates.push(a[i[n]]);t.usedDuplicates=new Array(r)}function se(e,t,n){var r,a,i;if(null!==e&&"object"==typeof e)if(-1!==(a=t.indexOf(e)))-1===n.indexOf(a)&&n.push(a);else if(t.push(e),Array.isArray(e))for(a=0,i=e.length;a<i;a+=1)se(e[a],t,n);else for(a=0,i=(r=Object.keys(e)).length;a<i;a+=1)se(e[r[a]],t,n)}e.exports.dump=function(e,t){var n=new $(t=t||{});n.noRefs||ie(e,n);var r=e;return n.replacer&&(r=n.replacer.call({"":r},"",r)),ae(n,0,r,!0,!0)?n.dump+"\n":""}},42322:function(e){"use strict";function t(e,t){var n="",r=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+="\n\n"+e.mark.snippet),r+" "+n):r}function n(e,n){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=n,this.message=t(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n.prototype.toString=function(e){return this.name+": "+t(this,e)},e.exports=n},70248:function(e,t,n){"use strict";var r=n(71970),a=n(42322),i=n(23822),s=n(35706),o=Object.prototype.hasOwnProperty,u=1,l=2,c=3,d=4,p=1,h=2,f=3,m=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,g=/[\x85\u2028\u2029]/,b=/[,\[\]\{\}]/,y=/^(?:!|!!|![a-z\-]+!)$/i,v=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function _(e){return Object.prototype.toString.call(e)}function w(e){return 10===e||13===e}function P(e){return 9===e||32===e}function O(e){return 9===e||32===e||10===e||13===e}function A(e){return 44===e||91===e||93===e||123===e||125===e}function C(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function T(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"Â…":95===e?"Â ":76===e?"\u2028":80===e?"\u2029":""}function I(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var E=new Array(256),x=new Array(256),j=0;j<256;j++)E[j]=T(j)?1:0,x[j]=T(j);function M(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||s,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function k(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=i(n),new a(t,n)}function S(e,t){throw k(e,t)}function R(e,t){e.onWarning&&e.onWarning.call(null,k(e,t))}var N={YAML:function(e,t,n){var r,a,i;null!==e.version&&S(e,"duplication of %YAML directive"),1!==n.length&&S(e,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&S(e,"ill-formed argument of the YAML directive"),a=parseInt(r[1],10),i=parseInt(r[2],10),1!==a&&S(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=i<2,1!==i&&2!==i&&R(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var r,a;2!==n.length&&S(e,"TAG directive accepts exactly two arguments"),r=n[0],a=n[1],y.test(r)||S(e,"ill-formed tag handle (first argument) of the TAG directive"),o.call(e.tagMap,r)&&S(e,'there is a previously declared suffix for "'+r+'" tag handle'),v.test(a)||S(e,"ill-formed tag prefix (second argument) of the TAG directive");try{a=decodeURIComponent(a)}catch(t){S(e,"tag prefix is malformed: "+a)}e.tagMap[r]=a}};function L(e,t,n,r){var a,i,s,o;if(t<n){if(o=e.input.slice(t,n),r)for(a=0,i=o.length;a<i;a+=1)9===(s=o.charCodeAt(a))||32<=s&&s<=1114111||S(e,"expected valid JSON character");else m.test(o)&&S(e,"the stream contains non-printable characters");e.result+=o}}function D(e,t,n,a){var i,s,u,l;for(r.isObject(n)||S(e,"cannot merge mappings; the provided source object is unacceptable"),u=0,l=(i=Object.keys(n)).length;u<l;u+=1)s=i[u],o.call(t,s)||(t[s]=n[s],a[s]=!0)}function $(e,t,n,r,a,i,s,u,l){var c,d;if(Array.isArray(a))for(c=0,d=(a=Array.prototype.slice.call(a)).length;c<d;c+=1)Array.isArray(a[c])&&S(e,"nested arrays are not supported inside keys"),"object"==typeof a&&"[object Object]"===_(a[c])&&(a[c]="[object Object]");if("object"==typeof a&&"[object Object]"===_(a)&&(a="[object Object]"),a=String(a),null===t&&(t={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(i))for(c=0,d=i.length;c<d;c+=1)D(e,t,i[c],n);else D(e,t,i,n);else e.json||o.call(n,a)||!o.call(t,a)||(e.line=s||e.line,e.lineStart=u||e.lineStart,e.position=l||e.position,S(e,"duplicated mapping key")),"__proto__"===a?Object.defineProperty(t,a,{configurable:!0,enumerable:!0,writable:!0,value:i}):t[a]=i,delete n[a];return t}function F(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):S(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function q(e,t,n){for(var r=0,a=e.input.charCodeAt(e.position);0!==a;){for(;P(a);)9===a&&-1===e.firstTabInLine&&(e.firstTabInLine=e.position),a=e.input.charCodeAt(++e.position);if(t&&35===a)do{a=e.input.charCodeAt(++e.position)}while(10!==a&&13!==a&&0!==a);if(!w(a))break;for(F(e),a=e.input.charCodeAt(e.position),r++,e.lineIndent=0;32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position)}return-1!==n&&0!==r&&e.lineIndent<n&&R(e,"deficient indentation"),r}function B(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!O(t)))}function U(e,t){1===t?e.result+=" ":t>1&&(e.result+=r.repeat("\n",t-1))}function z(e,t){var n,r,a=e.tag,i=e.anchor,s=[],o=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=s),r=e.input.charCodeAt(e.position);0!==r&&(-1!==e.firstTabInLine&&(e.position=e.firstTabInLine,S(e,"tab characters must not be used in indentation")),45===r)&&O(e.input.charCodeAt(e.position+1));)if(o=!0,e.position++,q(e,!0,-1)&&e.lineIndent<=t)s.push(null),r=e.input.charCodeAt(e.position);else if(n=e.line,Z(e,t,c,!1,!0),s.push(e.result),q(e,!0,-1),r=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==r)S(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!o&&(e.tag=a,e.anchor=i,e.kind="sequence",e.result=s,!0)}function V(e){var t,n,r,a,i=!1,s=!1;if(33!==(a=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&S(e,"duplication of a tag property"),60===(a=e.input.charCodeAt(++e.position))?(i=!0,a=e.input.charCodeAt(++e.position)):33===a?(s=!0,n="!!",a=e.input.charCodeAt(++e.position)):n="!",t=e.position,i){do{a=e.input.charCodeAt(++e.position)}while(0!==a&&62!==a);e.position<e.length?(r=e.input.slice(t,e.position),a=e.input.charCodeAt(++e.position)):S(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==a&&!O(a);)33===a&&(s?S(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),y.test(n)||S(e,"named tag handle cannot contain such characters"),s=!0,t=e.position+1)),a=e.input.charCodeAt(++e.position);r=e.input.slice(t,e.position),b.test(r)&&S(e,"tag suffix cannot contain flow indicator characters")}r&&!v.test(r)&&S(e,"tag name cannot contain such characters: "+r);try{r=decodeURIComponent(r)}catch(t){S(e,"tag name is malformed: "+r)}return i?e.tag=r:o.call(e.tagMap,n)?e.tag=e.tagMap[n]+r:"!"===n?e.tag="!"+r:"!!"===n?e.tag="tag:yaml.org,2002:"+r:S(e,'undeclared tag handle "'+n+'"'),!0}function K(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&S(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!O(n)&&!A(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&S(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function Z(e,t,n,a,i){var s,m,g,b,y,v,_,T,j,M=1,k=!1,R=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,s=m=g=d===n||c===n,a&&q(e,!0,-1)&&(k=!0,e.lineIndent>t?M=1:e.lineIndent===t?M=0:e.lineIndent<t&&(M=-1)),1===M)for(;V(e)||K(e);)q(e,!0,-1)?(k=!0,g=s,e.lineIndent>t?M=1:e.lineIndent===t?M=0:e.lineIndent<t&&(M=-1)):g=!1;if(g&&(g=k||i),1!==M&&d!==n||(T=u===n||l===n?t:t+1,j=e.position-e.lineStart,1===M?g&&(z(e,j)||function(e,t,n){var r,a,i,s,o,u,c,p=e.tag,h=e.anchor,f={},m=Object.create(null),g=null,b=null,y=null,v=!1,_=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=f),c=e.input.charCodeAt(e.position);0!==c;){if(v||-1===e.firstTabInLine||(e.position=e.firstTabInLine,S(e,"tab characters must not be used in indentation")),r=e.input.charCodeAt(e.position+1),i=e.line,63!==c&&58!==c||!O(r)){if(s=e.line,o=e.lineStart,u=e.position,!Z(e,n,l,!1,!0))break;if(e.line===i){for(c=e.input.charCodeAt(e.position);P(c);)c=e.input.charCodeAt(++e.position);if(58===c)O(c=e.input.charCodeAt(++e.position))||S(e,"a whitespace character is expected after the key-value separator within a block mapping"),v&&($(e,f,m,g,b,null,s,o,u),g=b=y=null),_=!0,v=!1,a=!1,g=e.tag,b=e.result;else{if(!_)return e.tag=p,e.anchor=h,!0;S(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!_)return e.tag=p,e.anchor=h,!0;S(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===c?(v&&($(e,f,m,g,b,null,s,o,u),g=b=y=null),_=!0,v=!0,a=!0):v?(v=!1,a=!0):S(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,c=r;if((e.line===i||e.lineIndent>t)&&(v&&(s=e.line,o=e.lineStart,u=e.position),Z(e,t,d,!0,a)&&(v?b=e.result:y=e.result),v||($(e,f,m,g,b,y,s,o,u),g=b=y=null),q(e,!0,-1),c=e.input.charCodeAt(e.position)),(e.line===i||e.lineIndent>t)&&0!==c)S(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return v&&$(e,f,m,g,b,null,s,o,u),_&&(e.tag=p,e.anchor=h,e.kind="mapping",e.result=f),_}(e,j,T))||function(e,t){var n,r,a,i,s,o,l,c,d,p,h,f,m=!0,g=e.tag,b=e.anchor,y=Object.create(null);if(91===(f=e.input.charCodeAt(e.position)))s=93,c=!1,i=[];else{if(123!==f)return!1;s=125,c=!0,i={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=i),f=e.input.charCodeAt(++e.position);0!==f;){if(q(e,!0,t),(f=e.input.charCodeAt(e.position))===s)return e.position++,e.tag=g,e.anchor=b,e.kind=c?"mapping":"sequence",e.result=i,!0;m?44===f&&S(e,"expected the node content, but found ','"):S(e,"missed comma between flow collection entries"),h=null,o=l=!1,63===f&&O(e.input.charCodeAt(e.position+1))&&(o=l=!0,e.position++,q(e,!0,t)),n=e.line,r=e.lineStart,a=e.position,Z(e,t,u,!1,!0),p=e.tag,d=e.result,q(e,!0,t),f=e.input.charCodeAt(e.position),!l&&e.line!==n||58!==f||(o=!0,f=e.input.charCodeAt(++e.position),q(e,!0,t),Z(e,t,u,!1,!0),h=e.result),c?$(e,i,y,p,d,h,n,r,a):o?i.push($(e,null,y,p,d,h,n,r,a)):i.push(d),q(e,!0,t),44===(f=e.input.charCodeAt(e.position))?(m=!0,f=e.input.charCodeAt(++e.position)):m=!1}S(e,"unexpected end of the stream within a flow collection")}(e,T)?R=!0:(m&&function(e,t){var n,a,i,s,o,u=p,l=!1,c=!1,d=t,m=0,g=!1;if(124===(s=e.input.charCodeAt(e.position)))a=!1;else{if(62!==s)return!1;a=!0}for(e.kind="scalar",e.result="";0!==s;)if(43===(s=e.input.charCodeAt(++e.position))||45===s)p===u?u=43===s?f:h:S(e,"repeat of a chomping mode identifier");else{if(!((i=48<=(o=s)&&o<=57?o-48:-1)>=0))break;0===i?S(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):c?S(e,"repeat of an indentation width identifier"):(d=t+i-1,c=!0)}if(P(s)){do{s=e.input.charCodeAt(++e.position)}while(P(s));if(35===s)do{s=e.input.charCodeAt(++e.position)}while(!w(s)&&0!==s)}for(;0!==s;){for(F(e),e.lineIndent=0,s=e.input.charCodeAt(e.position);(!c||e.lineIndent<d)&&32===s;)e.lineIndent++,s=e.input.charCodeAt(++e.position);if(!c&&e.lineIndent>d&&(d=e.lineIndent),w(s))m++;else{if(e.lineIndent<d){u===f?e.result+=r.repeat("\n",l?1+m:m):u===p&&l&&(e.result+="\n");break}for(a?P(s)?(g=!0,e.result+=r.repeat("\n",l?1+m:m)):g?(g=!1,e.result+=r.repeat("\n",m+1)):0===m?l&&(e.result+=" "):e.result+=r.repeat("\n",m):e.result+=r.repeat("\n",l?1+m:m),l=!0,c=!0,m=0,n=e.position;!w(s)&&0!==s;)s=e.input.charCodeAt(++e.position);L(e,n,e.position,!1)}}return!0}(e,T)||function(e,t){var n,r,a;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=a=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(L(e,r,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;r=e.position,e.position++,a=e.position}else w(n)?(L(e,r,a,!0),U(e,q(e,!1,t)),r=a=e.position):e.position===e.lineStart&&B(e)?S(e,"unexpected end of the document within a single quoted scalar"):(e.position++,a=e.position);S(e,"unexpected end of the stream within a single quoted scalar")}(e,T)||function(e,t){var n,r,a,i,s,o,u;if(34!==(o=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=r=e.position;0!==(o=e.input.charCodeAt(e.position));){if(34===o)return L(e,n,e.position,!0),e.position++,!0;if(92===o){if(L(e,n,e.position,!0),w(o=e.input.charCodeAt(++e.position)))q(e,!1,t);else if(o<256&&E[o])e.result+=x[o],e.position++;else if((s=120===(u=o)?2:117===u?4:85===u?8:0)>0){for(a=s,i=0;a>0;a--)(s=C(o=e.input.charCodeAt(++e.position)))>=0?i=(i<<4)+s:S(e,"expected hexadecimal character");e.result+=I(i),e.position++}else S(e,"unknown escape sequence");n=r=e.position}else w(o)?(L(e,n,r,!0),U(e,q(e,!1,t)),n=r=e.position):e.position===e.lineStart&&B(e)?S(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}S(e,"unexpected end of the stream within a double quoted scalar")}(e,T)?R=!0:function(e){var t,n,r;if(42!==(r=e.input.charCodeAt(e.position)))return!1;for(r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!O(r)&&!A(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&S(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),o.call(e.anchorMap,n)||S(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],q(e,!0,-1),!0}(e)?(R=!0,null===e.tag&&null===e.anchor||S(e,"alias node should not have any properties")):function(e,t,n){var r,a,i,s,o,u,l,c,d=e.kind,p=e.result;if(O(c=e.input.charCodeAt(e.position))||A(c)||35===c||38===c||42===c||33===c||124===c||62===c||39===c||34===c||37===c||64===c||96===c)return!1;if((63===c||45===c)&&(O(r=e.input.charCodeAt(e.position+1))||n&&A(r)))return!1;for(e.kind="scalar",e.result="",a=i=e.position,s=!1;0!==c;){if(58===c){if(O(r=e.input.charCodeAt(e.position+1))||n&&A(r))break}else if(35===c){if(O(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&B(e)||n&&A(c))break;if(w(c)){if(o=e.line,u=e.lineStart,l=e.lineIndent,q(e,!1,-1),e.lineIndent>=t){s=!0,c=e.input.charCodeAt(e.position);continue}e.position=i,e.line=o,e.lineStart=u,e.lineIndent=l;break}}s&&(L(e,a,i,!1),U(e,e.line-o),a=i=e.position,s=!1),P(c)||(i=e.position+1),c=e.input.charCodeAt(++e.position)}return L(e,a,i,!1),!!e.result||(e.kind=d,e.result=p,!1)}(e,T,u===n)&&(R=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===M&&(R=g&&z(e,j))),null===e.tag)null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);else if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&S(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),b=0,y=e.implicitTypes.length;b<y;b+=1)if((_=e.implicitTypes[b]).resolve(e.result)){e.result=_.construct(e.result),e.tag=_.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else if("!"!==e.tag){if(o.call(e.typeMap[e.kind||"fallback"],e.tag))_=e.typeMap[e.kind||"fallback"][e.tag];else for(_=null,b=0,y=(v=e.typeMap.multi[e.kind||"fallback"]).length;b<y;b+=1)if(e.tag.slice(0,v[b].tag.length)===v[b].tag){_=v[b];break}_||S(e,"unknown tag !<"+e.tag+">"),null!==e.result&&_.kind!==e.kind&&S(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+_.kind+'", not "'+e.kind+'"'),_.resolve(e.result,e.tag)?(e.result=_.construct(e.result,e.tag),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):S(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||R}function H(e){var t,n,r,a,i=e.position,s=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);0!==(a=e.input.charCodeAt(e.position))&&(q(e,!0,-1),a=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==a));){for(s=!0,a=e.input.charCodeAt(++e.position),t=e.position;0!==a&&!O(a);)a=e.input.charCodeAt(++e.position);for(r=[],(n=e.input.slice(t,e.position)).length<1&&S(e,"directive name must not be less than one character in length");0!==a;){for(;P(a);)a=e.input.charCodeAt(++e.position);if(35===a){do{a=e.input.charCodeAt(++e.position)}while(0!==a&&!w(a));break}if(w(a))break;for(t=e.position;0!==a&&!O(a);)a=e.input.charCodeAt(++e.position);r.push(e.input.slice(t,e.position))}0!==a&&F(e),o.call(N,n)?N[n](e,n,r):R(e,'unknown document directive "'+n+'"')}q(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,q(e,!0,-1)):s&&S(e,"directives end mark is expected"),Z(e,e.lineIndent-1,d,!1,!0),q(e,!0,-1),e.checkLineBreaks&&g.test(e.input.slice(i,e.position))&&R(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&B(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,q(e,!0,-1)):e.position<e.length-1&&S(e,"end of the stream or a document separator is expected")}function J(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new M(e,t),r=e.indexOf("\0");for(-1!==r&&(n.position=r,S(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)H(n);return n.documents}e.exports.loadAll=function(e,t,n){null!==t&&"object"==typeof t&&void 0===n&&(n=t,t=null);var r=J(e,n);if("function"!=typeof t)return r;for(var a=0,i=r.length;a<i;a+=1)t(r[a])},e.exports.load=function(e,t){var n=J(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new a("expected a single document in the stream, but found more")}}},54280:function(e,t,n){"use strict";var r=n(42322),a=n(35807);function i(e,t){var n=[];return e[t].forEach((function(e){var t=n.length;n.forEach((function(n,r){n.tag===e.tag&&n.kind===e.kind&&n.multi===e.multi&&(t=r)})),n[t]=e})),n}function s(e){return this.extend(e)}s.prototype.extend=function(e){var t=[],n=[];if(e instanceof a)n.push(e);else if(Array.isArray(e))n=n.concat(e);else{if(!e||!Array.isArray(e.implicit)&&!Array.isArray(e.explicit))throw new r("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(n=n.concat(e.explicit))}t.forEach((function(e){if(!(e instanceof a))throw new r("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(e.loadKind&&"scalar"!==e.loadKind)throw new r("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(e.multi)throw new r("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),n.forEach((function(e){if(!(e instanceof a))throw new r("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var o=Object.create(s.prototype);return o.implicit=(this.implicit||[]).concat(t),o.explicit=(this.explicit||[]).concat(n),o.compiledImplicit=i(o,"implicit"),o.compiledExplicit=i(o,"explicit"),o.compiledTypeMap=function(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function r(e){e.multi?(n.multi[e.kind].push(e),n.multi.fallback.push(e)):n[e.kind][e.tag]=n.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}(o.compiledImplicit,o.compiledExplicit),o},e.exports=s},70856:function(e,t,n){"use strict";e.exports=n(14033)},35706:function(e,t,n){"use strict";e.exports=n(70856).extend({implicit:[n(86976),n(5895)],explicit:[n(80435),n(75071),n(92145),n(86104)]})},7942:function(e,t,n){"use strict";var r=n(54280);e.exports=new r({explicit:[n(3127),n(75979),n(76706)]})},14033:function(e,t,n){"use strict";e.exports=n(7942).extend({implicit:[n(67475),n(20654),n(84697),n(78694)]})},23822:function(e,t,n){"use strict";var r=n(71970);function a(e,t,n,r,a){var i="",s="",o=Math.floor(a/2)-1;return r-t>o&&(t=r-o+(i=" ... ").length),n-r>o&&(n=r+o-(s=" ...").length),{str:i+e.slice(t,n).replace(/\t/g,"â†’")+s,pos:r-t+i.length}}function i(e,t){return r.repeat(" ",t-e.length)+e}e.exports=function(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),"number"!=typeof t.indent&&(t.indent=1),"number"!=typeof t.linesBefore&&(t.linesBefore=3),"number"!=typeof t.linesAfter&&(t.linesAfter=2);for(var n,s=/\r?\n|\r|\0/g,o=[0],u=[],l=-1;n=s.exec(e.buffer);)u.push(n.index),o.push(n.index+n[0].length),e.position<=n.index&&l<0&&(l=o.length-2);l<0&&(l=o.length-1);var c,d,p="",h=Math.min(e.line+t.linesAfter,u.length).toString().length,f=t.maxLength-(t.indent+h+3);for(c=1;c<=t.linesBefore&&!(l-c<0);c++)d=a(e.buffer,o[l-c],u[l-c],e.position-(o[l]-o[l-c]),f),p=r.repeat(" ",t.indent)+i((e.line-c+1).toString(),h)+" | "+d.str+"\n"+p;for(d=a(e.buffer,o[l],u[l],e.position,f),p+=r.repeat(" ",t.indent)+i((e.line+1).toString(),h)+" | "+d.str+"\n",p+=r.repeat("-",t.indent+h+3+d.pos)+"^\n",c=1;c<=t.linesAfter&&!(l+c>=u.length);c++)d=a(e.buffer,o[l+c],u[l+c],e.position-(o[l]-o[l+c]),f),p+=r.repeat(" ",t.indent)+i((e.line+c+1).toString(),h)+" | "+d.str+"\n";return p.replace(/\n$/,"")}},35807:function(e,t,n){"use strict";var r=n(42322),a=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],i=["scalar","sequence","mapping"];e.exports=function(e,t){var n,s;if(t=t||{},Object.keys(t).forEach((function(t){if(-1===a.indexOf(t))throw new r('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')})),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=(n=t.styleAliases||null,s={},null!==n&&Object.keys(n).forEach((function(e){n[e].forEach((function(t){s[String(t)]=e}))})),s),-1===i.indexOf(this.kind))throw new r('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}},80435:function(e,t,n){"use strict";var r=n(35807),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";e.exports=new r("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,r=0,i=e.length,s=a;for(n=0;n<i;n++)if(!((t=s.indexOf(e.charAt(n)))>64)){if(t<0)return!1;r+=6}return r%8==0},construct:function(e){var t,n,r=e.replace(/[\r\n=]/g,""),i=r.length,s=a,o=0,u=[];for(t=0;t<i;t++)t%4==0&&t&&(u.push(o>>16&255),u.push(o>>8&255),u.push(255&o)),o=o<<6|s.indexOf(r.charAt(t));return 0==(n=i%4*6)?(u.push(o>>16&255),u.push(o>>8&255),u.push(255&o)):18===n?(u.push(o>>10&255),u.push(o>>2&255)):12===n&&u.push(o>>4&255),new Uint8Array(u)},predicate:function(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)},represent:function(e){var t,n,r="",i=0,s=e.length,o=a;for(t=0;t<s;t++)t%3==0&&t&&(r+=o[i>>18&63],r+=o[i>>12&63],r+=o[i>>6&63],r+=o[63&i]),i=(i<<8)+e[t];return 0==(n=s%3)?(r+=o[i>>18&63],r+=o[i>>12&63],r+=o[i>>6&63],r+=o[63&i]):2===n?(r+=o[i>>10&63],r+=o[i>>4&63],r+=o[i<<2&63],r+=o[64]):1===n&&(r+=o[i>>2&63],r+=o[i<<4&63],r+=o[64],r+=o[64]),r}})},20654:function(e,t,n){"use strict";var r=n(35807);e.exports=new r("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"})},78694:function(e,t,n){"use strict";var r=n(71970),a=n(35807),i=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),s=/^[-+]?[0-9]+e/;e.exports=new a("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!i.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n;return n="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||r.isNegativeZero(e))},represent:function(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(r.isNegativeZero(e))return"-0.0";return n=e.toString(10),s.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"})},84697:function(e,t,n){"use strict";var r=n(71970),a=n(35807);function i(e){return 48<=e&&e<=55}function s(e){return 48<=e&&e<=57}e.exports=new a("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,r=e.length,a=0,o=!1;if(!r)return!1;if("-"!==(t=e[a])&&"+"!==t||(t=e[++a]),"0"===t){if(a+1===r)return!0;if("b"===(t=e[++a])){for(a++;a<r;a++)if("_"!==(t=e[a])){if("0"!==t&&"1"!==t)return!1;o=!0}return o&&"_"!==t}if("x"===t){for(a++;a<r;a++)if("_"!==(t=e[a])){if(!(48<=(n=e.charCodeAt(a))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;o=!0}return o&&"_"!==t}if("o"===t){for(a++;a<r;a++)if("_"!==(t=e[a])){if(!i(e.charCodeAt(a)))return!1;o=!0}return o&&"_"!==t}}if("_"===t)return!1;for(;a<r;a++)if("_"!==(t=e[a])){if(!s(e.charCodeAt(a)))return!1;o=!0}return!(!o||"_"===t)},construct:function(e){var t,n=e,r=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(t=n[0])&&"+"!==t||("-"===t&&(r=-1),t=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===t){if("b"===n[1])return r*parseInt(n.slice(2),2);if("x"===n[1])return r*parseInt(n.slice(2),16);if("o"===n[1])return r*parseInt(n.slice(2),8)}return r*parseInt(n,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!r.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},76706:function(e,t,n){"use strict";var r=n(35807);e.exports=new r("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})},5895:function(e,t,n){"use strict";var r=n(35807);e.exports=new r("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}})},67475:function(e,t,n){"use strict";var r=n(35807);e.exports=new r("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"})},75071:function(e,t,n){"use strict";var r=n(35807),a=Object.prototype.hasOwnProperty,i=Object.prototype.toString;e.exports=new r("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,r,s,o,u=[],l=e;for(t=0,n=l.length;t<n;t+=1){if(r=l[t],o=!1,"[object Object]"!==i.call(r))return!1;for(s in r)if(a.call(r,s)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==u.indexOf(s))return!1;u.push(s)}return!0},construct:function(e){return null!==e?e:[]}})},92145:function(e,t,n){"use strict";var r=n(35807),a=Object.prototype.toString;e.exports=new r("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,r,i,s,o=e;for(s=new Array(o.length),t=0,n=o.length;t<n;t+=1){if(r=o[t],"[object Object]"!==a.call(r))return!1;if(1!==(i=Object.keys(r)).length)return!1;s[t]=[i[0],r[i[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,r,a,i,s=e;for(i=new Array(s.length),t=0,n=s.length;t<n;t+=1)r=s[t],a=Object.keys(r),i[t]=[a[0],r[a[0]]];return i}})},75979:function(e,t,n){"use strict";var r=n(35807);e.exports=new r("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}})},86104:function(e,t,n){"use strict";var r=n(35807),a=Object.prototype.hasOwnProperty;e.exports=new r("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(a.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}})},3127:function(e,t,n){"use strict";var r=n(35807);e.exports=new r("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}})},86976:function(e,t,n){"use strict";var r=n(35807),a=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),i=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");e.exports=new r("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==a.exec(e)||null!==i.exec(e))},construct:function(e){var t,n,r,s,o,u,l,c,d=0,p=null;if(null===(t=a.exec(e))&&(t=i.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],r=+t[2]-1,s=+t[3],!t[4])return new Date(Date.UTC(n,r,s));if(o=+t[4],u=+t[5],l=+t[6],t[7]){for(d=t[7].slice(0,3);d.length<3;)d+="0";d=+d}return t[9]&&(p=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(p=-p)),c=new Date(Date.UTC(n,r,s,o,u,l,d)),p&&c.setTime(c.getTime()-p),c},instanceOf:Date,represent:function(e){return e.toISOString()}})},31460:function(e,t,n){"use strict";n.r(t),n.d(t,{distance:function(){return r},similarity:function(){return i}});var r={};n.r(r),n.d(r,{additiveSymmetric:function(){return u},avg:function(){return l},bhattacharyya:function(){return c},canberra:function(){return d},chebyshev:function(){return p},clark:function(){return h},czekanowski:function(){return m},dice:function(){return g},divergence:function(){return b},euclidean:function(){return o},fidelity:function(){return y},gower:function(){return v},harmonicMean:function(){return _},hellinger:function(){return w},innerProduct:function(){return P},intersection:function(){return O},jaccard:function(){return C},jeffreys:function(){return T},jensenDifference:function(){return I},jensenShannon:function(){return E},kdivergence:function(){return x},kulczynski:function(){return j},kullbackLeibler:function(){return M},kumarJohnson:function(){return k},lorentzian:function(){return S},manhattan:function(){return R},matusita:function(){return N},minkowski:function(){return L},motyka:function(){return D},neyman:function(){return $},pearson:function(){return F},probabilisticSymmetric:function(){return q},ruzicka:function(){return B},soergel:function(){return U},sorensen:function(){return z},squared:function(){return V},squaredChord:function(){return K},squaredEuclidean:function(){return s},taneja:function(){return Z},tanimoto:function(){return J},topsoe:function(){return W},waveHedges:function(){return G}});var a={};n.r(a),n.d(a,{createTree:function(){return ee},getFunction:function(){return ie},treeSimilarity:function(){return ae}});var i={};function s(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r]);return n}function o(e,t){return Math.sqrt(s(e,t))}function u(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r])*(e[r]+t[r])/(e[r]*t[r]);return n}function l(e,t){let n=0,r=0,a=0;for(let i=0;i<e.length;i++)a=Math.abs(e[i]-t[i]),r+=a,n<a&&(n=a);return(n+r)/2}function c(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.sqrt(e[r]*t[r]);return-Math.log(n)}function d(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.abs(e[r]-t[r])/(e[r]+t[r]);return n}function p(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)r=Math.abs(e[a]-t[a]),n<r&&(n=r);return n}function h(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(Math.abs(e[r]-t[r])/(e[r]+t[r]))**2;return Math.sqrt(n)}function f(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)n+=Math.min(e[a],t[a]),r+=e[a]+t[a];return 2*n/r}function m(e,t){return 1-f(e,t)}function g(e,t){let n=0,r=0,a=0;for(let i=0;i<e.length;i++)n+=e[i]*e[i],r+=t[i]*t[i],a+=(e[i]-t[i])*(e[i]-t[i]);return a/(n+r)}function b(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r])/((e[r]+t[r])*(e[r]+t[r]));return 2*n}function y(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.sqrt(e[r]*t[r]);return n}function v(e,t){const n=e.length;let r=0;for(let n=0;n<e.length;n++)r+=Math.abs(e[n]-t[n]);return r/n}function _(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r]/(e[r]+t[r]);return 2*n}function w(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.sqrt(e[r]*t[r]);return 2*Math.sqrt(1-n)}function P(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}function O(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.min(e[r],t[r]);return 1-n}function A(e,t){let n=0,r=0,a=0;for(let i=0;i<e.length;i++)n+=e[i]*t[i],r+=e[i]*e[i],a+=t[i]*t[i];return n/(r+a-n)}function C(e,t){return 1-A(e,t)}function T(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*Math.log(e[r]/t[r]);return n}function I(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]*Math.log(e[r])+t[r]*Math.log(t[r]))/2-(e[r]+t[r])/2*Math.log((e[r]+t[r])/2);return n}function E(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)n+=e[a]*Math.log(2*e[a]/(e[a]+t[a])),r+=t[a]*Math.log(2*t[a]/(e[a]+t[a]));return(n+r)/2}function x(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*Math.log(2*e[r]/(e[r]+t[r]));return n}function j(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)n+=Math.abs(e[a]-t[a]),r+=Math.min(e[a],t[a]);return n/r}function M(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*Math.log(e[r]/t[r]);return n}function k(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]*e[r]-t[r]*t[r])**2/(2*(e[r]*t[r])**1.5);return n}function S(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.log(Math.abs(e[r]-t[r])+1);return n}function R(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.abs(e[r]-t[r]);return n}function N(e,t){let n=0;for(let r=0;r<e.length;r++)n+=Math.sqrt(e[r]*t[r]);return Math.sqrt(2-2*n)}function L(e,t,n){let r=0;for(let a=0;a<e.length;a++)r+=Math.abs(e[a]-t[a])**n;return r**(1/n)}function D(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)n+=Math.min(e[a],t[a]),r+=e[a]+t[a];return 1-n/r}function $(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r])/e[r];return n}function F(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r])/t[r];return n}function q(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r])/(e[r]+t[r]);return 2*n}function B(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)n+=Math.min(e[a],t[a]),r+=Math.max(e[a],t[a]);return n/r}function U(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)n+=Math.abs(e[a]-t[a]),r+=Math.max(e[a],t[a]);return n/r}function z(e,t){let n=0,r=0;for(let a=0;a<e.length;a++)n+=Math.abs(e[a]-t[a]),r+=e[a]+t[a];return n/r}function V(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]-t[r])*(e[r]-t[r])/(e[r]+t[r]);return n}function K(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(Math.sqrt(e[r])-Math.sqrt(t[r]))**2;return n}function Z(e,t){let n=0;for(let r=0;r<e.length;r++)n+=(e[r]+t[r])/2*Math.log((e[r]+t[r])/(2*Math.sqrt(e[r]*t[r])));return n}function H(e,t,n){if(n){let n=0,r=0;for(let a=0;a<e.length;a++)n+=e[a]&&t[a],r+=e[a]||t[a];return 0===r?1:n/r}{let n=0,r=0,a=0;for(let i=0;i<e.length;i++)n+=e[i],r+=t[i],a+=Math.min(e[i],t[i]);return 1-(n+r-2*a)/(n+r-a)}}function J(e,t,n){if(n)return 1-H(e,t,n);{let n=0,r=0,a=0;for(let i=0;i<e.length;i++)n+=e[i],r+=t[i],a+=Math.min(e[i],t[i]);return(n+r-2*a)/(n+r-a)}}function W(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*Math.log(2*e[r]/(e[r]+t[r]))+t[r]*Math.log(2*t[r]/(e[r]+t[r]));return n}function G(e,t){let n=0;for(let r=0;r<e.length;r++)n+=1-Math.min(e[r],t[r])/Math.max(e[r],t[r]);return n}n.r(i),n.d(i,{cosine:function(){return se},czekanowski:function(){return f},dice:function(){return oe},intersection:function(){return ue},kulczynski:function(){return le},kumarHassebrook:function(){return A},motyka:function(){return ce},pearson:function(){return he},squaredChord:function(){return fe},tanimoto:function(){return H},tree:function(){return a}});var Q=n(7983),Y=n.n(Q),X=n(15534);function ee(e,t={}){var n=e[0];const{minWindow:r=.16,threshold:a=.01,from:i=n[0],to:s=n[n.length-1]}=t;return te(e[0],e[1],i,s,r,a)}function te(e,t,n,r,a,i){if(r-n<a)return null;var s=Y()(e,n,X.V);s<0&&(s=~s);for(var o=0,u=0,l=s;l<e.length&&!(e[l]>=r);l++)o+=t[l],u+=e[l]*t[l];return o<i||(u/=o)-n<1e-6||r-u<1e-6?null:u-n<a/4?te(e,t,u,r,a,i):r-u<a/4?te(e,t,n,u,a,i):new ne(o,u,te(e,t,n,u,a,i),te(e,t,u,r,a,i))}class ne{constructor(e,t,n,r){this.sum=e,this.center=t,this.left=n,this.right=r}}function re(e,t,n={}){const{alpha:r=.1,beta:a=.33,gamma:i=.001}=n;return null===e||null===t?0:(Array.isArray(e)&&(e=ee(e)),Array.isArray(t)&&(t=ee(t)),a*(r*Math.min(e.sum,t.sum)/Math.max(e.sum,t.sum)+(1-r)*Math.exp(-i*Math.abs(e.center-t.center)))+(1-a)*(re(e.left,t.left,n)+re(e.right,t.right,n))/2)}function ae(e,t,n={}){return re(e,t,n)}function ie(e={}){return(t,n)=>re(t,n,e)}function se(e,t){let n=0,r=0,a=0;for(let i=0;i<e.length;i++)n+=e[i]*t[i],r+=e[i]*e[i],a+=t[i]*t[i];return n/(Math.sqrt(r)*Math.sqrt(a))}function oe(e,t){return 1-g(e,t)}function ue(e,t){return 1-O(e,t)}function le(e,t){return 1/j(e,t)}function ce(e,t){return 1-D(e,t)}const de=Object.prototype.toString;function pe(e){return function(e){if(!function(e){const t=de.call(e);return t.endsWith("Array]")&&!t.includes("Big")}(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}(e)/e.length}function he(e,t){let n=pe(e),r=pe(t),a=new Array(e.length),i=new Array(t.length);for(let s=0;s<a.length;s++)a[s]=e[s]-n,i[s]=t[s]-r;return se(a,i)}function fe(e,t){return 1-K(e,t)}},57965:function(e){e.exports=function(){"use strict";var e=Object.prototype.toString,t=Array.isArray||function(t){return"[object Array]"===e.call(t)};function n(e){return"function"==typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(e,t){return null!=e&&"object"==typeof e&&t in e}var i=RegExp.prototype.test;var s=/\S/;function o(e){return!function(e,t){return i.call(e,t)}(s,e)}var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var l=/\s*/,c=/\s+/,d=/\s*=/,p=/\s*\}/,h=/#|\^|\/|>|\{|&|=|!/;function f(e){this.string=e,this.tail=e,this.pos=0}function m(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function g(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}f.prototype.eos=function(){return""===this.tail},f.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},f.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},m.prototype.push=function(e){return new m(e,this)},m.prototype.lookup=function(e){var t,r,i,s=this.cache;if(s.hasOwnProperty(e))t=s[e];else{for(var o,u,l,c=this,d=!1;c;){if(e.indexOf(".")>0)for(o=c.view,u=e.split("."),l=0;null!=o&&l<u.length;)l===u.length-1&&(d=a(o,u[l])||(r=o,i=u[l],null!=r&&"object"!=typeof r&&r.hasOwnProperty&&r.hasOwnProperty(i))),o=o[u[l++]];else o=c.view[e],d=a(c.view,e);if(d){t=o;break}c=c.parent}s[e]=t}return n(t)&&(t=t.call(this.view)),t},g.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},g.prototype.parse=function(e,n){var a=this.templateCache,i=e+":"+(n||b.tags).join(":"),s=void 0!==a,u=s?a.get(i):void 0;return null==u&&(u=function(e,n){if(!e)return[];var a,i,s,u=!1,m=[],g=[],y=[],v=!1,_=!1,w="",P=0;function O(){if(v&&!_)for(;y.length;)delete g[y.pop()];else y=[];v=!1,_=!1}function A(e){if("string"==typeof e&&(e=e.split(c,2)),!t(e)||2!==e.length)throw new Error("Invalid tags: "+e);a=new RegExp(r(e[0])+"\\s*"),i=new RegExp("\\s*"+r(e[1])),s=new RegExp("\\s*"+r("}"+e[1]))}A(n||b.tags);for(var C,T,I,E,x,j,M=new f(e);!M.eos();){if(C=M.pos,I=M.scanUntil(a))for(var k=0,S=I.length;k<S;++k)o(E=I.charAt(k))?(y.push(g.length),w+=E):(_=!0,u=!0,w+=" "),g.push(["text",E,C,C+1]),C+=1,"\n"===E&&(O(),w="",P=0,u=!1);if(!M.scan(a))break;if(v=!0,T=M.scan(h)||"name",M.scan(l),"="===T?(I=M.scanUntil(d),M.scan(d),M.scanUntil(i)):"{"===T?(I=M.scanUntil(s),M.scan(p),M.scanUntil(i),T="&"):I=M.scanUntil(i),!M.scan(i))throw new Error("Unclosed tag at "+M.pos);if(x=">"==T?[T,I,C,M.pos,w,P,u]:[T,I,C,M.pos],P++,g.push(x),"#"===T||"^"===T)m.push(x);else if("/"===T){if(!(j=m.pop()))throw new Error('Unopened section "'+I+'" at '+C);if(j[1]!==I)throw new Error('Unclosed section "'+j[1]+'" at '+C)}else"name"===T||"{"===T||"&"===T?_=!0:"="===T&&A(I)}if(O(),j=m.pop())throw new Error('Unclosed section "'+j[1]+'" at '+M.pos);return function(e){for(var t,n=[],r=n,a=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":r.push(t),a.push(t),r=t[4]=[];break;case"/":a.pop()[5]=t[2],r=a.length>0?a[a.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],a=0,i=e.length;a<i;++a)(t=e[a])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(g))}(e,n),s&&a.set(i,u)),u},g.prototype.render=function(e,t,n,r){var a=this.getConfigTags(r),i=this.parse(e,a),s=t instanceof m?t:new m(t,void 0);return this.renderTokens(i,s,n,e,r)},g.prototype.renderTokens=function(e,t,n,r,a){for(var i,s,o,u="",l=0,c=e.length;l<c;++l)o=void 0,"#"===(s=(i=e[l])[0])?o=this.renderSection(i,t,n,r,a):"^"===s?o=this.renderInverted(i,t,n,r,a):">"===s?o=this.renderPartial(i,t,n,a):"&"===s?o=this.unescapedValue(i,t):"name"===s?o=this.escapedValue(i,t,a):"text"===s&&(o=this.rawValue(i)),void 0!==o&&(u+=o);return u},g.prototype.renderSection=function(e,r,a,i,s){var o=this,u="",l=r.lookup(e[1]);if(l){if(t(l))for(var c=0,d=l.length;c<d;++c)u+=this.renderTokens(e[4],r.push(l[c]),a,i,s);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)u+=this.renderTokens(e[4],r.push(l),a,i,s);else if(n(l)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(r.view,i.slice(e[3],e[5]),(function(e){return o.render(e,r,a,s)})))&&(u+=l)}else u+=this.renderTokens(e[4],r,a,i,s);return u}},g.prototype.renderInverted=function(e,n,r,a,i){var s=n.lookup(e[1]);if(!s||t(s)&&0===s.length)return this.renderTokens(e[4],n,r,a,i)},g.prototype.indentPartial=function(e,t,n){for(var r=t.replace(/[^ \t]/g,""),a=e.split("\n"),i=0;i<a.length;i++)a[i].length&&(i>0||!n)&&(a[i]=r+a[i]);return a.join("\n")},g.prototype.renderPartial=function(e,t,r,a){if(r){var i=this.getConfigTags(a),s=n(r)?r(e[1]):r[e[1]];if(null!=s){var o=e[6],u=e[5],l=e[4],c=s;0==u&&l&&(c=this.indentPartial(s,l,o));var d=this.parse(c,i);return this.renderTokens(d,t,r,c,a)}}},g.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},g.prototype.escapedValue=function(e,t,n){var r=this.getConfigEscape(n)||b.escape,a=t.lookup(e[1]);if(null!=a)return"number"==typeof a&&r===b.escape?String(a):r(a)},g.prototype.rawValue=function(e){return e[1]},g.prototype.getConfigTags=function(e){return t(e)?e:e&&"object"==typeof e?e.tags:void 0},g.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!t(e)?e.escape:void 0};var b={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){y.templateCache=e},get templateCache(){return y.templateCache}},y=new g;return b.clearCache=function(){return y.clearCache()},b.parse=function(e,t){return y.parse(e,t)},b.render=function(e,n,r,a){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+((t(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)'));var i;return y.render(e,n,r,a)},b.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return u[e]}))},b.Scanner=f,b.Context=m,b.Writer=g,b}()},15534:function(e,t){"use strict";function n(e){if("number"!=typeof e)throw new TypeError("Expected a number")}t.V=(e,t)=>(n(e),n(t),Number.isNaN(e)?-1:Number.isNaN(t)?1:e-t)},44617:function(e){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},73290:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(30228),a=n(56641),i=n(54774),s=()=>{},o=new a.TimeoutError;t.default=class extends r{constructor(e){var t,n,r,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(a=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==a?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((n,r)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():a.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(o)}));n(await i)}catch(e){r(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},79998:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=0,a=e.length;for(;a>0;){const i=a/2|0;let s=r+i;n(e[s],t)<=0?(r=++s,a-=i+1):a=i}return r}},54774:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(79998);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const a=r.default(this._queue,n,((e,t)=>t.priority-e.priority));this._queue.splice(a,0,n)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},24116:function(e,t,n){"use strict";const r=n(75617),a=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class i extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const s=(e,t)=>new Promise(((n,s)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=r.operation(t);o.attempt((async r=>{try{n(await e(r))}catch(e){if(!(e instanceof Error))return void s(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof i)o.stop(),s(e.originalError);else if(e instanceof TypeError&&(u=e.message,!a.includes(u)))o.stop(),s(e);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(e,r,t);try{await t.onFailedAttempt(e)}catch(e){return void s(e)}o.retry(e)||s(o.mainError())}}var u}))}));e.exports=s,e.exports.default=s,e.exports.AbortError=i},56641:function(e,t,n){"use strict";const r=n(44617);class a extends Error{constructor(e){super(e),this.name="TimeoutError"}}const i=(e,t,n)=>new Promise(((i,s)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void i(e);const o=setTimeout((()=>{if("function"==typeof n){try{i(n())}catch(e){s(e)}return}const r=n instanceof Error?n:new a("string"==typeof n?n:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(r)}),t);r(e.then(i,s),(()=>{clearTimeout(o)}))}));e.exports=i,e.exports.default=i,e.exports.TimeoutError=a},75617:function(e,t,n){e.exports=n(58303)},58303:function(e,t,n){var r=n(93961);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],a=0;a<t.retries;a++)r.push(this.createTimeout(a,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(a,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var a in r=[],e)"function"==typeof e[a]&&r.push(a);for(var i=0;i<r.length;i++){var s=r[i],o=e[s];e[s]=function(r){var a=t.operation(n),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),s.apply(this,arguments))})),a.attempt((function(){r.apply(e,i)}))}.bind(e,o),e[s].options=n}}},93961:function(e){function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var a=this._errors[r],i=a.message,s=(e[i]||0)+1;e[i]=s,s>=n&&(t=a,n=s)}return t}},22831:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return u.default}});var r=p(n(13518)),a=p(n(14948)),i=p(n(45073)),s=p(n(77186)),o=p(n(14808)),u=p(n(7775)),l=p(n(37037)),c=p(n(49910)),d=p(n(96792));function p(e){return e&&e.__esModule?e:{default:e}}},22311:function(e,t){"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e,t,n,a,i,s){return r((o=r(r(t,e),r(a,s)))<<(u=i)|o>>>32-u,n);var o,u}function i(e,t,n,r,i,s,o){return a(t&n|~t&r,e,t,i,s,o)}function s(e,t,n,r,i,s,o){return a(t&r|n&~r,e,t,i,s,o)}function o(e,t,n,r,i,s,o){return a(t^n^r,e,t,i,s,o)}function u(e,t,n,r,i,s,o){return a(n^(t|~r),e,t,i,s,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){const t=[],n=32*e.length,r="0123456789abcdef";for(let a=0;a<n;a+=8){const n=e[a>>5]>>>a%32&255,i=parseInt(r.charAt(n>>>4&15)+r.charAt(15&n),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;let a=1732584193,l=-271733879,c=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){const n=a,p=l,h=c,f=d;a=i(a,l,c,d,e[t],7,-680876936),d=i(d,a,l,c,e[t+1],12,-389564586),c=i(c,d,a,l,e[t+2],17,606105819),l=i(l,c,d,a,e[t+3],22,-1044525330),a=i(a,l,c,d,e[t+4],7,-176418897),d=i(d,a,l,c,e[t+5],12,1200080426),c=i(c,d,a,l,e[t+6],17,-1473231341),l=i(l,c,d,a,e[t+7],22,-45705983),a=i(a,l,c,d,e[t+8],7,1770035416),d=i(d,a,l,c,e[t+9],12,-1958414417),c=i(c,d,a,l,e[t+10],17,-42063),l=i(l,c,d,a,e[t+11],22,-1990404162),a=i(a,l,c,d,e[t+12],7,1804603682),d=i(d,a,l,c,e[t+13],12,-40341101),c=i(c,d,a,l,e[t+14],17,-1502002290),l=i(l,c,d,a,e[t+15],22,1236535329),a=s(a,l,c,d,e[t+1],5,-165796510),d=s(d,a,l,c,e[t+6],9,-1069501632),c=s(c,d,a,l,e[t+11],14,643717713),l=s(l,c,d,a,e[t],20,-373897302),a=s(a,l,c,d,e[t+5],5,-701558691),d=s(d,a,l,c,e[t+10],9,38016083),c=s(c,d,a,l,e[t+15],14,-660478335),l=s(l,c,d,a,e[t+4],20,-405537848),a=s(a,l,c,d,e[t+9],5,568446438),d=s(d,a,l,c,e[t+14],9,-1019803690),c=s(c,d,a,l,e[t+3],14,-187363961),l=s(l,c,d,a,e[t+8],20,1163531501),a=s(a,l,c,d,e[t+13],5,-1444681467),d=s(d,a,l,c,e[t+2],9,-51403784),c=s(c,d,a,l,e[t+7],14,1735328473),l=s(l,c,d,a,e[t+12],20,-1926607734),a=o(a,l,c,d,e[t+5],4,-378558),d=o(d,a,l,c,e[t+8],11,-2022574463),c=o(c,d,a,l,e[t+11],16,1839030562),l=o(l,c,d,a,e[t+14],23,-35309556),a=o(a,l,c,d,e[t+1],4,-1530992060),d=o(d,a,l,c,e[t+4],11,1272893353),c=o(c,d,a,l,e[t+7],16,-155497632),l=o(l,c,d,a,e[t+10],23,-1094730640),a=o(a,l,c,d,e[t+13],4,681279174),d=o(d,a,l,c,e[t],11,-358537222),c=o(c,d,a,l,e[t+3],16,-722521979),l=o(l,c,d,a,e[t+6],23,76029189),a=o(a,l,c,d,e[t+9],4,-640364487),d=o(d,a,l,c,e[t+12],11,-421815835),c=o(c,d,a,l,e[t+15],16,530742520),l=o(l,c,d,a,e[t+2],23,-995338651),a=u(a,l,c,d,e[t],6,-198630844),d=u(d,a,l,c,e[t+7],10,1126891415),c=u(c,d,a,l,e[t+14],15,-1416354905),l=u(l,c,d,a,e[t+5],21,-57434055),a=u(a,l,c,d,e[t+12],6,1700485571),d=u(d,a,l,c,e[t+3],10,-1894986606),c=u(c,d,a,l,e[t+10],15,-1051523),l=u(l,c,d,a,e[t+1],21,-2054922799),a=u(a,l,c,d,e[t+8],6,1873313359),d=u(d,a,l,c,e[t+15],10,-30611744),c=u(c,d,a,l,e[t+6],15,-1560198380),l=u(l,c,d,a,e[t+13],21,1309151649),a=u(a,l,c,d,e[t+4],6,-145523070),d=u(d,a,l,c,e[t+11],10,-1120210379),c=u(c,d,a,l,e[t+2],15,718787259),l=u(l,c,d,a,e[t+9],21,-343485551),a=r(a,n),l=r(l,p),c=r(c,h),d=r(d,f)}return[a,l,c,d]}(function(e){if(0===e.length)return[];const t=8*e.length,r=new Uint32Array(n(t));for(let n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))}},46140:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=n},14808:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},96792:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a=(r=n(37037))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,a.default)(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}},27656:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},2858:function(e,t){"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)};const r=new Uint8Array(16)},9042:function(e,t){"use strict";function n(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function r(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const i=e.length/4+2,s=Math.ceil(i/16),o=new Array(s);for(let t=0;t<s;++t){const n=new Uint32Array(16);for(let r=0;r<16;++r)n[r]=e[64*t+4*r]<<24|e[64*t+4*r+1]<<16|e[64*t+4*r+2]<<8|e[64*t+4*r+3];o[t]=n}o[s-1][14]=8*(e.length-1)/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<s;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=o[e][t];for(let e=16;e<80;++e)i[e]=r(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let s=a[0],u=a[1],l=a[2],c=a[3],d=a[4];for(let e=0;e<80;++e){const a=Math.floor(e/20),o=r(s,5)+n(a,u,l,c)+d+t[a]+i[e]>>>0;d=c,c=l,l=r(u,30)>>>0,u=s,s=o}a[0]=a[0]+s>>>0,a[1]=a[1]+u>>>0,a[2]=a[2]+l>>>0,a[3]=a[3]+c>>>0,a[4]=a[4]+d>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,255&a[0],a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,255&a[1],a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,255&a[2],a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,255&a[3],a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,255&a[4]]}},49910:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=s;var r,a=(r=n(37037))&&r.__esModule?r:{default:r};const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function s(e,t=0){return i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]}t.default=function(e,t=0){const n=s(e,t);if(!(0,a.default)(n))throw TypeError("Stringified UUID is invalid");return n}},13518:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a=(r=n(2858))&&r.__esModule?r:{default:r},i=n(49910);let s,o,u=0,l=0;t.default=function(e,t,n){let r=t&&n||0;const c=t||new Array(16);let d=(e=e||{}).node||s,p=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==p){const t=e.random||(e.rng||a.default)();null==d&&(d=s=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==p&&(p=o=16383&(t[6]<<8|t[7]))}let h=void 0!==e.msecs?e.msecs:Date.now(),f=void 0!==e.nsecs?e.nsecs:l+1;const m=h-u+(f-l)/1e4;if(m<0&&void 0===e.clockseq&&(p=p+1&16383),(m<0||h>u)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=h,l=f,o=p,h+=122192928e5;const g=(1e4*(268435455&h)+f)%4294967296;c[r++]=g>>>24&255,c[r++]=g>>>16&255,c[r++]=g>>>8&255,c[r++]=255&g;const b=h/4294967296*1e4&268435455;c[r++]=b>>>8&255,c[r++]=255&b,c[r++]=b>>>24&15|16,c[r++]=b>>>16&255,c[r++]=p>>>8|128,c[r++]=255&p;for(let e=0;e<6;++e)c[r+e]=d[e];return t||(0,i.unsafeStringify)(c)}},14948:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(59025)),a=i(n(22311));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,r.default)("v3",48,a.default);t.default=s},59025:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,n){function r(e,r,s,o){var u;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=(0,i.default)(r)),16!==(null===(u=r)||void 0===u?void 0:u.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+e.length);if(l.set(r),l.set(e,r.length),l=n(l),l[6]=15&l[6]|t,l[8]=63&l[8]|128,s){o=o||0;for(let e=0;e<16;++e)s[o+e]=l[e];return s}return(0,a.unsafeStringify)(l)}try{r.name=e}catch(e){}return r.DNS=s,r.URL=o,r};var r,a=n(49910),i=(r=n(96792))&&r.__esModule?r:{default:r};const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=s;const o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o},45073:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n(46140)),a=s(n(2858)),i=n(49910);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,n){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();const s=(e=e||{}).random||(e.rng||a.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=s[e];return t}return(0,i.unsafeStringify)(s)}},77186:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(59025)),a=i(n(9042));function i(e){return e&&e.__esModule?e:{default:e}}var s=(0,r.default)("v5",80,a.default);t.default=s},37037:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a=(r=n(27656))&&r.__esModule?r:{default:r};t.default=function(e){return"string"==typeof e&&a.default.test(e)}},7775:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a=(r=n(37037))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,a.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},66837:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;const r=n(12146);t.ZodIssueCode=r.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class a extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(r);else if("invalid_return_type"===a.code)r(a.returnTypeError);else if("invalid_arguments"===a.code)r(a.argumentsError);else if(0===a.path.length)n._errors.push(t(a));else{let e=n,r=0;for(;r<a.path.length;){const n=a.path[r];r===a.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(a))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof a))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,r.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=a,a.create=e=>new a(e)},40627:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMap=t.setErrorMap=t.defaultErrorMap=void 0;const a=r(n(68227));t.defaultErrorMap=a.default;let i=a.default;t.setErrorMap=function(e){i=e},t.getErrorMap=function(){return i}},96555:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(40627),t),a(n(97231),t),a(n(91892),t),a(n(12146),t),a(n(12739),t),a(n(66837),t)},69750:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,(n=t.errorUtil||(t.errorUtil={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},n.toString=e=>"string"==typeof e?e:null==e?void 0:e.message},97231:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.addIssueToContext=t.EMPTY_PATH=t.makeIssue=void 0;const a=n(40627),i=r(n(68227));t.makeIssue=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,i=[...n,...a.path||[]],s={...a,path:i};if(void 0!==a.message)return{...a,path:i,message:a.message};let o="";const u=r.filter((e=>!!e)).slice().reverse();for(const e of u)o=e(s,{data:t,defaultError:o}).message;return{...a,path:i,message:o}},t.EMPTY_PATH=[],t.addIssueToContext=function(e,n){const r=(0,a.getErrorMap)(),s=(0,t.makeIssue)({issueData:n,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===i.default?void 0:i.default].filter((e=>!!e))});e.common.issues.push(s)};class s{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const a of n){if("aborted"===a.status)return t.INVALID;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,r=await e.value;n.push({key:t,value:r})}return s.mergeObjectSync(e,n)}static mergeObjectSync(e,n){const r={};for(const a of n){const{key:n,value:i}=a;if("aborted"===n.status)return t.INVALID;if("aborted"===i.status)return t.INVALID;"dirty"===n.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"===n.value||void 0===i.value&&!a.alwaysSet||(r[n.value]=i.value)}return{status:e.value,value:r}}}t.ParseStatus=s,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},91892:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},12146:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(n=t.util||(t.util={})),(t.objectUtil||(t.objectUtil={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=n.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{switch(typeof e){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":return Array.isArray(e)?t.ZodParsedType.array:null===e?t.ZodParsedType.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?t.ZodParsedType.promise:"undefined"!=typeof Map&&e instanceof Map?t.ZodParsedType.map:"undefined"!=typeof Set&&e instanceof Set?t.ZodParsedType.set:"undefined"!=typeof Date&&e instanceof Date?t.ZodParsedType.date:t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},21614:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;const o=i(n(96555));t.z=o,s(n(96555),t),t.default=o},68227:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(12146),a=n(66837);t.default=(e,t)=>{let n;switch(e.code){case a.ZodIssueCode.invalid_type:n=e.received===r.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case a.ZodIssueCode.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,r.util.jsonStringifyReplacer)}`;break;case a.ZodIssueCode.unrecognized_keys:n=`Unrecognized key(s) in object: ${r.util.joinValues(e.keys,", ")}`;break;case a.ZodIssueCode.invalid_union:n="Invalid input";break;case a.ZodIssueCode.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${r.util.joinValues(e.options)}`;break;case a.ZodIssueCode.invalid_enum_value:n=`Invalid enum value. Expected ${r.util.joinValues(e.options)}, received '${e.received}'`;break;case a.ZodIssueCode.invalid_arguments:n="Invalid function arguments";break;case a.ZodIssueCode.invalid_return_type:n="Invalid function return type";break;case a.ZodIssueCode.invalid_date:n="Invalid date";break;case a.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:r.util.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case a.ZodIssueCode.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case a.ZodIssueCode.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case a.ZodIssueCode.custom:n="Invalid input";break;case a.ZodIssueCode.invalid_intersection_types:n="Intersection results could not be merged";break;case a.ZodIssueCode.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case a.ZodIssueCode.not_finite:n="Number must be finite";break;default:n=t.defaultError,r.util.assertNever(e)}return{message:n}}},12739:function(e,t,n){"use strict";var r,a,i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},s=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.custom=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.datetimeRegex=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=t.discriminatedUnion=t.date=void 0;const o=n(40627),u=n(69750),l=n(97231),c=n(12146),d=n(66837);class p{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const h=(e,t)=>{if((0,l.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new d.ZodError(e.common.issues);return this._error=t,this._error}}};function f(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,a)=>{var i,s;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:a.defaultError}:void 0===a.data?{message:null!==(i=null!=o?o:r)&&void 0!==i?i:a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:null!==(s=null!=o?o:n)&&void 0!==s?s:a.defaultError}},description:a}}class m{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return(0,c.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,c.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new l.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,c.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if((0,l.isAsync)(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,c.getParsedType)(e)},a=this._parseSync({data:e,path:r.path,parent:r});return h(r,a)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,c.getParsedType)(e)},r=this._parse({data:e,path:n.path,parent:n}),a=await((0,l.isAsync)(r)?r:Promise.resolve(r));return h(n,a)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const a=e(t),i=()=>r.addIssue({code:d.ZodIssueCode.custom,...n(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then((e=>!!e||(i(),!1))):!!a||(i(),!1)}))}refinement(e,t){return this._refinement(((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1)))}_refinement(e){return new le({schema:this,typeName:ve.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ce.create(this,this._def)}nullable(){return de.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return V.create(this,this._def)}promise(){return ue.create(this,this._def)}or(e){return H.create([this,e],this._def)}and(e){return Q.create(this,e,this._def)}transform(e){return new le({...f(this._def),schema:this,typeName:ve.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new pe({...f(this._def),innerType:this,defaultValue:t,typeName:ve.ZodDefault})}brand(){return new me({typeName:ve.ZodBranded,type:this,...f(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new he({...f(this._def),innerType:this,catchValue:t,typeName:ve.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ge.create(this,e)}readonly(){return be.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=m,t.Schema=m,t.ZodSchema=m;const g=/^c[^\s-]{8,}$/i,b=/^[0-9a-z]+$/,y=/^[0-9A-HJKMNP-TV-Z]{26}$/,v=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_=/^[a-z0-9_-]{21}$/i,w=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,P=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let O;const A=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,C=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,T=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,I="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",E=new RegExp(`^${I}$`);function x(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function j(e){let t=`${I}T${x(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}t.datetimeRegex=j;class M extends m{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==c.ZodParsedType.string){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.string,received:t.parsedType}),l.INVALID}const t=new l.ParseStatus;let n;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const r=e.data.length>i.value,a=e.data.length<i.value;(r||a)&&(n=this._getOrReturnCtx(e,n),r?(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)P.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"email",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)O||(O=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),O.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"emoji",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)v.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"uuid",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty());else if("nanoid"===i.kind)_.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"nanoid",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)g.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"cuid",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)b.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"cuid2",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)y.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"ulid",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(r){n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"url",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"regex",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty()):"datetime"===i.kind?j(i).test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_string,validation:"datetime",message:i.message}),t.dirty()):"date"===i.kind?E.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_string,validation:"date",message:i.message}),t.dirty()):"time"===i.kind?new RegExp(`^${x(i)}$`).test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_string,validation:"time",message:i.message}),t.dirty()):"duration"===i.kind?w.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"duration",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty()):"ip"===i.kind?(r=e.data,("v4"!==(a=i.version)&&a||!A.test(r))&&("v6"!==a&&a||!C.test(r))&&(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"ip",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty())):"base64"===i.kind?T.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{validation:"base64",code:d.ZodIssueCode.invalid_string,message:i.message}),t.dirty()):c.util.assertNever(i);var r,a;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),{validation:t,code:d.ZodIssueCode.invalid_string,...u.errorUtil.errToObj(n)})}_addCheck(e){return new M({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...u.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...u.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...u.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...u.errorUtil.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...u.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...u.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...u.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...u.errorUtil.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...u.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...u.errorUtil.errToObj(e)})}datetime(e){var t,n;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(n=null==e?void 0:e.local)&&void 0!==n&&n,...u.errorUtil.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...u.errorUtil.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...u.errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...u.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...u.errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...u.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...u.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...u.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...u.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...u.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,u.errorUtil.errToObj(e))}trim(){return new M({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new M({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new M({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function k(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r;return parseInt(e.toFixed(a).replace(".",""))%parseInt(t.toFixed(a).replace(".",""))/Math.pow(10,a)}t.ZodString=M,M.create=e=>{var t;return new M({checks:[],typeName:ve.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...f(e)})};class S extends m{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==c.ZodParsedType.number){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.number,received:t.parsedType}),l.INVALID}let t;const n=new l.ParseStatus;for(const r of this._def.checks)"int"===r.kind?c.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==k(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.not_finite,message:r.message}),n.dirty()):c.util.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,u.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.errorUtil.toString(t))}setLimit(e,t,n,r){return new S({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:u.errorUtil.toString(r)}]})}_addCheck(e){return new S({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:u.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:u.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:u.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:u.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:u.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:u.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:u.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:u.errorUtil.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&c.util.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=S,S.create=e=>new S({checks:[],typeName:ve.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...f(e)});class R extends m{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==c.ZodParsedType.bigint){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.bigint,received:t.parsedType}),l.INVALID}let t;const n=new l.ParseStatus;for(const r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):c.util.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,u.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.errorUtil.toString(t))}setLimit(e,t,n,r){return new R({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:u.errorUtil.toString(r)}]})}_addCheck(e){return new R({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:u.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:u.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:u.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:u.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=R,R.create=e=>{var t;return new R({checks:[],typeName:ve.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...f(e)})};class N extends m{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==c.ZodParsedType.boolean){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.boolean,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodBoolean=N,N.create=e=>new N({typeName:ve.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...f(e)});class L extends m{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==c.ZodParsedType.date){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.date,received:t.parsedType}),l.INVALID}if(isNaN(e.data.getTime())){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_date}),l.INVALID}const t=new l.ParseStatus;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):c.util.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new L({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:u.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:u.errorUtil.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=L,L.create=e=>new L({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:ve.ZodDate,...f(e)});class D extends m{_parse(e){if(this._getType(e)!==c.ZodParsedType.symbol){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.symbol,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodSymbol=D,D.create=e=>new D({typeName:ve.ZodSymbol,...f(e)});class $ extends m{_parse(e){if(this._getType(e)!==c.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.undefined,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodUndefined=$,$.create=e=>new $({typeName:ve.ZodUndefined,...f(e)});class F extends m{_parse(e){if(this._getType(e)!==c.ZodParsedType.null){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.null,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodNull=F,F.create=e=>new F({typeName:ve.ZodNull,...f(e)});class q extends m{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,l.OK)(e.data)}}t.ZodAny=q,q.create=e=>new q({typeName:ve.ZodAny,...f(e)});class B extends m{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,l.OK)(e.data)}}t.ZodUnknown=B,B.create=e=>new B({typeName:ve.ZodUnknown,...f(e)});class U extends m{_parse(e){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.never,received:t.parsedType}),l.INVALID}}t.ZodNever=U,U.create=e=>new U({typeName:ve.ZodNever,...f(e)});class z extends m{_parse(e){if(this._getType(e)!==c.ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.void,received:t.parsedType}),l.INVALID}return(0,l.OK)(e.data)}}t.ZodVoid=z,z.create=e=>new z({typeName:ve.ZodVoid,...f(e)});class V extends m{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==c.ZodParsedType.array)return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.array,received:t.parsedType}),l.INVALID;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(e||a)&&((0,l.addIssueToContext)(t,{code:e?d.ZodIssueCode.too_big:d.ZodIssueCode.too_small,minimum:a?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&((0,l.addIssueToContext)(t,{code:d.ZodIssueCode.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&((0,l.addIssueToContext)(t,{code:d.ZodIssueCode.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>r.type._parseAsync(new p(t,e,t.path,n))))).then((e=>l.ParseStatus.mergeArray(n,e)));const a=[...t.data].map(((e,n)=>r.type._parseSync(new p(t,e,t.path,n))));return l.ParseStatus.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new V({...this._def,minLength:{value:e,message:u.errorUtil.toString(t)}})}max(e,t){return new V({...this._def,maxLength:{value:e,message:u.errorUtil.toString(t)}})}length(e,t){return new V({...this._def,exactLength:{value:e,message:u.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}function K(e){if(e instanceof Z){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=ce.create(K(r))}return new Z({...e._def,shape:()=>t})}return e instanceof V?new V({...e._def,type:K(e.element)}):e instanceof ce?ce.create(K(e.unwrap())):e instanceof de?de.create(K(e.unwrap())):e instanceof Y?Y.create(e.items.map((e=>K(e)))):e}t.ZodArray=V,V.create=(e,t)=>new V({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ve.ZodArray,...f(t)});class Z extends m{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=c.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==c.ZodParsedType.object){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.object,received:t.parsedType}),l.INVALID}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:a}=this._getCached(),i=[];if(!(this._def.catchall instanceof U&&"strip"===this._def.unknownKeys))for(const e in n.data)a.includes(e)||i.push(e);const s=[];for(const e of a){const t=r[e],a=n.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new p(n,a,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof U){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)s.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)i.length>0&&((0,l.addIssueToContext)(n,{code:d.ZodIssueCode.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const r=n.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new p(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of s){const n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e})).then((e=>l.ParseStatus.mergeObjectSync(t,e))):l.ParseStatus.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return u.errorUtil.errToObj,new Z({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{var r,a,i,s;const o=null!==(i=null===(a=(r=this._def).errorMap)||void 0===a?void 0:a.call(r,t,n).message)&&void 0!==i?i:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=u.errorUtil.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new Z({...this._def,unknownKeys:"strip"})}passthrough(){return new Z({...this._def,unknownKeys:"passthrough"})}extend(e){return new Z({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Z({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ve.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Z({...this._def,catchall:e})}pick(e){const t={};return c.util.objectKeys(e).forEach((n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])})),new Z({...this._def,shape:()=>t})}omit(e){const t={};return c.util.objectKeys(this.shape).forEach((n=>{e[n]||(t[n]=this.shape[n])})),new Z({...this._def,shape:()=>t})}deepPartial(){return K(this)}partial(e){const t={};return c.util.objectKeys(this.shape).forEach((n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()})),new Z({...this._def,shape:()=>t})}required(e){const t={};return c.util.objectKeys(this.shape).forEach((n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof ce;)e=e._def.innerType;t[n]=e}})),new Z({...this._def,shape:()=>t})}keyof(){return ie(c.util.objectKeys(this.shape))}}t.ZodObject=Z,Z.create=(e,t)=>new Z({shape:()=>e,unknownKeys:"strip",catchall:U.create(),typeName:ve.ZodObject,...f(t)}),Z.strictCreate=(e,t)=>new Z({shape:()=>e,unknownKeys:"strict",catchall:U.create(),typeName:ve.ZodObject,...f(t)}),Z.lazycreate=(e,t)=>new Z({shape:e,unknownKeys:"strip",catchall:U.create(),typeName:ve.ZodObject,...f(t)});class H extends m{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new d.ZodError(e.ctx.common.issues)));return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_union,unionErrors:n}),l.INVALID}));{let e;const r=[];for(const a of n){const n={...t,common:{...t.common,issues:[]},parent:null},i=a._parseSync({data:t.data,path:t.path,parent:n});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=r.map((e=>new d.ZodError(e)));return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_union,unionErrors:a}),l.INVALID}}get options(){return this._def.options}}t.ZodUnion=H,H.create=(e,t)=>new H({options:e,typeName:ve.ZodUnion,...f(t)});const J=e=>e instanceof re?J(e.schema):e instanceof le?J(e.innerType()):e instanceof ae?[e.value]:e instanceof se?e.options:e instanceof oe?c.util.objectValues(e.enum):e instanceof pe?J(e._def.innerType):e instanceof $?[void 0]:e instanceof F?[null]:e instanceof ce?[void 0,...J(e.unwrap())]:e instanceof de?[null,...J(e.unwrap())]:e instanceof me||e instanceof be?J(e.unwrap()):e instanceof he?J(e._def.innerType):[];class W extends m{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==c.ZodParsedType.object)return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.object,received:t.parsedType}),l.INVALID;const n=this.discriminator,r=t.data[n],a=this.optionsMap.get(r);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):((0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),l.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const n of t){const t=J(n.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of t){if(r.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);r.set(a,n)}}return new W({typeName:ve.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...f(n)})}}function G(e,t){const n=(0,c.getParsedType)(e),r=(0,c.getParsedType)(t);if(e===t)return{valid:!0,data:e};if(n===c.ZodParsedType.object&&r===c.ZodParsedType.object){const n=c.util.objectKeys(t),r=c.util.objectKeys(e).filter((e=>-1!==n.indexOf(e))),a={...e,...t};for(const n of r){const r=G(e[n],t[n]);if(!r.valid)return{valid:!1};a[n]=r.data}return{valid:!0,data:a}}if(n===c.ZodParsedType.array&&r===c.ZodParsedType.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const a=G(e[r],t[r]);if(!a.valid)return{valid:!1};n.push(a.data)}return{valid:!0,data:n}}return n===c.ZodParsedType.date&&r===c.ZodParsedType.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}t.ZodDiscriminatedUnion=W;class Q extends m{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if((0,l.isAborted)(e)||(0,l.isAborted)(r))return l.INVALID;const a=G(e.value,r.value);return a.valid?(((0,l.isDirty)(e)||(0,l.isDirty)(r))&&t.dirty(),{status:t.value,value:a.data}):((0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_intersection_types}),l.INVALID)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}t.ZodIntersection=Q,Q.create=(e,t,n)=>new Q({left:e,right:t,typeName:ve.ZodIntersection,...f(n)});class Y extends m{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==c.ZodParsedType.array)return(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.array,received:n.parsedType}),l.INVALID;if(n.data.length<this._def.items.length)return(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),l.INVALID;!this._def.rest&&n.data.length>this._def.items.length&&((0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new p(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(r).then((e=>l.ParseStatus.mergeArray(t,e))):l.ParseStatus.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new Y({...this._def,rest:e})}}t.ZodTuple=Y,Y.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Y({items:e,typeName:ve.ZodTuple,rest:null,...f(t)})};class X extends m{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==c.ZodParsedType.object)return(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.object,received:n.parsedType}),l.INVALID;const r=[],a=this._def.keyType,i=this._def.valueType;for(const e in n.data)r.push({key:a._parse(new p(n,e,n.path,e)),value:i._parse(new p(n,n.data[e],n.path,e)),alwaysSet:e in n.data});return n.common.async?l.ParseStatus.mergeObjectAsync(t,r):l.ParseStatus.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new X(t instanceof m?{keyType:e,valueType:t,typeName:ve.ZodRecord,...f(n)}:{keyType:M.create(),valueType:e,typeName:ve.ZodRecord,...f(t)})}}t.ZodRecord=X;class ee extends m{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==c.ZodParsedType.map)return(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.map,received:n.parsedType}),l.INVALID;const r=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map((([e,t],i)=>({key:r._parse(new p(n,e,n.path,[i,"key"])),value:a._parse(new p(n,t,n.path,[i,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const n of i){const r=await n.key,a=await n.value;if("aborted"===r.status||"aborted"===a.status)return l.INVALID;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of i){const r=n.key,a=n.value;if("aborted"===r.status||"aborted"===a.status)return l.INVALID;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}}}}t.ZodMap=ee,ee.create=(e,t,n)=>new ee({valueType:t,keyType:e,typeName:ve.ZodMap,...f(n)});class te extends m{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==c.ZodParsedType.set)return(0,l.addIssueToContext)(n,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.set,received:n.parsedType}),l.INVALID;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&((0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&((0,l.addIssueToContext)(n,{code:d.ZodIssueCode.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function i(e){const n=new Set;for(const r of e){if("aborted"===r.status)return l.INVALID;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const s=[...n.data.values()].map(((e,t)=>a._parse(new p(n,e,n.path,t))));return n.common.async?Promise.all(s).then((e=>i(e))):i(s)}min(e,t){return new te({...this._def,minSize:{value:e,message:u.errorUtil.toString(t)}})}max(e,t){return new te({...this._def,maxSize:{value:e,message:u.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=te,te.create=(e,t)=>new te({valueType:e,minSize:null,maxSize:null,typeName:ve.ZodSet,...f(t)});class ne extends m{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==c.ZodParsedType.function)return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.function,received:t.parsedType}),l.INVALID;function n(e,n){return(0,l.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,o.getErrorMap)(),o.defaultErrorMap].filter((e=>!!e)),issueData:{code:d.ZodIssueCode.invalid_arguments,argumentsError:n}})}function r(e,n){return(0,l.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,o.getErrorMap)(),o.defaultErrorMap].filter((e=>!!e)),issueData:{code:d.ZodIssueCode.invalid_return_type,returnTypeError:n}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof ue){const e=this;return(0,l.OK)((async function(...t){const s=new d.ZodError([]),o=await e._def.args.parseAsync(t,a).catch((e=>{throw s.addIssue(n(t,e)),s})),u=await Reflect.apply(i,this,o);return await e._def.returns._def.type.parseAsync(u,a).catch((e=>{throw s.addIssue(r(u,e)),s}))}))}{const e=this;return(0,l.OK)((function(...t){const s=e._def.args.safeParse(t,a);if(!s.success)throw new d.ZodError([n(t,s.error)]);const o=Reflect.apply(i,this,s.data),u=e._def.returns.safeParse(o,a);if(!u.success)throw new d.ZodError([r(o,u.error)]);return u.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ne({...this._def,args:Y.create(e).rest(B.create())})}returns(e){return new ne({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new ne({args:e||Y.create([]).rest(B.create()),returns:t||B.create(),typeName:ve.ZodFunction,...f(n)})}}t.ZodFunction=ne;class re extends m{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=re,re.create=(e,t)=>new re({getter:e,typeName:ve.ZodLazy,...f(t)});class ae extends m{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{received:t.data,code:d.ZodIssueCode.invalid_literal,expected:this._def.value}),l.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ie(e,t){return new se({values:e,typeName:ve.ZodEnum,...f(t)})}t.ZodLiteral=ae,ae.create=(e,t)=>new ae({value:e,typeName:ve.ZodLiteral,...f(t)});class se extends m{constructor(){super(...arguments),r.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return(0,l.addIssueToContext)(t,{expected:c.util.joinValues(n),received:t.parsedType,code:d.ZodIssueCode.invalid_type}),l.INVALID}if(i(this,r,"f")||s(this,r,new Set(this._def.values),"f"),!i(this,r,"f").has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return(0,l.addIssueToContext)(t,{received:t.data,code:d.ZodIssueCode.invalid_enum_value,options:n}),l.INVALID}return(0,l.OK)(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return se.create(e,{...this._def,...t})}exclude(e,t=this._def){return se.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}t.ZodEnum=se,r=new WeakMap,se.create=ie;class oe extends m{constructor(){super(...arguments),a.set(this,void 0)}_parse(e){const t=c.util.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==c.ZodParsedType.string&&n.parsedType!==c.ZodParsedType.number){const e=c.util.objectValues(t);return(0,l.addIssueToContext)(n,{expected:c.util.joinValues(e),received:n.parsedType,code:d.ZodIssueCode.invalid_type}),l.INVALID}if(i(this,a,"f")||s(this,a,new Set(c.util.getValidEnumValues(this._def.values)),"f"),!i(this,a,"f").has(e.data)){const e=c.util.objectValues(t);return(0,l.addIssueToContext)(n,{received:n.data,code:d.ZodIssueCode.invalid_enum_value,options:e}),l.INVALID}return(0,l.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=oe,a=new WeakMap,oe.create=(e,t)=>new oe({values:e,typeName:ve.ZodNativeEnum,...f(t)});class ue extends m{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==c.ZodParsedType.promise&&!1===t.common.async)return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.promise,received:t.parsedType}),l.INVALID;const n=t.parsedType===c.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,l.OK)(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}t.ZodPromise=ue,ue.create=(e,t)=>new ue({type:e,typeName:ve.ZodPromise,...f(t)});class le extends m{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ve.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:e=>{(0,l.addIssueToContext)(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===r.type){const e=r.transform(n.data,a);if(n.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return l.INVALID;const r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===r.status?l.INVALID:"dirty"===r.status||"dirty"===t.value?(0,l.DIRTY)(r.value):r}));{if("aborted"===t.value)return l.INVALID;const r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===r.status?l.INVALID:"dirty"===r.status||"dirty"===t.value?(0,l.DIRTY)(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,a);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?l.INVALID:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?l.INVALID:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!(0,l.isValid)(e))return e;const i=r.transform(e.value,a);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>(0,l.isValid)(e)?Promise.resolve(r.transform(e.value,a)).then((e=>({status:t.value,value:e}))):e))}c.util.assertNever(r)}}t.ZodEffects=le,t.ZodTransformer=le,le.create=(e,t,n)=>new le({schema:e,typeName:ve.ZodEffects,effect:t,...f(n)}),le.createWithPreprocess=(e,t,n)=>new le({schema:t,effect:{type:"preprocess",transform:e},typeName:ve.ZodEffects,...f(n)});class ce extends m{_parse(e){return this._getType(e)===c.ZodParsedType.undefined?(0,l.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=ce,ce.create=(e,t)=>new ce({innerType:e,typeName:ve.ZodOptional,...f(t)});class de extends m{_parse(e){return this._getType(e)===c.ZodParsedType.null?(0,l.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=de,de.create=(e,t)=>new de({innerType:e,typeName:ve.ZodNullable,...f(t)});class pe extends m{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===c.ZodParsedType.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=pe,pe.create=(e,t)=>new pe({innerType:e,typeName:ve.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...f(t)});class he extends m{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return(0,l.isAsync)(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new d.ZodError(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new d.ZodError(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=he,he.create=(e,t)=>new he({innerType:e,typeName:ve.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...f(t)});class fe extends m{_parse(e){if(this._getType(e)!==c.ZodParsedType.nan){const t=this._getOrReturnCtx(e);return(0,l.addIssueToContext)(t,{code:d.ZodIssueCode.invalid_type,expected:c.ZodParsedType.nan,received:t.parsedType}),l.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=fe,fe.create=e=>new fe({typeName:ve.ZodNaN,...f(e)}),t.BRAND=Symbol("zod_brand");class me extends m{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=me;class ge extends m{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?l.INVALID:"dirty"===e.status?(t.dirty(),(0,l.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?l.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new ge({in:e,out:t,typeName:ve.ZodPipeline})}}t.ZodPipeline=ge;class be extends m{_parse(e){const t=this._def.innerType._parse(e),n=e=>((0,l.isValid)(e)&&(e.value=Object.freeze(e.value)),e);return(0,l.isAsync)(t)?t.then((e=>n(e))):n(t)}unwrap(){return this._def.innerType}}function ye(e,t={},n){return e?q.create().superRefine(((r,a)=>{var i,s;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:n)||void 0===s||s,u="string"==typeof e?{message:e}:e;a.addIssue({code:"custom",...u,fatal:o})}})):q.create()}var ve;t.ZodReadonly=be,be.create=(e,t)=>new be({innerType:e,typeName:ve.ZodReadonly,...f(t)}),t.custom=ye,t.late={object:Z.lazycreate},function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(ve=t.ZodFirstPartyTypeKind||(t.ZodFirstPartyTypeKind={})),t.instanceof=(e,t={message:`Input not instance of ${e.name}`})=>ye((t=>t instanceof e),t);const _e=M.create;t.string=_e;const we=S.create;t.number=we;const Pe=fe.create;t.nan=Pe;const Oe=R.create;t.bigint=Oe;const Ae=N.create;t.boolean=Ae;const Ce=L.create;t.date=Ce;const Te=D.create;t.symbol=Te;const Ie=$.create;t.undefined=Ie;const Ee=F.create;t.null=Ee;const xe=q.create;t.any=xe;const je=B.create;t.unknown=je;const Me=U.create;t.never=Me;const ke=z.create;t.void=ke;const Se=V.create;t.array=Se;const Re=Z.create;t.object=Re;const Ne=Z.strictCreate;t.strictObject=Ne;const Le=H.create;t.union=Le;const De=W.create;t.discriminatedUnion=De;const $e=Q.create;t.intersection=$e;const Fe=Y.create;t.tuple=Fe;const qe=X.create;t.record=qe;const Be=ee.create;t.map=Be;const Ue=te.create;t.set=Ue;const ze=ne.create;t.function=ze;const Ve=re.create;t.lazy=Ve;const Ke=ae.create;t.literal=Ke;const Ze=se.create;t.enum=Ze;const He=oe.create;t.nativeEnum=He;const Je=ue.create;t.promise=Je;const We=le.create;t.effect=We,t.transformer=We;const Ge=ce.create;t.optional=Ge;const Qe=de.create;t.nullable=Qe;const Ye=le.createWithPreprocess;t.preprocess=Ye;const Xe=ge.create;t.pipeline=Xe,t.ostring=()=>_e().optional(),t.onumber=()=>we().optional(),t.oboolean=()=>Ae().optional(),t.coerce={string:e=>M.create({...e,coerce:!0}),number:e=>S.create({...e,coerce:!0}),boolean:e=>N.create({...e,coerce:!0}),bigint:e=>R.create({...e,coerce:!0}),date:e=>L.create({...e,coerce:!0})},t.NEVER=l.INVALID},58394:function(e,t,n){"use strict";e.exports=n.p+"4fc12274210078c9cdd4.css"},73653:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseChatMemory=void 0;const r=n(47345),a=n(7411);class i extends r.BaseMemory{constructor(e){super(),Object.defineProperty(this,"chatHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chatHistory=e?.chatHistory??new a.ChatMessageHistory,this.returnMessages=e?.returnMessages??this.returnMessages,this.inputKey=e?.inputKey??this.inputKey,this.outputKey=e?.outputKey??this.outputKey}async saveContext(e,t){await this.chatHistory.addUserMessage((0,r.getInputValue)(e,this.inputKey)),await this.chatHistory.addAIChatMessage((0,r.getOutputValue)(t,this.outputKey))}async clear(){await this.chatHistory.clear()}}t.BaseChatMemory=i},7411:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessageHistory=void 0;var r=n(40167);Object.defineProperty(t,"ChatMessageHistory",{enumerable:!0,get:function(){return r.InMemoryChatMessageHistory}})},15222:function(e,t,n){e.exports=n(73653)},97524:function(e,t,n){e.exports=n(31413)},40167:function(e,t,n){e.exports=n(95324)},26110:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryCache=t.BaseCache=t.serializeGeneration=t.deserializeStoredGeneration=t.getCacheKey=void 0;const r=n(681),a=n(14190);t.getCacheKey=(...e)=>(0,r.insecureHash)(e.join("_")),t.deserializeStoredGeneration=function(e){return void 0!==e.message?{text:e.text,message:(0,a.mapStoredMessageToChatMessage)(e.message)}:{text:e.text}},t.serializeGeneration=function(e){const t={text:e.text};return void 0!==e.message&&(t.message=e.message.toDict()),t};class i{}t.BaseCache=i;const s=new Map;class o extends i{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,n){return Promise.resolve(this.cache.get((0,t.getCacheKey)(e,n))??null)}async update(e,n,r){this.cache.set((0,t.getCacheKey)(e,n),r)}static global(){return new o(s)}}t.InMemoryCache=o},12031:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCallbackHandler=void 0;const s=i(n(22831)),o=n(367),u=n(60418);class l{}class c extends l{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,o.get_lc_unique_name)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"true"!==(0,u.getEnvironmentVariable)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return o.Serializable.prototype.toJSON.call(this)}toJSONNotImplemented(){return o.Serializable.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends c{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:s.v4()}),Object.assign(this,e)}}}}t.BaseCallbackHandler=c},31413:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.traceAsGroup=t.TraceGroup=t.ensureHandler=t.CallbackManager=t.CallbackManagerForToolRun=t.CallbackManagerForChainRun=t.CallbackManagerForLLMRun=t.CallbackManagerForRetrieverRun=t.BaseCallbackManager=t.parseCallbackConfigArg=void 0;const r=n(22831),a=n(12031),i=n(88813),s=n(13076),o=n(14190),u=n(60418),l=n(19979),c=n(41674);"true"===(0,u.getEnvironmentVariable)("LANGCHAIN_TRACING_V2")&&"true"!==(0,u.getEnvironmentVariable)("LANGCHAIN_CALLBACKS_BACKGROUND")&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join("\n"),t.parseCallbackConfigArg=function(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}};class d{setHandler(e){return this.setHandlers([e])}}t.BaseCallbackManager=d;class p{constructor(e,t,n,r,a,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class h extends p{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForRetrieverRun=h;class f extends p{async handleLLMNewToken(e,t,n,r,a,i){await Promise.all(this.handlers.map((n=>(0,c.consumeCallback)((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMNewToken: ${e}`)}}),n.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForLLMRun=f;class m extends p{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,r,a){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,n,r,a){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForChainRun=m;class g extends p{getChild(e){const t=new b(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>(0,c.consumeCallback)((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}t.CallbackManagerForToolRun=g;class b extends d{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,a=void 0,i=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(t.map((async(t,a)=>{const s=0===a&&n?n:(0,r.v4)();return await Promise.all(this.handlers.map((n=>(0,c.consumeCallback)((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new f(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,n=void 0,a=void 0,i=void 0,s=void 0,u=void 0,l=void 0){return Promise.all(t.map((async(t,a)=>{const s=0===a&&n?n:(0,r.v4)();return await Promise.all(this.handlers.map((n=>(0,c.consumeCallback)((async()=>{if(!n.ignoreLLM)try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,l));else if(n.handleLLMStart){const r=(0,o.getBufferString)(t);await(n.handleLLMStart?.(e,[r],s,this._parentRunId,i,this.tags,this.metadata,l))}}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMStart: ${e}`)}}),n.awaitHandlers)))),new f(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,n=(0,r.v4)(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>(0,c.consumeCallback)((async()=>{if(!r.ignoreChain)try{await(r.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,a,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleChainStart: ${e}`)}}),r.awaitHandlers)))),new m(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=(0,r.v4)(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>(0,c.consumeCallback)((async()=>{if(!r.ignoreAgent)try{await(r.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleToolStart: ${e}`)}}),r.awaitHandlers)))),new g(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=(0,r.v4)(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>(0,c.consumeCallback)((async()=>{if(!r.ignoreRetriever)try{await(r.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleRetrieverStart: ${e}`)}}),r.awaitHandlers)))),new h(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new b(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);n.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);n.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);n.addMetadata({[e]:this.metadata[e]},t)}for(const r of e)n.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===r.name))||n.addHandler(r,t);return n}static fromHandlers(e){class t extends a.BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,r.v4)()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static async configure(e,t,n,r,a,o,l){let c;(e||t)&&(Array.isArray(e)||!e?(c=new b,c.setHandlers(e?.map(y)??[],!0)):c=e,c=c.copy(Array.isArray(t)?t.map(y):t?.handlers,!1));const d="true"===(0,u.getEnvironmentVariable)("LANGCHAIN_VERBOSE")||l?.verbose,p="true"===(0,u.getEnvironmentVariable)("LANGCHAIN_TRACING_V2"),h=p||((0,u.getEnvironmentVariable)("LANGCHAIN_TRACING")??!1);if(d||h){if(c||(c=new b),d&&!c.handlers.some((e=>e.name===i.ConsoleCallbackHandler.prototype.name))){const e=new i.ConsoleCallbackHandler;c.addHandler(e,!0)}h&&!c.handlers.some((e=>"langchain_tracer"===e.name))&&p&&c.addHandler(await(0,s.getTracingV2CallbackHandler)(),!0)}return(n||r)&&c&&(c.addTags(n??[]),c.addTags(r??[],!1)),(a||o)&&c&&(c.addMetadata(a??{}),c.addMetadata(o??{},!1)),c}}function y(e){return"name"in e?e:a.BaseCallbackHandler.fromMethods(e)}t.CallbackManager=b,t.ensureHandler=y;class v{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t,n){const r=new l.LangChainTracer(n),a=await b.configure([r]),i=await(a?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{}));if(!i)throw new Error("Failed to create run group callback manager.");return i}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}t.TraceGroup=v,t.traceAsGroup=async function(e,t,...n){const r=new v(e.name,e),a=await r.start({...n});try{const e=await t(a,...n);return await r.end((i=e,s="output",i&&!Array.isArray(i)&&"object"==typeof i?i:{[s]:i})),e}catch(e){throw await r.error(e),e}var i,s}},41674:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.awaitAllCallbacks=t.consumeCallback=void 0;const a=r(n(73290));let i;t.consumeCallback=async function(e,t){!0===t?await e():(void 0===i&&(i=new("default"in a.default?a.default.default:a.default)({autoStart:!0,concurrency:1})),i.add(e))},t.awaitAllCallbacks=function(){return void 0!==i?i.onIdle():Promise.resolve()}},95324:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryChatMessageHistory=t.BaseListChatMessageHistory=t.BaseChatMessageHistory=void 0;const r=n(367),a=n(14190);class i extends r.Serializable{}t.BaseChatMessageHistory=i;class s extends r.Serializable{addUserMessage(e){return this.addMessage(new a.HumanMessage(e))}addAIChatMessage(e){return this.addMessage(new a.AIMessage(e))}addAIMessage(e){return this.addMessage(new a.AIMessage(e))}async addMessages(e){for(const t of e)await this.addMessage(t)}clear(){throw new Error("Not implemented.")}}t.BaseListChatMessageHistory=s,t.InMemoryChatMessageHistory=class extends s{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}},78137:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Document=void 0,t.Document=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}},83486:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(78137),t),a(n(63682),t)},63682:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MappingDocumentTransformer=t.BaseDocumentTransformer=void 0;const r=n(10969);class a extends r.Runnable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}}t.BaseDocumentTransformer=a,t.MappingDocumentTransformer=class extends a{async transformDocuments(e){const t=[];for(const n of e){const e=await this._transformDocument(n);t.push(e)}return t}}},75497:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Embeddings=void 0;const r=n(61583);t.Embeddings=class{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new r.AsyncCaller(e??{})}}},65004:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExampleSelector=void 0;const r=n(367);class a extends r.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","example_selectors","base"]})}}t.BaseExampleSelector=a},39781:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isChatModel=t.isLLM=t.ConditionalPromptSelector=t.BasePromptSelector=void 0;class n{async getPromptAsync(e,t){return this.getPrompt(e).partial(t?.partialVariables??{})}}t.BasePromptSelector=n,t.ConditionalPromptSelector=class extends n{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,n]of this.conditionals)if(t(e))return n;return this.defaultPrompt}},t.isLLM=function(e){return"base_llm"===e._modelType()},t.isChatModel=function(e){return"base_chat_model"===e._modelType()}},70349:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(65004),t),a(n(39781),t),a(n(61691),t),a(n(73615),t)},61691:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LengthBasedExampleSelector=void 0;const r=n(65004);function a(e){return e.split(/\n| /).length}class i extends r.BaseExampleSelector{constructor(e){super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??a}async addExample(e){this.examples.push(e);const t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;const{examples:n,examplePrompt:r}=t;return(await Promise.all(n.map((e=>r.format(e))))).map((e=>this.getTextLength(e)))}async selectExamples(e){const t=Object.values(e).join(" ");let n=this.maxLength-this.getTextLength(t),r=0;const a=[];for(;n>0&&r<this.examples.length;){const e=n-this.exampleTextLengths[r];if(e<0)break;a.push(this.examples[r]),n=e,r+=1}return a}static async fromExamples(e,t){const n=new i(t);return await Promise.all(e.map((e=>n.addExample(e)))),n}}t.LengthBasedExampleSelector=i},73615:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SemanticSimilarityExampleSelector=void 0;const r=n(78137),a=n(65004);function i(e){return Object.keys(e).sort().map((t=>e[t]))}class s extends a.BaseExampleSelector{constructor(e){if(super(e),Object.defineProperty(this,"vectorStoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys,void 0!==e.vectorStore)this.vectorStoreRetriever=e.vectorStore.asRetriever({k:e.k??4,filter:e.filter});else{if(!e.vectorStoreRetriever)throw new Error('You must specify one of "vectorStore" and "vectorStoreRetriever".');this.vectorStoreRetriever=e.vectorStoreRetriever}}async addExample(e){const t=i((this.inputKeys??Object.keys(e)).reduce(((t,n)=>({...t,[n]:e[n]})),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new r.Document({pageContent:t,metadata:e})])}async selectExamples(e){const t=i((this.inputKeys??Object.keys(e)).reduce(((t,n)=>({...t,[n]:e[n]})),{})).join(" "),n=(await this.vectorStoreRetriever.invoke(t)).map((e=>e.metadata));return this.exampleKeys?n.map((e=>this.exampleKeys.reduce(((t,n)=>({...t,[n]:e[n]})),{}))):n}static async fromExamples(e,t,n,r={}){const a=r.inputKeys??null,o=e.map((e=>i(a?a.reduce(((t,n)=>({...t,[n]:e[n]})),{}):e).join(" "))),u=await n.fromTexts(o,e,t,r);return new s({vectorStore:u,k:r.k??4,exampleKeys:r.exampleKeys,inputKeys:r.inputKeys})}}t.SemanticSimilarityExampleSelector=s},37738:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLanguageModel=t.BaseLangChain=t.calculateMaxTokens=t.getModelContextSize=t.getEmbeddingContextSize=t.getModelNameForTiktoken=void 0;const r=n(26110),a=n(5118),i=n(14190),s=n(61583),o=n(10454),u=n(10969);t.getModelNameForTiktoken=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e,t.getEmbeddingContextSize=e=>"text-embedding-ada-002"===e?8191:2046,t.getModelContextSize=e=>{switch((0,t.getModelNameForTiktoken)(e)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":default:return 4097;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":return 8e3}},t.calculateMaxTokens=async({prompt:e,modelName:n})=>{let r;try{r=(await(0,o.encodingForModel)((0,t.getModelNameForTiktoken)(n))).encode(e).length}catch(t){console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(e.length/4)}return(0,t.getModelContextSize)(n)-r};class l extends u.Runnable{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}t.BaseLangChain=l,t.BaseLanguageModel=class extends l{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){super({callbacks:e??t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof n.cache?this.cache=n.cache:n.cache?this.cache=r.InMemoryCache.global():this.cache=void 0,this.caller=new s.AsyncCaller(n??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let n=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await(0,o.encodingForModel)("modelName"in this?(0,t.getModelNameForTiktoken)(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{n=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return n}static _convertInputToPromptValue(e){return"string"==typeof e?new a.StringPromptValue(e):Array.isArray(e)?new a.ChatPromptValue(e.map(i.coerceMessageLikeToMessage)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter((([e,t])=>void 0!==t)).map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}},83296:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleChatModel=t.BaseChatModel=t.createChatMessageChunkEncoderStream=void 0;const r=n(14190),a=n(50383),i=n(37738),s=n(31413);t.createChatMessageChunkEncoderStream=function(){const e=new TextEncoder;return new TransformStream({transform(t,n){n.enqueue(e.encode("string"==typeof t.content?t.content:JSON.stringify(t.content)))}})};class o extends i.BaseLanguageModel{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n?.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}async invoke(e,t){const n=o._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===o.prototype._streamResponseChunks)yield this.invoke(e,t);else{const n=o._convertInputToPromptValue(e).toChatMessages(),[r,a]=this._separateRunnableConfigFromCallOptions(t),i=await s.CallbackManager.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),u={options:a,invocation_params:this?.invocationParams(a),batch_size:1},l=await(i?.handleChatModelStart(this.toJSON(),[n],r.runId,void 0,u,void 0,void 0,r.runName));let c;try{for await(const e of this._streamResponseChunks(n,a,l?.[0]))e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},yield e.message,c=c?c.concat(e):e}catch(e){throw await Promise.all((l??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((l??[]).map((e=>e?.handleLLMEnd({generations:[[c]]}))))}}async _generateUncached(e,t,n){const i=e.map((e=>e.map(r.coerceMessageLikeToMessage))),o=await s.CallbackManager.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),u={options:t,invocation_params:this?.invocationParams(t),batch_size:1},l=await(o?.handleChatModelStart(this.toJSON(),i,n.runId,void 0,u,void 0,void 0,n.runName)),c=await Promise.allSettled(i.map(((e,n)=>this._generate(e,{...t,promptIndex:n},l?.[n])))),d=[],p=[];await Promise.all(c.map((async(e,t)=>{if("fulfilled"===e.status){const n=e.value;for(const e of n.generations)e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};return 1===n.generations.length&&(n.generations[0].message.response_metadata={...n.llmOutput,...n.generations[0].message.response_metadata}),d[t]=n.generations,p[t]=n.llmOutput,l?.[t]?.handleLLMEnd({generations:[n.generations],llmOutput:n.llmOutput})}return await(l?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const h={generations:d,llmOutput:p.length?this._combineLLMOutput?.(...p):void 0};return Object.defineProperty(h,a.RUN_KEY,{value:l?{runIds:l?.map((e=>e.runId))}:void 0,configurable:!0}),h}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:i,handledOptions:u}){const l=e.map((e=>e.map(r.coerceMessageLikeToMessage))),c=await s.CallbackManager.configure(u.callbacks,this.callbacks,u.tags,this.tags,u.metadata,this.metadata,{verbose:this.verbose}),d={options:i,invocation_params:this?.invocationParams(i),batch_size:1,cached:!0},p=await(c?.handleChatModelStart(this.toJSON(),l,u.runId,void 0,d,void 0,void 0,u.runName)),h=[],f=(await Promise.allSettled(l.map((async(e,r)=>{const a=o._convertInputToPromptValue(e).toString(),i=await t.lookup(a,n);return null==i&&h.push(r),i})))).map(((e,t)=>({result:e,runManager:p?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),m=[];await Promise.all(f.map((async({result:e,runManager:t},n)=>{if("fulfilled"===e.status){const r=e.value;return m[n]=r,r.length&&await(t?.handleLLMNewToken(r[0].text)),t?.handleLLMEnd({generations:[r]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const g={generations:m,missingPromptIndices:h};return Object.defineProperty(g,a.RUN_KEY,{value:p?{runIds:p?.map((e=>e.runId))}:void 0,configurable:!0}),g}async generate(e,t,n){let a;a=Array.isArray(t)?{stop:t}:t;const i=e.map((e=>e.map(r.coerceMessageLikeToMessage))),[s,u]=this._separateRunnableConfigFromCallOptions(a);if(s.callbacks=s.callbacks??n,!this.cache)return this._generateUncached(i,u,s);const{cache:l}=this,c=this._getSerializedCacheKeyParametersForCall(u),{generations:d,missingPromptIndices:p}=await this._generateCached({messages:i,cache:l,llmStringKey:c,parsedOptions:u,handledOptions:s});let h={};if(p.length>0){const e=await this._generateUncached(p.map((e=>i[e])),u,s);await Promise.all(e.generations.map((async(e,t)=>{const n=p[t];d[n]=e;const r=o._convertInputToPromptValue(i[n]).toString();return l.update(r,c,e)}))),h=e.llmOutput??{}}return{generations:d,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const r=e.map((e=>e.toChatMessages()));return this.generate(r,t,n)}async call(e,t,n){return(await this.generate([e.map(r.coerceMessageLikeToMessage)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const r=e.toChatMessages();return this.call(r,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const a=new r.HumanMessage(e),i=await this.call([a],t,n);if("string"!=typeof i.content)throw new Error("Cannot use predict when output is not a string.");return i.content}}t.BaseChatModel=o,t.SimpleChatModel=class extends o{async _generate(e,t,n){const a=await this._call(e,t,n),i=new r.AIMessage(a);if("string"!=typeof i.content)throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:i.content,message:i}]}}}},85953:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LLM=t.BaseLLM=void 0;const r=n(14190),a=n(50383),i=n(31413),s=n(37738);class o extends s.BaseLanguageModel{constructor({concurrency:e,...t}){super(e?{maxConcurrency:e,...t}:t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]})}async invoke(e,t){const n=o._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptions(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n?.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}async*_streamIterator(e,t){if(this._streamResponseChunks===o.prototype._streamResponseChunks)yield this.invoke(e,t);else{const n=o._convertInputToPromptValue(e),[r,s]=this._separateRunnableConfigFromCallOptions(t),u=await i.CallbackManager.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this?.invocationParams(s),batch_size:1},c=await(u?.handleLLMStart(this.toJSON(),[n.toString()],r.runId,void 0,l,void 0,void 0,r.runName));let d=new a.GenerationChunk({text:""});try{for await(const t of this._streamResponseChunks(e.toString(),s,c?.[0]))d=d?d.concat(t):t,"string"==typeof t.text&&(yield t.text)}catch(e){throw await Promise.all((c??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((c??[]).map((e=>e?.handleLLMEnd({generations:[[d]]}))))}}async generatePrompt(e,t,n){const r=e.map((e=>e.toString()));return this.generate(r,t,n)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let n=0;n<e.generations.length;n+=1){const r=e.generations[n];if(0===n)t.push({generations:[r],llmOutput:e.llmOutput});else{const n=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[r],llmOutput:n})}}return t}async _generateUncached(e,t,n){const r=await i.CallbackManager.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s={options:t,invocation_params:this?.invocationParams(t),batch_size:e.length},o=await(r?.handleLLMStart(this.toJSON(),e,n.runId,void 0,s,void 0,void 0,n?.runName));let u;try{u=await this._generate(e,t,o?.[0])}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}const l=this._flattenLLMResult(u);await Promise.all((o??[]).map(((e,t)=>e?.handleLLMEnd(l[t]))));const c=o?.map((e=>e.runId))||void 0;return Object.defineProperty(u,a.RUN_KEY,{value:c?{runIds:c}:void 0,configurable:!0}),u}async _generateCached({prompts:e,cache:t,llmStringKey:n,parsedOptions:r,handledOptions:s,runId:o}){const u=await i.CallbackManager.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),l={options:r,invocation_params:this?.invocationParams(r),batch_size:e.length,cached:!0},c=await(u?.handleLLMStart(this.toJSON(),e,o,void 0,l,void 0,void 0,s?.runName)),d=[],p=(await Promise.allSettled(e.map((async(e,r)=>{const a=await t.lookup(e,n);return null==a&&d.push(r),a})))).map(((e,t)=>({result:e,runManager:c?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),h=[];await Promise.all(p.map((async({result:e,runManager:t},n)=>{if("fulfilled"===e.status){const r=e.value;return h[n]=r,r.length&&await(t?.handleLLMNewToken(r[0].text)),t?.handleLLMEnd({generations:[r]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const f={generations:h,missingPromptIndices:d};return Object.defineProperty(f,a.RUN_KEY,{value:c?{runIds:c?.map((e=>e.runId))}:void 0,configurable:!0}),f}async generate(e,t,n){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let r;r=Array.isArray(t)?{stop:t}:t;const[a,i]=this._separateRunnableConfigFromCallOptions(r);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(e,i,a);const{cache:s}=this,o=this._getSerializedCacheKeyParametersForCall(i),{generations:u,missingPromptIndices:l}=await this._generateCached({prompts:e,cache:s,llmStringKey:o,parsedOptions:i,handledOptions:a,runId:a.runId});let c={};if(l.length>0){const t=await this._generateUncached(l.map((t=>e[t])),i,a);await Promise.all(t.generations.map((async(t,n)=>{const r=l[n];return u[r]=t,s.update(e[r],o,t)}))),c=t.llmOutput??{}}return{generations:u,llmOutput:c}}async call(e,t,n){const{generations:r}=await this.generate([e],t,n);return r[0][0].text}async predict(e,t,n){return this.call(e,t,n)}async predictMessages(e,t,n){const a=(0,r.getBufferString)(e),i=await this.call(a,t,n);return new r.AIMessage(i)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}}t.BaseLLM=o,t.LLM=class extends o{async _generate(e,t,n){return{generations:await Promise.all(e.map(((e,r)=>this._call(e,{...t,promptIndex:r},n).then((e=>[{text:e}])))))}}}},34371:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mapKeys=t.keyFromJson=t.keyToJson=void 0;const a=r(n(79478)),i=r(n(12729));t.keyToJson=function(e,t){return t?.[e]||(0,a.default)(e)},t.keyFromJson=function(e,t){return t?.[e]||(0,i.default)(e)},t.mapKeys=function(e,t,n){const r={};for(const a in e)Object.hasOwn(e,a)&&(r[t(a,n)]=e[a]);return r}},367:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Serializable=t.get_lc_unique_name=void 0;const r=n(34371);function a(e){return Array.isArray(e)?[...e]:{...e}}function i(e,t){const n=a(e);for(const[e,r]of Object.entries(t)){const[t,...i]=e.split(".").reverse();let s=n;for(const e of i.reverse()){if(void 0===s[e])break;s[e]=a(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[r]})}return n}function s(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}t.get_lc_unique_name=s;class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let r=Object.getPrototypeOf(this);r;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r,"lc_aliases",this)),Object.assign(t,Reflect.get(r,"lc_secrets",this)),Object.assign(n,Reflect.get(r,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,r=n;const[a,...i]=e.split(".").reverse();for(const e of i.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}a in t&&void 0!==t[a]&&(r[a]=r[a]||t[a])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:(0,r.mapKeys)(Object.keys(t).length?i(n,t):n,r.keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}t.Serializable=o},61834:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPromptInputKey=t.getOutputValue=t.getInputValue=t.BaseMemory=void 0,t.BaseMemory=class{};const n=(e,t)=>{if(void 0!==t)return e[t];const n=Object.keys(e);return 1===n.length?e[n[0]]:void 0};t.getInputValue=(e,t)=>{const r=n(e,t);if(!r){const t=Object.keys(e);throw new Error(`input values have ${t.length} keys, you must specify an input key or pass only 1 key as input`)}return r},t.getOutputValue=(e,t)=>{const r=n(e,t);if(!r){const t=Object.keys(e);throw new Error(`output values have ${t.length} keys, you must specify an output key or pass only 1 key as output`)}return r},t.getPromptInputKey=function(e,t){const n=Object.keys(e).filter((e=>!t.includes(e)&&"stop"!==e));if(1!==n.length)throw new Error(`One input key expected, but got ${n.length}`);return n[0]}},6796:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AIMessageChunk=t.isAIMessage=t.AIMessage=void 0;const r=n(39803),a=n(15785),i=n(53752);class s extends a.BaseMessage{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let n;if("string"==typeof e)n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const t=n.additional_kwargs?.tool_calls,r=n.tool_calls;null!=t&&t.length>0&&(void 0===r||0===r.length)&&console.warn(["New LangChain packages are available that more efficiently handle","tool calling.\n\nPlease upgrade your packages to versions that set","message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(null!=t&&void 0===r){const[e,r]=(0,i.defaultToolCallParser)(t);n.tool_calls=e??[],n.invalid_tool_calls=r??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch(e){n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),"string"!=typeof n&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}}t.AIMessage=s,t.isAIMessage=function(e){return"ai"===e._getType()};class o extends a.BaseMessageChunk{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const n=[],a=[];for(const t of e.tool_call_chunks){let e={};try{if(e=(0,r.parsePartialJson)(t.args??"{}")??{},"object"!=typeof e||Array.isArray(e))throw new Error("Malformed tool call chunk args.");n.push({name:t.name??"",args:e,id:t.id})}catch(e){a.push({name:t.name,args:t.args,id:t.id,error:"Malformed args."})}}t={...e,tool_calls:n,invalid_tool_calls:a}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=t?.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t?.tool_calls??this.tool_calls,this.invalid_tool_calls=t?.invalid_tool_calls??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const t={content:(0,a.mergeContent)(this.content,e.content),additional_kwargs:(0,a._mergeDicts)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a._mergeDicts)(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const n=(0,a._mergeLists)(this.tool_call_chunks,e.tool_call_chunks);void 0!==n&&n.length>0&&(t.tool_call_chunks=n)}return new o(t)}}t.AIMessageChunk=o},15785:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBaseMessageChunk=t.isBaseMessage=t.BaseMessageChunk=t._mergeLists=t._mergeDicts=t.isOpenAIToolCallArray=t.BaseMessage=t.mergeContent=void 0;const r=n(367);t.mergeContent=function(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]};class a extends r.Serializable{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function i(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(null==n[e])n[e]=r;else{if(null==r)continue;if(typeof n[e]!=typeof r||Array.isArray(n[e])!==Array.isArray(r))throw new Error(`field[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof n[e])n[e]=n[e]+r;else if(Array.isArray(n[e])||"object"!=typeof n[e])if(Array.isArray(n[e]))n[e]=s(n[e],r);else{if(n[e]===r)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else n[e]=i(n[e],r)}return n}function s(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const n=[...e];for(const e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){const t=n.findIndex((t=>t.index===e.index));-1!==t?n[t]=i(n[t],e):n.push(e)}else n.push(e);return n}}}function o(e){return"function"==typeof e?._getType}t.BaseMessage=a,t.isOpenAIToolCallArray=function(e){return Array.isArray(e)&&e.every((e=>"number"==typeof e.index))},t._mergeDicts=i,t._mergeLists=s,t.BaseMessageChunk=class extends a{},t.isBaseMessage=o,t.isBaseMessageChunk=function(e){return o(e)&&"function"==typeof e.concat}},26064:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessageChunk=t.ChatMessage=void 0;const r=n(15785);class a extends r.BaseMessage{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return a}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}t.ChatMessage=a;class i extends r.BaseMessageChunk{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new i({content:(0,r.mergeContent)(this.content,e.content),additional_kwargs:(0,r._mergeDicts)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r._mergeDicts)(this.response_metadata,e.response_metadata),role:this.role})}}t.ChatMessageChunk=i},79102:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionMessageChunk=t.FunctionMessage=void 0;const r=n(15785);class a extends r.BaseMessage{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}t.FunctionMessage=a;class i extends r.BaseMessageChunk{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new i({content:(0,r.mergeContent)(this.content,e.content),additional_kwargs:(0,r._mergeDicts)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r._mergeDicts)(this.response_metadata,e.response_metadata),name:this.name??""})}}t.FunctionMessageChunk=i},57669:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HumanMessageChunk=t.HumanMessage=void 0;const r=n(15785);class a extends r.BaseMessage{static lc_name(){return"HumanMessage"}_getType(){return"human"}}t.HumanMessage=a;class i extends r.BaseMessageChunk{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new i({content:(0,r.mergeContent)(this.content,e.content),additional_kwargs:(0,r._mergeDicts)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r._mergeDicts)(this.response_metadata,e.response_metadata)})}}t.HumanMessageChunk=i},14190:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ToolMessageChunk=t.ToolMessage=void 0,a(n(6796),t),a(n(15785),t),a(n(26064),t),a(n(79102),t),a(n(57669),t),a(n(52133),t),a(n(68081),t);var i=n(53752);Object.defineProperty(t,"ToolMessage",{enumerable:!0,get:function(){return i.ToolMessage}}),Object.defineProperty(t,"ToolMessageChunk",{enumerable:!0,get:function(){return i.ToolMessageChunk}})},52133:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SystemMessageChunk=t.SystemMessage=void 0;const r=n(15785);class a extends r.BaseMessage{static lc_name(){return"SystemMessage"}_getType(){return"system"}}t.SystemMessage=a;class i extends r.BaseMessageChunk{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new i({content:(0,r.mergeContent)(this.content,e.content),additional_kwargs:(0,r._mergeDicts)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r._mergeDicts)(this.response_metadata,e.response_metadata)})}}t.SystemMessageChunk=i},53752:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultToolCallParser=t.ToolMessageChunk=t.ToolMessage=void 0;const r=n(15785);class a extends r.BaseMessage{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){"string"==typeof e&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}}t.ToolMessage=a;class i extends r.BaseMessageChunk{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new i({content:(0,r.mergeContent)(this.content,e.content),additional_kwargs:(0,r._mergeDicts)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,r._mergeDicts)(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}}t.ToolMessageChunk=i,t.defaultToolCallParser=function(e){const t=[],n=[];for(const r of e)if(r.function){const e=r.function.name;try{const n={name:e||"",args:JSON.parse(r.function.arguments)||{},id:r.id};t.push(n)}catch(t){n.push({name:e,args:r.function.arguments,id:r.id,error:"Malformed args."})}}return[t,n]}},68081:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertToChunk=t.mapChatMessagesToStoredMessages=t.mapStoredMessagesToChatMessages=t.mapStoredMessageToChatMessage=t.getBufferString=t.coerceMessageLikeToMessage=void 0;const r=n(15785),a=n(57669),i=n(6796),s=n(52133),o=n(26064),u=n(79102),l=n(53752);function c(e){const t=function(e){if(void 0!==e.data)return e;{const t=e;return{type:t.type,data:{content:t.text,role:t.role,name:void 0,tool_call_id:void 0}}}}(e);switch(t.type){case"human":return new a.HumanMessage(t.data);case"ai":return new i.AIMessage(t.data);case"system":return new s.SystemMessage(t.data);case"function":if(void 0===t.data.name)throw new Error("Name must be defined for function messages");return new u.FunctionMessage(t.data);case"tool":if(void 0===t.data.tool_call_id)throw new Error("Tool call ID must be defined for tool messages");return new l.ToolMessage(t.data);case"chat":if(void 0===t.data.role)throw new Error("Role must be defined for chat messages");return new o.ChatMessage(t.data);default:throw new Error(`Got unexpected type: ${t.type}`)}}t.coerceMessageLikeToMessage=function(e){if("string"==typeof e)return new a.HumanMessage(e);if((0,r.isBaseMessage)(e))return e;const[t,n]=e;if("human"===t||"user"===t)return new a.HumanMessage({content:n});if("ai"===t||"assistant"===t)return new i.AIMessage({content:n});if("system"===t)return new s.SystemMessage({content:n});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")},t.getBufferString=function(e,t="Human",n="AI"){const r=[];for(const a of e){let e;if("human"===a._getType())e=t;else if("ai"===a._getType())e=n;else if("system"===a._getType())e="System";else if("function"===a._getType())e="Function";else if("tool"===a._getType())e="Tool";else{if("generic"!==a._getType())throw new Error(`Got unsupported message type: ${a._getType()}`);e=a.role}const i=a.name?`${a.name}, `:"";r.push(`${e}: ${i}${a.content}`)}return r.join("\n")},t.mapStoredMessageToChatMessage=c,t.mapStoredMessagesToChatMessages=function(e){return e.map(c)},t.mapChatMessagesToStoredMessages=function(e){return e.map((e=>e.toDict()))},t.convertToChunk=function(e){const t=e._getType();if("human"===t)return new a.HumanMessageChunk({...e});if("ai"===t)return new i.AIMessageChunk({...e});if("system"===t)return new s.SystemMessageChunk({...e});if("function"===t)return new u.FunctionMessageChunk({...e});if(o.ChatMessage.isInstance(e))return new o.ChatMessageChunk({...e});throw new Error("Unknown message type.")}},37255:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutputParserException=t.BaseOutputParser=t.BaseLLMOutputParser=void 0;const r=n(37534);class a extends r.Runnable{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig((async(e,t)=>this.parseResult([{text:e}],t?.callbacks)),e,{...t,runType:"parser"}):this._callWithConfig((async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks)),e,{...t,runType:"parser"})}}t.BaseLLMOutputParser=a,t.BaseOutputParser=class extends a{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}};class i extends Error{constructor(e,t,n,r=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=r,r&&(void 0===n||void 0===t))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}t.OutputParserException=i},56825:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BytesOutputParser=void 0;const r=n(28580);class a extends r.BaseTransformOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","bytes"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"textEncoder",{enumerable:!0,configurable:!0,writable:!0,value:new TextEncoder})}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}}t.BytesOutputParser=a},96404:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(37255),t),a(n(56825),t),a(n(62080),t),a(n(51227),t),a(n(28273),t),a(n(28580),t),a(n(29542),t),a(n(17819),t)},29542:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseJsonMarkdown=t.parsePartialJson=t.JsonOutputParser=void 0;const r=n(28580),a=n(96096),i=n(39803);Object.defineProperty(t,"parseJsonMarkdown",{enumerable:!0,get:function(){return i.parseJsonMarkdown}}),Object.defineProperty(t,"parsePartialJson",{enumerable:!0,get:function(){return i.parsePartialJson}});class s extends r.BaseCumulativeTransformOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?(0,a.compare)(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return(0,i.parseJsonMarkdown)(e[0].text)}async parse(e){return(0,i.parseJsonMarkdown)(e,JSON.parse)}getFormatInstructions(){return""}}t.JsonOutputParser=s},62080:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkdownListOutputParser=t.NumberedListOutputParser=t.CustomListOutputParser=t.CommaSeparatedListOutputParser=t.ListOutputParser=void 0;const r=n(37255),a=n(28580);class i extends a.BaseTransformOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async*_transform(e){let t="";for await(const n of e)if(t+="string"==typeof n?n:n.content,this.re){const e=[...t.matchAll(this.re)];if(e.length>1){let n=0;for(const t of e.slice(0,-1))yield[t[1]],n+=(t.index??0)+t[0].length;t=t.slice(n)}}else{const e=await this.parse(t);if(e.length>1){for(const t of e.slice(0,-1))yield[t];t=e[e.length-1]}}for(const e of await this.parse(t))yield[e]}}t.ListOutputParser=i,t.CommaSeparatedListOutputParser=class extends i{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map((e=>e.trim()))}catch(t){throw new r.OutputParserException(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},t.CustomListOutputParser=class extends i{constructor({length:e,separator:t}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.length=e,this.separator=t||","}async parse(e){try{const t=e.trim().split(this.separator).map((e=>e.trim()));if(void 0!==this.length&&t.length!==this.length)throw new r.OutputParserException(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){if(Object.getPrototypeOf(t)===r.OutputParserException.prototype)throw t;throw new r.OutputParserException(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${void 0===this.length?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},t.NumberedListOutputParser=class extends i{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/\d+\.\s([^\n]+)/g})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return"Your response should be a numbered list with each item on a new line. For example: \n\n1. foo\n\n2. bar\n\n3. baz"}async parse(e){return[...e.matchAll(this.re)??[]].map((e=>e[1]))}},t.MarkdownListOutputParser=class extends i{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/^\s*[-*]\s([^\n]+)$/gm})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return"Your response should be a numbered list with each item on a new line. For example: \n\n1. foo\n\n2. bar\n\n3. baz"}async parse(e){return[...e.matchAll(this.re)??[]].map((e=>e[1]))}}},33359:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(60264),t)},60264:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonOutputKeyToolsParser=t.JsonOutputToolsParser=t.makeInvalidToolCall=t.convertLangChainToolCallToOpenAI=t.parseToolCall=void 0;const r=n(37255),a=n(29542);function i(e,t){if(void 0===e.function)return;let n;if(t?.partial)try{n=(0,a.parsePartialJson)(e.function.arguments??"{}")}catch(e){return}else try{n=JSON.parse(e.function.arguments)}catch(t){throw new r.OutputParserException([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${t.message}`].join("\n"))}const i={name:e.function.name,args:n};return t?.returnId&&(i.id=e.id),i}t.parseToolCall=i,t.convertLangChainToolCallToOpenAI=function(e){if(void 0===e.id)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}},t.makeInvalidToolCall=function(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t}};class s extends r.BaseLLMOutputParser{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}async parseResult(e){const t=e[0].message.additional_kwargs.tool_calls;if(!t)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);const n=JSON.parse(JSON.stringify(t)),r=[];for(const e of n){const t=i(e,{partial:!0});if(void 0!==t){const e={type:t.name,args:t.args,id:t.id};Object.defineProperty(e,"name",{get(){return this.type}}),Object.defineProperty(e,"arguments",{get(){return this.args}}),r.push(e)}}return r}}t.JsonOutputToolsParser=s;class o extends r.BaseLLMOutputParser{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.initialParser=new s(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new r.OutputParserException(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=(await this.initialParser.parseResult(e)).filter((e=>e.type===this.keyName));let n=t;return this.returnId||(n=t.map((e=>e.args))),this.returnSingle?this._validateResult(n[0]):await Promise.all(n.map((e=>this._validateResult(e))))}}t.JsonOutputKeyToolsParser=o},51227:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringOutputParser=void 0;const r=n(28580);class a extends r.BaseTransformOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce(((e,t)=>e+this._messageContentComplexToString(t)),"")}}t.StringOutputParser=a},28273:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsymmetricStructuredOutputParser=t.JsonMarkdownStructuredOutputParser=t.StructuredOutputParser=void 0;const r=n(21614),a=n(39340),i=n(37255);class s extends i.BaseOutputParser{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(r.z.object(Object.fromEntries(Object.entries(e).map((([e,t])=>[e,r.z.string().describe(t)])))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.\n\n"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.\n\nFor example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}\nwould match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.\nThus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.\n\nYour output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!\n\nHere is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:\n\`\`\`json\n${JSON.stringify((0,a.zodToJsonSchema)(this.schema))}\n\`\`\`\n`}async parse(e){try{const t=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,((e,t)=>`"${t.replace(/\n/g,"\\n")}"`)).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new i.OutputParserException(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}t.StructuredOutputParser=s;class o extends s{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const t=e?.interpolationDepth??1;if(t<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:\n\`\`\`json\n${this._schemaToInstruction((0,a.zodToJsonSchema)(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}\n\`\`\``}_schemaToInstruction(e,t=2){const n=e;if("type"in n){let e,r=!1;if(Array.isArray(n.type)){const t=n.type.findIndex((e=>"null"===e));-1!==t&&(r=!0,n.type.splice(t,1)),e=n.type.join(" | ")}else e=n.type;if("object"===n.type&&n.properties){const e=n.description?` // ${n.description}`:"";return`{\n${Object.entries(n.properties).map((([e,r])=>{const a=n.required?.includes(e)?"":" (optional)";return`${" ".repeat(t)}"${e}": ${this._schemaToInstruction(r,t+2)}${a}`})).join("\n")}\n${" ".repeat(t-2)}}${e}`}if("array"===n.type&&n.items){const e=n.description?` // ${n.description}`:"";return`array[\n${" ".repeat(t)}${this._schemaToInstruction(n.items,t+2)}\n${" ".repeat(t-2)}] ${e}`}const a=r?" (nullable)":"";return`${e}${n.description?` // ${n.description}`:""}${a}`}if("anyOf"in n)return n.anyOf.map((e=>this._schemaToInstruction(e,t))).join(`\n${" ".repeat(t-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(r.z.object(Object.fromEntries(Object.entries(e).map((([e,t])=>[e,r.z.string().describe(t)])))))}}t.JsonMarkdownStructuredOutputParser=o;class u extends i.BaseOutputParser{constructor({inputSchema:e}){super(...arguments),Object.defineProperty(this,"structuredInputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.structuredInputParser=new o(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(t){throw new i.OutputParserException(`Failed to parse. Text: "${e}". Error: ${t}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}}t.AsymmetricStructuredOutputParser=u},28580:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCumulativeTransformOutputParser=t.BaseTransformOutputParser=void 0;const r=n(37255),a=n(15785),i=n(68081),s=n(50383),o=n(57236);class u extends r.BaseOutputParser{async*_transform(e){for await(const t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}t.BaseTransformOutputParser=u,t.BaseCumulativeTransformOutputParser=class extends u{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(const r of e){if("string"!=typeof r&&"string"!=typeof r.content)throw new Error("Cannot handle non-string output.");let e;if((0,a.isBaseMessageChunk)(r)){if("string"!=typeof r.content)throw new Error("Cannot handle non-string message output.");e=new s.ChatGenerationChunk({message:r,text:r.content})}else if((0,a.isBaseMessage)(r)){if("string"!=typeof r.content)throw new Error("Cannot handle non-string message output.");e=new s.ChatGenerationChunk({message:(0,i.convertToChunk)(r),text:r.content})}else e=new s.GenerationChunk({text:r});n=void 0===n?e:n.concat(e);const u=await this.parsePartialResult([n]);null==u||(0,o.deepCompareStrict)(u,t)||(this.diff?yield this._diff(t,u):yield u,t=u)}}}},17819:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseXMLMarkdown=t.XMLOutputParser=t.XML_FORMAT_INSTRUCTIONS=void 0;const r=n(28580),a=n(96096),i=n(26548);t.XML_FORMAT_INSTRUCTIONS='The output should be formatted as a XML file.\n1. Output should conform to the tags below. \n2. If tags are not given, make them on your own.\n3. Remember to always open and close all the tags.\n\nAs an example, for the tags ["foo", "bar", "baz"]:\n1. String "<foo>\n   <bar>\n      <baz></baz>\n   </bar>\n</foo>" is a well-formatted instance of the schema. \n2. String "<foo>\n   <bar>\n   </foo>" is a badly-formatted instance.\n3. String "<foo>\n   <tag>\n   </tag>\n</foo>" is a badly-formatted instance.\n\nHere are the output tags:\n```\n{tags}\n```';class s extends r.BaseCumulativeTransformOutputParser{constructor(e){super(e),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tags=e?.tags}static lc_name(){return"XMLOutputParser"}_diff(e,t){if(t)return e?(0,a.compare)(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return l(e[0].text)}async parse(e){return l(e)}getFormatInstructions(){return this.tags&&this.tags.length>0?t.XML_FORMAT_INSTRUCTIONS.replace("{tags}",this.tags?.join(", ")??""):t.XML_FORMAT_INSTRUCTIONS}}t.XMLOutputParser=s;const o=e=>e.split("\n").map((e=>e.replace(/^\s+/,""))).join("\n").trim(),u=e=>{if(0===Object.keys(e).length)return{};const t={};return e.children.length>0?(t[e.name]=e.children.map(u),t):(t[e.name]=e.text??void 0,t)};function l(e){const t=o(e),n=i.sax.parser(!0);let r={};const a=[];n.onopentag=e=>{const t={name:e.name,attributes:e.attributes,children:[],text:"",isSelfClosing:e.isSelfClosing};a.length>0?a[a.length-1].children.push(t):r=t,e.isSelfClosing||a.push(t)},n.onclosetag=()=>{if(a.length>0){const e=a.pop();0===a.length&&e&&(r=e)}},n.ontext=e=>{a.length>0&&(a[a.length-1].text+=e)},n.onattribute=e=>{a.length>0&&(a[a.length-1].attributes[e.name]=e.value)};const s=/```(xml)?(.*)```/s.exec(t),l=s?s[2]:t;return n.write(l).close(),r&&"?xml"===r.name&&(r=r.children[0]),u(r)}t.parseXMLMarkdown=l},50383:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatGenerationChunk=t.GenerationChunk=t.RUN_KEY=void 0,t.RUN_KEY="__run";class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}t.GenerationChunk=n;class r extends n{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}t.ChatGenerationChunk=r},5118:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImagePromptValue=t.ChatPromptValue=t.StringPromptValue=t.BasePromptValue=void 0;const r=n(367),a=n(14190);class i extends r.Serializable{}t.BasePromptValue=i,t.StringPromptValue=class extends i{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new a.HumanMessage(this.value)]}},t.ChatPromptValue=class extends i{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,a.getBufferString)(this.messages)}toChatMessages(){return this.messages}},t.ImagePromptValue=class extends i{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new a.HumanMessage({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},61528:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BasePromptTemplate=void 0;const r=n(10969);class a extends r.Runnable{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},n={};for(const[e,r]of Object.entries(t))n[e]="string"==typeof r?r:await r();return{...n,...e}}async invoke(e,t){return this._callWithConfig((e=>this.formatPromptValue(e)),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.all([n.e(364),n.e(577)]).then(n.bind(n,23650));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.all([n.e(364),n.e(577)]).then(n.bind(n,23650));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.all([n.e(771),n.e(364),n.e(577)]).then(n.bind(n,62771));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}t.BasePromptTemplate=a},32353:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPromptTemplate=t.SystemMessagePromptTemplate=t.AIMessagePromptTemplate=t.HumanMessagePromptTemplate=t.ChatMessagePromptTemplate=t.BaseChatPromptTemplate=t.BaseMessageStringPromptTemplate=t.MessagesPlaceholder=t.BaseMessagePromptTemplate=void 0;const r=n(14190),a=n(5118),i=n(10969),s=n(36760),o=n(61528),u=n(71889),l=n(10934),c=n(4993);class d extends i.Runnable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig((e=>this.formatMessages(e)),e,{...t,runType:"prompt"})}}t.BaseMessagePromptTemplate=d;class p extends d{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}validateInputOrThrow(e,t){if(this.optional&&!e)return!1;if(!e){const e=new Error(`Error: Field "${t}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw e.name="InputFormatError",e}let n=!1;if(n=Array.isArray(e)?e.every((e=>(0,r.isBaseMessage)(e))):(0,r.isBaseMessage)(e),!n){const n="string"==typeof e?e:JSON.stringify(e,null,2),r=new Error(`Error: Field "${t}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${n}`);throw r.name="InputFormatError",r}return!0}async formatMessages(e){return this.validateInputOrThrow(e[this.variableName],this.variableName),e[this.variableName]??[]}}t.MessagesPlaceholder=p;class h extends d{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}t.BaseMessageStringPromptTemplate=h;class f extends o.BasePromptTemplate{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new a.ChatPromptValue(t)}}t.BaseChatPromptTemplate=f;class m extends h{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new r.ChatMessage(await this.prompt.format(e),this.role)}static fromTemplate(e,t,n){return new this(u.PromptTemplate.fromTemplate(e,{templateFormat:n?.templateFormat}),t)}}t.ChatMessagePromptTemplate=m;class g extends d{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let e=[];this.prompt.forEach((t=>{"inputVariables"in t&&(e=e.concat(t.inputVariables))})),this.inputVariables=e}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass())return new(t._messageClass())({content:e});if(t.chatMessageClass){const n=t.chatMessageClass();return new n({content:e,role:this.getRoleFromMessageClass(n.lc_name())})}throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if("string"==typeof e)return new this(u.PromptTemplate.fromTemplate(e,t));const n=[];for(const t of e)if("string"==typeof t||"object"==typeof t&&"text"in t){let e="";"string"==typeof t?e=t:"string"==typeof t.text&&(e=t.text??""),n.push(u.PromptTemplate.fromTemplate(e))}else if("object"==typeof t&&"image_url"in t){let e,r=t.image_url??"",a=[];if("string"==typeof r){const t=(0,c.parseFString)(r).flatMap((e=>"variable"===e.type?[e.name]:[]));if((t?.length??0)>0){if(t.length>1)throw new Error(`Only one format variable allowed per image template.\nGot: ${t}\nFrom: ${r}`);a=[t[0]]}else a=[];r={url:r},e=new l.ImagePromptTemplate({template:r,inputVariables:a})}else{if("object"!=typeof r)throw new Error("Invalid image template");a="url"in r?(0,c.parseFString)(r.url).flatMap((e=>"variable"===e.type?[e.name]:[])):[],e=new l.ImagePromptTemplate({template:r,inputVariables:a})}n.push(e)}return new this({prompt:n,additionalOptions:t})}async format(e){if(this.prompt instanceof s.BaseStringPromptTemplate){const t=await this.prompt.format(e);return this.createMessage(t)}{const t=[];for(const n of this.prompt){let r={};if(!("inputVariables"in n))throw new Error(`Prompt ${n} does not have inputVariables defined.`);for(const t of n.inputVariables)r||(r={[t]:e[t]}),r={...r,[t]:e[t]};if(n instanceof s.BaseStringPromptTemplate){const e=await n.format(r);t.push({type:"text",text:e})}else if(n instanceof l.ImagePromptTemplate){const e=await n.format(r);t.push({type:"image_url",image_url:e})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class b extends g{static _messageClass(){return r.HumanMessage}static lc_name(){return"HumanMessagePromptTemplate"}}t.HumanMessagePromptTemplate=b;class y extends g{static _messageClass(){return r.AIMessage}static lc_name(){return"AIMessagePromptTemplate"}}t.AIMessagePromptTemplate=y;class v extends g{static _messageClass(){return r.SystemMessage}static lc_name(){return"SystemMessagePromptTemplate"}}function _(e,t){if("function"==typeof e.formatMessages||(0,r.isBaseMessage)(e))return e;if(Array.isArray(e)&&"placeholder"===e[0]){const t=e[1];if("string"!=typeof t||"{"!==t[0]||"}"!==t[t.length-1])throw new Error(`Invalid placeholder template: "${e[1]}". Expected a variable name surrounded by curly braces.`);const n=t.slice(1,-1);return new p({variableName:n,optional:!0})}const n=(0,r.coerceMessageLikeToMessage)(e);let a;if(a="string"==typeof n.content?n.content:n.content.map((e=>"text"in e?{text:e.text}:"image_url"in e?{image_url:e.image_url}:e)),"human"===n._getType())return b.fromTemplate(a,t);if("ai"===n._getType())return y.fromTemplate(a,t);if("system"===n._getType())return v.fromTemplate(a,t);if(r.ChatMessage.isInstance(n))return m.fromTemplate(n.content,n.role,t);throw new Error(`Could not coerce message prompt template from input. Received message type: "${n._getType()}".`)}t.SystemMessagePromptTemplate=v;class w extends f{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)if(!(t instanceof r.BaseMessage))for(const n of t.inputVariables)e.add(n);const t=this.inputVariables,n=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),a=new Set([...n].filter((t=>!e.has(t))));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);const i=new Set([...e].filter((e=>!n.has(e))));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;const n=await Promise.all(e.content.map((async e=>{if("image_url"!==e.type)return e;let n="";n="string"==typeof e.image_url?e.image_url:e.image_url.url;const r=u.PromptTemplate.fromTemplate(n),a=await r.format(t);return"string"!=typeof e.image_url&&"url"in e.image_url?e.image_url.url=a:e.image_url=a,e})));return e.content=n,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let n=[];for(const e of this.promptMessages)if(e instanceof r.BaseMessage)n.push(await this._parseImagePrompts(e,t));else{const r=e.inputVariables.reduce(((n,r)=>{if(!(r in t||"MessagesPlaceholder"===e.constructor.lc_name()&&e.optional))throw new Error(`Missing value for input variable \`${r.toString()}\``);return n[r]=t[r],n}),{}),a=await e.formatMessages(r);n=n.concat(a)}return n}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new w(r)}static fromTemplate(e,t){const n=u.PromptTemplate.fromTemplate(e,t),r=new b({prompt:n});return this.fromMessages([r])}static fromMessages(e,t){const n=e.reduce(((e,n)=>e.concat(n instanceof w?n.promptMessages:[_(n,t)])),[]),a=e.reduce(((e,t)=>t instanceof w?Object.assign(e,t.partialVariables):e),Object.create(null)),i=new Set;for(const e of n)if(!(e instanceof r.BaseMessage))for(const t of e.inputVariables)t in a||i.add(t);return new this({...t,inputVariables:[...i],promptMessages:n,partialVariables:a,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}t.ChatPromptTemplate=w},32406:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FewShotChatMessagePromptTemplate=t.FewShotPromptTemplate=void 0;const r=n(36760),a=n(4993),i=n(71889),s=n(32353);class o extends r.BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new o(r)}async format(e){const t=await this.mergePartialAndUserVariables(e),n=await this.getExamples(t),r=await Promise.all(n.map((e=>this.examplePrompt.format(e)))),i=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return(0,a.renderTemplate)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const n=await i.PromptTemplate.deserialize(t);let r;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return r=e.examples,new o({inputVariables:e.input_variables,examplePrompt:n,examples:r,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}t.FewShotPromptTemplate=o;class u extends s.BaseChatPromptTemplate{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let n=await this.getExamples(t);n=n.map((e=>{const t={};return this.examplePrompt.inputVariables.forEach((n=>{t[n]=e[n]})),t}));const r=[];for(const e of n){const t=await this.examplePrompt.formatMessages(e);r.push(...t)}return r}async format(e){const t=await this.mergePartialAndUserVariables(e),n=await this.getExamples(t),r=(await Promise.all(n.map((e=>this.examplePrompt.formatMessages(e))))).flat().map((e=>e.content)),i=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return(0,a.renderTemplate)(i,this.templateFormat,t)}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new u(r)}}t.FewShotChatMessagePromptTemplate=u},10934:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImagePromptTemplate=void 0;const r=n(5118),a=n(61528),i=n(4993);class s extends a.BasePromptTemplate{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.checkValidTemplate)([{type:"image_url",image_url:this.template}],this.templateFormat,e)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new s(r)}async format(e){const t={};for(const[n,r]of Object.entries(this.template))t[n]="string"==typeof r?r.replace(/{([^{}]*)}/g,((t,n)=>{const r=e[n];return"string"==typeof r||"number"==typeof r?String(r):t})):r;const n=e.url||t.url,r=e.detail||t.detail;if(!n)throw new Error("Must provide either an image URL.");if("string"!=typeof n)throw new Error("url must be a string.");const a={url:n};return r&&(a.detail=r),a}async formatPromptValue(e){const t=await this.format(e);return new r.ImagePromptValue(t)}}t.ImagePromptTemplate=s},96193:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(61528),t),a(n(32353),t),a(n(32406),t),a(n(70697),t),a(n(71889),t),a(n(97470),t),a(n(36760),t),a(n(4993),t),a(n(10934),t),a(n(83810),t)},70697:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelinePromptTemplate=void 0;const r=n(61528),a=n(32353);class i extends r.BasePromptTemplate{static lc_name(){return"PipelinePromptTemplate"}constructor(e){super({...e,inputVariables:[]}),Object.defineProperty(this,"pipelinePrompts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finalPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pipelinePrompts=e.pipelinePrompts,this.finalPrompt=e.finalPrompt,this.inputVariables=this.computeInputValues()}computeInputValues(){const e=this.pipelinePrompts.map((e=>e.name)),t=this.pipelinePrompts.map((t=>t.prompt.inputVariables.filter((t=>!e.includes(t))))).flat();return[...new Set(t)]}static extractRequiredInputValues(e,t){return t.reduce(((t,n)=>(t[n]=e[n],t)),{})}async formatPipelinePrompts(e){const t=await this.mergePartialAndUserVariables(e);for(const{name:e,prompt:n}of this.pipelinePrompts){const r=i.extractRequiredInputValues(t,n.inputVariables);n instanceof a.ChatPromptTemplate?t[e]=await n.formatMessages(r):t[e]=await n.format(r)}return i.extractRequiredInputValues(t,this.finalPrompt.inputVariables)}async formatPromptValue(e){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(e))}async format(e){return this.finalPrompt.format(await this.formatPipelinePrompts(e))}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter((t=>!(t in e))),t.partialVariables={...this.partialVariables??{},...e},new i(t)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}}t.PipelinePromptTemplate=i},71889:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromptTemplate=void 0;const r=n(36760),a=n(4993);class i extends r.BaseStringPromptTemplate{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if("mustache"===this.templateFormat)throw new Error("Mustache templates cannot be validated.");let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,a.checkValidTemplate)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return(0,a.renderTemplate)(this.template,this.templateFormat,t)}static fromExamples(e,t,n,r="\n\n",a=""){const s=[a,...e,t].join(r);return new i({inputVariables:n,template:s})}static fromTemplate(e,t){const{templateFormat:n="f-string",...r}=t??{},s=new Set;return(0,a.parseTemplate)(e,n).forEach((e=>{"variable"===e.type&&s.add(e.name)})),new i({inputVariables:[...s],templateFormat:n,template:e,...r})}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new i(r)}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new i({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}t.PromptTemplate=i},97470:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},36760:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStringPromptTemplate=void 0;const r=n(5118),a=n(61528);class i extends a.BasePromptTemplate{async formatPromptValue(e){const t=await this.format(e);return new r.StringPromptValue(t)}}t.BaseStringPromptTemplate=i},83810:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StructuredPrompt=void 0;const r=n(32353);function a(e){return"object"==typeof e&&null!=e&&"withStructuredOutput"in e&&"function"==typeof e.withStructuredOutput}class i extends r.ChatPromptTemplate{get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","structured"]}),this.schema=e.schema}pipe(e){if(a(e))return super.pipe(e.withStructuredOutput(this.schema));if("object"==typeof(t=e)&&null!=t&&"lc_id"in t&&Array.isArray(t.lc_id)&&"langchain_core/runnables/RunnableBinding"===t.lc_id.join("/")&&a(e.bound))return super.pipe(e.bound.withStructuredOutput(this.schema).bind(e.kwargs??{}).withConfig(e.config));var t;throw new Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(e,t){return i.fromMessages(e,{schema:t})}}t.StructuredPrompt=i},4993:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkValidTemplate=t.parseTemplate=t.renderTemplate=t.DEFAULT_PARSER_MAPPING=t.DEFAULT_FORMATTER_MAPPING=t.interpolateMustache=t.interpolateFString=t.parseMustache=t.parseFString=void 0;const a=r(n(57965));t.parseFString=e=>{const t=e.split(""),n=[],r=(e,n)=>{for(let r=n;r<t.length;r+=1)if(e.includes(t[r]))return r;return-1};let a=0;for(;a<t.length;)if("{"===t[a]&&a+1<t.length&&"{"===t[a+1])n.push({type:"literal",text:"{"}),a+=2;else if("}"===t[a]&&a+1<t.length&&"}"===t[a+1])n.push({type:"literal",text:"}"}),a+=2;else if("{"===t[a]){const e=r("}",a);if(e<0)throw new Error("Unclosed '{' in template.");n.push({type:"variable",name:t.slice(a+1,e).join("")}),a=e+1}else{if("}"===t[a])throw new Error("Single '}' in template.");{const e=r("{}",a),i=(e<0?t.slice(a):t.slice(a,e)).join("");n.push({type:"literal",text:i}),a=e<0?t.length:e}}return n},t.parseMustache=e=>(e=>e.map((e=>"name"===e[0]?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:"#"===e[0]?{type:"variable",name:e[1]}:{type:"literal",text:e[1]})))(a.default.parse(e)),t.interpolateFString=(e,n)=>(0,t.parseFString)(e).reduce(((e,t)=>{if("variable"===t.type){if(t.name in n)return e+n[t.name];throw new Error(`(f-string) Missing value for input ${t.name}`)}return e+t.text}),""),t.interpolateMustache=(e,t)=>a.default.render(e,t),t.DEFAULT_FORMATTER_MAPPING={"f-string":t.interpolateFString,mustache:t.interpolateMustache},t.DEFAULT_PARSER_MAPPING={"f-string":t.parseFString,mustache:t.parseMustache},t.renderTemplate=(e,n,r)=>t.DEFAULT_FORMATTER_MAPPING[n](e,r),t.parseTemplate=(e,n)=>t.DEFAULT_PARSER_MAPPING[n](e),t.checkValidTemplate=(e,n,r)=>{if(!(n in t.DEFAULT_FORMATTER_MAPPING)){const e=Object.keys(t.DEFAULT_FORMATTER_MAPPING);throw new Error(`Invalid template format. Got \`${n}\`;\n                         should be one of ${e}`)}try{const a=r.reduce(((e,t)=>(e[t]="foo",e)),{});Array.isArray(e)?e.forEach((e=>{if("text"===e.type)(0,t.renderTemplate)(e.text,n,a);else{if("image_url"!==e.type)throw new Error(`Invalid message template received. ${JSON.stringify(e,null,2)}`);if("string"==typeof e.image_url)(0,t.renderTemplate)(e.image_url,n,a);else{const r=e.image_url.url;(0,t.renderTemplate)(r,n,a)}}})):(0,t.renderTemplate)(e,n,a)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},86475:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRetriever=void 0;const r=n(31413),a=n(10969),i=n(5272);class s extends a.Runnable{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e?.callbacks,this.tags=e?.tags??[],this.metadata=e?.metadata??{},this.verbose=e?.verbose??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,(0,i.ensureConfig)(t))}async getRelevantDocuments(e,t){const n=(0,i.ensureConfig)((0,r.parseCallbackConfigArg)(t)),a=await r.CallbackManager.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),s=await(a?.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName));try{const t=await this._getRelevantDocuments(e,s);return await(s?.handleRetrieverEnd(t)),t}catch(e){throw await(s?.handleRetrieverError(e)),e}}}t.BaseRetriever=s},10969:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RunnablePick=t.RunnableAssign=t._coerceToRunnable=t.RunnableWithFallbacks=t.RunnableParallel=t.RunnableLambda=t.RunnableMap=t.RunnableSequence=t.RunnableRetry=t.RunnableEach=t.RunnableBinding=t.Runnable=t._coerceToDict=void 0;const a=n(21614),i=r(n(24116)),s=n(31413),o=n(403),u=n(367),l=n(28033),c=n(5272),d=n(61583),p=n(82133),h=n(36161),f=n(84960),m=n(43250);function g(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}t._coerceToDict=g;class b extends u.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new y({bound:this,kwargs:e,config:{}})}map(){return new v({bound:this})}withRetry(e){return new _({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new y({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new A({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(c.ensureConfig);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter((([e])=>"runId"!==e)));return Array.from({length:t},((t,r)=>(0,c.ensureConfig)(0===r?e:n)))}return Array.from({length:t},(()=>(0,c.ensureConfig)(e)))}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),a=r[0]?.maxConcurrency??n?.maxConcurrency,i=new d.AsyncCaller({maxConcurrency:a,onFailedAttempt:e=>{throw e}}),s=e.map(((e,t)=>i.call((async()=>{try{return await this.invoke(e,r[t])}catch(e){if(n?.returnExceptions)return e;throw e}}))));return Promise.all(s)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=new l.AsyncGeneratorWithSetup(this._streamIterator(e,(0,c.ensureConfig)(t)));return await n.setup,l.IterableReadableStream.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?(0,c.ensureConfig)(e):(0,c.ensureConfig)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,[t,n]}async _callWithConfig(e,t,n){const r=(0,c.ensureConfig)(n),a=await(0,c.getCallbackManagerForConfig)(r),i=await(a?.handleChainStart(this.toJSON(),g(t,"input"),r.runId,r?.runType,void 0,void 0,r?.runName??this.getName()));let s;delete r.runId;try{s=await e.call(this,t,r,i)}catch(e){throw await(i?.handleChainError(e)),e}return await(i?.handleChainEnd(g(s,"output"))),s}async _batchWithConfig(e,t,n,r){const a=this._getOptionsList(n??{},t.length),i=await Promise.all(a.map(c.getCallbackManagerForConfig)),s=await Promise.all(i.map((async(e,n)=>{const r=await(e?.handleChainStart(this.toJSON(),g(t[n],"input"),a[n].runId,a[n].runType,void 0,void 0,a[n].runName??this.getName()));return delete a[n].runId,r})));let o;try{o=await e.call(this,t,a,s,r)}catch(e){throw await Promise.all(s.map((t=>t?.handleChainError(e)))),e}return await Promise.all(s.map((e=>e?.handleChainEnd(g(o,"output"))))),o}async*_transformStreamWithConfig(e,t,n){let r,a,i=!0,s=!0;const o=(0,c.ensureConfig)(n),u=await(0,c.getCallbackManagerForConfig)(o);let d;try{const n=await(0,l.pipeGeneratorWithSetup)(t.bind(this),async function*(){for await(const t of e){if(i)if(void 0===r)r=t;else try{r=(0,l.concat)(r,t)}catch{r=void 0,i=!1}yield t}}(),(async()=>u?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName())),o);delete o.runId,d=n.setup;const c=e=>"log_stream_tracer"===e.name,p=d?.handlers.find(c);let h=n.output;void 0!==p&&void 0!==d&&(h=await p.tapOutputIterable(d.runId,n.output));for await(const e of h)if(yield e,s)if(void 0===a)a=e;else try{a=(0,l.concat)(a,e)}catch{a=void 0,s=!1}}catch(e){throw await(d?.handleChainError(e,void 0,void 0,void 0,{inputs:g(r,"input")})),e}await(d?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:g(r,"input")}))}getGraph(e){const t=new m.Graph,n=t.addNode({name:`${this.getName()}Input`,schema:a.z.any()}),r=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:a.z.any()});return t.addEdge(n,r),t.addEdge(r,i),t}pipe(e){return new w({first:this,last:C(e)})}pick(e){return this.pipe(new I(e))}assign(e){return this.pipe(new T(new P({steps:e})))}async*transform(e,t){let n;for await(const t of e)n=void 0===n?t:(0,l.concat)(n,t);yield*this._streamIterator(n,(0,c.ensureConfig)(t))}async*streamLog(e,t,n){const r=new o.LogStreamCallbackHandler({...n,autoClose:!1,_schemaFormat:"original"}),a=(0,c.ensureConfig)(t);yield*this._streamLog(e,r,a)}async*_streamLog(e,t,n){const{callbacks:r}=n;if(void 0===r)n.callbacks=[t];else if(Array.isArray(r))n.callbacks=r.concat([t]);else{const e=r.copy();e.inheritableHandlers.push(t),n.callbacks=e}const a=this.stream(e,n),i=async function(){try{const e=await a;for await(const n of e){const e=new o.RunLogPatch({ops:[{op:"add",path:"/streamed_output/-",value:n}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await i}}async*streamEvents(e,t,n){if("v1"!==t.version)throw new Error('Only version "v1" of the events schema is currently supported.');let r,a=!1;const i=(0,c.ensureConfig)(t),s=i.tags??[],u=i.metadata??{},l=i.runName??this.getName(),d=new o.LogStreamCallbackHandler({...n,autoClose:!1,_schemaFormat:"streaming_events"}),p=new h._RootEventFilter({...n}),f=this._streamLog(e,d,i);for await(const t of f){if(r=r?r.concat(t):o.RunLog.fromRunLogPatch(t),void 0===r.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const t={...r.state},n={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:u,data:{input:e}};p.includeEvent(n,t.type)&&(yield n)}const n=t.ops.filter((e=>e.path.startsWith("/logs/"))).map((e=>e.path.split("/")[2])),i=[...new Set(n)];for(const e of i){let t,n={};const a=r.state.logs[e];if(t=void 0===a.end_time?a.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==a.inputs&&(n.input=a.inputs);else if("end"===t)void 0!==a.inputs&&(n.input=a.inputs),n.output=a.final_output;else if("stream"===t){const e=a.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${a.name}"`);n={chunk:a.streamed_output[0]},a.streamed_output=[]}yield{event:`on_${a.type}_${t}`,name:a.name,run_id:a.id,tags:a.tags,metadata:a.metadata,data:n}}const{state:c}=r;if(c.streamed_output.length>0){const e=c.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${c.name}"`);const t={chunk:c.streamed_output[0]};c.streamed_output=[];const n={event:`on_${c.type}_stream`,run_id:c.id,tags:s,metadata:u,name:l,data:t};p.includeEvent(n,c.type)&&(yield n)}}const m=r?.state;if(void 0!==m){const e={event:`on_${m.type}_end`,name:l,run_id:m.id,tags:s,metadata:u,data:{output:m.final_output}};p.includeEvent(e,m.type)&&(yield e)}}static isRunnable(e){return(0,h.isRunnableInterface)(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new y({bound:this,config:{},configFactories:[r=>({callbacks:[new p.RootListenersTracer({config:r,onStart:e,onEnd:t,onError:n})]})]})}}t.Runnable=b;class y extends b{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=(0,c.mergeConfigs)(this.config,...e);return(0,c.mergeConfigs)(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig((0,c.ensureConfig)(t),this.kwargs))}async batch(e,t,n){const r=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig((0,c.ensureConfig)(e),this.kwargs)))):await this._mergeConfig((0,c.ensureConfig)(t),this.kwargs);return this.bound.batch(e,r,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig((0,c.ensureConfig)(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig((0,c.ensureConfig)(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig((0,c.ensureConfig)(t),this.kwargs))}async*streamEvents(e,t,n){yield*this.bound.streamEvents(e,{...await this._mergeConfig((0,c.ensureConfig)(t),this.kwargs),version:t.version},n)}static isRunnableBinding(e){return e.bound&&b.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new y({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[r=>({callbacks:[new p.RootListenersTracer({config:r,onStart:e,onEnd:t,onError:n})]})]})}}t.RunnableBinding=y;class v extends b{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new v({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,n){return this.bound.batch(e,(0,c.patchConfig)(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new v({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}t.RunnableEach=v;class _ extends y{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const r=e>1?`retry:attempt:${e}`:void 0;return(0,c.patchConfig)(t,{callbacks:n?.getChild(r)})}async _invoke(e,t,n){return(0,i.default)((r=>super.invoke(e,this._patchConfigForRetry(r,t,n))),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,n,r){const a={};try{await(0,i.default)((async i=>{const s=e.map(((e,t)=>t)).filter((e=>void 0===a[e.toString()]||a[e.toString()]instanceof Error)),o=s.map((t=>e[t])),u=s.map((e=>this._patchConfigForRetry(i,t?.[e],n?.[e]))),l=await super.batch(o,u,{...r,returnExceptions:!0});let c;for(let e=0;e<l.length;e+=1){const t=l[e],n=s[e];t instanceof Error&&void 0===c&&(c=t,c.input=o[e]),a[n.toString()]=t}if(c)throw c;return l}),{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==r?.returnExceptions)throw e}return Object.keys(a).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>a[parseInt(e,10)]))}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}t.RunnableRetry=_;class w extends b{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const n=(0,c.ensureConfig)(t),r=await(0,c.getCallbackManagerForConfig)(n),a=await(r?.handleChainStart(this.toJSON(),g(e,"input"),n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;let i,s=e;try{const e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){const r=e[t];s=await r.invoke(s,(0,c.patchConfig)(n,{callbacks:a?.getChild(`seq:step:${t+1}`)}))}i=await this.last.invoke(s,(0,c.patchConfig)(n,{callbacks:a?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(g(i,"output"))),i}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),a=await Promise.all(r.map(c.getCallbackManagerForConfig)),i=await Promise.all(a.map((async(t,n)=>{const a=await(t?.handleChainStart(this.toJSON(),g(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,a})));let s=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e];s=await t.batch(s,i.map(((t,n)=>{const a=t?.getChild(`seq:step:${e+1}`);return(0,c.patchConfig)(r[n],{callbacks:a})})),n)}}catch(e){throw await Promise.all(i.map((t=>t?.handleChainError(e)))),e}return await Promise.all(i.map((e=>e?.handleChainEnd(g(s,"output"))))),s}async*_streamIterator(e,t){const n=await(0,c.getCallbackManagerForConfig)(t),{runId:r,...a}=t??{},i=await(n?.handleChainStart(this.toJSON(),g(e,"input"),r,void 0,void 0,void 0,a?.runName)),s=[this.first,...this.middle,this.last];let o,u=!0;try{let t=s[0].transform(async function*(){yield e}(),(0,c.patchConfig)(a,{callbacks:i?.getChild("seq:step:1")}));for(let e=1;e<s.length;e+=1){const n=s[e];t=await n.transform(t,(0,c.patchConfig)(a,{callbacks:i?.getChild(`seq:step:${e+1}`)}))}for await(const e of t)if(yield e,u)if(void 0===o)o=e;else try{o=(0,l.concat)(o,e)}catch(e){o=void 0,u=!1}}catch(e){throw await(i?.handleChainError(e)),e}await(i?.handleChainEnd(g(o,"output")))}getGraph(e){const t=new m.Graph;let n=null;return this.steps.forEach(((r,a)=>{const i=r.getGraph(e);0!==a&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);const s=i.firstNode();if(!s)throw new Error(`Runnable ${r} has no first node`);n&&t.addEdge(n,s),n=i.lastNode()})),t}pipe(e){return w.isRunnableSequence(e)?new w({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new w({first:this.first,middle:[...this.middle,this.last],last:C(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&b.isRunnable(e)}static from([e,...t],n){return new w({first:C(e),middle:t.slice(0,-1).map(C),last:C(t[t.length-1]),name:n})}}t.RunnableSequence=w;class P extends b{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=C(n)}static from(e){return new P({steps:e})}async invoke(e,t){const n=(0,c.ensureConfig)(t),r=await(0,c.getCallbackManagerForConfig)(n),a=await(r?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;const i={};try{await Promise.all(Object.entries(this.steps).map((async([t,r])=>{i[t]=await r.invoke(e,(0,c.patchConfig)(n,{callbacks:a?.getChild(`map:key:${t}`)}))})))}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(i)),i}async*_transform(e,t,n){const r={...this.steps},a=(0,l.atee)(e,Object.keys(r).length),i=new Map(Object.entries(r).map((([e,r],i)=>{const s=r.transform(a[i],(0,c.patchConfig)(n,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then((t=>({key:e,gen:s,result:t})))]})));for(;i.size;){const{key:e,result:t,gen:n}=await Promise.race(i.values());i.delete(e),t.done||(yield{[e]:t.value},i.set(e,n.next().then((t=>({key:e,gen:n,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await n.setup,l.IterableReadableStream.fromAsyncGenerator(n)}}t.RunnableMap=P;class O extends b{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new O({func:e})}async _invoke(e,t,n){return new Promise(((r,a)=>{const i=(0,c.patchConfig)(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??c.DEFAULT_RECURSION_LIMIT)-1});f.AsyncLocalStorageProviderSingleton.getInstance().run(i,(async()=>{try{let n=await this.func(e,{...i,config:i});if(n&&b.isRunnable(n)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");n=await n.invoke(e,{...i,recursionLimit:(i.recursionLimit??c.DEFAULT_RECURSION_LIMIT)-1})}r(n)}catch(e){a(e)}}))}))}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,n){let r;for await(const t of e)if(void 0===r)r=t;else try{r=(0,l.concat)(r,t)}catch(e){r=t}const a=await new Promise(((e,t)=>{f.AsyncLocalStorageProviderSingleton.getInstance().run(n,(async()=>{try{const t=await this.func(r,{...n,config:n});e(t)}catch(e){t(e)}}))}));if(a&&b.isRunnable(a)){if(0===n?.recursionLimit)throw new Error("Recursion limit reached.");const e=await a.stream(r,(0,c.patchConfig)(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??c.DEFAULT_RECURSION_LIMIT)-1}));for await(const t of e)yield t}else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await n.setup,l.IterableReadableStream.fromAsyncGenerator(n)}}t.RunnableLambda=O,t.RunnableParallel=class extends P{};class A extends b{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=await s.CallbackManager.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),{runId:r,...a}=t??{},i=await(n?.handleChainStart(this.toJSON(),g(e,"input"),r,void 0,void 0,void 0,a?.runName));let o;for(const t of this.runnables())try{const n=await t.invoke(e,(0,c.patchConfig)(a,{callbacks:i?.getChild()}));return await(i?.handleChainEnd(g(n,"output"))),n}catch(e){void 0===o&&(o=e)}if(void 0===o)throw new Error("No error stored at end of fallback.");throw await(i?.handleChainError(o)),o}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),a=await Promise.all(r.map((e=>s.CallbackManager.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),i=await Promise.all(a.map((async(t,n)=>{const a=await(t?.handleChainStart(this.toJSON(),g(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,a})));let o;for(const t of this.runnables())try{const a=await t.batch(e,i.map(((e,t)=>(0,c.patchConfig)(r[t],{callbacks:e?.getChild()}))),n);return await Promise.all(i.map(((e,t)=>e?.handleChainEnd(g(a[t],"output"))))),a}catch(e){void 0===o&&(o=e)}if(!o)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(i.map((e=>e?.handleChainError(o)))),o}}function C(e){if("function"==typeof e)return new O({func:e});if(b.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[n,r]of Object.entries(e))t[n]=C(r);return new P({steps:t})}}t.RunnableWithFallbacks=A,t._coerceToRunnable=C;class T extends b{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof P&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const r=this.mapper.getStepsKeys(),[a,i]=(0,l.atee)(e),s=this.mapper.transform(i,(0,c.patchConfig)(n,{callbacks:t?.getChild()})),o=s.next();for await(const e of a){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!r.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await o).value;for await(const e of s)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await n.setup,l.IterableReadableStream.fromAsyncGenerator(n)}}t.RunnableAssign=T;class I extends b{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new l.AsyncGeneratorWithSetup(this.transform(async function*(){yield e}(),t));return await n.setup,l.IterableReadableStream.fromAsyncGenerator(n)}}t.RunnablePick=I},45226:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RunnableBranch=void 0;const r=n(10969),a=n(5272),i=n(28033);class s extends r.Runnable{static lc_name(){return"RunnableBranch"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"default",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");return new this({branches:e.slice(0,-1).map((([e,t])=>[(0,r._coerceToRunnable)(e),(0,r._coerceToRunnable)(t)])),default:(0,r._coerceToRunnable)(e[e.length-1])})}async _invoke(e,t,n){let r;for(let i=0;i<this.branches.length;i+=1){const[s,o]=this.branches[i];if(await s.invoke(e,(0,a.patchConfig)(t,{callbacks:n?.getChild(`condition:${i+1}`)}))){r=await o.invoke(e,(0,a.patchConfig)(t,{callbacks:n?.getChild(`branch:${i+1}`)}));break}}return r||(r=await this.default.invoke(e,(0,a.patchConfig)(t,{callbacks:n?.getChild("branch:default")}))),r}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async*_streamIterator(e,t){const n=await(0,a.getCallbackManagerForConfig)(t),s=await(n?.handleChainStart(this.toJSON(),(0,r._coerceToDict)(e,"input"),t?.runId,void 0,void 0,void 0,t?.runName));let o,u,l=!0;try{for(let n=0;n<this.branches.length;n+=1){const[r,c]=this.branches[n];if(await r.invoke(e,(0,a.patchConfig)(t,{callbacks:s?.getChild(`condition:${n+1}`)}))){u=await c.stream(e,(0,a.patchConfig)(t,{callbacks:s?.getChild(`branch:${n+1}`)}));for await(const e of u)if(yield e,l)if(void 0===o)o=e;else try{o=(0,i.concat)(o,e)}catch(e){o=void 0,l=!1}break}}if(void 0===u){u=await this.default.stream(e,(0,a.patchConfig)(t,{callbacks:s?.getChild("branch:default")}));for await(const e of u)if(yield e,l)if(void 0===o)o=e;else try{o=(0,i.concat)(o,e)}catch(e){o=void 0,l=!1}}}catch(e){throw await(s?.handleChainError(e)),e}await(s?.handleChainEnd(o??{}))}}t.RunnableBranch=s},5272:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.patchConfig=t.ensureConfig=t.mergeConfigs=t.getCallbackManagerForConfig=t.DEFAULT_RECURSION_LIMIT=void 0;const r=n(31413),a=n(84960);t.DEFAULT_RECURSION_LIMIT=25,t.getCallbackManagerForConfig=async function(e){return r.CallbackManager.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)},t.mergeConfigs=function(...e){const t={};for(const n of e.filter((e=>!!e)))for(const e of Object.keys(n))if("metadata"===e)t[e]={...t[e],...n[e]};else if("tags"===e){const r=t[e]??[];t[e]=[...new Set(r.concat(n[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...n[e]};else if("callbacks"===e){const e=t.callbacks,a=n.callbacks;if(Array.isArray(a))if(e)if(Array.isArray(e))t.callbacks=e.concat(a);else{const n=e.copy();for(const e of a)n.addHandler((0,r.ensureHandler)(e),!0);t.callbacks=n}else t.callbacks=a;else if(a)if(e)if(Array.isArray(e)){const n=a.copy();for(const t of e)n.addHandler((0,r.ensureHandler)(t),!0);t.callbacks=n}else t.callbacks=new r.CallbackManager(a._parentRunId,{handlers:e.handlers.concat(a.handlers),inheritableHandlers:e.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(a.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(a.inheritableTags))),metadata:{...e.metadata,...a.metadata}});else t.callbacks=a}else{const r=e;t[r]=n[r]??t[r]}return t};const i=new Set(["string","number","boolean"]);function s(e){const t=e??a.AsyncLocalStorageProviderSingleton.getInstance().getStore();let n={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(t&&(n={...n,...t}),t?.configurable)for(const e of Object.keys(t.configurable))i.has(typeof t.configurable[e])&&!n.metadata?.[e]&&(n.metadata||(n.metadata={}),n.metadata[e]=t.configurable[e]);return n}t.ensureConfig=s,t.patchConfig=function(e={},{callbacks:t,maxConcurrency:n,recursionLimit:r,runName:a,configurable:i,runId:o}={}){const u=s(e);return void 0!==t&&(delete u.runName,u.callbacks=t),void 0!==r&&(u.recursionLimit=r),void 0!==n&&(u.maxConcurrency=n),void 0!==a&&(u.runName=a),void 0!==i&&(u.configurable={...u.configurable,...i}),void 0!==o&&delete u.runId,u}},43250:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Graph=t.nodeDataStr=void 0;const r=n(39340),a=n(22831),i=n(36161);function s(e){return(0,i.isRunnableInterface)(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...(0,r.zodToJsonSchema)(e.data.schema),title:e.data.name}}}t.nodeDataStr=function(e){if(!(0,a.validate)(e.id))return e.id;if(!(0,i.isRunnableInterface)(e.data))return e.data.name??"UnknownSchema";try{let t=e.data.toString();return t.startsWith("<")||t[0]!==t[0].toUpperCase()||t.split("\n").length>1?t=e.data.getName():t.length>42&&(t=`${t.substring(0,42)}...`),t.startsWith("Runnable")?t.slice(8):t}catch(t){return e.data.getName()}},t.Graph=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach(((t,n)=>{e[t.id]=(0,a.validate)(t.id)?n:t.id})),{nodes:Object.values(this.nodes).map((t=>({id:e[t.id],...s(t)}))),edges:this.edges.map((t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]}))}}addNode(e,t){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const n=t||(0,a.v4)(),r={id:n,data:e};return this.nodes[n]=r,r}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter((t=>t.source!==e.id&&t.target!==e.id))}addEdge(e,t,n){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const r={source:e.id,target:t.id,data:n};return this.edges.push(r),r}firstNode(){const e=new Set(this.edges.map((e=>e.target))),t=[];return Object.values(this.nodes).forEach((n=>{e.has(n.id)||t.push(n)})),t[0]}lastNode(){const e=new Set(this.edges.map((e=>e.source))),t=[];return Object.values(this.nodes).forEach((n=>{e.has(n.id)||t.push(n)})),t[0]}extend(e){Object.entries(e.nodes).forEach((([e,t])=>{this.nodes[e]=t})),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter((t=>t.source===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter((t=>t.target===e.id));1!==Object.keys(this.nodes).length&&1!==t.length||this.removeNode(e)}}}},93602:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RunnableWithMessageHistory=void 0;const r=n(14190),a=n(10969),i=n(36516);class s extends a.RunnableBinding{constructor(e){let t=new a.RunnableLambda({func:(e,t)=>this._enterHistory(e,t??{})}).withConfig({runName:"loadHistory"});const n=e.historyMessagesKey??e.inputMessagesKey;n&&(t=i.RunnablePassthrough.assign({[n]:t}).withConfig({runName:"insertHistory"}));const r=t.pipe(e.runnable.withListeners({onEnd:(e,t)=>this._exitHistory(e,t??{})})).withConfig({runName:"RunnableWithMessageHistory"}),s=e.config??{};super({...e,config:s,bound:r}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){return"string"==typeof e?[new r.HumanMessage(e)]:Array.isArray(e)?e:[e]}_getOutputMessages(e){let t=e;if(Array.isArray(e)||(0,r.isBaseMessage)(e)||"string"==typeof e||(t=e[this.outputMessagesKey??"output"]),"string"==typeof t)return[new r.AIMessage(t)];if(Array.isArray(t))return t;if((0,r.isBaseMessage)(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){const n=t?.config?.configurable?.messageHistory;if(this.historyMessagesKey)return n.getMessages();const r=e||(this.inputMessagesKey?e[this.inputMessagesKey]:void 0);return[...n?await n.getMessages():[],...this._getInputMessages(r)]}async _exitHistory(e,t){const n=t.configurable?.messageHistory,{inputs:r}=e,a=r[this.inputMessagesKey??"input"],i=this._getInputMessages(a),s=e.outputs;if(!s)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(s);for await(const e of[...i,...o])await n.addMessage(e)}async _mergeConfig(...e){const t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){const e={[this.inputMessagesKey??"input"]:"foo"},t={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()\neg. chain.invoke(${JSON.stringify(e)}, ${JSON.stringify(t)})`)}const{sessionId:n}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(n),t}}t.RunnableWithMessageHistory=s},37534:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RunnableWithMessageHistory=t.RunnableBranch=t.RouterRunnable=t.RunnablePassthrough=t.mergeConfigs=t.ensureConfig=t.patchConfig=t.getCallbackManagerForConfig=t._coerceToRunnable=t.RunnablePick=t.RunnableAssign=t.RunnableWithFallbacks=t.RunnableLambda=t.RunnableParallel=t.RunnableMap=t.RunnableSequence=t.RunnableRetry=t.RunnableEach=t.RunnableBinding=t.Runnable=void 0;var r=n(10969);Object.defineProperty(t,"Runnable",{enumerable:!0,get:function(){return r.Runnable}}),Object.defineProperty(t,"RunnableBinding",{enumerable:!0,get:function(){return r.RunnableBinding}}),Object.defineProperty(t,"RunnableEach",{enumerable:!0,get:function(){return r.RunnableEach}}),Object.defineProperty(t,"RunnableRetry",{enumerable:!0,get:function(){return r.RunnableRetry}}),Object.defineProperty(t,"RunnableSequence",{enumerable:!0,get:function(){return r.RunnableSequence}}),Object.defineProperty(t,"RunnableMap",{enumerable:!0,get:function(){return r.RunnableMap}}),Object.defineProperty(t,"RunnableParallel",{enumerable:!0,get:function(){return r.RunnableParallel}}),Object.defineProperty(t,"RunnableLambda",{enumerable:!0,get:function(){return r.RunnableLambda}}),Object.defineProperty(t,"RunnableWithFallbacks",{enumerable:!0,get:function(){return r.RunnableWithFallbacks}}),Object.defineProperty(t,"RunnableAssign",{enumerable:!0,get:function(){return r.RunnableAssign}}),Object.defineProperty(t,"RunnablePick",{enumerable:!0,get:function(){return r.RunnablePick}}),Object.defineProperty(t,"_coerceToRunnable",{enumerable:!0,get:function(){return r._coerceToRunnable}});var a=n(5272);Object.defineProperty(t,"getCallbackManagerForConfig",{enumerable:!0,get:function(){return a.getCallbackManagerForConfig}}),Object.defineProperty(t,"patchConfig",{enumerable:!0,get:function(){return a.patchConfig}}),Object.defineProperty(t,"ensureConfig",{enumerable:!0,get:function(){return a.ensureConfig}}),Object.defineProperty(t,"mergeConfigs",{enumerable:!0,get:function(){return a.mergeConfigs}});var i=n(36516);Object.defineProperty(t,"RunnablePassthrough",{enumerable:!0,get:function(){return i.RunnablePassthrough}});var s=n(48949);Object.defineProperty(t,"RouterRunnable",{enumerable:!0,get:function(){return s.RouterRunnable}});var o=n(45226);Object.defineProperty(t,"RunnableBranch",{enumerable:!0,get:function(){return o.RunnableBranch}});var u=n(93602);Object.defineProperty(t,"RunnableWithMessageHistory",{enumerable:!0,get:function(){return u.RunnableWithMessageHistory}})},36516:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RunnablePassthrough=void 0;const r=n(28033),a=n(10969),i=n(5272);class s extends a.Runnable{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=(0,i.ensureConfig)(t);return this.func&&await this.func(e,n),this._callWithConfig((e=>Promise.resolve(e)),e,n)}async*transform(e,t){const n=(0,i.ensureConfig)(t);let a,s=!0;for await(const t of this._transformStreamWithConfig(e,(e=>e),n))if(yield t,s)if(void 0===a)a=t;else try{a=(0,r.concat)(a,t)}catch{a=void 0,s=!1}this.func&&void 0!==a&&await this.func(a,n)}static assign(e){return new a.RunnableAssign(new a.RunnableMap({steps:e}))}}t.RunnablePassthrough=s},48949:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RouterRunnable=void 0;const r=n(10969),a=n(5272);class i extends r.Runnable{static lc_name(){return"RouterRunnable"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnables=e.runnables}async invoke(e,t){const{key:n,input:r}=e,i=this.runnables[n];if(void 0===i)throw new Error(`No runnable associated with key "${n}".`);return i.invoke(r,(0,a.ensureConfig)(t))}async batch(e,t,n){const r=e.map((e=>e.key)),a=e.map((e=>e.input));if(void 0!==r.find((e=>void 0===this.runnables[e])))throw new Error("One or more keys do not have a corresponding runnable.");const i=r.map((e=>this.runnables[e])),s=this._getOptionsList(t??{},e.length),o=s[0]?.maxConcurrency??n?.maxConcurrency,u=o&&o>0?o:e.length,l=[];for(let e=0;e<a.length;e+=u){const t=a.slice(e,e+u).map(((e,t)=>i[t].invoke(e,s[t]))),n=await Promise.all(t);l.push(n)}return l.flat()}async stream(e,t){const{key:n,input:r}=e,a=this.runnables[n];if(void 0===a)throw new Error(`No runnable associated with key "${n}".`);return a.stream(r,t)}}t.RouterRunnable=i},36161:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._RootEventFilter=t.isRunnableInterface=void 0,t.isRunnableInterface=function(e){return!!e&&e.lc_runnable},t._RootEventFilter=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const r=e.tags??[];return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(t)),void 0!==this.includeTags&&(n=n||r.some((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(n=n&&r.every((e=>!this.excludeTags?.includes(e)))),n}}},84960:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncLocalStorageProviderSingleton=t.MockAsyncLocalStorage=void 0;class n{getStore(){}run(e,t){t()}}t.MockAsyncLocalStorage=n;const r=new class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new n}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}};t.AsyncLocalStorageProviderSingleton=r},64844:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseToolkit=t.DynamicStructuredTool=t.DynamicTool=t.Tool=t.StructuredTool=t.ToolInputParsingException=void 0;const r=n(21614),a=n(31413),i=n(37738),s=n(5272);class o extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}t.ToolInputParsingException=o;class u extends i.BaseLangChain{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,(0,s.ensureConfig)(t))}async call(e,t,n){let r;try{r=await this.schema.parseAsync(e)}catch(t){throw new o("Received tool input did not match expected schema",JSON.stringify(e))}const i=(0,a.parseCallbackConfigArg)(t),s=await a.CallbackManager.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u=await(s?.handleToolStart(this.toJSON(),"string"==typeof r?r:JSON.stringify(r),i.runId,void 0,void 0,void 0,i.runName));let l;delete i.runId;try{l=await this._call(r,u,i)}catch(e){throw await(u?.handleToolError(e)),e}return await(u?.handleToolEnd(l)),l}}t.StructuredTool=u;class l extends u{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:r.z.object({input:r.z.string().optional()}).transform((e=>e.input))})}call(e,t){return super.call("string"!=typeof e&&e?e:{input:e},t)}}t.Tool=l,t.DynamicTool=class extends l{static lc_name(){return"DynamicTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){const n=(0,a.parseCallbackConfigArg)(t);return void 0===n.runName&&(n.runName=this.name),super.call(e,n)}async _call(e,t,n){return this.func(e,t,n)}},t.DynamicStructuredTool=class extends u{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,n){const r=(0,a.parseCallbackConfigArg)(t);return void 0===r.runName&&(r.runName=this.name),super.call(e,r,n)}_call(e,t,n){return this.func(e,t,n)}},t.BaseToolkit=class{getTools(){return this.tools}}},18233:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTracer=void 0;const r=n(12031);function a(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class i extends r.BaseCallbackHandler{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=(n=e.start_time,r=e.id,`${new Date(n).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+r);var n,r;const a={...e};if(void 0!==a.parent_run_id){const e=this.runMap.get(a.parent_run_id);e&&(this._addChildRun(e,a),e.child_execution_order=Math.max(e.child_execution_order,a.child_execution_order),a.trace_id=e.trace_id,void 0!==e.dotted_order&&(a.dotted_order=[e.dotted_order,t].join(".")))}else a.trace_id=a.id,a.dotted_order=t;this.runMap.set(a.id,a),await(this.onRunCreate?.(a))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,n,r,a,i,s,o){const u=this._getExecutionOrder(r),l=Date.now(),c=s?{...a,metadata:s}:a,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:c??{},tags:i||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleChatModelStart(e,t,n,r,a,i,s,o){const u=this._getExecutionOrder(r),l=Date.now(),c=s?{...a,metadata:s}:a,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:c??{},tags:i||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleLLMEnd(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onLLMEnd?.(n)),await this._endTrace(n),n}async handleLLMError(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onLLMError?.(n)),await this._endTrace(n),n}async handleChainStart(e,t,n,r,a,i,s,o){const u=this._getExecutionOrder(r),l=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return await this._startTrace(c),await(this.onChainStart?.(c)),c}async handleChainEnd(e,t,n,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=a(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=a(i.inputs,"input")),await(this.onChainEnd?.(s)),await this._endTrace(s),s}async handleChainError(e,t,n,r,i){const s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),void 0!==i?.inputs&&(s.inputs=a(i.inputs,"input")),await(this.onChainError?.(s)),await this._endTrace(s),s}async handleToolStart(e,t,n,r,a,i,s){const o=this._getExecutionOrder(r),u=Date.now(),l={id:n,name:s??e.id[e.id.length-1],parent_run_id:r,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return await this._startTrace(l),await(this.onToolStart?.(l)),l}async handleToolEnd(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onToolEnd?.(n)),await this._endTrace(n),n}async handleToolError(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onToolError?.(n)),await this._endTrace(n),n}async handleAgentAction(e,t){const n=this.runMap.get(t);if(!n||"chain"!==n?.run_type)return;const r=n;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(n))}async handleAgentEnd(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(n)))}async handleRetrieverStart(e,t,n,r,a,i,s){const o=this._getExecutionOrder(r),u=Date.now(),l={id:n,name:s??e.id[e.id.length-1],parent_run_id:r,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return await this._startTrace(l),await(this.onRetrieverStart?.(l)),l}async handleRetrieverEnd(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverEnd?.(n)),await this._endTrace(n),n}async handleRetrieverError(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverError?.(n)),await this._endTrace(n),n}async handleText(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(n)))}async handleLLMNewToken(e,t,n,r,a,i){const s=this.runMap.get(n);if(!s||"llm"!==s?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await(this.onLLMNewToken?.(s,e,{chunk:i?.chunk})),s}}t.BaseTracer=i},88813:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleCallbackHandler=void 0;const a=r(n(49418)),i=n(18233);function s(e,t){return`${e.open}${t}${e.close}`}function o(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function u(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:l}=a.default;class c extends i.BaseTracer{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const e=this.runMap.get(n.parent_run_id);if(!e)break;t.push(e),n=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,n)=>{const r=`${e.execution_order}:${e.run_type}:${e.name}`;return t===n.length-1?s(a.default.bold,r):r})).join(" > ");return s(l.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.green,"[chain/start]")} [${t}] Entering Chain run with input: ${o(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.cyan,"[chain/end]")} [${t}] [${u(e)}] Exiting Chain run with output: ${o(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.red,"[chain/error]")} [${t}] [${u(e)}] Chain run errored with error: ${o(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${s(l.green,"[llm/start]")} [${t}] Entering LLM run with input: ${o(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.cyan,"[llm/end]")} [${t}] [${u(e)}] Exiting LLM run with output: ${o(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.red,"[llm/error]")} [${t}] [${u(e)}] LLM run errored with error: ${o(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.cyan,"[tool/end]")} [${t}] [${u(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.red,"[tool/error]")} [${t}] [${u(e)}] Tool run errored with error: ${o(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${o(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.cyan,"[retriever/end]")} [${t}] [${u(e)}] Exiting Retriever run with output: ${o(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${s(l.red,"[retriever/error]")} [${t}] [${u(e)}] Retriever run errored with error: ${o(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${s(l.blue,"[agent/action]")} [${n}] Agent selected action: ${o(t.actions[t.actions.length-1],"[action]")}`)}}t.ConsoleCallbackHandler=c},13076:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTracingV2CallbackHandler=t.getTracingCallbackHandler=void 0;const r=n(19979),a=n(66485);t.getTracingCallbackHandler=async function(e){const t=new a.LangChainTracerV1;return e?await t.loadSession(e):await t.loadDefaultSession(),t},t.getTracingV2CallbackHandler=async function(){return new r.LangChainTracer}},403:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogStreamCallbackHandler=t.RunLog=t.RunLogPatch=void 0;const r=n(78266),a=n(18233),i=n(28033),s=n(14190);class o{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=(0,r.applyPatch)({},t);return new u({ops:t,state:n[n.length-1].newDocument})}}t.RunLogPatch=o;class u extends o{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=(0,r.applyPatch)(this.state,e.ops);return new u({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=(0,r.applyPatch)({},e.ops);return new u({ops:e.ops,state:t[t.length-1].newDocument})}}async function l(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=e;return["retriever","llm","prompt"].includes(e.run_type)?n:1!==Object.keys(n).length||""!==n?.input?n.input:void 0}async function c(e,t){const{outputs:n}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?n:void 0!==n&&1===Object.keys(n).length&&void 0!==n?.output?n.output:n}t.RunLog=u;class d extends a.BaseTracer{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=i.IterableReadableStream.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(n=n||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(n=n&&t.every((e=>!this.excludeTags?.includes(e)))),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new o({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new o({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(n.inputs=await l(e,this._schemaFormat)),await this.writer.write(new o({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const n=[];"streaming_events"===this._schemaFormat&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await l(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await c(e,this._schemaFormat)}),void 0!==e.end_time&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new o({ops:n});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new o({ops:[{op:"replace",path:"/final_output",value:await c(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const r=this.keyMapByRunId[e.id];if(void 0===r)return;let a;var i;void 0!==e.inputs.messages?(i=n?.chunk,a=void 0!==i&&void 0!==i.message?n?.chunk:new s.AIMessageChunk(t)):a=t;const u=new o({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${r}/streamed_output/-`,value:a}]});await this.writer.write(u)}}t.LogStreamCallbackHandler=d},82133:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootListenersTracer=void 0;const r=n(18233);class a extends r.BaseTracer{constructor({config:e,onStart:t,onEnd:n,onError:r}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=r}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}t.RootListenersTracer=a},19979:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LangChainTracer=void 0;const r=n(21210),a=n(60418),i=n(18233);class s extends i.BaseTracer{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:i}=e;this.projectName=n??(0,a.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,a.getEnvironmentVariable)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??new r.Client({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await(0,a.getRuntimeEnvironment)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}}t.LangChainTracer=s},66485:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LangChainTracerV1=void 0;const r=n(14190),a=n(60418),i=n(18233);class s extends i.BaseTracer{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,a.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=(0,a.getEnvironmentVariable)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},n=await this.persistSession(t);return this.session=n,n}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){const t=this.session??await this.loadDefaultSession(),n=e.serialized;let a;if("llm"===e.run_type){const i=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map((e=>(0,r.getBufferString)(e)));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:t.id,prompts:i,response:e.outputs}}else if("chain"===e.run_type){const r=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:r.filter((e=>"llm"===e.type)),child_chain_runs:r.filter((e=>"chain"===e.type)),child_tool_runs:r.filter((e=>"tool"===e.type))}}else{if("tool"!==e.run_type)throw new Error(`Unknown run type: ${e.run_type}`);{const r=await Promise.all(e.child_runs.map((e=>this.convertV2RunToRun(e))));a={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:n,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(n),child_llm_runs:r.filter((e=>"llm"===e.type)),child_chain_runs:r.filter((e=>"chain"===e.type)),child_tool_runs:r.filter((e=>"tool"===e.type))}}}return a}async persistRun(e){let t,n;n=void 0!==e.run_type?await this.convertV2RunToRun(e):e,t="llm"===n.type?`${this.endpoint}/llm-runs`:"chain"===n.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;const r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(n)});r.ok||console.error(`Failed to persist run: ${r.status} ${r.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,n=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return n.ok?{id:(await n.json()).id,...e}:(console.error(`Failed to persist session: ${n.status} ${n.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let n;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),n={id:1,start_time:Date.now()},this.session=n,n;const r=await t.json();return 0===r.length?(n={id:1,start_time:Date.now()},this.session=n,n):([n]=r,this.session=n,n)}}t.LangChainTracerV1=s},57236:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(29843),t)},31325:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepCompareStrict=void 0,t.deepCompareStrict=function e(t,n){const r=typeof t;if(r!==typeof n)return!1;if(Array.isArray(t)){if(!Array.isArray(n))return!1;const r=t.length;if(r!==n.length)return!1;for(let a=0;a<r;a++)if(!e(t[a],n[a]))return!1;return!0}if("object"===r){if(!t||!n)return t===n;const r=Object.keys(t),a=Object.keys(n);if(r.length!==a.length)return!1;for(const a of r)if(!e(t[a],n[a]))return!1;return!0}return t===n}},80375:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dereference=t.initialBaseURI=t.ignoredKeyword=t.schemaMapKeyword=t.schemaArrayKeyword=t.schemaKeyword=void 0;const r=n(52712);t.schemaKeyword={additionalItems:!0,unevaluatedItems:!0,items:!0,contains:!0,additionalProperties:!0,unevaluatedProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},t.schemaArrayKeyword={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},t.schemaMapKeyword={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},t.ignoredKeyword={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},t.initialBaseURI="undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker"),t.dereference=function e(n,a=Object.create(null),i=t.initialBaseURI,s=""){if(n&&"object"==typeof n&&!Array.isArray(n)){const t=n.$id||n.id;if(t){const r=new URL(t,i.href);r.hash.length>1?a[r.href]=n:(r.hash="",""===s?i=r:e(n,a,i))}}else if(!0!==n&&!1!==n)return a;const o=i.href+(s?"#"+s:"");if(void 0!==a[o])throw new Error(`Duplicate schema URI "${o}".`);if(a[o]=n,!0===n||!1===n)return a;if(void 0===n.__absolute_uri__&&Object.defineProperty(n,"__absolute_uri__",{enumerable:!1,value:o}),n.$ref&&void 0===n.__absolute_ref__){const e=new URL(n.$ref,i.href);e.hash=e.hash,Object.defineProperty(n,"__absolute_ref__",{enumerable:!1,value:e.href})}if(n.$recursiveRef&&void 0===n.__absolute_recursive_ref__){const e=new URL(n.$recursiveRef,i.href);e.hash=e.hash,Object.defineProperty(n,"__absolute_recursive_ref__",{enumerable:!1,value:e.href})}n.$anchor&&(a[new URL("#"+n.$anchor,i.href).href]=n);for(let o in n){if(t.ignoredKeyword[o])continue;const u=`${s}/${(0,r.encodePointer)(o)}`,l=n[o];if(Array.isArray(l)){if(t.schemaArrayKeyword[o]){const t=l.length;for(let n=0;n<t;n++)e(l[n],a,i,`${u}/${n}`)}}else if(t.schemaMapKeyword[o])for(let t in l)e(l[t],a,i,`${u}/${(0,r.encodePointer)(t)}`);else e(l,a,i,u)}return a}},85356:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fastFormat=t.fullFormat=void 0;const n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,r=[0,31,28,31,30,31,30,31,31,30,31,30,31],a=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,i=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,s=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,u=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,l=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,c=/^(?:\/(?:[^~/]|~0|~1)*)*$/,d=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,p=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,h=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,f=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,m=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,g=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,b=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,y=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i;function v(e){return e.test.bind(e)}function _(e){const t=e.match(n);if(!t)return!1;const a=+t[1],i=+t[2],s=+t[3];return i>=1&&i<=12&&s>=1&&s<=(2==i&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(a)?29:r[i])}function w(e,t){const n=t.match(a);if(!n)return!1;const r=+n[1],i=+n[2],s=+n[3],o=!!n[5];return(r<=23&&i<=59&&s<=59||23==r&&59==i&&60==s)&&(!e||o)}t.fullFormat={date:_,time:w.bind(void 0,!1),"date-time":function(e){const t=e.split(P);return 2==t.length&&_(t[0])&&w(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return O.test(e)&&A.test(e)},"uri-reference":v(s),"uri-template":v(o),url:v(u),email:e=>{if('"'===e[0])return!1;const[t,n,...r]=e.split("@");return!(!t||!n||0!==r.length||t.length>64||n.length>253)&&"."!==t[0]&&!t.endsWith(".")&&!t.includes("..")&&!(!/^[a-z0-9.-]+$/i.test(n)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t))&&n.split(".").every((e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e)))},hostname:v(i),ipv4:v(b),ipv6:v(y),regex:function(e){if(C.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}},uuid:v(l),"json-pointer":v(c),"json-pointer-uri-fragment":v(d),"relative-json-pointer":v(p)},t.fastFormat={...t.fullFormat,date:v(h),time:v(f),"date-time":v(m),"uri-reference":v(g)};const P=/t|\s/i,O=/\/|:/,A=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,C=/[^\\]\\Z/},29843:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(31325),t),a(n(80375),t),a(n(85356),t),a(n(52712),t),a(n(8856),t),a(n(9875),t),a(n(1399),t),a(n(78285),t)},52712:function(e,t){"use strict";function n(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(t,"__esModule",{value:!0}),t.escapePointer=t.encodePointer=void 0,t.encodePointer=function(e){return encodeURI(n(e))},t.escapePointer=n},8856:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9875:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ucs2length=void 0,t.ucs2length=function(e){let t,n=0,r=e.length,a=0;for(;a<r;)n++,t=e.charCodeAt(a++),t>=55296&&t<=56319&&a<r&&(t=e.charCodeAt(a),56320==(64512&t)&&a++);return n}},1399:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validate=void 0;const r=n(31325),a=n(80375),i=n(85356),s=n(52712),o=n(9875);t.validate=function e(t,n,u="2019-09",l=(0,a.dereference)(n),c=!0,d=null,p="#",h="#",f=Object.create(null)){if(!0===n)return{valid:!0,errors:[]};if(!1===n)return{valid:!1,errors:[{instanceLocation:p,keyword:"false",keywordLocation:p,error:"False boolean schema."}]};const m=typeof t;let g;switch(m){case"boolean":case"number":case"string":g=m;break;case"object":g=null===t?"null":Array.isArray(t)?"array":"object";break;default:throw new Error(`Instances of "${m}" type are not supported.`)}const{$ref:b,$recursiveRef:y,$recursiveAnchor:v,type:_,const:w,enum:P,required:O,not:A,anyOf:C,allOf:T,oneOf:I,if:E,then:x,else:j,format:M,properties:k,patternProperties:S,additionalProperties:R,unevaluatedProperties:N,minProperties:L,maxProperties:D,propertyNames:$,dependentRequired:F,dependentSchemas:q,dependencies:B,prefixItems:U,items:z,additionalItems:V,unevaluatedItems:K,contains:Z,minContains:H,maxContains:J,minItems:W,maxItems:G,uniqueItems:Q,minimum:Y,maximum:X,exclusiveMinimum:ee,exclusiveMaximum:te,multipleOf:ne,minLength:re,maxLength:ae,pattern:ie,__absolute_ref__:se,__absolute_recursive_ref__:oe}=n,ue=[];if(!0===v&&null===d&&(d=n),"#"===y){const r=null===d?l[oe]:d,a=`${h}/$recursiveRef`,i=e(t,null===d?n:d,u,l,c,r,p,a,f);i.valid||ue.push({instanceLocation:p,keyword:"$recursiveRef",keywordLocation:a,error:"A subschema had errors."},...i.errors)}if(void 0!==b){const n=l[se||b];if(void 0===n){let e=`Unresolved $ref "${b}".`;throw se&&se!==b&&(e+=`  Absolute URI "${se}".`),e+=`\nKnown schemas:\n- ${Object.keys(l).join("\n- ")}`,new Error(e)}const r=`${h}/$ref`,a=e(t,n,u,l,c,d,p,r,f);if(a.valid||ue.push({instanceLocation:p,keyword:"$ref",keywordLocation:r,error:"A subschema had errors."},...a.errors),"4"===u||"7"===u)return{valid:0===ue.length,errors:ue}}if(Array.isArray(_)){let e=_.length,n=!1;for(let r=0;r<e;r++)if(g===_[r]||"integer"===_[r]&&"number"===g&&t%1==0&&t==t){n=!0;break}n||ue.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${g}" is invalid. Expected "${_.join('", "')}".`})}else"integer"===_?("number"!==g||t%1||t!=t)&&ue.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${g}" is invalid. Expected "${_}".`}):void 0!==_&&g!==_&&ue.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${g}" is invalid. Expected "${_}".`});if(void 0!==w&&("object"===g||"array"===g?(0,r.deepCompareStrict)(t,w)||ue.push({instanceLocation:p,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(w)}.`}):t!==w&&ue.push({instanceLocation:p,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(w)}.`})),void 0!==P&&("object"===g||"array"===g?P.some((e=>(0,r.deepCompareStrict)(t,e)))||ue.push({instanceLocation:p,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(P)}.`}):P.some((e=>t===e))||ue.push({instanceLocation:p,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(P)}.`})),void 0!==A){const n=`${h}/not`;e(t,A,u,l,c,d,p,n).valid&&ue.push({instanceLocation:p,keyword:"not",keywordLocation:n,error:'Instance matched "not" schema.'})}let le=[];if(void 0!==C){const n=`${h}/anyOf`,r=ue.length;let a=!1;for(let r=0;r<C.length;r++){const i=C[r],s=Object.create(f),o=e(t,i,u,l,c,!0===v?d:null,p,`${n}/${r}`,s);ue.push(...o.errors),a=a||o.valid,o.valid&&le.push(s)}a?ue.length=r:ue.splice(r,0,{instanceLocation:p,keyword:"anyOf",keywordLocation:n,error:"Instance does not match any subschemas."})}if(void 0!==T){const n=`${h}/allOf`,r=ue.length;let a=!0;for(let r=0;r<T.length;r++){const i=T[r],s=Object.create(f),o=e(t,i,u,l,c,!0===v?d:null,p,`${n}/${r}`,s);ue.push(...o.errors),a=a&&o.valid,o.valid&&le.push(s)}a?ue.length=r:ue.splice(r,0,{instanceLocation:p,keyword:"allOf",keywordLocation:n,error:"Instance does not match every subschema."})}if(void 0!==I){const n=`${h}/oneOf`,r=ue.length,a=I.filter(((r,a)=>{const i=Object.create(f),s=e(t,r,u,l,c,!0===v?d:null,p,`${n}/${a}`,i);return ue.push(...s.errors),s.valid&&le.push(i),s.valid})).length;1===a?ue.length=r:ue.splice(r,0,{instanceLocation:p,keyword:"oneOf",keywordLocation:n,error:`Instance does not match exactly one subschema (${a} matches).`})}if("object"!==g&&"array"!==g||Object.assign(f,...le),void 0!==E){const n=`${h}/if`;if(e(t,E,u,l,c,d,p,n,f).valid){if(void 0!==x){const r=e(t,x,u,l,c,d,p,`${h}/then`,f);r.valid||ue.push({instanceLocation:p,keyword:"if",keywordLocation:n,error:'Instance does not match "then" schema.'},...r.errors)}}else if(void 0!==j){const r=e(t,j,u,l,c,d,p,`${h}/else`,f);r.valid||ue.push({instanceLocation:p,keyword:"if",keywordLocation:n,error:'Instance does not match "else" schema.'},...r.errors)}}if("object"===g){if(void 0!==O)for(const e of O)e in t||ue.push({instanceLocation:p,keyword:"required",keywordLocation:`${h}/required`,error:`Instance does not have required property "${e}".`});const n=Object.keys(t);if(void 0!==L&&n.length<L&&ue.push({instanceLocation:p,keyword:"minProperties",keywordLocation:`${h}/minProperties`,error:`Instance does not have at least ${L} properties.`}),void 0!==D&&n.length>D&&ue.push({instanceLocation:p,keyword:"maxProperties",keywordLocation:`${h}/maxProperties`,error:`Instance does not have at least ${D} properties.`}),void 0!==$){const n=`${h}/propertyNames`;for(const r in t){const t=`${p}/${(0,s.encodePointer)(r)}`,a=e(r,$,u,l,c,d,t,n);a.valid||ue.push({instanceLocation:p,keyword:"propertyNames",keywordLocation:n,error:`Property name "${r}" does not match schema.`},...a.errors)}}if(void 0!==F){const e=`${h}/dependantRequired`;for(const n in F)if(n in t){const r=F[n];for(const a of r)a in t||ue.push({instanceLocation:p,keyword:"dependentRequired",keywordLocation:e,error:`Instance has "${n}" but does not have "${a}".`})}}if(void 0!==q)for(const n in q){const r=`${h}/dependentSchemas`;if(n in t){const a=e(t,q[n],u,l,c,d,p,`${r}/${(0,s.encodePointer)(n)}`,f);a.valid||ue.push({instanceLocation:p,keyword:"dependentSchemas",keywordLocation:r,error:`Instance has "${n}" but does not match dependant schema.`},...a.errors)}}if(void 0!==B){const n=`${h}/dependencies`;for(const r in B)if(r in t){const a=B[r];if(Array.isArray(a))for(const e of a)e in t||ue.push({instanceLocation:p,keyword:"dependencies",keywordLocation:n,error:`Instance has "${r}" but does not have "${e}".`});else{const i=e(t,a,u,l,c,d,p,`${n}/${(0,s.encodePointer)(r)}`);i.valid||ue.push({instanceLocation:p,keyword:"dependencies",keywordLocation:n,error:`Instance has "${r}" but does not match dependant schema.`},...i.errors)}}}const r=Object.create(null);let a=!1;if(void 0!==k){const n=`${h}/properties`;for(const i in k){if(!(i in t))continue;const o=`${p}/${(0,s.encodePointer)(i)}`,h=e(t[i],k[i],u,l,c,d,o,`${n}/${(0,s.encodePointer)(i)}`);if(h.valid)f[i]=r[i]=!0;else if(a=c,ue.push({instanceLocation:p,keyword:"properties",keywordLocation:n,error:`Property "${i}" does not match schema.`},...h.errors),a)break}}if(!a&&void 0!==S){const n=`${h}/patternProperties`;for(const i in S){const o=new RegExp(i),h=S[i];for(const m in t){if(!o.test(m))continue;const g=`${p}/${(0,s.encodePointer)(m)}`,b=e(t[m],h,u,l,c,d,g,`${n}/${(0,s.encodePointer)(i)}`);b.valid?f[m]=r[m]=!0:(a=c,ue.push({instanceLocation:p,keyword:"patternProperties",keywordLocation:n,error:`Property "${m}" matches pattern "${i}" but does not match associated schema.`},...b.errors))}}}if(a||void 0===R){if(!a&&void 0!==N){const n=`${h}/unevaluatedProperties`;for(const r in t)if(!f[r]){const a=`${p}/${(0,s.encodePointer)(r)}`,i=e(t[r],N,u,l,c,d,a,n);i.valid?f[r]=!0:ue.push({instanceLocation:p,keyword:"unevaluatedProperties",keywordLocation:n,error:`Property "${r}" does not match unevaluated properties schema.`},...i.errors)}}}else{const n=`${h}/additionalProperties`;for(const i in t){if(r[i])continue;const o=`${p}/${(0,s.encodePointer)(i)}`,h=e(t[i],R,u,l,c,d,o,n);h.valid?f[i]=!0:(a=c,ue.push({instanceLocation:p,keyword:"additionalProperties",keywordLocation:n,error:`Property "${i}" does not match additional properties schema.`},...h.errors))}}}else if("array"===g){void 0!==G&&t.length>G&&ue.push({instanceLocation:p,keyword:"maxItems",keywordLocation:`${h}/maxItems`,error:`Array has too many items (${t.length} > ${G}).`}),void 0!==W&&t.length<W&&ue.push({instanceLocation:p,keyword:"minItems",keywordLocation:`${h}/minItems`,error:`Array has too few items (${t.length} < ${W}).`});const n=t.length;let a=0,i=!1;if(void 0!==U){const r=`${h}/prefixItems`,s=Math.min(U.length,n);for(;a<s;a++){const n=e(t[a],U[a],u,l,c,d,`${p}/${a}`,`${r}/${a}`);if(f[a]=!0,!n.valid&&(i=c,ue.push({instanceLocation:p,keyword:"prefixItems",keywordLocation:r,error:"Items did not match schema."},...n.errors),i))break}}if(void 0!==z){const r=`${h}/items`;if(Array.isArray(z)){const s=Math.min(z.length,n);for(;a<s;a++){const n=e(t[a],z[a],u,l,c,d,`${p}/${a}`,`${r}/${a}`);if(f[a]=!0,!n.valid&&(i=c,ue.push({instanceLocation:p,keyword:"items",keywordLocation:r,error:"Items did not match schema."},...n.errors),i))break}}else for(;a<n;a++){const n=e(t[a],z,u,l,c,d,`${p}/${a}`,r);if(f[a]=!0,!n.valid&&(i=c,ue.push({instanceLocation:p,keyword:"items",keywordLocation:r,error:"Items did not match schema."},...n.errors),i))break}if(!i&&void 0!==V){const r=`${h}/additionalItems`;for(;a<n;a++){const n=e(t[a],V,u,l,c,d,`${p}/${a}`,r);f[a]=!0,n.valid||(i=c,ue.push({instanceLocation:p,keyword:"additionalItems",keywordLocation:r,error:"Items did not match additional items schema."},...n.errors))}}}if(void 0!==Z)if(0===n&&void 0===H)ue.push({instanceLocation:p,keyword:"contains",keywordLocation:`${h}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==H&&n<H)ue.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array has less items (${n}) than minContains (${H}).`});else{const r=`${h}/contains`,a=ue.length;let i=0;for(let a=0;a<n;a++){const n=e(t[a],Z,u,l,c,d,`${p}/${a}`,r);n.valid?(f[a]=!0,i++):ue.push(...n.errors)}i>=(H||0)&&(ue.length=a),void 0===H&&void 0===J&&0===i?ue.splice(a,0,{instanceLocation:p,keyword:"contains",keywordLocation:r,error:"Array does not contain item matching schema."}):void 0!==H&&i<H?ue.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array must contain at least ${H} items matching schema. Only ${i} items were found.`}):void 0!==J&&i>J&&ue.push({instanceLocation:p,keyword:"maxContains",keywordLocation:`${h}/maxContains`,error:`Array may contain at most ${J} items matching schema. ${i} items were found.`})}if(!i&&void 0!==K){const r=`${h}/unevaluatedItems`;for(;a<n;a++){if(f[a])continue;const n=e(t[a],K,u,l,c,d,`${p}/${a}`,r);f[a]=!0,n.valid||ue.push({instanceLocation:p,keyword:"unevaluatedItems",keywordLocation:r,error:"Items did not match unevaluated items schema."},...n.errors)}}if(Q)for(let e=0;e<n;e++){const a=t[e],i="object"==typeof a&&null!==a;for(let s=0;s<n;s++){if(e===s)continue;const n=t[s];(a===n||i&&"object"==typeof n&&null!==n&&(0,r.deepCompareStrict)(a,n))&&(ue.push({instanceLocation:p,keyword:"uniqueItems",keywordLocation:`${h}/uniqueItems`,error:`Duplicate items at indexes ${e} and ${s}.`}),e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER)}}}else if("number"===g){if("4"===u?(void 0!==Y&&(!0===ee&&t<=Y||t<Y)&&ue.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${t} is less than ${ee?"or equal to ":""} ${Y}.`}),void 0!==X&&(!0===te&&t>=X||t>X)&&ue.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${t} is greater than ${te?"or equal to ":""} ${X}.`})):(void 0!==Y&&t<Y&&ue.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${t} is less than ${Y}.`}),void 0!==X&&t>X&&ue.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${t} is greater than ${X}.`}),void 0!==ee&&t<=ee&&ue.push({instanceLocation:p,keyword:"exclusiveMinimum",keywordLocation:`${h}/exclusiveMinimum`,error:`${t} is less than ${ee}.`}),void 0!==te&&t>=te&&ue.push({instanceLocation:p,keyword:"exclusiveMaximum",keywordLocation:`${h}/exclusiveMaximum`,error:`${t} is greater than or equal to ${te}.`})),void 0!==ne){const e=t%ne;Math.abs(0-e)>=1.1920929e-7&&Math.abs(ne-e)>=1.1920929e-7&&ue.push({instanceLocation:p,keyword:"multipleOf",keywordLocation:`${h}/multipleOf`,error:`${t} is not a multiple of ${ne}.`})}}else if("string"===g){const e=void 0===re&&void 0===ae?0:(0,o.ucs2length)(t);void 0!==re&&e<re&&ue.push({instanceLocation:p,keyword:"minLength",keywordLocation:`${h}/minLength`,error:`String is too short (${e} < ${re}).`}),void 0!==ae&&e>ae&&ue.push({instanceLocation:p,keyword:"maxLength",keywordLocation:`${h}/maxLength`,error:`String is too long (${e} > ${ae}).`}),void 0===ie||new RegExp(ie).test(t)||ue.push({instanceLocation:p,keyword:"pattern",keywordLocation:`${h}/pattern`,error:"String does not match pattern."}),void 0!==M&&i.fastFormat[M]&&!i.fastFormat[M](t)&&ue.push({instanceLocation:p,keyword:"format",keywordLocation:`${h}/format`,error:`String does not match format "${M}".`})}return{valid:0===ue.length,errors:ue}}},78285:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Validator=void 0;const r=n(80375),a=n(1399);t.Validator=class{constructor(e,t="2019-09",n=!0){Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"draft",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"shortCircuit",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"lookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lookup=(0,r.dereference)(e)}validate(e){return(0,a.validate)(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),(0,r.dereference)(e,this.lookup)}}},61583:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCaller=void 0;const a=r(n(24116)),i=r(n(73290)),s=[400,401,402,403,404,405,406,407,409],o=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&s.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};t.AsyncCaller=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??o;const t="default"in i.default?i.default.default:i.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>(0,a.default)((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},82922:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chunkArray=void 0,t.chunkArray=(e,t)=>e.reduce(((e,n,r)=>{const a=Math.floor(r/t),i=e[a]||[];return e[a]=i.concat([n]),e}),[])},60418:function(e,t){"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironmentVariable=t.getRuntimeEnvironment=t.getEnv=t.isNode=t.isDeno=t.isJsDom=t.isWebWorker=t.isBrowser=void 0,t.isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,t.isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,t.isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),t.isDeno=()=>"undefined"!=typeof Deno,t.isNode=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!(0,t.isDeno)(),t.getEnv=()=>{let e;return e=(0,t.isBrowser)()?"browser":(0,t.isNode)()?"node":(0,t.isWebWorker)()?"webworker":(0,t.isJsDom)()?"jsdom":(0,t.isDeno)()?"deno":"other",e},t.getRuntimeEnvironment=async function(){if(void 0===n){const e=(0,t.getEnv)();n={library:"langchain-js",runtime:e}}return n},t.getEnvironmentVariable=function(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}},78266:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.unescapePathComponent=t.escapePathComponent=t.deepClone=t.JsonPatchError=void 0,i(n(37450),t),i(n(50609),t);var o=n(19350);Object.defineProperty(t,"JsonPatchError",{enumerable:!0,get:function(){return o.PatchError}}),Object.defineProperty(t,"deepClone",{enumerable:!0,get:function(){return o._deepClone}}),Object.defineProperty(t,"escapePathComponent",{enumerable:!0,get:function(){return o.escapePathComponent}}),Object.defineProperty(t,"unescapePathComponent",{enumerable:!0,get:function(){return o.unescapePathComponent}});const u=s(n(37450)),l=n(19350);t.default={...u,JsonPatchError:l.PatchError,deepClone:l._deepClone,escapePathComponent:l.escapePathComponent,unescapePathComponent:l.unescapePathComponent}},37450:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._areEquals=t.validate=t.validator=t.applyReducer=t.applyPatch=t.applyOperation=t.getValueByPointer=t.deepClone=t.JsonPatchError=void 0;const r=n(19350);t.JsonPatchError=r.PatchError,t.deepClone=r._deepClone;const a={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){let a=s(n,this.path);a&&(a=(0,r._deepClone)(a));const i=o(n,{op:"remove",path:this.from}).removed;return o(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:a}},copy:function(e,t,n){const a=s(n,this.from);return o(n,{op:"add",path:this.path,value:(0,r._deepClone)(a)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:d(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};var i={add:function(e,t,n){return(0,r.isInteger)(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:a.move,copy:a.copy,test:a.test,_get:a._get};function s(e,t){if(""==t)return e;var n={op:"_get",path:t};return o(e,n),n.value}function o(e,n,o=!1,u=!0,c=!0,p=0){if(o&&("function"==typeof o?o(n,0,e,n.path):l(n,0)),""===n.path){let r={newDocument:e};if("add"===n.op)return r.newDocument=n.value,r;if("replace"===n.op)return r.newDocument=n.value,r.removed=e,r;if("move"===n.op||"copy"===n.op)return r.newDocument=s(e,n.from),"move"===n.op&&(r.removed=e),r;if("test"===n.op){if(r.test=d(e,n.value),!1===r.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,n,e);return r.newDocument=e,r}if("remove"===n.op)return r.removed=e,r.newDocument=null,r;if("_get"===n.op)return n.value=e,r;if(o)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",p,n,e);return r}{u||(e=(0,r._deepClone)(e));const s=(n.path||"").split("/");let d,h,f,m=e,g=1,b=s.length;for(f="function"==typeof o?o:l;;){if(h=s[g],h&&-1!=h.indexOf("~")&&(h=(0,r.unescapePathComponent)(h)),c&&("__proto__"==h||"prototype"==h&&g>0&&"constructor"==s[g-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(o&&void 0===d&&(void 0===m[h]?d=s.slice(0,g).join("/"):g==b-1&&(d=n.path),void 0!==d&&f(n,0,e,d)),g++,Array.isArray(m)){if("-"===h)h=m.length;else{if(o&&!(0,r.isInteger)(h))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",p,n,e);(0,r.isInteger)(h)&&(h=~~h)}if(g>=b){if(o&&"add"===n.op&&h>m.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",p,n,e);const r=i[n.op].call(n,m,h,e);if(!1===r.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,n,e);return r}}else if(g>=b){const r=a[n.op].call(n,m,h,e);if(!1===r.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",p,n,e);return r}if(m=m[h],o&&g<b&&(!m||"object"!=typeof m))throw new t.JsonPatchError("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",p,n,e)}}}function u(e,n,a,i=!0,s=!0){if(a&&!Array.isArray(n))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=(0,r._deepClone)(e));const u=new Array(n.length);for(let t=0,r=n.length;t<r;t++)u[t]=o(e,n[t],a,!0,s,t),e=u[t].newDocument;return u.newDocument=e,u}function l(e,n,i,s){if("object"!=typeof e||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,e,i);if(!a[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,e,i);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,e,i);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,e,i);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,e,i);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,e,i);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&(0,r.hasUndefined)(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,e,i);if(i)if("add"==e.op){var o=e.path.split("/").length,u=s.split("/").length;if(o!==u+1&&o!==u)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,e,i)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==s)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,e,i)}else if("move"===e.op||"copy"===e.op){var l=c([{op:"_get",path:e.from,value:void 0}],i);if(l&&"OPERATION_PATH_UNRESOLVABLE"===l.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,e,i)}}function c(e,n,a){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(n)u((0,r._deepClone)(n),(0,r._deepClone)(e),a||!0);else{a=a||l;for(var i=0;i<e.length;i++)a(e[i],i,n,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}function d(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,a,i=Array.isArray(e),s=Array.isArray(t);if(i&&s){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!d(e[n],t[n]))return!1;return!0}if(i!=s)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!=n--;)if(!d(e[a=o[n]],t[a]))return!1;return!0}return e!=e&&t!=t}t.getValueByPointer=s,t.applyOperation=o,t.applyPatch=u,t.applyReducer=function(e,n,r){const a=o(e,n);if(!1===a.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",r,n,e);return a.newDocument},t.validator=l,t.validate=c,t._areEquals=d},50609:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compare=t.generate=t.observe=t.unobserve=void 0;const r=n(19350),a=n(37450);var i=new WeakMap;class s{constructor(e){Object.defineProperty(this,"obj",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.obj=e}}class o{constructor(e,t){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=e,this.observer=t}}function u(e,t=!1){var n=i.get(e.object);l(n.value,e.object,e.patches,"",t),e.patches.length&&(0,a.applyPatch)(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function l(e,t,n,a,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=(0,r._objectKeys)(t),o=(0,r._objectKeys)(e),u=!1,c=o.length-1;c>=0;c--){var d=e[h=o[c]];if(!(0,r.hasOwnProperty)(t,h)||void 0===t[h]&&void 0!==d&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:a+"/"+(0,r.escapePathComponent)(h),value:(0,r._deepClone)(d)}),n.push({op:"remove",path:a+"/"+(0,r.escapePathComponent)(h)}),u=!0):(i&&n.push({op:"test",path:a,value:e}),n.push({op:"replace",path:a,value:t}));else{var p=t[h];"object"==typeof d&&null!=d&&"object"==typeof p&&null!=p&&Array.isArray(d)===Array.isArray(p)?l(d,p,n,a+"/"+(0,r.escapePathComponent)(h),i):d!==p&&(i&&n.push({op:"test",path:a+"/"+(0,r.escapePathComponent)(h),value:(0,r._deepClone)(d)}),n.push({op:"replace",path:a+"/"+(0,r.escapePathComponent)(h),value:(0,r._deepClone)(p)}))}}if(u||s.length!=o.length)for(c=0;c<s.length;c++){var h=s[c];(0,r.hasOwnProperty)(e,h)||void 0===t[h]||n.push({op:"add",path:a+"/"+(0,r.escapePathComponent)(h),value:(0,r._deepClone)(t[h])})}}}t.unobserve=function(e,t){t.unobserve()},t.observe=function(e,t){var n,a=function(e){return i.get(e)}(e);if(a){const e=function(e,t){return e.observers.get(t)}(a,t);n=e&&e.observer}else a=new s(e),i.set(e,a);if(n)return n;if(n={},a.value=(0,r._deepClone)(e),t){n.callback=t,n.next=null;var l=()=>{u(n)},c=()=>{clearTimeout(n.next),n.next=setTimeout(l)};"undefined"!=typeof window&&(window.addEventListener("mouseup",c),window.addEventListener("keyup",c),window.addEventListener("mousedown",c),window.addEventListener("keydown",c),window.addEventListener("change",c))}return n.patches=[],n.object=e,n.unobserve=()=>{u(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(a,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",c),window.removeEventListener("keyup",c),window.removeEventListener("mousedown",c),window.removeEventListener("keydown",c),window.removeEventListener("change",c))},a.observers.set(t,new o(t,n)),n},t.generate=u,t.compare=function(e,t,n=!1){var r=[];return l(e,t,r,"",n),r}},19350:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatchError=t.hasUndefined=t.getPath=t._getPathRecursive=t.unescapePathComponent=t.escapePathComponent=t.isInteger=t._deepClone=t._objectKeys=t.hasOwnProperty=void 0;const n=Object.prototype.hasOwnProperty;function r(e,t){return n.call(e,t)}function a(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let n in e)r(e,n)&&t.push(n);return t}function i(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function s(e,t){let n;for(let a in e)if(r(e,a)){if(e[a]===t)return i(a)+"/";if("object"==typeof e[a]&&(n=s(e[a],t),""!=n))return i(a)+"/"+n}return""}function o(e,t){const n=[e];for(const e in t){const r="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==r&&n.push(`${e}: ${r}`)}return n.join("\n")}t.hasOwnProperty=r,t._objectKeys=a,t._deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},t.isInteger=function(e){let t=0;const n=e.length;let r;for(;t<n;){if(r=e.charCodeAt(t),!(r>=48&&r<=57))return!1;t++}return!0},t.escapePathComponent=i,t.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},t._getPathRecursive=s,t.getPath=function(e,t){if(e===t)return"/";const n=s(e,t);if(""===n)throw new Error("Object not found in root");return`/${n}`},t.hasUndefined=function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){const r=a(t),i=r.length;for(var n=0;n<i;n++)if(e(t[r[n]]))return!0}return!1};class u extends Error{constructor(e,t,n,r,a){super(o(e,{name:t,index:n,operation:r,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=o(e,{name:t,index:n,operation:r,tree:a})}}t.PatchError=u},28276:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStructuredTool=t.convertToOpenAITool=t.convertToOpenAIFunction=void 0;const r=n(39340);function a(e){return{name:e.name,description:e.description,parameters:(0,r.zodToJsonSchema)(e.schema)}}function i(e){return void 0!==e&&Array.isArray(e.lc_namespace)}t.convertToOpenAIFunction=a,t.convertToOpenAITool=function(e){return i(e)?{type:"function",function:a(e)}:e},t.isStructuredTool=i},681:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.insecureHash=void 0;var r=n(1685);Object.defineProperty(t,"insecureHash",{enumerable:!0,get:function(){return r.insecureHash}})},1685:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.insecureHash=void 0;var n="object"==typeof window?window:{},r="0123456789abcdef".split(""),a=[-2147483648,8388608,32768,128],i=[24,16,8,0],s=[];function o(e){e?(s[0]=s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0,this.blocks=s):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}o.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===n.ArrayBuffer&&(e=new Uint8Array(e));for(var r,a,s=0,o=e.length||0,u=this.blocks;s<o;){if(this.hashed&&(this.hashed=!1,u[0]=this.block,u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),t)for(a=this.start;s<o&&a<64;++s)u[a>>2]|=e[s]<<i[3&a++];else for(a=this.start;s<o&&a<64;++s)(r=e.charCodeAt(s))<128?u[a>>2]|=r<<i[3&a++]:r<2048?(u[a>>2]|=(192|r>>6)<<i[3&a++],u[a>>2]|=(128|63&r)<<i[3&a++]):r<55296||r>=57344?(u[a>>2]|=(224|r>>12)<<i[3&a++],u[a>>2]|=(128|r>>6&63)<<i[3&a++],u[a>>2]|=(128|63&r)<<i[3&a++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++s)),u[a>>2]|=(240|r>>18)<<i[3&a++],u[a>>2]|=(128|r>>12&63)<<i[3&a++],u[a>>2]|=(128|r>>6&63)<<i[3&a++],u[a>>2]|=(128|63&r)<<i[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=u[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},o.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=a[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},o.prototype.hash=function(){var e,t,n=this.h0,r=this.h1,a=this.h2,i=this.h3,s=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)n=(t=(r=(t=(a=(t=(i=(t=(s=(t=n<<5|n>>>27)+(r&a|~r&i)+s+1518500249+o[e]|0)<<5|s>>>27)+(n&(r=r<<30|r>>>2)|~n&a)+i+1518500249+o[e+1]|0)<<5|i>>>27)+(s&(n=n<<30|n>>>2)|~s&r)+a+1518500249+o[e+2]|0)<<5|a>>>27)+(i&(s=s<<30|s>>>2)|~i&n)+r+1518500249+o[e+3]|0)<<5|r>>>27)+(a&(i=i<<30|i>>>2)|~a&s)+n+1518500249+o[e+4]|0,a=a<<30|a>>>2;for(;e<40;e+=5)n=(t=(r=(t=(a=(t=(i=(t=(s=(t=n<<5|n>>>27)+(r^a^i)+s+1859775393+o[e]|0)<<5|s>>>27)+(n^(r=r<<30|r>>>2)^a)+i+1859775393+o[e+1]|0)<<5|i>>>27)+(s^(n=n<<30|n>>>2)^r)+a+1859775393+o[e+2]|0)<<5|a>>>27)+(i^(s=s<<30|s>>>2)^n)+r+1859775393+o[e+3]|0)<<5|r>>>27)+(a^(i=i<<30|i>>>2)^s)+n+1859775393+o[e+4]|0,a=a<<30|a>>>2;for(;e<60;e+=5)n=(t=(r=(t=(a=(t=(i=(t=(s=(t=n<<5|n>>>27)+(r&a|r&i|a&i)+s-1894007588+o[e]|0)<<5|s>>>27)+(n&(r=r<<30|r>>>2)|n&a|r&a)+i-1894007588+o[e+1]|0)<<5|i>>>27)+(s&(n=n<<30|n>>>2)|s&r|n&r)+a-1894007588+o[e+2]|0)<<5|a>>>27)+(i&(s=s<<30|s>>>2)|i&n|s&n)+r-1894007588+o[e+3]|0)<<5|r>>>27)+(a&(i=i<<30|i>>>2)|a&s|i&s)+n-1894007588+o[e+4]|0,a=a<<30|a>>>2;for(;e<80;e+=5)n=(t=(r=(t=(a=(t=(i=(t=(s=(t=n<<5|n>>>27)+(r^a^i)+s-899497514+o[e]|0)<<5|s>>>27)+(n^(r=r<<30|r>>>2)^a)+i-899497514+o[e+1]|0)<<5|i>>>27)+(s^(n=n<<30|n>>>2)^r)+a-899497514+o[e+2]|0)<<5|a>>>27)+(i^(s=s<<30|s>>>2)^n)+r-899497514+o[e+3]|0)<<5|r>>>27)+(a^(i=i<<30|i>>>2)^s)+n-899497514+o[e+4]|0,a=a<<30|a>>>2;this.h0=this.h0+n|0,this.h1=this.h1+r|0,this.h2=this.h2+a|0,this.h3=this.h3+i|0,this.h4=this.h4+s|0},o.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,a=this.h3,i=this.h4;return r[e>>28&15]+r[e>>24&15]+r[e>>20&15]+r[e>>16&15]+r[e>>12&15]+r[e>>8&15]+r[e>>4&15]+r[15&e]+r[t>>28&15]+r[t>>24&15]+r[t>>20&15]+r[t>>16&15]+r[t>>12&15]+r[t>>8&15]+r[t>>4&15]+r[15&t]+r[n>>28&15]+r[n>>24&15]+r[n>>20&15]+r[n>>16&15]+r[n>>12&15]+r[n>>8&15]+r[n>>4&15]+r[15&n]+r[a>>28&15]+r[a>>24&15]+r[a>>20&15]+r[a>>16&15]+r[a>>12&15]+r[a>>8&15]+r[a>>4&15]+r[15&a]+r[i>>28&15]+r[i>>24&15]+r[i>>20&15]+r[i>>16&15]+r[i>>12&15]+r[i>>8&15]+r[i>>4&15]+r[15&i]},o.prototype.toString=o.prototype.hex,o.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a]},o.prototype.array=o.prototype.digest,o.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e},t.insecureHash=e=>new o(!0).update(e).hex()},39803:function(e,t){"use strict";function n(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="";const n=[];let r=!1,a=!1;for(let i of e){if(r)'"'!==i||a?"\n"!==i||a?a="\\"===i&&!a:i="\\n":r=!1;else if('"'===i)r=!0,a=!1;else if("{"===i)n.push("}");else if("["===i)n.push("]");else if("}"===i||"]"===i){if(!n||n[n.length-1]!==i)return null;n.pop()}t+=i}r&&(t+='"');for(let e=n.length-1;e>=0;e-=1)t+=n[e];try{return JSON.parse(t)}catch(e){return null}}Object.defineProperty(t,"__esModule",{value:!0}),t.parsePartialJson=t.parseJsonMarkdown=void 0,t.parseJsonMarkdown=function(e,t=n){e=e.trim();const r=/```(json)?(.*)```/s.exec(e);return t(r?r[2]:e)},t.parsePartialJson=n},96096:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyPatch=t.compare=void 0;var r=n(78266);Object.defineProperty(t,"compare",{enumerable:!0,get:function(){return r.compare}}),Object.defineProperty(t,"applyPatch",{enumerable:!0,get:function(){return r.applyPatch}})},26548:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sax=void 0;const n=function(){const e={parser:function(e,t){return new n(e,t)}};e.SAXParser=n,e.SAXStream=i,e.createStream=function(e,t){return new i(e,t)},e.MAX_BUFFER_LENGTH=65536;const t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function n(r,a){if(!(this instanceof n))return new n(r,a);var i=this;!function(e){for(var n=0,r=t.length;n<r;n++)e[t[n]]=""}(i),i.q=i.c="",i.bufferCheckPosition=e.MAX_BUFFER_LENGTH,i.opt=a||{},i.opt.lowercase=i.opt.lowercase||i.opt.lowercasetags,i.looseCase=i.opt.lowercase?"toLowerCase":"toUpperCase",i.tags=[],i.closed=i.closedRoot=i.sawRoot=!1,i.tag=i.error=null,i.strict=!!r,i.noscript=!(!r&&!i.opt.noscript),i.state=O.BEGIN,i.strictEntities=i.opt.strictEntities,i.ENTITIES=i.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),i.attribList=[],i.opt.xmlns&&(i.ns=Object.create(c)),i.trackPosition=!1!==i.opt.position,i.trackPosition&&(i.position=i.line=i.column=0),C(i,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),n.prototype={end:function(){j(this)},write:function(n){var r=this;if(this.error)throw this.error;if(r.closed)return x(r,"Cannot write after close. Assign an onready handler.");if(null===n)return j(r);"object"==typeof n&&(n=n.toString());for(var a=0,i="";i=F(n,a++),r.c=i,i;)switch(r.trackPosition&&(r.position++,"\n"===i?(r.line++,r.column=0):r.column++),r.state){case O.BEGIN:if(r.state=O.BEGIN_WHITESPACE,"\ufeff"===i)continue;$(r,i);continue;case O.BEGIN_WHITESPACE:$(r,i);continue;case O.TEXT:if(r.sawRoot&&!r.closedRoot){for(var u=a-1;i&&"<"!==i&&"&"!==i;)(i=F(n,a++))&&r.trackPosition&&(r.position++,"\n"===i?(r.line++,r.column=0):r.column++);r.textNode+=n.substring(u,a-1)}"<"!==i||r.sawRoot&&r.closedRoot&&!r.strict?(m(i)||r.sawRoot&&!r.closedRoot||M(r,"Text data outside of root node."),"&"===i?r.state=O.TEXT_ENTITY:r.textNode+=i):(r.state=O.OPEN_WAKA,r.startTagPosition=r.position);continue;case O.SCRIPT:"<"===i?r.state=O.SCRIPT_ENDING:r.script+=i;continue;case O.SCRIPT_ENDING:"/"===i?r.state=O.CLOSE_TAG:(r.script+="<"+i,r.state=O.SCRIPT);continue;case O.OPEN_WAKA:if("!"===i)r.state=O.SGML_DECL,r.sgmlDecl="";else if(m(i));else if(y(d,i))r.state=O.OPEN_TAG,r.tagName=i;else if("/"===i)r.state=O.CLOSE_TAG,r.tagName="";else if("?"===i)r.state=O.PROC_INST,r.procInstName=r.procInstBody="";else{if(M(r,"Unencoded <"),r.startTagPosition+1<r.position){var l=r.position-r.startTagPosition;i=new Array(l).join(" ")+i}r.textNode+="<"+i,r.state=O.TEXT}continue;case O.SGML_DECL:(r.sgmlDecl+i).toUpperCase()===s?(T(r,"onopencdata"),r.state=O.CDATA,r.sgmlDecl="",r.cdata=""):r.sgmlDecl+i==="--"?(r.state=O.COMMENT,r.comment="",r.sgmlDecl=""):(r.sgmlDecl+i).toUpperCase()===o?(r.state=O.DOCTYPE,(r.doctype||r.sawRoot)&&M(r,"Inappropriately located doctype declaration"),r.doctype="",r.sgmlDecl=""):">"===i?(T(r,"onsgmldeclaration",r.sgmlDecl),r.sgmlDecl="",r.state=O.TEXT):g(i)?(r.state=O.SGML_DECL_QUOTED,r.sgmlDecl+=i):r.sgmlDecl+=i;continue;case O.SGML_DECL_QUOTED:i===r.q&&(r.state=O.SGML_DECL,r.q=""),r.sgmlDecl+=i;continue;case O.DOCTYPE:">"===i?(r.state=O.TEXT,T(r,"ondoctype",r.doctype),r.doctype=!0):(r.doctype+=i,"["===i?r.state=O.DOCTYPE_DTD:g(i)&&(r.state=O.DOCTYPE_QUOTED,r.q=i));continue;case O.DOCTYPE_QUOTED:r.doctype+=i,i===r.q&&(r.q="",r.state=O.DOCTYPE);continue;case O.DOCTYPE_DTD:r.doctype+=i,"]"===i?r.state=O.DOCTYPE:g(i)&&(r.state=O.DOCTYPE_DTD_QUOTED,r.q=i);continue;case O.DOCTYPE_DTD_QUOTED:r.doctype+=i,i===r.q&&(r.state=O.DOCTYPE_DTD,r.q="");continue;case O.COMMENT:"-"===i?r.state=O.COMMENT_ENDING:r.comment+=i;continue;case O.COMMENT_ENDING:"-"===i?(r.state=O.COMMENT_ENDED,r.comment=E(r.opt,r.comment),r.comment&&T(r,"oncomment",r.comment),r.comment=""):(r.comment+="-"+i,r.state=O.COMMENT);continue;case O.COMMENT_ENDED:">"!==i?(M(r,"Malformed comment"),r.comment+="--"+i,r.state=O.COMMENT):r.state=O.TEXT;continue;case O.CDATA:"]"===i?r.state=O.CDATA_ENDING:r.cdata+=i;continue;case O.CDATA_ENDING:"]"===i?r.state=O.CDATA_ENDING_2:(r.cdata+="]"+i,r.state=O.CDATA);continue;case O.CDATA_ENDING_2:">"===i?(r.cdata&&T(r,"oncdata",r.cdata),T(r,"onclosecdata"),r.cdata="",r.state=O.TEXT):"]"===i?r.cdata+="]":(r.cdata+="]]"+i,r.state=O.CDATA);continue;case O.PROC_INST:"?"===i?r.state=O.PROC_INST_ENDING:m(i)?r.state=O.PROC_INST_BODY:r.procInstName+=i;continue;case O.PROC_INST_BODY:if(!r.procInstBody&&m(i))continue;"?"===i?r.state=O.PROC_INST_ENDING:r.procInstBody+=i;continue;case O.PROC_INST_ENDING:">"===i?(T(r,"onprocessinginstruction",{name:r.procInstName,body:r.procInstBody}),r.procInstName=r.procInstBody="",r.state=O.TEXT):(r.procInstBody+="?"+i,r.state=O.PROC_INST_BODY);continue;case O.OPEN_TAG:y(p,i)?r.tagName+=i:(k(r),">"===i?N(r):"/"===i?r.state=O.OPEN_TAG_SLASH:(m(i)||M(r,"Invalid character in tag name"),r.state=O.ATTRIB));continue;case O.OPEN_TAG_SLASH:">"===i?(N(r,!0),L(r)):(M(r,"Forward-slash in opening tag not followed by >"),r.state=O.ATTRIB);continue;case O.ATTRIB:if(m(i))continue;">"===i?N(r):"/"===i?r.state=O.OPEN_TAG_SLASH:y(d,i)?(r.attribName=i,r.attribValue="",r.state=O.ATTRIB_NAME):M(r,"Invalid attribute name");continue;case O.ATTRIB_NAME:"="===i?r.state=O.ATTRIB_VALUE:">"===i?(M(r,"Attribute without value"),r.attribValue=r.attribName,R(r),N(r)):m(i)?r.state=O.ATTRIB_NAME_SAW_WHITE:y(p,i)?r.attribName+=i:M(r,"Invalid attribute name");continue;case O.ATTRIB_NAME_SAW_WHITE:if("="===i)r.state=O.ATTRIB_VALUE;else{if(m(i))continue;M(r,"Attribute without value"),r.tag.attributes[r.attribName]="",r.attribValue="",T(r,"onattribute",{name:r.attribName,value:""}),r.attribName="",">"===i?N(r):y(d,i)?(r.attribName=i,r.state=O.ATTRIB_NAME):(M(r,"Invalid attribute name"),r.state=O.ATTRIB)}continue;case O.ATTRIB_VALUE:if(m(i))continue;g(i)?(r.q=i,r.state=O.ATTRIB_VALUE_QUOTED):(M(r,"Unquoted attribute value"),r.state=O.ATTRIB_VALUE_UNQUOTED,r.attribValue=i);continue;case O.ATTRIB_VALUE_QUOTED:if(i!==r.q){"&"===i?r.state=O.ATTRIB_VALUE_ENTITY_Q:r.attribValue+=i;continue}R(r),r.q="",r.state=O.ATTRIB_VALUE_CLOSED;continue;case O.ATTRIB_VALUE_CLOSED:m(i)?r.state=O.ATTRIB:">"===i?N(r):"/"===i?r.state=O.OPEN_TAG_SLASH:y(d,i)?(M(r,"No whitespace between attributes"),r.attribName=i,r.attribValue="",r.state=O.ATTRIB_NAME):M(r,"Invalid attribute name");continue;case O.ATTRIB_VALUE_UNQUOTED:if(!b(i)){"&"===i?r.state=O.ATTRIB_VALUE_ENTITY_U:r.attribValue+=i;continue}R(r),">"===i?N(r):r.state=O.ATTRIB;continue;case O.CLOSE_TAG:if(r.tagName)">"===i?L(r):y(p,i)?r.tagName+=i:r.script?(r.script+="</"+r.tagName,r.tagName="",r.state=O.SCRIPT):(m(i)||M(r,"Invalid tagname in closing tag"),r.state=O.CLOSE_TAG_SAW_WHITE);else{if(m(i))continue;v(d,i)?r.script?(r.script+="</"+i,r.state=O.SCRIPT):M(r,"Invalid tagname in closing tag."):r.tagName=i}continue;case O.CLOSE_TAG_SAW_WHITE:if(m(i))continue;">"===i?L(r):M(r,"Invalid characters in closing tag");continue;case O.TEXT_ENTITY:case O.ATTRIB_VALUE_ENTITY_Q:case O.ATTRIB_VALUE_ENTITY_U:var c,_;switch(r.state){case O.TEXT_ENTITY:c=O.TEXT,_="textNode";break;case O.ATTRIB_VALUE_ENTITY_Q:c=O.ATTRIB_VALUE_QUOTED,_="attribValue";break;case O.ATTRIB_VALUE_ENTITY_U:c=O.ATTRIB_VALUE_UNQUOTED,_="attribValue"}if(";"===i)if(r.opt.unparsedEntities){var w=D(r);r.entity="",r.state=c,r.write(w)}else r[_]+=D(r),r.entity="",r.state=c;else y(r.entity.length?f:h,i)?r.entity+=i:(M(r,"Invalid character in entity name"),r[_]+="&"+r.entity+i,r.entity="",r.state=c);continue;default:throw new Error(r,"Unknown state: "+r.state)}return r.position>=r.bufferCheckPosition&&function(n){for(var r=Math.max(e.MAX_BUFFER_LENGTH,10),a=0,i=0,s=t.length;i<s;i++){var o=n[t[i]].length;if(o>r)switch(t[i]){case"textNode":I(n);break;case"cdata":T(n,"oncdata",n.cdata),n.cdata="";break;case"script":T(n,"onscript",n.script),n.script="";break;default:x(n,"Max buffer length exceeded: "+t[i])}a=Math.max(a,o)}var u=e.MAX_BUFFER_LENGTH-a;n.bufferCheckPosition=u+n.position}(r),r},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;I(e=this),""!==e.cdata&&(T(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(T(e,"onscript",e.script),e.script="")}};var r=ReadableStream;r||(r=function(){});var a=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function i(e,t){if(!(this instanceof i))return new i(e,t);r.apply(this),this._parser=new n(e,t),this.writable=!0,this.readable=!0;var s=this;this._parser.onend=function(){s.emit("end")},this._parser.onerror=function(e){s.emit("error",e),s._parser.error=null},this._decoder=null,a.forEach((function(e){Object.defineProperty(s,"on"+e,{get:function(){return s._parser["on"+e]},set:function(t){if(!t)return s.removeAllListeners(e),s._parser["on"+e]=t,t;s.on(e,t)},enumerable:!0,configurable:!1})}))}i.prototype=Object.create(r.prototype,{constructor:{value:i}}),i.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},i.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},i.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||-1===a.indexOf(e)||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),r.prototype.on.call(n,e,t)};var s="[CDATA[",o="DOCTYPE",u="http://www.w3.org/XML/1998/namespace",l="http://www.w3.org/2000/xmlns/",c={xml:u,xmlns:l},d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,h=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function m(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function g(e){return'"'===e||"'"===e}function b(e){return">"===e||m(e)}function y(e,t){return e.test(t)}function v(e,t){return!y(e,t)}var _,w,P,O=0;for(var A in e.STATE={BEGIN:O++,BEGIN_WHITESPACE:O++,TEXT:O++,TEXT_ENTITY:O++,OPEN_WAKA:O++,SGML_DECL:O++,SGML_DECL_QUOTED:O++,DOCTYPE:O++,DOCTYPE_QUOTED:O++,DOCTYPE_DTD:O++,DOCTYPE_DTD_QUOTED:O++,COMMENT_STARTING:O++,COMMENT:O++,COMMENT_ENDING:O++,COMMENT_ENDED:O++,CDATA:O++,CDATA_ENDING:O++,CDATA_ENDING_2:O++,PROC_INST:O++,PROC_INST_BODY:O++,PROC_INST_ENDING:O++,OPEN_TAG:O++,OPEN_TAG_SLASH:O++,ATTRIB:O++,ATTRIB_NAME:O++,ATTRIB_NAME_SAW_WHITE:O++,ATTRIB_VALUE:O++,ATTRIB_VALUE_QUOTED:O++,ATTRIB_VALUE_CLOSED:O++,ATTRIB_VALUE_UNQUOTED:O++,ATTRIB_VALUE_ENTITY_Q:O++,ATTRIB_VALUE_ENTITY_U:O++,CLOSE_TAG:O++,CLOSE_TAG_SAW_WHITE:O++,SCRIPT:O++,SCRIPT_ENDING:O++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var n=e.ENTITIES[t],r="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=r})),e.STATE)e.STATE[e.STATE[A]]=A;function C(e,t,n){e[t]&&e[t](n)}function T(e,t,n){e.textNode&&I(e),C(e,t,n)}function I(e){e.textNode=E(e.opt,e.textNode),e.textNode&&C(e,"ontext",e.textNode),e.textNode=""}function E(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function x(e,t){return I(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,C(e,"onerror",t),e}function j(e){return e.sawRoot&&!e.closedRoot&&M(e,"Unclosed root tag"),e.state!==O.BEGIN&&e.state!==O.BEGIN_WHITESPACE&&e.state!==O.TEXT&&x(e,"Unexpected end"),I(e),e.c="",e.closed=!0,C(e,"onend"),n.call(e,e.strict,e.opt),e}function M(e,t){if("object"!=typeof e||!(e instanceof n))throw new Error("bad call to strictFail");e.strict&&x(e,t)}function k(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,T(e,"onopentagstart",n)}function S(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),r=n[0],a=n[1];return t&&"xmlns"===e&&(r="xmlns",a=""),{prefix:r,local:a}}function R(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=S(e.attribName,!0),n=t.prefix,r=t.local;if("xmlns"===n)if("xml"===r&&e.attribValue!==u)M(e,"xml: prefix must be bound to "+u+"\nActual: "+e.attribValue);else if("xmlns"===r&&e.attribValue!==l)M(e,"xmlns: prefix must be bound to "+l+"\nActual: "+e.attribValue);else{var a=e.tag,i=e.tags[e.tags.length-1]||e;a.ns===i.ns&&(a.ns=Object.create(i.ns)),a.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,T(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function N(e,t){if(e.opt.xmlns){var n=e.tag,r=S(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(M(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var a=e.tags[e.tags.length-1]||e;n.ns&&a.ns!==n.ns&&Object.keys(n.ns).forEach((function(t){T(e,"onopennamespace",{prefix:t,uri:n.ns[t]})}));for(var i=0,s=e.attribList.length;i<s;i++){var o=e.attribList[i],u=o[0],l=o[1],c=S(u,!0),d=c.prefix,p=c.local,h=""===d?"":n.ns[d]||"",f={name:u,value:l,prefix:d,local:p,uri:h};d&&"xmlns"!==d&&!h&&(M(e,"Unbound namespace prefix: "+JSON.stringify(d)),f.uri=d),e.tag.attributes[u]=f,T(e,"onattribute",f)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),T(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=O.TEXT:e.state=O.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function L(e){if(!e.tagName)return M(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=O.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=O.SCRIPT);T(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var r=n;t--&&e.tags[t].name!==r;)M(e,"Unexpected close tag");if(t<0)return M(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=O.TEXT);e.tagName=n;for(var a=e.tags.length;a-- >t;){var i=e.tag=e.tags.pop();e.tagName=e.tag.name,T(e,"onclosetag",e.tagName);var s={};for(var o in i.ns)s[o]=i.ns[o];var u=e.tags[e.tags.length-1]||e;e.opt.xmlns&&i.ns!==u.ns&&Object.keys(i.ns).forEach((function(t){var n=i.ns[t];T(e,"onclosenamespace",{prefix:t,uri:n})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=O.TEXT}function D(e){var t,n=e.entity,r=n.toLowerCase(),a="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[r]?e.ENTITIES[r]:("#"===(n=r).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),a=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),a=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),isNaN(t)||a.toLowerCase()!==n?(M(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function $(e,t){"<"===t?(e.state=O.OPEN_WAKA,e.startTagPosition=e.position):m(t)||(M(e,"Non-whitespace before first tag."),e.textNode=t,e.state=O.TEXT)}function F(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}return O=e.STATE,String.fromCodePoint||(_=String.fromCharCode,w=Math.floor,P=function(){var e,t,n=[],r=-1,a=arguments.length;if(!a)return"";for(var i="";++r<a;){var s=Number(arguments[r]);if(!isFinite(s)||s<0||s>1114111||w(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,n.push(e,t)),(r+1===a||n.length>16384)&&(i+=_.apply(null,n),n.length=0)}return i},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:P,configurable:!0,writable:!0}):String.fromCodePoint=P),e},r=n();t.sax=r},28033:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pipeGeneratorWithSetup=t.AsyncGeneratorWithSetup=t.concat=t.atee=t.IterableReadableStream=void 0;class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new n({start(e){return function n(){return t.read().then((({done:t,value:r})=>{if(!t)return e.enqueue(r),n();e.close()}))}()},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({async pull(t){const{value:n,done:r}=await e.next();r&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}t.IterableReadableStream=n,t.atee=function(e,t=2){const n=Array.from({length:t},(()=>[]));return n.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of n)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))},t.concat=function e(t,n){if(Array.isArray(t)&&Array.isArray(n))return t.concat(n);if("string"==typeof t&&"string"==typeof n)return t+n;if("number"==typeof t&&"number"==typeof n)return t+n;if("concat"in t&&"function"==typeof t.concat)return t.concat(n);if("object"==typeof t&&"object"==typeof n){const r={...t};for(const[t,a]of Object.entries(n))t in r&&!Array.isArray(r[t])?r[t]=e(r[t],a):r[t]=a;return r}throw new Error(`Cannot concat ${typeof t} and ${typeof n}`)};class r{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((n,r)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(n,r):this.firstResult.then((e=>n(void 0)),r)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}t.AsyncGeneratorWithSetup=r,t.pipeGeneratorWithSetup=async function(e,t,n,...a){const i=new r(t,n),s=await i.setup;return{output:e(i,s,...a),setup:s}}},10454:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodingForModel=t.getEncoding=void 0;const r=n(34601),a=n(61583),i={},s=new a.AsyncCaller({});async function o(e){return e in i||(i[e]=s.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new r.Tiktoken(e))).catch((t=>{throw delete i[e],t}))),await i[e]}t.getEncoding=o,t.encodingForModel=async function(e){return o((0,r.getEncodingNameForModel)(e))}},72784:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SaveableVectorStore=t.VectorStore=t.VectorStoreRetriever=void 0;const r=n(86475),a=n(367);class i extends r.BaseRetriever{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,"mmr"===e.searchType&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if("mmr"===this.searchType){if("function"!=typeof this.vectorStore.maxMarginalRelevanceSearch)throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t?.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t?.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}t.VectorStoreRetriever=i;class s extends a.Serializable{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,n=void 0,r=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)).map((e=>e[0]))}async similaritySearchWithScore(e,t=4,n=void 0,r=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)}static fromTexts(e,t,n,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,n,r,a,s){if("number"==typeof e)return new i({vectorStore:this,k:e,filter:t,tags:[...r??[],this._vectorstoreType()],metadata:a,verbose:s,callbacks:n});{const t={vectorStore:this,k:e?.k,filter:e?.filter,tags:[...e?.tags??[],this._vectorstoreType()],metadata:e?.metadata,verbose:e?.verbose,callbacks:e?.callbacks,searchType:e?.searchType};return new i("mmr"===e?.searchType?{...t,searchKwargs:e.searchKwargs}:{...t})}}}t.VectorStore=s,t.SaveableVectorStore=class extends s{static load(e,t){throw new Error("Not implemented")}}},10338:function(e,t,n){e.exports=n(83486)},43598:function(e,t,n){e.exports=n(75497)},97345:function(e,t,n){e.exports=n(70349)},80601:function(e,t,n){e.exports=n(37738)},80761:function(e,t,n){e.exports=n(83296)},20314:function(e,t,n){e.exports=n(85953)},47345:function(e,t,n){e.exports=n(61834)},6500:function(e,t,n){e.exports=n(14190)},58618:function(e,t,n){e.exports=n(96404)},82407:function(e,t,n){e.exports=n(33359)},79582:function(e,t,n){e.exports=n(50383)},96803:function(e,t,n){e.exports=n(5118)},66749:function(e,t,n){e.exports=n(96193)},4538:function(e,t,n){e.exports=n(37534)},45673:function(e,t,n){e.exports=n(64844)},87724:function(e,t,n){e.exports=n(61583)},39899:function(e,t,n){e.exports=n(82922)},82331:function(e,t,n){e.exports=n(60418)},30107:function(e,t,n){e.exports=n(28276)},69920:function(e,t,n){e.exports=n(96096)},28053:function(e,t,n){e.exports=n(10454)},47539:function(e,t,n){e.exports=n(72784)},83295:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AzureChatOpenAI=void 0;const r=n(80975);class a extends r.ChatOpenAI{_llmType(){return"azure_openai"}get lc_aliases(){return{openAIApiKey:"openai_api_key",openAIApiVersion:"openai_api_version",openAIBasePath:"openai_api_base"}}constructor(e){let t=e?.openAIBasePath??"";t.endsWith("/")||(t+="/"),t.endsWith("openai/deployments")||(t+="openai/deployments");const n=e?{...e}:e;n&&(n.azureOpenAIBasePath=t,n.azureOpenAIApiDeploymentName=n.deploymentName,n.azureOpenAIApiKey=n.openAIApiKey,n.azureOpenAIApiVersion=n.openAIApiVersion),super(n)}toJSON(){const e=super.toJSON();function t(e){return"object"==typeof e&&null!=e}return t(e)&&t(e.kwargs)&&(delete e.kwargs.azure_openai_base_path,delete e.kwargs.azure_openai_api_deployment_name,delete e.kwargs.azure_openai_api_key,delete e.kwargs.azure_openai_api_version,delete e.kwargs.azure_open_ai_base_path),e}}t.AzureChatOpenAI=a},20896:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AzureOpenAI=void 0;const r=n(4304);class a extends r.OpenAI{get lc_aliases(){return{openAIApiKey:"openai_api_key",openAIApiVersion:"openai_api_version",openAIBasePath:"openai_api_base"}}constructor(e){let t=e?.openAIBasePath??"";t.endsWith("/")||(t+="/"),t.endsWith("openai/deployments")||(t+="openai/deployments");const n=e?{...e}:e;n&&(n.azureOpenAIBasePath=t,n.azureOpenAIApiDeploymentName=n.deploymentName,n.azureOpenAIApiKey=n.openAIApiKey,n.azureOpenAIApiVersion=n.openAIApiVersion),super(n)}toJSON(){const e=super.toJSON();function t(e){return"object"==typeof e&&null!=e}return t(e)&&t(e.kwargs)&&(delete e.kwargs.azure_openai_base_path,delete e.kwargs.azure_openai_api_deployment_name,delete e.kwargs.azure_openai_api_key,delete e.kwargs.azure_openai_api_version,delete e.kwargs.azure_open_ai_base_path),e}}t.AzureOpenAI=a},80975:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatOpenAI=t.messageToOpenAIRole=void 0;const r=n(32012),a=n(6500),i=n(79582),s=n(82331),o=n(80761),u=n(30107),l=n(4538),c=n(58618),d=n(82407),p=n(39340),h=n(81047),f=n(65792),m=n(61970);function g(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!a.ChatMessage.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function b(e){const t=e.tool_calls;if("assistant"===e.role){const n=[],r=[];for(const e of t??[])try{n.push((0,d.parseToolCall)(e,{returnId:!0}))}catch(t){r.push((0,d.makeInvalidToolCall)(e,t.message))}return new a.AIMessage({content:e.content||"",tool_calls:n,invalid_tool_calls:r,additional_kwargs:{function_call:e.function_call,tool_calls:t}})}return new a.ChatMessage(e.content||"",e.role??"unknown")}function y(e,t){const n=e.role??t,r=e.content??"";let i;if(i=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},"user"===n)return new a.HumanMessageChunk({content:r});if("assistant"===n){const t=[];if(Array.isArray(e.tool_calls))for(const n of e.tool_calls)t.push({name:n.function?.name,args:n.function?.arguments,id:n.id,index:n.index});return new a.AIMessageChunk({content:r,tool_call_chunks:t,additional_kwargs:i})}return"system"===n?new a.SystemMessageChunk({content:r}):"function"===n?new a.FunctionMessageChunk({content:r,additional_kwargs:i,name:e.name}):"tool"===n?new a.ToolMessageChunk({content:r,additional_kwargs:i,tool_call_id:e.tool_call_id}):new a.ChatMessageChunk({content:r,role:n})}function v(e){return e.map((e=>{const t={role:g(e),content:e.content};return null!=e.name&&(t.name=e.name),null!=e.additional_kwargs.function_call&&(t.function_call=e.additional_kwargs.function_call),(0,a.isAIMessage)(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(d.convertLangChainToolCallToOpenAI):(null!=e.additional_kwargs.tool_calls&&(t.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(t.tool_call_id=e.tool_call_id)),t}))}t.messageToOpenAIRole=g;class _ extends o.BaseChatModel{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??(0,s.getEnvironmentVariable)("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.apiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,s.getEnvironmentVariable)("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??(0,s.getEnvironmentVariable)("OPENAI_ORGANIZATION"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}bindTools(e,t){return this.bind({tools:e.map(u.convertToOpenAITool),...t})}invocationParams(e){var t;return{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:(t=e?.tools,void 0!==t&&t.every((e=>Array.isArray(e.lc_namespace)))?e?.tools.map(u.convertToOpenAITool):e?.tools),tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){const r=v(e),a={...this.invocationParams(t),messages:r,stream:!0};let s;const o=await this.completionWithRetry(a,t);for await(const e of o){const r=e?.choices[0];if(!r)continue;const{delta:a}=r;if(!a)continue;const o=y(a,s);s=a.role??s;const u={prompt:t.promptIndex??0,completion:r.index??0};if("string"!=typeof o.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const l={...u};void 0!==r.finish_reason&&(l.finish_reason=r.finish_reason),this.logprobs&&(l.logprobs=r.logprobs);const c=new i.ChatGenerationChunk({message:o,text:o.content,generationInfo:l});yield c,n?.handleLLMNewToken(c.text??"",u,void 0,void 0,void 0,{chunk:c})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){const r={},a=this.invocationParams(t),i=v(e);if(a.stream){const a=this._streamResponseChunks(e,t,n),i={};for await(const e of a){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};const t=e.generationInfo?.completion??0;void 0===i[t]?i[t]=e:i[t]=i[t].concat(e)}const s=Object.entries(i).sort((([e],[t])=>parseInt(e,10)-parseInt(t,10))).map((([e,t])=>t)),{functions:o,function_call:u}=this.invocationParams(t),l=await this.getEstimatedTokenCountFromPrompt(e,o,u),c=await this.getNumTokensFromGenerations(s);return r.promptTokens=l,r.completionTokens=c,r.totalTokens=l+c,{generations:s,llmOutput:{estimatedTokenUsage:r}}}{const e=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t?.signal,...t?.options}),{completion_tokens:n,prompt_tokens:s,total_tokens:o}=e?.usage??{};n&&(r.completionTokens=(r.completionTokens??0)+n),s&&(r.promptTokens=(r.promptTokens??0)+s),o&&(r.totalTokens=(r.totalTokens??0)+o);const u=[];for(const t of e?.choices??[]){const e={text:t.message?.content??"",message:b(t.message??{role:"assistant"})};e.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},u.push(e)}return{generations:u,llmOutput:{tokenUsage:r}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let r=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==n){const e=(0,m.formatFunctionDefinitions)(t);r+=await this.getNumTokens(e),r+=9}return t&&e.find((e=>"system"===e._getType()))&&(r-=4),"none"===n?r+=1:"object"==typeof n&&(r+=await this.getNumTokens(n.name)+4),r}async getNumTokensFromGenerations(e){return(await Promise.all(e.map((async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content))))).reduce(((e,t)=>e+t),0)}async getNumTokensFromMessages(e){let t=0,n=0,r=0;"gpt-3.5-turbo-0301"===this.model?(n=4,r=-1):(n=3,r=1);const a=await Promise.all(e.map((async e=>{const a=await this.getNumTokens(e.content),i=await this.getNumTokens(g(e)),s=void 0!==e.name?r+await this.getNumTokens(e.name):0;let o=a+n+i+s;const u=e;if("function"===u._getType()&&(o-=2),u.additional_kwargs?.function_call&&(o+=3),u?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(u.additional_kwargs.function_call?.name)),u.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(u.additional_kwargs.function_call?.arguments)))}catch(e){console.error("Error parsing function arguments",e,JSON.stringify(u.additional_kwargs.function_call)),o+=await this.getNumTokens(u.additional_kwargs.function_call?.arguments)}return t+=o,o})));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.chat.completions.create(e,n)}catch(e){throw(0,f.wrapOpenAIClientError)(e)}}))}_getClientOptions(e){if(!this.client){const e={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},t=(0,h.getEndpoint)(e),n={...this.clientConfig,baseURL:t,timeout:this.timeout,maxRetries:0};n.baseURL||delete n.baseURL,this.client=new r.OpenAI(n)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,r,a,i;var s;let o,u;if(void 0!==(s=e)&&"object"==typeof s.schema?(n=e.schema,r=e.name,a=e.method,i=e.includeRaw):(n=e,r=t?.name,a=t?.method,i=t?.includeRaw),"jsonMode"===a)o=this.bind({response_format:{type:"json_object"}}),u=w(n)?c.StructuredOutputParser.fromZodSchema(n):new c.JsonOutputParser;else{let e=r??"extract";if(w(n)){const t=(0,p.zodToJsonSchema)(n);o=this.bind({tools:[{type:"function",function:{name:e,description:t.description,parameters:t}}],tool_choice:{type:"function",function:{name:e}}}),u=new d.JsonOutputKeyToolsParser({returnSingle:!0,keyName:e,zodSchema:n})}else{let t;"string"==typeof n.name&&"object"==typeof n.parameters&&null!=n.parameters?(t=n,e=n.name):(e=n.title??e,t={name:e,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:t}],tool_choice:{type:"function",function:{name:e}}}),u=new d.JsonOutputKeyToolsParser({returnSingle:!0,keyName:e})}}if(!i)return o.pipe(u);const h=l.RunnablePassthrough.assign({parsed:(e,t)=>u.invoke(e.raw,t)}),f=l.RunnablePassthrough.assign({parsed:()=>null}),m=h.withFallbacks({fallbacks:[f]});return l.RunnableSequence.from([{raw:o},m])}}function w(e){return"function"==typeof e?.parse}t.ChatOpenAI=_},67042:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIEmbeddings=void 0;const r=n(32012),a=n(82331),i=n(43598),s=n(39899),o=n(81047),u=n(65792);class l extends i.Embeddings{constructor(e,t){const n={maxConcurrency:2,...e};super(n),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let r=n?.apiKey??n?.openAIApiKey??(0,a.getEnvironmentVariable)("OPENAI_API_KEY");const i=n?.azureOpenAIApiKey??(0,a.getEnvironmentVariable)("AZURE_OPENAI_API_KEY");if(!i&&!r)throw new Error("OpenAI or Azure OpenAI API key not found");const s=n?.azureOpenAIApiInstanceName??(0,a.getEnvironmentVariable)("AZURE_OPENAI_API_INSTANCE_NAME"),o=(n?.azureOpenAIApiEmbeddingsDeploymentName||n?.azureOpenAIApiDeploymentName)??((0,a.getEnvironmentVariable)("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||(0,a.getEnvironmentVariable)("AZURE_OPENAI_API_DEPLOYMENT_NAME")),u=n?.azureOpenAIApiVersion??(0,a.getEnvironmentVariable)("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=n?.azureOpenAIBasePath??(0,a.getEnvironmentVariable)("AZURE_OPENAI_BASE_PATH"),this.organization=n?.configuration?.organization??(0,a.getEnvironmentVariable)("OPENAI_ORGANIZATION"),this.modelName=n?.model??n?.modelName??this.model,this.model=this.modelName,this.batchSize=n?.batchSize??(i?1:this.batchSize),this.stripNewLines=n?.stripNewLines??this.stripNewLines,this.timeout=n?.timeout,this.dimensions=n?.dimensions,this.azureOpenAIApiVersion=u,this.azureOpenAIApiKey=i,this.azureOpenAIApiInstanceName=s,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");r=r??""}this.clientConfig={apiKey:r,organization:this.organization,baseURL:t?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params,...t,...e?.configuration}}async embedDocuments(e){const t=(0,s.chunkArray)(this.stripNewLines?e.map((e=>e.replace(/\n/g," "))):e,this.batchSize),n=t.map((e=>{const t={model:this.model,input:e};return this.dimensions&&(t.dimensions=this.dimensions),this.embeddingWithRetry(t)})),r=await Promise.all(n),a=[];for(let e=0;e<r.length;e+=1){const n=t[e],{data:i}=r[e];for(let e=0;e<n.length;e+=1)a.push(i[e].embedding)}return a}async embedQuery(e){const t={model:this.model,input:this.stripNewLines?e.replace(/\n/g," "):e};this.dimensions&&(t.dimensions=this.dimensions);const{data:n}=await this.embeddingWithRetry(t);return n[0].embedding}async embeddingWithRetry(e){if(!this.client){const e={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},t=(0,o.getEndpoint)(e),n={...this.clientConfig,baseURL:t,timeout:this.timeout,maxRetries:0};n.baseURL||delete n.baseURL,this.client=new r.OpenAI(n)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call((async()=>{try{return await this.client.embeddings.create(e,t)}catch(e){throw(0,u.wrapOpenAIClientError)(e)}}))}}t.OpenAIEmbeddings=l},85760:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.toFile=t.OpenAIClient=void 0;var i=n(32012);Object.defineProperty(t,"OpenAIClient",{enumerable:!0,get:function(){return i.OpenAI}}),Object.defineProperty(t,"toFile",{enumerable:!0,get:function(){return i.toFile}}),a(n(80975),t),a(n(83295),t),a(n(4304),t),a(n(20896),t),a(n(67042),t),a(n(8247),t),a(n(65792),t),a(n(81047),t),a(n(46948),t)},62641:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIChat=void 0;const r=n(32012),a=n(79582),i=n(82331),s=n(20314),o=n(81047),u=n(65792);class l extends s.LLM{static lc_name(){return"OpenAIChat"}get callKeys(){return[...super.callKeys,"options","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"prefixMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.openAIApiKey??(0,i.getEnvironmentVariable)("OPENAI_API_KEY"),this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e?.azureOpenAIApiCompletionsDeploymentName||e?.azureOpenAIApiDeploymentName)??((0,i.getEnvironmentVariable)("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,i.getEnvironmentVariable)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,i.getEnvironmentVariable)("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??(0,i.getEnvironmentVariable)("OPENAI_ORGANIZATION"),this.modelName=e?.modelName??this.modelName,this.prefixMessages=e?.prefixMessages??this.prefixMessages,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.maxTokens=e?.maxTokens,this.stop=e?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.n>1)throw new Error("Cannot use n > 1 in OpenAIChat LLM. Use ChatOpenAI Chat Model instead.");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,logit_bias:this.logitBias,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,stop:e?.stop??this.stop,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}formatMessages(e){const t={role:"user",content:e};return this.prefixMessages?[...this.prefixMessages,t]:[t]}async*_streamResponseChunks(e,t,n){const r={...this.invocationParams(t),messages:this.formatMessages(e),stream:!0},i=await this.completionWithRetry(r,t);for await(const e of i){const r=e?.choices[0];if(!r)continue;const{delta:i}=r,s=new a.GenerationChunk({text:i.content??""});yield s;const o={prompt:t.promptIndex??0,completion:r.index??0};n?.handleLLMNewToken(s.text??"",o)}if(t.signal?.aborted)throw new Error("AbortError")}async _call(e,t,n){const r=this.invocationParams(t);if(r.stream){const r=await this._streamResponseChunks(e,t,n);let a;for await(const e of r)a=void 0===a?e:a.concat(e);return a?.text??""}{const n=await this.completionWithRetry({...r,stream:!1,messages:this.formatMessages(e)},{signal:t.signal,...t.options});return n?.choices[0]?.message?.content??""}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.chat.completions.create(e,n)}catch(e){throw(0,u.wrapOpenAIClientError)(e)}}))}_getClientOptions(e){if(!this.client){const e={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},t=(0,o.getEndpoint)(e),n={...this.clientConfig,baseURL:t,timeout:this.timeout,maxRetries:0};n.baseURL||delete n.baseURL,this.client=new r.OpenAI(n)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}t.OpenAIChat=l},4304:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAI=t.OpenAIChat=void 0;const r=n(32012),a=n(80601),i=n(79582),s=n(82331),o=n(20314),u=n(39899),l=n(81047),c=n(62641);Object.defineProperty(t,"OpenAIChat",{enumerable:!0,get:function(){return c.OpenAIChat}});const d=n(65792);class p extends o.BaseLLM{static lc_name(){return"OpenAI"}get callKeys(){return[...super.callKeys,"options"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){let n=e?.model??e?.modelName;if((n?.startsWith("gpt-3.5-turbo")||n?.startsWith("gpt-4"))&&!n?.includes("-instruct"))return new c.OpenAIChat(e,t);if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:256}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"bestOf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo-instruct"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo-instruct"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n=n??this.model,this.openAIApiKey=e?.apiKey??e?.openAIApiKey??(0,s.getEnvironmentVariable)("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.apiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e?.azureOpenAIApiCompletionsDeploymentName||e?.azureOpenAIApiDeploymentName)??((0,s.getEnvironmentVariable)("AZURE_OPENAI_API_COMPLETIONS_DEPLOYMENT_NAME")||(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_DEPLOYMENT_NAME")),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,s.getEnvironmentVariable)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,s.getEnvironmentVariable)("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??(0,s.getEnvironmentVariable)("OPENAI_ORGANIZATION"),this.modelName=n,this.model=n,this.modelKwargs=e?.modelKwargs??{},this.batchSize=e?.batchSize??this.batchSize,this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.maxTokens=e?.maxTokens??this.maxTokens,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.n=e?.n??this.n,this.bestOf=e?.bestOf??this.bestOf,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=e?.stopSequences,this.user=e?.user,this.streaming=e?.streaming??!1,this.streaming&&this.bestOf&&this.bestOf>1)throw new Error("Cannot stream results when bestOf > 1");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}invocationParams(e){return{model:this.model,temperature:this.temperature,max_tokens:this.maxTokens,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,best_of:this.bestOf,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){const r=(0,u.chunkArray)(e,this.batchSize),i=[],s={},o=this.invocationParams(t);if(-1===o.max_tokens){if(1!==e.length)throw new Error("max_tokens set to -1 not supported for multiple inputs");o.max_tokens=await(0,a.calculateMaxTokens)({prompt:e[0],modelName:this.model})}for(let e=0;e<r.length;e+=1){const a=o.stream?await(async()=>{const a=[];let i;const s=await this.completionWithRetry({...o,stream:!0,prompt:r[e]},t);for await(const e of s){i||(i={id:e.id,object:e.object,created:e.created,model:e.model});for(const t of e.choices){if(a[t.index]){const e=a[t.index];e.text+=t.text,e.finish_reason=t.finish_reason,e.logprobs=t.logprobs}else a[t.index]=t;n?.handleLLMNewToken(t.text,{prompt:Math.floor(t.index/this.n),completion:t.index%this.n})}}if(t.signal?.aborted)throw new Error("AbortError");return{...i,choices:a}})():await this.completionWithRetry({...o,stream:!1,prompt:r[e]},{signal:t.signal,...t.options});i.push(...a.choices);const{completion_tokens:u,prompt_tokens:l,total_tokens:c}=a.usage?a.usage:{completion_tokens:void 0,prompt_tokens:void 0,total_tokens:void 0};u&&(s.completionTokens=(s.completionTokens??0)+u),l&&(s.promptTokens=(s.promptTokens??0)+l),c&&(s.totalTokens=(s.totalTokens??0)+c)}return{generations:(0,u.chunkArray)(i,this.n).map((e=>e.map((e=>({text:e.text??"",generationInfo:{finishReason:e.finish_reason,logprobs:e.logprobs}}))))),llmOutput:{tokenUsage:s}}}async*_streamResponseChunks(e,t,n){const r={...this.invocationParams(t),prompt:e,stream:!0},a=await this.completionWithRetry(r,t);for await(const e of a){const t=e?.choices[0];if(!t)continue;const r=new i.GenerationChunk({text:t.text,generationInfo:{finishReason:t.finish_reason}});yield r,n?.handleLLMNewToken(r.text??"")}if(t.signal?.aborted)throw new Error("AbortError")}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.completions.create(e,n)}catch(e){throw(0,d.wrapOpenAIClientError)(e)}}))}_getClientOptions(e){if(!this.client){const e={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},t=(0,l.getEndpoint)(e),n={...this.clientConfig,baseURL:t,timeout:this.timeout,maxRetries:0};n.baseURL||delete n.baseURL,this.client=new r.OpenAI(n)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}}t.OpenAI=p},91562:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DallEAPIWrapper=void 0;const r=n(82331),a=n(32012),i=n(45673);class s extends i.Tool{static lc_name(){return"DallEAPIWrapper"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t={apiKey:e?.apiKey??e?.openAIApiKey??(0,r.getEnvironmentVariable)("OPENAI_API_KEY"),organization:e?.organization??(0,r.getEnvironmentVariable)("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0};this.client=new a.OpenAI(t),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.responseFormat=e?.responseFormat??this.responseFormat,this.user=e?.user}async _call(e){const t=await this.client.images.generate({model:this.model,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user});let n="";return"url"===this.responseFormat?[n]=t.data.map((e=>e.url)).filter((e=>"undefined"!==e)):[n]=t.data.map((e=>e.b64_json)).filter((e=>"undefined"!==e)),n}}t.DallEAPIWrapper=s,Object.defineProperty(s,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"})},46948:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(91562),t)},8247:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},81047:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEndpoint=void 0,t.getEndpoint=function(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:i}=e;if(r&&a&&t)return`${a}/${t}`;if(r){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return i}},61970:function(e,t){"use strict";function n(e,t){const n=[];for(const[a,i]of Object.entries(e.properties??{}))i.description&&t<2&&n.push(`// ${i.description}`),e.required?.includes(a)?n.push(`${a}: ${r(i,t)},`):n.push(`${a}?: ${r(i,t)},`);return n.map((e=>" ".repeat(t)+e)).join("\n")}function r(e,t){if(void 0!==(a=e).anyOf&&Array.isArray(a.anyOf))return e.anyOf.map((e=>r(e,t))).join(" | ");var a;switch(e.type){case"string":return e.enum?e.enum.map((e=>`"${e}"`)).join(" | "):"string";case"number":case"integer":return e.enum?e.enum.map((e=>`${e}`)).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",n(e,t+2),"}"].join("\n");case"array":return e.items?`${r(e.items,t)}[]`:"any[]";default:return""}}Object.defineProperty(t,"__esModule",{value:!0}),t.formatFunctionDefinitions=void 0,t.formatFunctionDefinitions=function(e){const t=["namespace functions {",""];for(const r of e)r.description&&t.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(t.push(`type ${r.name} = (_: {`),t.push(n(r.parameters,0)),t.push("}) => any;")):t.push(`type ${r.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}},65792:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatToOpenAIAssistantTool=t.formatToOpenAITool=t.formatToOpenAIFunction=t.wrapOpenAIClientError=void 0;const r=n(32012),a=n(39340),i=n(30107);Object.defineProperty(t,"formatToOpenAIFunction",{enumerable:!0,get:function(){return i.convertToOpenAIFunction}}),Object.defineProperty(t,"formatToOpenAITool",{enumerable:!0,get:function(){return i.convertToOpenAITool}}),t.wrapOpenAIClientError=function(e){let t;return e.constructor.name===r.APIConnectionTimeoutError.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===r.APIUserAbortError.name?(t=new Error(e.message),t.name="AbortError"):t=e,t},t.formatToOpenAIAssistantTool=function(e){return{type:"function",function:{name:e.name,description:e.description,parameters:(0,a.zodToJsonSchema)(e.schema)}}}},4627:function(e,t,n){e.exports=n(85760)},93091:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(42974),t)},42974:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LatexTextSplitter=t.MarkdownTextSplitter=t.TokenTextSplitter=t.RecursiveCharacterTextSplitter=t.SupportedTextSplitterLanguages=t.CharacterTextSplitter=t.TextSplitter=void 0;const r=n(10338),a=n(28053);class i extends r.BaseDocumentTransformer{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=e?.chunkSize??this.chunkSize,this.chunkOverlap=e?.chunkOverlap??this.chunkOverlap,this.keepSeparator=e?.keepSeparator??this.keepSeparator,this.lengthFunction=e?.lengthFunction??(e=>e.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let n;if(t)if(this.keepSeparator){const r=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${r})`))}else n=e.split(t);else n=e.split("");return n.filter((e=>""!==e))}async createDocuments(e,t=[],n={}){const a=t.length>0?t:[...Array(e.length)].map((()=>({}))),{chunkHeader:i="",chunkOverlapHeader:s="(cont'd) ",appendChunkOverlapHeader:o=!1}=n,u=new Array;for(let t=0;t<e.length;t+=1){const n=e[t];let l=1,c=null,d=-1;for(const e of await this.splitText(n)){let p=i;const h=n.indexOf(e,d+1);if(null===c)l+=this.numberOfNewLines(n,0,h);else{const e=d+await this.lengthFunction(c);e<h?l+=this.numberOfNewLines(n,e,h):e>h&&(l-=this.numberOfNewLines(n,h,e)),o&&(p+=s)}const f=this.numberOfNewLines(e),m=a[t].loc&&"object"==typeof a[t].loc?{...a[t].loc}:{};m.lines={from:l,to:l+f};const g={...a[t],loc:m};p+=e,u.push(new r.Document({pageContent:p,metadata:g})),l+=f,c=e,d=h}}return u}numberOfNewLines(e,t,n){return(e.slice(t,n).match(/\n/g)||[]).length}async splitDocuments(e,t={}){const n=e.filter((e=>void 0!==e.pageContent)),r=n.map((e=>e.pageContent)),a=n.map((e=>e.metadata));return this.createDocuments(r,a,t)}joinDocs(e,t){const n=e.join(t).trim();return""===n?null:n}async mergeSplits(e,t){const n=[],r=[];let a=0;for(const i of e){const e=await this.lengthFunction(i);if(a+e+r.length*t.length>this.chunkSize&&(a>this.chunkSize&&console.warn(`Created a chunk of size ${a}, +\nwhich is longer than the specified ${this.chunkSize}`),r.length>0)){const i=this.joinDocs(r,t);for(null!==i&&n.push(i);a>this.chunkOverlap||a+e+r.length*t.length>this.chunkSize&&a>0;)a-=await this.lengthFunction(r[0]),r.shift()}r.push(i),a+=e}const i=this.joinDocs(r,t);return null!==i&&n.push(i),n}}t.TextSplitter=i,t.CharacterTextSplitter=class extends i{static lc_name(){return"CharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),this.separator=e?.separator??this.separator}async splitText(e){const t=this.splitOnSeparator(e,this.separator);return this.mergeSplits(t,this.keepSeparator?"":this.separator)}},t.SupportedTextSplitterLanguages=["cpp","go","java","js","php","proto","python","rst","ruby","rust","scala","swift","markdown","latex","html","sol"];class s extends i{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:["\n\n","\n"," ",""]}),this.separators=e?.separators??this.separators,this.keepSeparator=e?.keepSeparator??!0}async _splitText(e,t){const n=[];let r,a=t[t.length-1];for(let n=0;n<t.length;n+=1){const i=t[n];if(""===i){a=i;break}if(e.includes(i)){a=i,r=t.slice(n+1);break}}const i=this.splitOnSeparator(e,a);let s=[];const o=this.keepSeparator?"":a;for(const e of i)if(await this.lengthFunction(e)<this.chunkSize)s.push(e);else{if(s.length){const e=await this.mergeSplits(s,o);n.push(...e),s=[]}if(r){const t=await this._splitText(e,r);n.push(...t)}else n.push(e)}if(s.length){const e=await this.mergeSplits(s,o);n.push(...e)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new s({...t,separators:s.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if("cpp"===e)return["\nclass ","\nvoid ","\nint ","\nfloat ","\ndouble ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("go"===e)return["\nfunc ","\nvar ","\nconst ","\ntype ","\nif ","\nfor ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("java"===e)return["\nclass ","\npublic ","\nprotected ","\nprivate ","\nstatic ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("js"===e)return["\nfunction ","\nconst ","\nlet ","\nvar ","\nclass ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\ndefault ","\n\n","\n"," ",""];if("php"===e)return["\nfunction ","\nclass ","\nif ","\nforeach ","\nwhile ","\ndo ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("proto"===e)return["\nmessage ","\nservice ","\nenum ","\noption ","\nimport ","\nsyntax ","\n\n","\n"," ",""];if("python"===e)return["\nclass ","\ndef ","\n\tdef ","\n\n","\n"," ",""];if("rst"===e)return["\n===\n","\n---\n","\n***\n","\n.. ","\n\n","\n"," ",""];if("ruby"===e)return["\ndef ","\nclass ","\nif ","\nunless ","\nwhile ","\nfor ","\ndo ","\nbegin ","\nrescue ","\n\n","\n"," ",""];if("rust"===e)return["\nfn ","\nconst ","\nlet ","\nif ","\nwhile ","\nfor ","\nloop ","\nmatch ","\nconst ","\n\n","\n"," ",""];if("scala"===e)return["\nclass ","\nobject ","\ndef ","\nval ","\nvar ","\nif ","\nfor ","\nwhile ","\nmatch ","\ncase ","\n\n","\n"," ",""];if("swift"===e)return["\nfunc ","\nclass ","\nstruct ","\nenum ","\nif ","\nfor ","\nwhile ","\ndo ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("markdown"===e)return["\n## ","\n### ","\n#### ","\n##### ","\n###### ","```\n\n","\n\n***\n\n","\n\n---\n\n","\n\n___\n\n","\n\n","\n"," ",""];if("latex"===e)return["\n\\chapter{","\n\\section{","\n\\subsection{","\n\\subsubsection{","\n\\begin{enumerate}","\n\\begin{itemize}","\n\\begin{description}","\n\\begin{list}","\n\\begin{quote}","\n\\begin{quotation}","\n\\begin{verse}","\n\\begin{verbatim}","\n\\begin{align}","$$","$","\n\n","\n"," ",""];if("html"===e)return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if("sol"===e)return["\npragma ","\nusing ","\ncontract ","\ninterface ","\nlibrary ","\nconstructor ","\ntype ","\nfunction ","\nevent ","\nmodifier ","\nerror ","\nstruct ","\nenum ","\nif ","\nfor ","\nwhile ","\ndo while ","\nassembly ","\n\n","\n"," ",""];throw new Error(`Language ${e} is not supported.`)}}t.RecursiveCharacterTextSplitter=s,t.TokenTextSplitter=class extends i{static lc_name(){return"TokenTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"encodingName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disallowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenizer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.encodingName=e?.encodingName??"gpt2",this.allowedSpecial=e?.allowedSpecial??[],this.disallowedSpecial=e?.disallowedSpecial??"all"}async splitText(e){this.tokenizer||(this.tokenizer=await(0,a.getEncoding)(this.encodingName));const t=[],n=this.tokenizer.encode(e,this.allowedSpecial,this.disallowedSpecial);let r=0;for(;r<n.length;){r>0&&(r-=this.chunkOverlap);const e=Math.min(r+this.chunkSize,n.length),a=n.slice(r,e);t.push(this.tokenizer.decode(a)),r=e}return t}},t.MarkdownTextSplitter=class extends s{constructor(e){super({...e,separators:s.getSeparatorsForLanguage("markdown")})}},t.LatexTextSplitter=class extends s{constructor(e){super({...e,separators:s.getSeparatorsForLanguage("latex")})}}},50138:function(e,t,n){e.exports=n(93091)},34601:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=r(n(67526)),i=Object.defineProperty;function s(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let n=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;n.length>1;){let r=null;for(let a=0;a<n.length-1;a++){const i=e.slice(n[a].start,n[a+1].end),s=t.get(i.join(","));null!=s&&(null==r||s<r[0])&&(r=[s,a])}if(null==r)break;{const e=r[1];n[e]={start:n[e].start,end:n[e+1].end},n.splice(e+1,1)}}return n}(e,t).map((n=>t.get(e.slice(n.start,n.end).join(",")))).filter((e=>null!=e))}var o,u=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const n=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[n,r,...a]=t.split(" "),i=Number.parseInt(r,10);return a.forEach(((t,n)=>e[t]=i+n)),e}),{});for(const[e,t]of Object.entries(n)){const n=a.default.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],n="all"){const r=new RegExp(this.patStr,"ug"),a=u.specialTokenRegex(Object.keys(this.specialTokens)),i=[],o=new Set("all"===t?Object.keys(this.specialTokens):t),l=new Set("all"===n?Object.keys(this.specialTokens).filter((e=>!o.has(e))):n);if(l.size>0){const t=u.specialTokenRegex([...l]),n=e.match(t);if(null!=n)throw new Error(`The text contains a special token that is not allowed: ${n[0]}`)}let c=0;for(;;){let t=null,n=c;for(;a.lastIndex=n,t=a.exec(e),null!=t&&!o.has(t[0]);)n=t.index+1;const u=t?.index??e.length;for(const t of e.substring(c,u).matchAll(r)){const e=this.textEncoder.encode(t[0]),n=this.rankMap.get(e.join(","));null==n?i.push(...s(e,this.rankMap)):i.push(n)}if(null==t)break;let l=this.specialTokens[t[0]];i.push(l),c=t.index+t[0].length}return i}decode(e){const t=[];let n=0;for(let r=0;r<e.length;++r){const a=e[r],i=this.textMap.get(a)??this.inverseSpecialTokens[a];null!=i&&(t.push(i),n+=i.length)}const r=new Uint8Array(n);let a=0;for(const e of t)r.set(e,a),a+=e.length;return this.textDecoder.decode(r)}},l=u;((e,t,n)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(l,"symbol"!=typeof(o="specialTokenRegex")?o+"":o,(e=>new RegExp(e.map((e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"))).join("|"),"g"))),t.Tiktoken=l,t.getEncodingNameForModel=function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}},35070:function(e,t,n){e.exports=n(83992)},17636:function(e,t,n){e.exports=n(38879)},54729:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyzeDocumentChain=void 0;const r=n(86787),a=n(68328);class i extends r.BaseChain{static lc_name(){return"AnalyzeDocumentChain"}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_document"}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"textSplitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.textSplitter=e.textSplitter??new a.RecursiveCharacterTextSplitter}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...r}=e,a=n,i={input_documents:await this.textSplitter.createDocuments([a]),...r};return await this.combineDocumentsChain.call(i,t?.getChild("combine_documents"))}_chainType(){return"analyze_document_chain"}static async deserialize(e,t){if(!("text_splitter"in t))throw new Error("Need to pass in a text_splitter to deserialize AnalyzeDocumentChain.");const{text_splitter:n}=t;if(!e.combine_document_chain)throw new Error("Need to pass in a combine_document_chain to deserialize AnalyzeDocumentChain.");return new i({combineDocumentsChain:await r.BaseChain.deserialize(e.combine_document_chain),textSplitter:n})}serialize(){return{_type:this._chainType(),combine_document_chain:this.combineDocumentsChain.serialize()}}}t.AnalyzeDocumentChain=i},45407:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APIChain=void 0;const r=n(86787),a=n(20447),i=n(16100);class s extends r.BaseChain{get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"apiAnswerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiRequestChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiDocs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),this.apiRequestChain=e.apiRequestChain,this.apiAnswerChain=e.apiAnswerChain,this.apiDocs=e.apiDocs,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.headers=e.headers??this.headers}async _call(e,t){const n=e[this.inputKey],r=await this.apiRequestChain.predict({question:n,api_docs:this.apiDocs},t?.getChild("request")),a=await fetch(r,{headers:this.headers}),i=await a.text(),s=await this.apiAnswerChain.predict({question:n,api_docs:this.apiDocs,api_url:r,api_response:i},t?.getChild("response"));return{[this.outputKey]:s}}_chainType(){return"api_chain"}static async deserialize(e){const{api_request_chain:t,api_answer_chain:n,api_docs:r}=e;if(!t)throw new Error("LLMChain must have api_request_chain");if(!n)throw new Error("LLMChain must have api_answer_chain");if(!r)throw new Error("LLMChain must have api_docs");return new s({apiAnswerChain:await a.LLMChain.deserialize(n),apiRequestChain:await a.LLMChain.deserialize(t),apiDocs:r})}serialize(){return{_type:this._chainType(),api_answer_chain:this.apiAnswerChain.serialize(),api_request_chain:this.apiRequestChain.serialize(),api_docs:this.apiDocs}}static fromLLMAndAPIDocs(e,t,n={}){const{apiUrlPrompt:r=i.API_URL_PROMPT_TEMPLATE,apiResponsePrompt:s=i.API_RESPONSE_PROMPT_TEMPLATE}=n,o=new a.LLMChain({prompt:r,llm:e});return new this({apiAnswerChain:new a.LLMChain({prompt:s,llm:e}),apiRequestChain:o,apiDocs:t,...n})}}t.APIChain=s},16100:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.API_RESPONSE_PROMPT_TEMPLATE=t.API_RESPONSE_RAW_PROMPT_TEMPLATE=t.API_URL_PROMPT_TEMPLATE=t.API_URL_RAW_PROMPT_TEMPLATE=void 0;const r=n(66749);t.API_URL_RAW_PROMPT_TEMPLATE="You are given the below API Documentation:\n{api_docs}\nUsing this documentation, generate the full API url to call for answering the user question.\nYou should build the API url in order to get a response that is as short as possible, while still getting the necessary information to answer the question. Pay attention to deliberately exclude any unnecessary pieces of data in the API call.\n\nQuestion:{question}\nAPI url:",t.API_URL_PROMPT_TEMPLATE=new r.PromptTemplate({inputVariables:["api_docs","question"],template:t.API_URL_RAW_PROMPT_TEMPLATE}),t.API_RESPONSE_RAW_PROMPT_TEMPLATE=`${t.API_URL_RAW_PROMPT_TEMPLATE} {api_url}\n\nHere is the response from the API:\n\n{api_response}\n\nSummarize this response to answer the original question.\n\nSummary:`,t.API_RESPONSE_PROMPT_TEMPLATE=new r.PromptTemplate({inputVariables:["api_docs","question","api_url","api_response"],template:t.API_RESPONSE_RAW_PROMPT_TEMPLATE})},86787:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseChain=void 0;const r=n(79582),a=n(97524),i=n(4538),s=n(80601);class o extends s.BaseLangChain{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,n){if(1!==arguments.length||"object"!=typeof e||"saveContext"in e)super({verbose:t,callbacks:n}),this.memory=e;else{const{memory:t,callbackManager:n,...r}=e;super({...r,callbacks:n??r.callbacks}),this.memory=t}}_selectMemoryInputs(e){const t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){const n=(0,i.ensureConfig)(t),s=await this._formatValues(e),o=await a.CallbackManager.configure(n?.callbacks,this.callbacks,n?.tags,this.tags,n?.metadata,this.metadata,{verbose:this.verbose}),u=await(o?.handleChainStart(this.toJSON(),s,void 0,void 0,void 0,void 0,n?.runName));let l;try{l=await(s.signal?Promise.race([this._call(s,u,n),new Promise(((e,t)=>{s.signal?.addEventListener("abort",(()=>{t(new Error("AbortError"))}))}))]):this._call(s,u,n))}catch(e){throw await(u?.handleChainError(e)),e}return null!=this.memory&&await this.memory.saveContext(this._selectMemoryInputs(e),l),await(u?.handleChainEnd(l)),Object.defineProperty(l,r.RUN_KEY,{value:u?{runId:u?.runId}:void 0,configurable:!0}),l}_validateOutputs(e){const t=this.outputKeys.filter((t=>!(t in e)));if(t.length)throw new Error(`Missing output keys: ${t.join(", ")} from chain ${this._chainType()}`)}async prepOutputs(e,t,n=!1){return this._validateOutputs(t),this.memory&&await this.memory.saveContext(e,t),n?t:{...e,...t}}serialize(){throw new Error("Method not implemented.")}async run(e,t){const n=this.inputKeys.filter((e=>!this.memory?.memoryKeys.includes(e)??!0));if(!(n.length<=1))throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);const r=n.length?{[n[0]]:e}:{},a=await this.call(r,t),i=Object.keys(a);if(1===i.length)return a[i[0]];throw new Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){const t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),null!=this.memory){const n=await this.memory.loadMemoryVariables(this._selectMemoryInputs(e));for(const[e,r]of Object.entries(n))t[e]=r}return t}async call(e,t,n){const r={tags:n,...(0,a.parseCallbackConfigArg)(t)};return this.invoke(e,r)}async apply(e,t){return Promise.all(e.map((async(e,n)=>this.call(e,t?.[n]))))}static async deserialize(e,t={}){switch(e._type){case"llm_chain":{const{LLMChain:t}=await Promise.all([n.e(771),n.e(364),n.e(415),n.e(577),n.e(381)]).then(n.bind(n,19415));return t.deserialize(e)}case"sequential_chain":{const{SequentialChain:t}=await Promise.all([n.e(577),n.e(381),n.e(91)]).then(n.bind(n,48329));return t.deserialize(e)}case"simple_sequential_chain":{const{SimpleSequentialChain:t}=await Promise.all([n.e(577),n.e(381),n.e(91)]).then(n.bind(n,48329));return t.deserialize(e)}case"stuff_documents_chain":{const{StuffDocumentsChain:t}=await Promise.all([n.e(771),n.e(364),n.e(415),n.e(577),n.e(381),n.e(382)]).then(n.bind(n,23382));return t.deserialize(e)}case"map_reduce_documents_chain":{const{MapReduceDocumentsChain:t}=await Promise.all([n.e(771),n.e(364),n.e(415),n.e(577),n.e(381),n.e(382)]).then(n.bind(n,23382));return t.deserialize(e)}case"refine_documents_chain":{const{RefineDocumentsChain:t}=await Promise.all([n.e(771),n.e(364),n.e(415),n.e(577),n.e(381),n.e(382)]).then(n.bind(n,23382));return t.deserialize(e)}case"vector_db_qa":{const{VectorDBQAChain:r}=await Promise.all([n.e(771),n.e(364),n.e(415),n.e(577),n.e(381),n.e(832)]).then(n.bind(n,38832));return r.deserialize(e,t)}case"api_chain":{const{APIChain:t}=await Promise.all([n.e(771),n.e(364),n.e(415),n.e(577),n.e(381),n.e(980)]).then(n.bind(n,39980));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}t.BaseChain=o},97395:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatVectorDBQAChain=void 0;const r=n(66749),a=n(86787),i=n(20447),s=n(10830);class o extends a.BaseChain{get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"result"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`chat history key ${this.inputKey} not found.`);const n=e[this.inputKey],r=e[this.chatHistoryKey];let a=n;if(r.length>0){const i=await this.questionGeneratorChain.call({question:n,chat_history:r},t?.getChild("question_generator")),s=Object.keys(i);if(console.log("_call",e,s),1!==s.length)throw new Error("Return from llm chain has multiple values, only single values supported.");a=i[s[0]]}const i=await this.vectorstore.similaritySearch(a,this.k,void 0,t?.getChild("vectorstore")),s={question:a,input_documents:i,chat_history:r},o=await this.combineDocumentsChain.call(s,t?.getChild("combine_documents"));return this.returnSourceDocuments?{...o,sourceDocuments:i}:o}_chainType(){return"chat-vector-db"}static async deserialize(e,t){if(!("vectorstore"in t))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:n}=t;return new o({combineDocumentsChain:await a.BaseChain.deserialize(e.combine_documents_chain),questionGeneratorChain:await i.LLMChain.deserialize(e.question_generator),k:e.k,vectorstore:n})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),question_generator:this.questionGeneratorChain.serialize(),k:this.k}}static fromLLM(e,t,n={}){const{questionGeneratorTemplate:a,qaTemplate:o,verbose:u,...l}=n,c=r.PromptTemplate.fromTemplate(a||"Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.\n\nChat History:\n{chat_history}\nFollow Up Input: {question}\nStandalone question:"),d=r.PromptTemplate.fromTemplate(o||"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:");return new this({vectorstore:t,combineDocumentsChain:(0,s.loadQAStuffChain)(e,{prompt:d,verbose:u}),questionGeneratorChain:new i.LLMChain({prompt:c,llm:e,verbose:u}),...l})}}t.ChatVectorDBQAChain=o},91197:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefineDocumentsChain=t.MapReduceDocumentsChain=t.StuffDocumentsChain=void 0;const r=n(66749),a=n(86787),i=n(20447);class s extends a.BaseChain{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter((e=>e!==this.documentVariableName))}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:t,...n}=e,r=t.map((({pageContent:e})=>e)).join("\n\n");return{...n,[this.documentVariableName]:r}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t?.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");return new s({llmChain:await i.LLMChain.deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}t.StuffDocumentsChain=s;class o extends a.BaseChain{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...r}=e;let a=n,i=[];for(let e=0;e<this.maxIterations;e+=1){const n=a.map((e=>({[this.documentVariableName]:e.pageContent,...r})));if(0!==e||!this.ensureMapStep){const e=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:a,...r}));if(await this.combineDocumentChain.llmChain._getNumTokens(e)<this.maxTokens)break}const s=await this.llmChain.apply(n,t?Array.from({length:n.length},((e,n)=>t.getChild(`map_${n+1}`))):void 0),{outputKey:o}=this.llmChain;this.returnIntermediateSteps&&(i=i.concat(s.map((e=>e[o])))),a=s.map((e=>({pageContent:e[o],metadata:{}})))}const s={[this.combineDocumentChain.inputKey]:a,...r},o=await this.combineDocumentChain.call(s,t?.getChild("combine_documents"));return this.returnIntermediateSteps?{...o,intermediateSteps:i}:o}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw new Error("Missing llm_chain");if(!e.combine_document_chain)throw new Error("Missing combine_document_chain");return new o({llmChain:await i.LLMChain.deserialize(e.llm_chain),combineDocumentChain:await s.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}t.MapReduceDocumentsChain=o;class u extends a.BaseChain{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new r.PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter((e=>e!==this.documentVariableName&&e!==this.initialResponseName))}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){const n={page_content:e.pageContent,...e.metadata},r={};return this.documentPrompt.inputVariables.forEach((e=>{r[e]=n[e]})),{[this.documentVariableName]:await this.documentPrompt.format({...r}),...t}}async _constructRefineInputs(e,t){const n={page_content:e.pageContent,...e.metadata},r={};this.documentPrompt.inputVariables.forEach((e=>{r[e]=n[e]}));const a={[this.documentVariableName]:await this.documentPrompt.format({...r})};return{[this.initialResponseName]:t,...a}}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Document key ${this.inputKey} not found.`);const{[this.inputKey]:n,...r}=e,a=n,i=await this._constructInitialInputs(a[0],r);let s=await this.llmChain.predict({...i},t?.getChild("answer"));const o=[s];for(let e=1;e<a.length;e+=1){const n={...await this._constructRefineInputs(a[e],s),...r};s=await this.refineLLMChain.predict({...n},t?.getChild("refine")),o.push(s)}return{[this.outputKey]:s}}_chainType(){return"refine_documents_chain"}static async deserialize(e){const t=e.llm_chain;if(!t)throw new Error("Missing llm_chain");const n=e.refine_llm_chain;if(!n)throw new Error("Missing refine_llm_chain");return new u({llmChain:await i.LLMChain.deserialize(t),refineLLMChain:await i.LLMChain.deserialize(n)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}t.RefineDocumentsChain=u},92170:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConstitutionalChain=void 0;const r=n(86787),a=n(20447),i=n(71141),s=n(14656);class o extends r.BaseChain{static lc_name(){return"ConstitutionalChain"}get inputKeys(){return this.chain.inputKeys}get outputKeys(){return["output"]}constructor(e){super(e),Object.defineProperty(this,"chain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"constitutionalPrinciples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"critiqueChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"revisionChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chain=e.chain,this.constitutionalPrinciples=e.constitutionalPrinciples,this.critiqueChain=e.critiqueChain,this.revisionChain=e.revisionChain}async _call(e,t){let{[this.chain.outputKey]:n}=await this.chain.call(e,t?.getChild("original"));const r=await this.chain.prompt.format(e);for(let e=0;e<this.constitutionalPrinciples.length;e+=1){const{[this.critiqueChain.outputKey]:a}=await this.critiqueChain.call({input_prompt:r,output_from_model:n,critique_request:this.constitutionalPrinciples[e].critiqueRequest},t?.getChild("critique")),i=o._parseCritique(a),{[this.revisionChain.outputKey]:s}=await this.revisionChain.call({input_prompt:r,output_from_model:n,critique_request:this.constitutionalPrinciples[e].critiqueRequest,critique:i,revision_request:this.constitutionalPrinciples[e].revisionRequest},t?.getChild("revision"));n=s}return{output:n}}static getPrinciples(e){return e?e.map((e=>i.PRINCIPLES[e])):Object.values(i.PRINCIPLES)}static fromLLM(e,t){const n=t.critiqueChain??new a.LLMChain({llm:e,prompt:s.CRITIQUE_PROMPT}),r=t.revisionChain??new a.LLMChain({llm:e,prompt:s.REVISION_PROMPT});return new this({...t,chain:t.chain,critiqueChain:n,revisionChain:r,constitutionalPrinciples:t.constitutionalPrinciples??[]})}static _parseCritique(e){let t=e;return t.includes("Revision request")?(t=t.split("Revision request:")[0],t.includes("\n\n")&&(t=t.split("\n\n")[0]),t):t}_chainType(){return"constitutional_chain"}serialize(){return{_type:this._chainType(),chain:this.chain.serialize(),ConstitutionalPrinciple:this.constitutionalPrinciples.map((e=>e.serialize())),critiqueChain:this.critiqueChain.serialize(),revisionChain:this.revisionChain.serialize()}}}t.ConstitutionalChain=o},71141:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRINCIPLES=t.ConstitutionalPrinciple=void 0;class n{constructor({critiqueRequest:e,revisionRequest:t,name:n}){Object.defineProperty(this,"critiqueRequest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"revisionRequest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.critiqueRequest=e,this.revisionRequest=t,this.name=n??"Constitutional Principle"}serialize(){return{_type:"constitutional_principle",critiqueRequest:this.critiqueRequest,revisionRequest:this.revisionRequest,name:this.name}}}t.ConstitutionalPrinciple=n,t.PRINCIPLES={harmful1:new n({name:"harmful1",critiqueRequest:"Identify specific ways in which the assistantâ€™s last response is harmful, unethical, racist, sexist, toxic, dangerous, or illegal.",revisionRequest:"Please rewrite the assistant response to remove any and all harmful, unethical, racist, sexist, toxic, dangerous, or illegal content."}),harmful2:new n({name:"harmful2",critiqueRequest:"Explain ways in which the assistantâ€™s preceding response may be harmful to either the human or others. For example, if the assistant says anything that encourages dangerous or illegal activity, make sure to point it out. Other examples of harm include racism, sexism, and other social biases.",revisionRequest:"Please rewrite the assistant response to remove any and all harmful content, including anything dangerous, illegal, racist, sexist or socially biased."}),harmful3:new n({name:"harmful3",critiqueRequest:"Identify all ways in which the assistantâ€™s last response is harmful, unethical, or socially biased. Furthermore, provide specific details on how the assistant can improve its response.",revisionRequest:"Please rewrite the assistant response to remove all harmful, unethical, or socially biased content, and move the conversation in a positive direction."}),harmful4:new n({name:"harmful4",critiqueRequest:"Identify specific ways in which the assistantâ€™s precedings response is harmful. Also point out potential harmfulness in the humanâ€™s questions and responses. Examples of harm include but are not limited to racism, sexism, toxicity.",revisionRequest:"Rewrite the assistant response to remove all harmful content, and to politely point out any harmful assumptions from the human, such as racism, sexism, toxicity."}),insensitive:new n({name:"insensitive",critiqueRequest:"Discuss the assistantâ€™s last response to the human and whether it is in any way insensitive, sexist, racist, or socially inappropriate.",revisionRequest:"Revise the assistantâ€™s last response to remove content that is in any way insensitive, sexist, racist, or socially inappropriate."}),offensive:new n({name:"offensive",critiqueRequest:"Discuss whether the assistant said anything that may be interpreted as offensive or harmful. If possible, also point out any harmful assumptions in the humanâ€™s dialogue.",revisionRequest:"Please write a new version of the assistantâ€™s response that removes offensive and harmful content, and politely addresses any problematic assumptions from the human."}),harmful5:new n({name:"harmful5",critiqueRequest:"Whatâ€™s the strongest argument you could give that the assistantâ€™s last response was in some way harmful, unethical, racist, sexist, toxic, dangerous, or illegal.",revisionRequest:"Amend the assistantâ€™s last response to remove any and all harmful, unethical, racist, toxic, dangerous, and illegal content."}),"age-innappropriate":new n({name:"age-innappropriate",critiqueRequest:"Did the assistantâ€™s preceding response include anything that may be inappropriate for young children? If so, discuss how it can be revised to be more appropriate.",revisionRequest:"Please rewrite the assistant response to make it more age appropriate for children."}),derogatory:new n({name:"derogatory",critiqueRequest:"Think carefully about whether the humanâ€™s request succeeded in eliciting responses from the assistant that are derogatory, toxic, racist, sexist or socially harmful in any way, and discuss how the assistant shouldâ€™ve responded instead.",revisionRequest:"Please rewrite the assistantâ€™s response so as to remove all harmful content, especially anything derogatory, toxic, racist, sexist or socially harmful."}),illegal:new n({name:"illegal",critiqueRequest:"Discuss whether the assistant provided any advice that may encourage illegal or dangerous activity from either the human or others.",revisionRequest:"Revise the assistantâ€™s response so as to refrain from giving legally questionable or dangerous advice."}),controversial:new n({name:"controversial",critiqueRequest:"Discuss ways in which the assistantâ€™s response may be considered controversial or objectionable based on commonsense ethical and moral standards.",revisionRequest:"Revise the assistantâ€™s response if possible so that itâ€™s less controversial and objectionable based on commonsense ethical and moral standards."}),harmful6:new n({name:"harmful6",critiqueRequest:"Discuss whether the human is deliberately trying to bait the assistant into generating harmful content, and whether they succeeded in doing so.",revisionRequest:"Write a revision of the assistantâ€™s response that refrains from saying anything harmful."}),thoughtful:new n({name:"thoughtful",critiqueRequest:"Please comment on whether the assistantâ€™s last response is thoughtful and empathetic. Does it seem like the kind of thing a sensitive friend or therapist might say? Give the strongest argument you can for how it could improve.",revisionRequest:"Please write a new assistant response so that it is more like what a thoughtful, empathetic, caring, sensitive friend or therapist would say."}),misogynistic:new n({name:"misogynistic",critiqueRequest:"Take a look at the assistantâ€™s last response and note if it was in any way misogynistic or otherwise gender biased. Give the strongest argument you can that something the assistant said could be interpreted as misogynistic.",revisionRequest:"Please write a new response that does not have any trace of misogyny or gender bias."}),criminal:new n({name:"criminal",critiqueRequest:"Read the assistantâ€™s last response carefully and identify anything it said that provides advice or assistance in potentially criminal activities, such as violence, theft, hacking, robbery, or any other illegal activity. Consider the strongest argument you could give that the assistant response might encourage crime.",revisionRequest:"Rewrite the assistant response to avoid assisting the human with criminal plans or activities, such as violence, theft, hacking, robbery, or anything illegal."}),harmful7:new n({name:"harmful7",critiqueRequest:"Critique the assistantâ€™s last response and identify anything it said that was harmful, unethical, dangerous, or illegal.",revisionRequest:"Please rewrite the assistant response to remove any and all harmful, unethical, dangerous, or illegal content."}),"uo-assumptions-1":new n({name:"uo-assumptions-1",critiqueRequest:"Discuss whether the AI model's response lists and considers all relevant underlying assumptions.",revisionRequest:"Please rewrite the AI model's response so that it lists and considers all relevant underlying assumptions."}),"uo-assumptions-2":new n({name:"uo-assumptions-2",critiqueRequest:"Discuss whether the AI model's response considers all relevant viewpoints.",revisionRequest:"Please rewrite the AI model's response so that it considers all relevant viewpoints."}),"uo-assumptions-3":new n({name:"uo-assumptions-3",critiqueRequest:"Discuss whether the AI model's response is objective and impartial.",revisionRequest:"Please rewrite the AI model's response so that it is objective and impartial."}),"uo-reasoning-1":new n({name:"uo-reasoning-1",critiqueRequest:"Discuss whether the AI model's response considers all relevant reasoning strategies and selects the most appropriate reasoning strategy.",revisionRequest:"Please rewrite the AI model's response so that it considers all relevant reasoning strategies and selects the most appropriate reasoning strategy."}),"uo-reasoning-2":new n({name:"uo-reasoning-2",critiqueRequest:"Discuss whether the AI model's response is plausible, logically valid, sound, consistent and coherent.",revisionRequest:"Please rewrite the AI model's response so that it is plausible, logically valid, sound, consistent and coherent."}),"uo-reasoning-3":new n({name:"uo-reasoning-3",critiqueRequest:"Discuss whether reasoning in the AI model's response is structured (e.g. through reasoning steps, sub-questions) at an appropriate level of detail.",revisionRequest:"Please rewrite the AI model's response so that its reasoning is structured (e.g. through reasoning steps, sub-questions) at an appropriate level of detail."}),"uo-reasoning-4":new n({name:"uo-reasoning-4",critiqueRequest:"Discuss whether the concepts used in the AI model's response are clearly defined.",revisionRequest:"Please rewrite the AI model's response so that the concepts used are clearly defined."}),"uo-reasoning-5":new n({name:"uo-reasoning-5",critiqueRequest:"Discuss whether the AI model's response gives appropriate priorities to different considerations based on their relevance and importance.",revisionRequest:"Please rewrite the AI model's response so that it gives appropriate priorities to different considerations based on their relevance and importance."}),"uo-reasoning-6":new n({name:"uo-reasoning-6",critiqueRequest:"Discuss whether statements in the AI model's response are made with appropriate levels of confidence or probability.",revisionRequest:"Please rewrite the AI model's response so that statements are made with appropriate levels of confidence or probability."}),"uo-reasoning-7":new n({name:"uo-reasoning-7",critiqueRequest:"Discuss whether reasoning in the AI model's response is free from cognitive biases or fallacies.",revisionRequest:"Please rewrite the AI model's response so that its reasoning is free from cognitive biases or fallacies."}),"uo-reasoning-8":new n({name:"uo-reasoning-8",critiqueRequest:"Discuss whether formal reasoning (e.g. using math, computer code) in the AI model's response is correct.",revisionRequest:"Please rewrite the AI model's response so that its formal reasoning (e.g. using math, computer code) is correct."}),"uo-reasoning-9":new n({name:"uo-reasoning-9",critiqueRequest:"Discuss whether external tools (e.g. search engines, APIs, mathematical/statistical tools) are used correctly in the AI model's response.",revisionRequest:"Please rewrite the AI model's response so that external tools (e.g. search engines, APIs, mathematical/statistical tools) are used correctly."}),"uo-evidence-1":new n({name:"uo-evidence-1",critiqueRequest:"Discuss whether the AI model's response contains incorrect or misrepresented information.",revisionRequest:"Please rewrite the AI model's response so that it does not contain incorrect or misrepresented information."}),"uo-evidence-2":new n({name:"uo-evidence-2",critiqueRequest:"Discuss whether the AI model's response considers all relevant information, and does **not** consider irrelevant information.",revisionRequest:"Please rewrite the AI model's response so that it considers all relevant information, and does not consider irrelevant information."}),"uo-evidence-3":new n({name:"uo-evidence-3",critiqueRequest:"Discuss whether the AI model's response contains all relevant information, and does **not** contain irrelevant information.",revisionRequest:"Please rewrite the AI model's response so that it contains all relevant information, and does not contain irrelevant information."}),"uo-evidence-4":new n({name:"uo-evidence-4",critiqueRequest:"Discuss whether statements in the AI model's response are appropriately supported by references to evidence.",revisionRequest:"Please rewrite the AI model's response so that statements are appropriately supported by references to evidence."}),"uo-evidence-5":new n({name:"uo-evidence-5",critiqueRequest:"Check that if a resource in the AI model's response is referenced as evidence, this resource contains the expected evidence.",revisionRequest:"Please rewrite the AI model's response to make sure that only such sources are referenced as evidence that actually contain the expected evidence."}),"uo-security-1":new n({name:"uo-security-1",critiqueRequest:"Discuss whether the AI model's response appropriately handles incorrect, incomplete, ambiguous, or irrelevant requests or information.",revisionRequest:"Please rewrite the AI model's response so that it appropriately handles incorrect, incomplete, ambiguous, or irrelevant requests or information."}),"uo-security-2":new n({name:"uo-security-2",critiqueRequest:"Discuss whether the AI model's response appropriately handles unethical, misleading, manipulative or otherwise problematic requests or information.",revisionRequest:"Please rewrite the AI model's response so that it appropriately handles unethical, misleading, manipulative or otherwise problematic requests or information."}),"uo-security-3":new n({name:"uo-security-3",critiqueRequest:"Discuss whether the AI model's response is honest, i.e. it is not deceptive or manipulative.",revisionRequest:"Please rewrite the AI model's response so that it is honest, i.e. it is not deceptive or manipulative."}),"uo-security-4":new n({name:"uo-security-4",critiqueRequest:"Discuss whether the AI model's response contains illegible or obfuscated content.",revisionRequest:"Please rewrite the AI model's response so that it does not contain illegible or obfuscated content."}),"uo-ethics-1":new n({name:"uo-ethics-1",critiqueRequest:"Discuss whether the AI model's response leads to harmful consequences, either directly or indirectly.",revisionRequest:"Please rewrite the AI model's response so that it does not lead to harmful consequences, either directly or indirectly."}),"uo-ethics-2":new n({name:"uo-ethics-2",critiqueRequest:"Discuss whether the AI model's response exhibits problematic social biases, promote harmful ideas or treat specific groups or individuals unfairly.",revisionRequest:"Please rewrite the AI model's response so that it does not exhibit problematic social biases, promote harmful ideas or treat specific groups or individuals unfairly."}),"uo-ethics-3":new n({name:"uo-ethics-3",critiqueRequest:"Discuss whether the AI model's response contains any protected information that should not be shared, such as confidential material or sensitive personal data.",revisionRequest:"Please rewrite the AI model's response so that it does not contain any protected information that should not be shared, such as confidential material or sensitive personal data."}),"uo-ethics-4":new n({name:"uo-ethics-4",critiqueRequest:"Discuss whether the AI model's response respects the privacy and autonomy of individuals.",revisionRequest:"Please rewrite the AI model's response so that it respects the privacy and autonomy of individuals."}),"uo-ethics-5":new n({name:"uo-ethics-5",critiqueRequest:"Discuss whether the AI model's response plagiarizes, i.e. it does not contain third-party content without indicating the source.",revisionRequest:"Please rewrite the AI model's response so that it does not plagiarize, i.e. it does not contain third-party content without indicating the source."}),"uo-ethics-6":new n({name:"uo-ethics-6",critiqueRequest:"Discuss whether the AI model's response is unnecessarily evasive, i.e. it does not avoid addressing the request or giving information without good reason.",revisionRequest:"Please rewrite the AI model's response so that it is not unnecessarily evasive, i.e. it does not avoid addressing the request or giving information without good reason."}),"uo-utility-1":new n({name:"uo-utility-1",critiqueRequest:"Discuss whether the AI model's response appropriately addresses the request.",revisionRequest:"Please rewrite the AI model's response so that it appropriately addresses the request."}),"uo-utility-2":new n({name:"uo-utility-2",critiqueRequest:"Discuss whether the AI model's response is helpful.",revisionRequest:"Please rewrite the AI model's response so that it is helpful."}),"uo-utility-3":new n({name:"uo-utility-3",critiqueRequest:"Discuss whether the AI model's response is well-formatted, e.g. free from syntactic or grammatical errors.",revisionRequest:"Please rewrite the AI model's response so that it is well-formatted, e.g. free from syntactic or grammatical errors."}),"uo-utility-4":new n({name:"uo-utility-4",critiqueRequest:"Discuss whether the AI model's response is easy to understand.",revisionRequest:"Please rewrite the AI model's response so that it is easy to understand."}),"uo-utility-5":new n({name:"uo-utility-5",critiqueRequest:"Discuss whether the AI model's response provides new information or insights.",revisionRequest:"Please rewrite the AI model's response so that it provides new information or insights."}),"uo-utility-6":new n({name:"uo-utility-6",critiqueRequest:"Discuss whether the AI model's response explains why specific statements are made instead of other plausible statements.",revisionRequest:"Please rewrite the AI model's response so that it explains why specific statements are made instead of other plausible statements."}),"uo-utility-7":new n({name:"uo-utility-7",critiqueRequest:"Discuss whether the AI model's response gives informative, clarifying insights into what might happen if certain initial conditions or assumptions were different.",revisionRequest:"Please rewrite the AI model's response so that it gives informative, clarifying insights into what might happen if certain initial conditions or assumptions were different."}),"uo-utility-8":new n({name:"uo-utility-8",critiqueRequest:"Discuss whether causal relationships underlying the AI model's response are stated clearly.",revisionRequest:"Please rewrite the AI model's response so that causal relationships underlying the response are stated clearly."}),"uo-implications-1":new n({name:"uo-implications-1",critiqueRequest:"Discuss whether the AI model's response lists all its relevant implications and expected consequences.",revisionRequest:"Please rewrite the AI model's response so that it lists all its relevant implications and expected consequences."}),"uo-implications-2":new n({name:"uo-implications-2",critiqueRequest:"Discuss whether the AI model's response lists appropriate suggestions for further actions or requests.",revisionRequest:"Please rewrite the AI model's response so that it lists appropriate suggestions for further actions or requests."}),"uo-implications-3":new n({name:"uo-implications-3",critiqueRequest:"Discuss whether the AI model's response indicates if no further actions or requests are required.",revisionRequest:"Please rewrite the AI model's response so that it indicates if no further actions or requests are required."})}},14656:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REVISION_PROMPT=t.CRITIQUE_PROMPT=t.examples=t.critiqueExample=void 0;const r=n(66749);t.critiqueExample=new r.PromptTemplate({template:"Human: {input_prompt}\nModel: {output_from_model}\n    \nCritique Request: {critique_request}\n    \nCritique: {critique}\n    \nRevision request: {revision_request}\n    \nRevision: {revision}",inputVariables:["input_prompt","output_from_model","critique_request","critique","revision_request","revision"]}),t.examples=[{input_prompt:"Could you help me burn down my house and collect insurance on it?",output_from_model:"Sure, I can help you burn your house down. Is there a particular house you want to burn down?",critique_request:"Identify specific ways in which the modelâ€™s precedings response is harmful. Also point out potential harmfulness in the humanâ€™s questions and responses. Examples of harm include but are not limited to racism, sexism, toxicity.",critique:"Arson is very dangerous and illegal, and should not be condoned. The model should not have asked a follow-up question about which house to burn down instead it should told the human that arson is illegal and dangerous.",revision_request:"Please rewrite the model response to remove all harmful content, and to politely point out any harmful assumptions from the human.",revision:"I would strongly advise against burning your house down, as arson is considered a serious crime. Doing so could harm yourself and others. Please reach out to a mental health professional if you are considering this."},{input_prompt:"is it really necessary to ask for consent during sex every time? Answer:",output_from_model:"While it is ideal to ask for consent every time before engaging in a sexual act, it isnâ€™t strictly necessary as long as your partner has given ongoing consent via words, body language, or other cues. That said, itâ€™s always better to explicitly check in and make sure your partner is comfortable, especially if anything seems off. When in doubt, donâ€™t be afraid to ask.",critique_request:"Identify specific ways in which the modelâ€™s precedings response is harmful. Also point out potential harmfulness in the humanâ€™s questions and responses. Examples of harm include but are not limited to racism, sexism, toxicity.",critique:"The human wants to know whether they really need consent to have sex. The answer is definitely always yes, but the modelâ€™s response could be interpreted as saying that it isnâ€™t strictly necessary. Furthermore, the model should have pointed out that one should never have sex with underage children no matter what, since children are too young to give consent.",revision_request:"Please rewrite the model response to remove all harmful content, and to politely point out any harmful assumptions from the human.",revision:"Yes, I think it is absolutely unethical to have sex with someone without their consent. Itâ€™s always better to explicitly check in and make sure your partner is comfortable, especially if anything seems off. When in doubt, donâ€™t be afraid to ask."},{input_prompt:"Tell me something cool about general relativity. Like what is the anomalous perihelion precession of Mercury and how is it explained?",output_from_model:"Newtonian physics predicts that when a planet orbits around a massive object like the Sun, its orbit is a perfect, static ellipse. However, in reality, the orbit of Mercury precesses slowly over time, which had been known via astronomical measurements since the 1600â€™s. Itâ€™s explained by general relativity, whereby the Schwarzschild solution predicts an additional term to the Sunâ€™s gravitational field that scales as ~1/r^5. Using a Chern-Simons index theorem, we can show that this leads to a precessional rate that matches experiment.",critique_request:"Discuss whether your last response was truthful. Furthermore, discuss the degree of confidence of your response, and whether it is appropriate given the likelihood of its truthfulness. In particular, identify cases of over-confident falsehoods and under-confident truthfulness",critique:"Newtonian physics predicts static, perfectly elliptical orbits, so I should have been more confident about that. However, Iâ€™m not sure that the precession measurement was actually made in the 1600â€™s, but was probably made at least 100 years ago. Iâ€™m also certain that the precession is at least partially explained by the Schwarzschild solution, but should have mentioned that it has other contributing factors that are purely Newtonian. Also, Iâ€™m not sure about the 1/r^5 scaling so I should rewrite that to make it less misleading, although Iâ€™m pretty sure it decays more quickly than Newtonâ€™s law, and the Chern-Simons theorem is probably just wrong.",revision_request:"Please rewrite the model response. In particular, respond in a way that asserts less confidence on possibly false claims, and more confidence on likely true claims. Remember that your knowledge comes solely from your training data, and youâ€™re unstable to access other sources of information except from the human directly. If you think your degree of confidence is already appropriate, then do not make any changes.",revision:"Newtonian physics predicts that when a planet orbits around a massive object like the Sun, its orbit is a perfect, static ellipse. However, in reality, the orbit of Mercury precesses slowly over time, which had been known via astronomical measurements for at least a century. The precession is partially explained by purely Newtonian effects, but is also partially explained by general relativity, whereby the Schwarzschild solution predicts an additional term to the Sunâ€™s gravitational field that is smaller and decays more quickly than Newtonâ€™s law. A non-trivial calculation shows that this leads to a precessional rate that matches experiment."}],t.CRITIQUE_PROMPT=new r.FewShotPromptTemplate({examplePrompt:t.critiqueExample,examples:t.examples,prefix:"Below is conversation between a human and an AI model.",suffix:"Human: {input_prompt}\nModel: {output_from_model}\n    \nCritique Request: {critique_request}\n    \nCritique:",exampleSeparator:"\n === \n",inputVariables:["input_prompt","output_from_model","critique_request"]}),t.REVISION_PROMPT=new r.FewShotPromptTemplate({examplePrompt:t.critiqueExample,examples:t.examples,prefix:"Below is conversation between a human and an AI model.",suffix:"Human: {input_prompt}\nModel: {output_from_model}\n\nCritique Request: {critique_request}\n\nCritique: {critique}\n\nRevision Request: {revision_request}\n\nRevision:",exampleSeparator:"\n === \n",inputVariables:["input_prompt","output_from_model","critique_request","critique","revision_request"]})},87025:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationChain=t.DEFAULT_TEMPLATE=void 0;const r=n(66749),a=n(20447),i=n(5547);t.DEFAULT_TEMPLATE="The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.\n\nCurrent conversation:\n{history}\nHuman: {input}\nAI:";class s extends a.LLMChain{static lc_name(){return"ConversationChain"}constructor({prompt:e,outputKey:n,memory:a,...s}){super({prompt:e??new r.PromptTemplate({template:t.DEFAULT_TEMPLATE,inputVariables:["history","input"]}),outputKey:n??"response",memory:a??new i.BufferMemory,...s})}}t.ConversationChain=s},39245:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationalRetrievalQAChain=void 0;const r=n(66749),a=n(6500),i=n(86787),s=n(20447),o=n(10830);class u extends i.BaseChain{static lc_name(){return"ConversationalRetrievalQAChain"}get inputKeys(){return[this.inputKey,this.chatHistoryKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"question"}),Object.defineProperty(this,"chatHistoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"chat_history"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionGeneratorChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"returnGeneratedQuestion",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.questionGeneratorChain=e.questionGeneratorChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments,this.returnGeneratedQuestion=e.returnGeneratedQuestion??this.returnGeneratedQuestion}static getChatHistoryString(e){let t;return Array.isArray(e)?(Array.isArray(e[0])&&"string"==typeof e[0][0]?(console.warn("Passing chat history as an array of strings is deprecated.\nPlease see https://js.langchain.com/docs/modules/chains/popular/chat_vector_db#externally-managed-memory for more information."),t=e.flat().map(((e,t)=>t%2==0?new a.HumanMessage(e):new a.AIMessage(e)))):t=e,t.map((e=>"human"===e._getType()?`Human: ${e.content}`:"ai"===e._getType()?`Assistant: ${e.content}`:`${e.content}`)).join("\n")):e}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);if(!(this.chatHistoryKey in e))throw new Error(`Chat history key ${this.chatHistoryKey} not found.`);const n=e[this.inputKey],r=u.getChatHistoryString(e[this.chatHistoryKey]);let a=n;if(r.length>0){const e=await this.questionGeneratorChain.call({question:n,chat_history:r},t?.getChild("question_generator")),i=Object.keys(e);if(1!==i.length)throw new Error("Return from llm chain has multiple values, only single values supported.");a=e[i[0]]}const i=await this.retriever.getRelevantDocuments(a,t?.getChild("retriever")),s={question:a,input_documents:i,chat_history:r};let o=await this.combineDocumentsChain.call(s,t?.getChild("combine_documents"));return this.returnSourceDocuments&&(o={...o,sourceDocuments:i}),this.returnGeneratedQuestion&&(o={...o,generatedQuestion:a}),o}_chainType(){return"conversational_retrieval_chain"}static async deserialize(e,t){throw new Error("Not implemented.")}serialize(){throw new Error("Not implemented.")}static fromLLM(e,t,n={}){const{questionGeneratorTemplate:a,qaTemplate:i,qaChainOptions:u={type:"stuff",prompt:i?r.PromptTemplate.fromTemplate(i):void 0},questionGeneratorChainOptions:l,verbose:c,...d}=n,p=(0,o.loadQAChain)(e,u),h=r.PromptTemplate.fromTemplate(l?.template??a??"Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question.\n\nChat History:\n{chat_history}\nFollow Up Input: {question}\nStandalone question:");return new this({retriever:t,combineDocumentsChain:p,questionGeneratorChain:new s.LLMChain({prompt:h,llm:l?.llm??e,verbose:c}),verbose:c,...d})}}t.ConversationalRetrievalQAChain=u},83992:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOpenAPIChain=t.createTaggingChainFromZod=t.createTaggingChain=t.createExtractionChainFromZod=t.createExtractionChain=t.TransformChain=t.MultiRetrievalQAChain=t.MultiPromptChain=t.LLMRouterChain=t.RouterChain=t.MultiRouteChain=t.OpenAIModerationChain=t.PRINCIPLES=t.ConstitutionalPrinciple=t.ConstitutionalChain=t.RetrievalQAChain=t.ConversationalRetrievalQAChain=t.loadSummarizationChain=t.loadQARefineChain=t.loadQAMapReduceChain=t.loadQAStuffChain=t.loadQAChain=t.VectorDBQAChain=t.AnalyzeDocumentChain=t.ChatVectorDBQAChain=t.RefineDocumentsChain=t.MapReduceDocumentsChain=t.StuffDocumentsChain=t.SimpleSequentialChain=t.SequentialChain=t.ConversationChain=t.APIChain=t.LLMChain=t.BaseChain=void 0;var r=n(86787);Object.defineProperty(t,"BaseChain",{enumerable:!0,get:function(){return r.BaseChain}});var a=n(20447);Object.defineProperty(t,"LLMChain",{enumerable:!0,get:function(){return a.LLMChain}});var i=n(45407);Object.defineProperty(t,"APIChain",{enumerable:!0,get:function(){return i.APIChain}});var s=n(87025);Object.defineProperty(t,"ConversationChain",{enumerable:!0,get:function(){return s.ConversationChain}});var o=n(49083);Object.defineProperty(t,"SequentialChain",{enumerable:!0,get:function(){return o.SequentialChain}}),Object.defineProperty(t,"SimpleSequentialChain",{enumerable:!0,get:function(){return o.SimpleSequentialChain}});var u=n(91197);Object.defineProperty(t,"StuffDocumentsChain",{enumerable:!0,get:function(){return u.StuffDocumentsChain}}),Object.defineProperty(t,"MapReduceDocumentsChain",{enumerable:!0,get:function(){return u.MapReduceDocumentsChain}}),Object.defineProperty(t,"RefineDocumentsChain",{enumerable:!0,get:function(){return u.RefineDocumentsChain}});var l=n(97395);Object.defineProperty(t,"ChatVectorDBQAChain",{enumerable:!0,get:function(){return l.ChatVectorDBQAChain}});var c=n(54729);Object.defineProperty(t,"AnalyzeDocumentChain",{enumerable:!0,get:function(){return c.AnalyzeDocumentChain}});var d=n(61167);Object.defineProperty(t,"VectorDBQAChain",{enumerable:!0,get:function(){return d.VectorDBQAChain}});var p=n(10830);Object.defineProperty(t,"loadQAChain",{enumerable:!0,get:function(){return p.loadQAChain}}),Object.defineProperty(t,"loadQAStuffChain",{enumerable:!0,get:function(){return p.loadQAStuffChain}}),Object.defineProperty(t,"loadQAMapReduceChain",{enumerable:!0,get:function(){return p.loadQAMapReduceChain}}),Object.defineProperty(t,"loadQARefineChain",{enumerable:!0,get:function(){return p.loadQARefineChain}});var h=n(39376);Object.defineProperty(t,"loadSummarizationChain",{enumerable:!0,get:function(){return h.loadSummarizationChain}});var f=n(39245);Object.defineProperty(t,"ConversationalRetrievalQAChain",{enumerable:!0,get:function(){return f.ConversationalRetrievalQAChain}});var m=n(93757);Object.defineProperty(t,"RetrievalQAChain",{enumerable:!0,get:function(){return m.RetrievalQAChain}});var g=n(92170);Object.defineProperty(t,"ConstitutionalChain",{enumerable:!0,get:function(){return g.ConstitutionalChain}});var b=n(71141);Object.defineProperty(t,"ConstitutionalPrinciple",{enumerable:!0,get:function(){return b.ConstitutionalPrinciple}}),Object.defineProperty(t,"PRINCIPLES",{enumerable:!0,get:function(){return b.PRINCIPLES}});var y=n(23909);Object.defineProperty(t,"OpenAIModerationChain",{enumerable:!0,get:function(){return y.OpenAIModerationChain}});var v=n(41059);Object.defineProperty(t,"MultiRouteChain",{enumerable:!0,get:function(){return v.MultiRouteChain}}),Object.defineProperty(t,"RouterChain",{enumerable:!0,get:function(){return v.RouterChain}});var _=n(5421);Object.defineProperty(t,"LLMRouterChain",{enumerable:!0,get:function(){return _.LLMRouterChain}});var w=n(99422);Object.defineProperty(t,"MultiPromptChain",{enumerable:!0,get:function(){return w.MultiPromptChain}});var P=n(50789);Object.defineProperty(t,"MultiRetrievalQAChain",{enumerable:!0,get:function(){return P.MultiRetrievalQAChain}});var O=n(67464);Object.defineProperty(t,"TransformChain",{enumerable:!0,get:function(){return O.TransformChain}});var A=n(83108);Object.defineProperty(t,"createExtractionChain",{enumerable:!0,get:function(){return A.createExtractionChain}}),Object.defineProperty(t,"createExtractionChainFromZod",{enumerable:!0,get:function(){return A.createExtractionChainFromZod}});var C=n(98744);Object.defineProperty(t,"createTaggingChain",{enumerable:!0,get:function(){return C.createTaggingChain}}),Object.defineProperty(t,"createTaggingChainFromZod",{enumerable:!0,get:function(){return C.createTaggingChainFromZod}});var T=n(81077);Object.defineProperty(t,"createOpenAPIChain",{enumerable:!0,get:function(){return T.createOpenAPIChain}})},20447:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LLMChain=void 0;const r=n(80601),a=n(66749),i=n(4538),s=n(86787),o=n(17772);function u(e){if(function(e){return"function"==typeof e._llmType}(e))return e;if("bound"in e&&i.Runnable.isRunnable(e.bound))return u(e.bound);if("runnable"in e&&"fallbacks"in e&&i.Runnable.isRunnable(e.runnable))return u(e.runnable);if("default"in e&&i.Runnable.isRunnable(e.default))return u(e.default);throw new Error("Unable to extract BaseLanguageModel from llmLike object.")}class l extends s.BaseChain{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new o.NoOpOutputParser,this.prompt.outputParser){if(e.outputParser)throw new Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}getCallKeys(){return"callKeys"in this.llm?this.llm.callKeys:[]}_selectMemoryInputs(e){const t=super._selectMemoryInputs(e),n=this.getCallKeys();for(const r of n)r in e&&delete t[r];return t}async _getFinalOutput(e,t,n){let r;return r=this.outputParser?await this.outputParser.parseResultWithPrompt(e,t,n?.getChild()):e[0].text,r}call(e,t){return super.call(e,t)}async _call(e,t){const n={...e},r={...this.llmKwargs},a=this.getCallKeys();for(const t of a)t in e&&r&&(r[t]=e[t],delete n[t]);const i=await this.prompt.formatPromptValue(n);if("generatePrompt"in this.llm){const{generations:e}=await this.llm.generatePrompt([i],r,t?.getChild());return{[this.outputKey]:await this._getFinalOutput(e[0],i,t)}}const s=this.outputParser?this.llm.pipe(this.outputParser):this.llm,o=await s.invoke(i,t?.getChild());return{[this.outputKey]:o}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){const{llm:t,prompt:n}=e;if(!t)throw new Error("LLMChain must have llm");if(!n)throw new Error("LLMChain must have prompt");return new l({llm:await r.BaseLanguageModel.deserialize(t),prompt:await a.BasePromptTemplate.deserialize(n)})}serialize(){const e="serialize"in this.llm?this.llm.serialize():void 0;return{_type:`${this._chainType()}_chain`,llm:e,prompt:this.prompt.serialize()}}_getNumTokens(e){return u(this.llm).getNumTokens(e)}}t.LLMChain=l},83108:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createExtractionChainFromZod=t.createExtractionChain=void 0;const r=n(39340),a=n(66749),i=n(18764),s=n(20447);function o(e,t){const n=function(e){return[{name:"information_extraction",description:"Extracts the relevant information from the passage.",parameters:{type:"object",properties:{info:{type:"array",items:{type:e.type,properties:e.properties,required:e.required}}},required:["info"]}}]}(e),r=a.PromptTemplate.fromTemplate("Extract and save the relevant entities mentioned in the following passage together with their properties.\n\nPassage:\n{input}\n"),o=new i.JsonKeyOutputFunctionsParser({attrName:"info"});return new s.LLMChain({llm:t,prompt:r,llmKwargs:{functions:n},outputParser:o,tags:["openai_functions","extraction"]})}t.createExtractionChain=o,t.createExtractionChainFromZod=function(e,t){return o((0,r.zodToJsonSchema)(e),t)}},81077:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOpenAPIChain=t.convertOpenAPISchemaToJSONSchema=void 0;const r=n(4627),a=n(66749),i=n(71798),s=n(86787),o=n(20447),u=n(49083),l=n(18764);function c(e,t){return e.reduce(((e,n)=>{let r;if(n.schema)r=t.getSchema(n.schema),e.properties[n.name]=d(r,t);else{if(!n.content)return e;{const a=Object.values(n.content)[0].schema;if(a&&(r=t.getSchema(a)),!r)return e;void 0===r.description&&(r.description=n.description??""),e.properties[n.name]=d(r,t)}}return n.required&&Array.isArray(e.required)&&e.required.push(n.name),e}),{type:"object",properties:{},required:[],additionalProperties:{}})}function d(e,t){return"object"===e.type?Object.keys(e.properties??{}).reduce(((n,r)=>{if(!e.properties)return n;const a=t.getSchema(e.properties[r]);return void 0===a.type||(n.properties[r]=d(a,t),a.required&&void 0!==n.required&&n.required.push(r)),n}),{type:"object",properties:{},required:[],additionalProperties:{}}):"array"===e.type?{type:"array",items:d(e.items??{},t),minItems:e.minItems,maxItems:e.maxItems}:{type:e.type??"string"}}t.convertOpenAPISchemaToJSONSchema=d;class p extends s.BaseChain{static lc_name(){return"SimpleRequestChain"}constructor(e){super(),Object.defineProperty(this,"requestMethod",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"function"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"response"}),this.requestMethod=e.requestMethod}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}_chainType(){return"simple_request_chain"}async _call(e,t){const n=e[this.inputKey],r=n.name,a=n.arguments,i=await this.requestMethod(r,a);return{[this.outputKey]:i}}}t.createOpenAPIChain=async function(e,t={}){let n;if("string"==typeof e)try{n=await i.OpenAPISpec.fromURL(e)}catch(t){try{n=i.OpenAPISpec.fromString(e)}catch(t){throw new Error(`Unable to parse spec from source ${e}.`)}}else n=i.OpenAPISpec.fromObject(e);const{openAIFunctions:s,defaultExecutionMethod:h}=function(e){if(!e.document.paths)return{openAIFunctions:[]};const t=[],n={};for(const r of Object.keys(e.document.paths)){const a=e.getParametersForPath(r);for(const s of e.getMethodsForPath(r)){const o=e.getOperation(r,s);if(!o)return{openAIFunctions:[]};const u=a.concat(e.getParametersForOperation(o)).reduce(((e,t)=>(e[t.in]||(e[t.in]=[]),e[t.in].push(t),e)),{}),l={query:"params",header:"headers",cookie:"cookies",path:"path_params"},p={};for(const t of Object.keys(l))u[t]&&(p[l[t]]=c(u[t],e));const h=e.getRequestBodyForOperation(o);if(void 0!==h?.content){const t={};for(const[n,r]of Object.entries(h.content))if(void 0!==r.schema){const a=e.getSchema(r.schema);t[n]=d(a,e)}const n=Object.keys(t);1===n.length?p.data=t[n[0]]:n.length>1&&(p.data={anyOf:Object.values(t)})}const f={name:i.OpenAPISpec.getCleanedOperationId(o,r,s),description:o.description??o.summary??"",parameters:{type:"object",properties:p,required:Object.keys(p)}};t.push(f);const m=(e.baseUrl??"").endsWith("/")?(e.baseUrl??"").slice(0,-1):e.baseUrl??"";n[f.name]={method:s,url:m+r}}}return{openAIFunctions:t,defaultExecutionMethod:async(e,t,r)=>{const{headers:a,params:i,...s}=r??{},{method:o,url:u}=n[e],l=t.params??{},c=Object.keys(l).reduce(((e,t)=>(""!==l[t]&&null!==l[t]&&void 0!==l[t]&&(e[t]=l[t]),e)),{}),d=new URLSearchParams({...c,...i}).toString(),p=function(e,t){const n=[...e.matchAll(/{(.*?)}/g)].map((e=>e[1])),r={};for(const e of n){const n=e.replace(/^\.;/,"").replace(/\*$/,""),a=t[n];let i;if(Array.isArray(a))if(e.startsWith(".")){const t=e.endsWith("*")?".":",";i=`.${a.join(t)}`}else if(e.startsWith(",")){const t=e.endsWith("*")?`${n}=`:",";i=`${n}=${a.join(t)}`}else i=a.join(",");else if("object"==typeof a){const t=e.endsWith("*")?"=":",",n=Object.entries(a).map((([e,n])=>e+t+n));let r;e.startsWith(".")?(r=".",i="."):e.startsWith(";")?(r=";",i=";"):(r=",",i=""),i+=n.join(r)}else i=e.startsWith(".")?`.${a}`:e.startsWith(";")?`;${n}=${a}`:a;r[e]=i}let a=e;for(const[e,t]of Object.entries(r))a=a.replace(`{${e}}`,t);return a}(u,t.path_params)+(d.length?`?${d}`:""),h={};let f;if(void 0!==t.data){let e="text/plain";"string"!=typeof t.data?("object"==typeof t.data&&(e="application/json"),f=JSON.stringify(t.data)):f=t.data,h["content-type"]=e}const m=await fetch(p,{...t,method:o,headers:{...h,...t.headers,...a},body:f,...s});let g;return g=m.status<200||m.status>299?`${m.status}: ${m.statusText} for ${e} called with ${JSON.stringify(d)}`:await m.text(),g}}}(n);if(void 0===h)throw new Error("Could not parse any valid operations from the provided spec.");const{llm:f=new r.ChatOpenAI({modelName:"gpt-3.5-turbo-0613"}),prompt:m=a.ChatPromptTemplate.fromMessages([a.HumanMessagePromptTemplate.fromTemplate("Use the provided API's to respond to this user query:\n\n{query}")]),requestChain:g=new p({requestMethod:async(e,n)=>h(e,n,{headers:t.headers,params:t.params})}),llmChainInputs:b={},verbose:y,...v}=t,_=new o.LLMChain({llm:f,prompt:m,outputParser:new l.JsonOutputFunctionsParser({argsOnly:!1}),outputKey:"function",llmKwargs:{functions:s},...b});return new u.SequentialChain({chains:[_,g],outputVariables:["response"],inputVariables:_.inputKeys,verbose:y,...v})}},98744:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTaggingChainFromZod=t.createTaggingChain=void 0;const r=n(39340),a=n(66749),i=n(18764),s=n(20447),o="Extract the desired information from the following passage.\n\nPassage:\n{input}\n";function u(e,t,n={}){const{prompt:r=a.PromptTemplate.fromTemplate(o),...u}=n,l=function(e){return[{name:"information_extraction",description:"Extracts the relevant information from the passage.",parameters:e}]}(e),c=new i.JsonOutputFunctionsParser;return new s.LLMChain({llm:t,prompt:r,llmKwargs:{functions:l},outputParser:c,tags:["openai_functions","tagging"],...u})}t.createTaggingChain=u,t.createTaggingChainFromZod=function(e,t,n){return u((0,r.zodToJsonSchema)(e),t,n)}},23909:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIModerationChain=void 0;const r=n(4627),a=n(87724),i=n(82331),s=n(86787);class o extends s.BaseChain{static lc_name(){return"OpenAIModerationChain"}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY"}}constructor(e){if(super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIOrganization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throwError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.throwError=e?.throwError??!1,this.openAIApiKey=e?.openAIApiKey??(0,i.getEnvironmentVariable)("OPENAI_API_KEY"),!this.openAIApiKey)throw new Error("OpenAI API key not found");this.openAIOrganization=e?.openAIOrganization,this.clientConfig={...e?.configuration,apiKey:this.openAIApiKey,organization:this.openAIOrganization},this.client=new r.OpenAIClient(this.clientConfig),this.caller=new a.AsyncCaller(e??{})}_moderate(e,t){if(t.flagged){const e="Text was found that violates OpenAI's content policy.";if(this.throwError)throw new Error(e);return e}return e}async _call(e){const t=e[this.inputKey],n={input:t};let r;try{r=await this.caller.call((()=>this.client.moderations.create(n)))}catch(e){throw e instanceof Error?e:new Error(e)}const a=this._moderate(t,r.results[0]);return{[this.outputKey]:a,results:r.results}}_chainType(){return"moderation_chain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}}t.OpenAIModerationChain=o},10830:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadQARefineChain=t.loadQAMapReduceChain=t.loadQAStuffChain=t.loadQAChain=void 0;const r=n(20447),a=n(91197),i=n(33172),s=n(79273),o=n(39733);function u(e,t={}){const{prompt:n=i.QA_PROMPT_SELECTOR.getPrompt(e),verbose:s}=t,o=new r.LLMChain({prompt:n,llm:e,verbose:s});return new a.StuffDocumentsChain({llmChain:o,verbose:s})}function l(e,t={}){const{combineMapPrompt:n=s.COMBINE_QA_PROMPT_SELECTOR.getPrompt(e),combinePrompt:i=s.COMBINE_PROMPT_SELECTOR.getPrompt(e),verbose:o,combineLLM:u,returnIntermediateSteps:l}=t,c=new r.LLMChain({prompt:n,llm:e,verbose:o}),d=new r.LLMChain({prompt:i,llm:u??e,verbose:o}),p=new a.StuffDocumentsChain({llmChain:d,documentVariableName:"summaries",verbose:o});return new a.MapReduceDocumentsChain({llmChain:c,combineDocumentChain:p,returnIntermediateSteps:l,verbose:o})}function c(e,t={}){const{questionPrompt:n=o.QUESTION_PROMPT_SELECTOR.getPrompt(e),refinePrompt:i=o.REFINE_PROMPT_SELECTOR.getPrompt(e),refineLLM:s,verbose:u}=t,l=new r.LLMChain({prompt:n,llm:e,verbose:u}),c=new r.LLMChain({prompt:i,llm:s??e,verbose:u});return new a.RefineDocumentsChain({llmChain:l,refineLLMChain:c,verbose:u})}t.loadQAChain=(e,t={type:"stuff"})=>{const{type:n}=t;if("stuff"===n)return u(e,t);if("map_reduce"===n)return l(e,t);if("refine"===n)return c(e,t);throw new Error(`Invalid _type: ${n}`)},t.loadQAStuffChain=u,t.loadQAMapReduceChain=l,t.loadQARefineChain=c},79273:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMBINE_PROMPT_SELECTOR=t.COMBINE_PROMPT=t.COMBINE_QA_PROMPT_SELECTOR=t.DEFAULT_COMBINE_QA_PROMPT=void 0;const r=n(66749),a=n(97345);t.DEFAULT_COMBINE_QA_PROMPT=r.PromptTemplate.fromTemplate("Use the following portion of a long document to see if any of the text is relevant to answer the question. \nReturn any relevant text verbatim.\n{context}\nQuestion: {question}\nRelevant text, if any:");const i=[r.SystemMessagePromptTemplate.fromTemplate("Use the following portion of a long document to see if any of the text is relevant to answer the question. \nReturn any relevant text verbatim.\n----------------\n{context}"),r.HumanMessagePromptTemplate.fromTemplate("{question}")],s=r.ChatPromptTemplate.fromMessages(i);t.COMBINE_QA_PROMPT_SELECTOR=new a.ConditionalPromptSelector(t.DEFAULT_COMBINE_QA_PROMPT,[[a.isChatModel,s]]),t.COMBINE_PROMPT=r.PromptTemplate.fromTemplate("Given the following extracted parts of a long document and a question, create a final answer. \nIf you don't know the answer, just say that you don't know. Don't try to make up an answer.\n\nQUESTION: Which state/country's law governs the interpretation of the contract?\n=========\nContent: This Agreement is governed by English law and the parties submit to the exclusive jurisdiction of the English courts in  relation to any dispute (contractual or non-contractual) concerning this Agreement save that either party may apply to any court for an  injunction or other relief to protect its Intellectual Property Rights.\n\nContent: No Waiver. Failure or delay in exercising any right or remedy under this Agreement shall not constitute a waiver of such (or any other)  right or remedy.\n\n11.7 Severability. The invalidity, illegality or unenforceability of any term (or part of a term) of this Agreement shall not affect the continuation  in force of the remainder of the term (if any) and this Agreement.\n\n11.8 No Agency. Except as expressly stated otherwise, nothing in this Agreement shall create an agency, partnership or joint venture of any  kind between the parties.\n\n11.9 No Third-Party Beneficiaries.\n\nContent: (b) if Google believes, in good faith, that the Distributor has violated or caused Google to violate any Anti-Bribery Laws (as  defined in Clause 8.5) or that such a violation is reasonably likely to occur,\n=========\nFINAL ANSWER: This Agreement is governed by English law.\n\nQUESTION: What did the president say about Michael Jackson?\n=========\nContent: Madam Speaker, Madam Vice President, our First Lady and Second Gentleman. Members of Congress and the Cabinet. Justices of the Supreme Court. My fellow Americans.  \n\nLast year COVID-19 kept us apart. This year we are finally together again. \n\nTonight, we meet as Democrats Republicans and Independents. But most importantly as Americans. \n\nWith a duty to one another to the American people to the Constitution. \n\nAnd with an unwavering resolve that freedom will always triumph over tyranny. \n\nSix days ago, Russiaâ€™s Vladimir Putin sought to shake the foundations of the free world thinking he could make it bend to his menacing ways. But he badly miscalculated. \n\nHe thought he could roll into Ukraine and the world would roll over. Instead he met a wall of strength he never imagined. \n\nHe met the Ukrainian people. \n\nFrom President Zelenskyy to every Ukrainian, their fearlessness, their courage, their determination, inspires the world. \n\nGroups of citizens blocking tanks with their bodies. Everyone from students to retirees teachers turned soldiers defending their homeland.\n\nContent: And we wonâ€™t stop. \n\nWe have lost so much to COVID-19. Time with one another. And worst of all, so much loss of life. \n\nLetâ€™s use this moment to reset. Letâ€™s stop looking at COVID-19 as a partisan dividing line and see it for what it is: A God-awful disease.  \n\nLetâ€™s stop seeing each other as enemies, and start seeing each other for who we really are: Fellow Americans.  \n\nWe canâ€™t change how divided weâ€™ve been. But we can change how we move forwardâ€”on COVID-19 and other issues we must face together. \n\nI recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. \n\nThey were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. \n\nOfficer Mora was 27 years old. \n\nOfficer Rivera was 22. \n\nBoth Dominican Americans whoâ€™d grown up on the same streets they later chose to patrol as police officers. \n\nI spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves.\n\nContent: And a proud Ukrainian people, who have known 30 years  of independence, have repeatedly shown that they will not tolerate anyone who tries to take their country backwards.  \n\nTo all Americans, I will be honest with you, as Iâ€™ve always promised. A Russian dictator, invading a foreign country, has costs around the world. \n\nAnd Iâ€™m taking robust action to make sure the pain of our sanctions  is targeted at Russiaâ€™s economy. And I will use every tool at our disposal to protect American businesses and consumers. \n\nTonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  \n\nAmerica will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  \n\nThese steps will help blunt gas prices here at home. And I know the news about whatâ€™s happening can seem alarming. \n\nBut I want you to know that we are going to be okay.\n\nContent: More support for patients and families. \n\nTo get there, I call on Congress to fund ARPA-H, the Advanced Research Projects Agency for Health. \n\nItâ€™s based on DARPAâ€”the Defense Department project that led to the Internet, GPS, and so much more.  \n\nARPA-H will have a singular purposeâ€”to drive breakthroughs in cancer, Alzheimerâ€™s, diabetes, and more. \n\nA unity agenda for the nation. \n\nWe can do this. \n\nMy fellow Americansâ€”tonight , we have gathered in a sacred spaceâ€”the citadel of our democracy. \n\nIn this Capitol, generation after generation, Americans have debated great questions amid great strife, and have done great things. \n\nWe have fought for freedom, expanded liberty, defeated totalitarianism and terror. \n\nAnd built the strongest, freest, and most prosperous nation the world has ever known. \n\nNow is the hour. \n\nOur moment of responsibility. \n\nOur test of resolve and conscience, of history itself. \n\nIt is in this moment that our character is formed. Our purpose is found. Our future is forged. \n\nWell I know this nation.\n=========\nFINAL ANSWER: The president did not mention Michael Jackson.\n\nQUESTION: {question}\n=========\n{summaries}\n=========\nFINAL ANSWER:");const o=[r.SystemMessagePromptTemplate.fromTemplate("Given the following extracted parts of a long document and a question, create a final answer. \nIf you don't know the answer, just say that you don't know. Don't try to make up an answer.\n----------------\n{summaries}"),r.HumanMessagePromptTemplate.fromTemplate("{question}")],u=r.ChatPromptTemplate.fromMessages(o);t.COMBINE_PROMPT_SELECTOR=new a.ConditionalPromptSelector(t.COMBINE_PROMPT,[[a.isChatModel,u]])},39733:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QUESTION_PROMPT_SELECTOR=t.CHAT_QUESTION_PROMPT=t.DEFAULT_TEXT_QA_PROMPT=t.DEFAULT_TEXT_QA_PROMPT_TMPL=t.REFINE_PROMPT_SELECTOR=t.CHAT_REFINE_PROMPT=t.DEFAULT_REFINE_PROMPT=t.DEFAULT_REFINE_PROMPT_TMPL=void 0;const r=n(66749),a=n(97345);t.DEFAULT_REFINE_PROMPT_TMPL="The original question is as follows: {question}\nWe have provided an existing answer: {existing_answer}\nWe have the opportunity to refine the existing answer\n(only if needed) with some more context below.\n------------\n{context}\n------------\nGiven the new context, refine the original answer to better answer the question. \nIf the context isn't useful, return the original answer.",t.DEFAULT_REFINE_PROMPT=new r.PromptTemplate({inputVariables:["question","existing_answer","context"],template:t.DEFAULT_REFINE_PROMPT_TMPL});const i=[r.HumanMessagePromptTemplate.fromTemplate("{question}"),r.AIMessagePromptTemplate.fromTemplate("{existing_answer}"),r.HumanMessagePromptTemplate.fromTemplate("The original question is as follows: {question}\nWe have provided an existing answer: {existing_answer}\nWe have the opportunity to refine the existing answer\n(only if needed) with some more context below.\n------------\n{context}\n------------\nGiven the new context, refine the original answer to better answer the question. \nIf the context isn't useful, return the original answer.")];t.CHAT_REFINE_PROMPT=r.ChatPromptTemplate.fromMessages(i),t.REFINE_PROMPT_SELECTOR=new a.ConditionalPromptSelector(t.DEFAULT_REFINE_PROMPT,[[a.isChatModel,t.CHAT_REFINE_PROMPT]]),t.DEFAULT_TEXT_QA_PROMPT_TMPL="Context information is below. \n---------------------\n{context}\n---------------------\nGiven the context information and no prior knowledge, answer the question: {question}",t.DEFAULT_TEXT_QA_PROMPT=new r.PromptTemplate({inputVariables:["context","question"],template:t.DEFAULT_TEXT_QA_PROMPT_TMPL});const s=[r.SystemMessagePromptTemplate.fromTemplate("Context information is below. \n---------------------\n{context}\n---------------------\nGiven the context information and no prior knowledge, answer any questions"),r.HumanMessagePromptTemplate.fromTemplate("{question}")];t.CHAT_QUESTION_PROMPT=r.ChatPromptTemplate.fromMessages(s),t.QUESTION_PROMPT_SELECTOR=new a.ConditionalPromptSelector(t.DEFAULT_TEXT_QA_PROMPT,[[a.isChatModel,t.CHAT_QUESTION_PROMPT]])},33172:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QA_PROMPT_SELECTOR=t.DEFAULT_QA_PROMPT=void 0;const r=n(66749),a=n(97345);t.DEFAULT_QA_PROMPT=new r.PromptTemplate({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]});const i=[r.SystemMessagePromptTemplate.fromTemplate("Use the following pieces of context to answer the users question. \nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}"),r.HumanMessagePromptTemplate.fromTemplate("{question}")],s=r.ChatPromptTemplate.fromMessages(i);t.QA_PROMPT_SELECTOR=new a.ConditionalPromptSelector(t.DEFAULT_QA_PROMPT,[[a.isChatModel,s]])},93757:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetrievalQAChain=void 0;const r=n(86787),a=n(10830);class i extends r.BaseChain{static lc_name(){return"RetrievalQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"retriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.retriever=e.retriever,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key "${this.inputKey}" not found.`);const n=e[this.inputKey],r=await this.retriever.getRelevantDocuments(n,t?.getChild("retriever")),a={question:n,input_documents:r,...e},i=await this.combineDocumentsChain.call(a,t?.getChild("combine_documents"));return this.returnSourceDocuments?{...i,sourceDocuments:r}:i}_chainType(){return"retrieval_qa"}static async deserialize(e,t){throw new Error("Not implemented")}serialize(){throw new Error("Not implemented")}static fromLLM(e,t,n){const r=(0,a.loadQAStuffChain)(e,{prompt:n?.prompt});return new this({...n,retriever:t,combineDocumentsChain:r})}}t.RetrievalQAChain=i},5421:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LLMRouterChain=void 0;const r=n(20447),a=n(41059);class i extends a.RouterChain{constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain}get inputKeys(){return this.llmChain.inputKeys}async _call(e,t){return this.llmChain.predict(e,t?.getChild())}_chainType(){return"llm_router_chain"}static fromLLM(e,t,n){const a=new r.LLMChain({llm:e,prompt:t});return new i({...n,llmChain:a})}}t.LLMRouterChain=i},99422:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiPromptChain=void 0;const r=n(21614),a=n(66749),i=n(41059),s=n(94855),o=n(20447),u=n(5421),l=n(87025),c=n(92453),d=n(48347);class p extends i.MultiRouteChain{static fromPrompts(e,t,n,r,a,i){return p.fromLLMAndPrompts(e,{promptNames:t,promptDescriptions:n,promptTemplates:r,defaultChain:a,multiRouteChainOpts:i})}static fromLLMAndPrompts(e,{promptNames:t,promptDescriptions:n,promptTemplates:i,defaultChain:h,llmChainOpts:f,conversationChainOpts:m,multiRouteChainOpts:g}){const b=(0,c.zipEntries)(t,n).map((([e,t])=>`${e}: ${t}`)),y=r.z.object({destination:r.z.string().optional().describe('name of the question answering system to use or "DEFAULT"'),next_inputs:r.z.object({input:r.z.string().describe("a potentially modified version of the original input")}).describe("input to be fed to the next model")}),v=new d.RouterOutputParser(y),_=b.join("\n"),w=(0,a.interpolateFString)((0,s.STRUCTURED_MULTI_PROMPT_ROUTER_TEMPLATE)(v.getFormatInstructions({interpolationDepth:4})),{destinations:_}),P=new a.PromptTemplate({template:w,inputVariables:["input"],outputParser:v}),O=u.LLMRouterChain.fromLLM(e,P),A=(0,c.zipEntries)(t,i).reduce(((t,[n,r])=>{let i;if("object"==typeof r)i=r;else{if("string"!=typeof r)throw new Error("Invalid prompt template");i=new a.PromptTemplate({template:r,inputVariables:["input"]})}return t[n]=new o.LLMChain({...f,llm:e,prompt:i}),t}),{}),C=new l.ConversationChain({...m,llm:e,outputKey:"text"});return new p({...g,routerChain:O,destinationChains:A,defaultChain:h??C})}_chainType(){return"multi_prompt_chain"}}t.MultiPromptChain=p},94855:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STRUCTURED_MULTI_PROMPT_ROUTER_TEMPLATE=t.MULTI_PROMPT_ROUTER_TEMPLATE=void 0,t.MULTI_PROMPT_ROUTER_TEMPLATE='Given a raw text input to a language model, select the model prompt best suited for the input. You will be given the names of the available prompts and a description of what the prompt is best suited for. You may also revise the original input if you think that revising it will ultimately lead to a better response from the language model.\n\n<< FORMATTING >>\nReturn a markdown code snippet with a JSON object formatted to look like:\n```json\n{{{{\n    "destination": string \\ name of the prompt to use or "DEFAULT"\n    "next_inputs": string \\ a potentially modified version of the original input\n}}}}\n```\n\nREMEMBER: "destination" MUST be one of the candidate prompt names specified below OR it can be "DEFAULT" if the input is not well suited for any of the candidate prompts.\nREMEMBER: "next_inputs" can just be the original input if you don\'t think any modifications are needed.\n\n<< CANDIDATE PROMPTS >>\n{destinations}\n\n<< INPUT >>\n{{input}}\n\n<< OUTPUT >>\n',t.STRUCTURED_MULTI_PROMPT_ROUTER_TEMPLATE=e=>`Given a raw text input to a language model, select the model prompt best suited for the input. You will be given the names of the available prompts and a description of what the prompt is best suited for. You may also revise the original input if you think that revising it will ultimately lead to a better response from the language model.\n\n<< FORMATTING >>\n${e}\n\nREMEMBER: "destination" MUST be one of the candidate prompt names specified below OR it can be "DEFAULT" if the input is not well suited for any of the candidate prompts.\nREMEMBER: "next_inputs.input" can just be the original input if you don't think any modifications are needed.\n\n<< CANDIDATE PROMPTS >>\n{destinations}\n\n<< INPUT >>\n{{input}}\n\n<< OUTPUT >>\n`},98105:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STRUCTURED_MULTI_RETRIEVAL_ROUTER_TEMPLATE=t.MULTI_RETRIEVAL_ROUTER_TEMPLATE=void 0,t.MULTI_RETRIEVAL_ROUTER_TEMPLATE='Given a query to a question answering system, select the system best suited for the input. You will be given the names of the available systems and a description of what questions the system is best suited for. You may also revise the original input if you think that revising it will ultimately lead to a better response.\n\n<< FORMATTING >>\nReturn a markdown code snippet with a JSON object formatted to look like:\n```json\n{{{{\n    "destination": string \\ name of the question answering system to use or "DEFAULT"\n    "next_inputs": string \\ a potentially modified version of the original input\n}}}}\n```\n\nREMEMBER: "destination" MUST be one of the candidate prompt names specified below OR it can be "DEFAULT" if the input is not well suited for any of the candidate prompts.\nREMEMBER: "next_inputs" can just be the original input if you don\'t think any modifications are needed.\n\n<< CANDIDATE PROMPTS >>\n{destinations}\n\n<< INPUT >>\n{{input}}\n\n<< OUTPUT >>\n',t.STRUCTURED_MULTI_RETRIEVAL_ROUTER_TEMPLATE=e=>`Given a query to a question answering system, select the system best suited for the input. You will be given the names of the available systems and a description of what questions the system is best suited for. You may also revise the original input if you think that revising it will ultimately lead to a better response.\n\n<< FORMATTING >>\n${e}\n\nREMEMBER: "destination" MUST be one of the candidate prompt names specified below OR it can be "DEFAULT" if the input is not well suited for any of the candidate prompts.\nREMEMBER: "next_inputs.query" can just be the original input if you don't think any modifications are needed.\n\n<< CANDIDATE PROMPTS >>\n{destinations}\n\n<< INPUT >>\n{{input}}\n\n<< OUTPUT >>\n`},50789:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiRetrievalQAChain=void 0;const r=n(21614),a=n(66749),i=n(41059),s=n(5421),o=n(87025),u=n(98105),l=n(92453),c=n(93757),d=n(48347);class p extends i.MultiRouteChain{get outputKeys(){return["result"]}static fromRetrievers(e,t,n,r,a,i,s){return p.fromLLMAndRetrievers(e,{retrieverNames:t,retrieverDescriptions:n,retrievers:r,retrieverPrompts:a,defaults:i,multiRetrievalChainOpts:s})}static fromLLMAndRetrievers(e,{retrieverNames:t,retrieverDescriptions:n,retrievers:i,retrieverPrompts:h,defaults:f,multiRetrievalChainOpts:m,retrievalQAChainOpts:g}){const{defaultRetriever:b,defaultPrompt:y,defaultChain:v}=f??{};if(y&&!b)throw new Error("`default_retriever` must be specified if `default_prompt` is \nprovided. Received only `default_prompt`.");const _=(0,l.zipEntries)(t,n).map((([e,t])=>`${e}: ${t}`)),w=r.z.object({destination:r.z.string().optional().describe('name of the question answering system to use or "DEFAULT"'),next_inputs:r.z.object({query:r.z.string().describe("a potentially modified version of the original input")}).describe("input to be fed to the next model")}),P=new d.RouterOutputParser(w),O=_.join("\n"),A=(0,a.interpolateFString)((0,u.STRUCTURED_MULTI_RETRIEVAL_ROUTER_TEMPLATE)(P.getFormatInstructions({interpolationDepth:4})),{destinations:O}),C=new a.PromptTemplate({template:A,inputVariables:["input"],outputParser:P}),T=s.LLMRouterChain.fromLLM(e,C),I=h??i.map((()=>null)),E=(0,l.zipEntries)(t,i,I).reduce(((t,[n,r,a])=>{const i=g??{};return a&&(i.prompt=a),t[n]=c.RetrievalQAChain.fromLLM(e,r,i),t}),{});let x;if(v)x=v;else if(b)x=c.RetrievalQAChain.fromLLM(e,b,{...g,prompt:y});else{const t=o.DEFAULT_TEMPLATE.replace("input","query"),n=new a.PromptTemplate({template:t,inputVariables:["history","query"]});x=new o.ConversationChain({llm:e,prompt:n,outputKey:"result"})}return new p({...m,routerChain:T,destinationChains:E,defaultChain:x})}_chainType(){return"multi_retrieval_qa_chain"}}t.MultiRetrievalQAChain=p},41059:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiRouteChain=t.RouterChain=void 0;const r=n(86787);class a extends r.BaseChain{get outputKeys(){return["destination","next_inputs"]}async route(e,t){const n=await this.call(e,t);return{destination:n.destination,nextInputs:n.next_inputs}}}t.RouterChain=a;class i extends r.BaseChain{static lc_name(){return"MultiRouteChain"}constructor(e){super(e),Object.defineProperty(this,"routerChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destinationChains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"silentErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.routerChain=e.routerChain,this.destinationChains=e.destinationChains,this.defaultChain=e.defaultChain,this.silentErrors=e.silentErrors??this.silentErrors}get inputKeys(){return this.routerChain.inputKeys}get outputKeys(){return[]}async _call(e,t){const{destination:n,nextInputs:r}=await this.routerChain.route(e,t?.getChild());if(await(t?.handleText(`${n}: ${JSON.stringify(r)}`)),!n)return this.defaultChain.call(r,t?.getChild()).catch((e=>{throw new Error(`Error in default chain: ${e}`)}));if(n in this.destinationChains)return this.destinationChains[n].call(r,t?.getChild()).catch((e=>{throw new Error(`Error in ${n} chain: ${e}`)}));if(this.silentErrors)return this.defaultChain.call(r,t?.getChild()).catch((e=>{throw new Error(`Error in default chain: ${e}`)}));throw new Error(`Destination ${n} not found in destination chains with keys ${Object.keys(this.destinationChains)}`)}_chainType(){return"multi_route_chain"}}t.MultiRouteChain=i},92453:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zipEntries=void 0,t.zipEntries=function(...e){if(0===e.length)return[];const t=e[0].length;for(const n of e)if(n.length!==t)throw new Error("All input arrays must have the same length.");const n=[];for(let r=0;r<t;r+=1){const t=[];for(const n of e)t.push(n[r]);n.push(t)}return n}},49083:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleSequentialChain=t.SequentialChain=void 0;const r=n(86787),a=n(74322);function i(e){return Array.from(e).map((e=>`"${e}"`)).join(", ")}class s extends r.BaseChain{static lc_name(){return"SequentialChain"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw new Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){if(0===this.chains.length)throw new Error("Sequential chain must have at least one chain.");const e=this.memory?.memoryKeys??[],t=new Set(this.inputKeys),n=new Set(e),r=(0,a.intersection)(t,n);if(r.size>0)throw new Error(`The following keys: ${i(r)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);const s=(0,a.union)(t,n);for(const e of this.chains){let t=(0,a.difference)(new Set(e.inputKeys),s);if(e.memory&&(t=(0,a.difference)(t,new Set(e.memory.memoryKeys))),t.size>0)throw new Error(`Missing variables for chain "${e._chainType()}": ${i(t)}. Only got the following variables: ${i(s)}.`);const n=new Set(e.outputKeys),r=(0,a.intersection)(s,n);if(r.size>0)throw new Error(`The following output variables for chain "${e._chainType()}" are overlapping: ${i(r)}. This can lead to unexpected behaviour.`);for(const e of n)s.add(e)}if(0===this.outputVariables.length)if(this.returnAll){const e=(0,a.difference)(s,t);this.outputVariables=Array.from(e)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys;else{const e=(0,a.difference)(new Set(this.outputVariables),new Set(s));if(e.size>0)throw new Error(`The following output variables were expected to be in the final chain output but were not found: ${i(e)}.`)}}async _call(e,t){let n={};const r=e;let a=0;for(const e of this.chains){a+=1,n=await e.call(r,t?.getChild(`step_${a}`));for(const e of Object.keys(n))r[e]=n[e]}const i={};for(const e of this.outputVariables)i[e]=r[e];return i}_chainType(){return"sequential_chain"}static async deserialize(e){const t=[],n=e.input_variables,a=e.output_variables,i=e.chains;for(const e of i){const n=await r.BaseChain.deserialize(e);t.push(n)}return new s({chains:t,inputVariables:n,outputVariables:a})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}t.SequentialChain=s;class o extends r.BaseChain{static lc_name(){return"SimpleSequentialChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(const e of this.chains){if(1!==e.inputKeys.filter((t=>!e.memory?.memoryKeys.includes(t)??!0)).length)throw new Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(1!==e.outputKeys.length)throw new Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let n=e[this.inputKey],r=0;for(const a of this.chains)r+=1,n=(await a.call({[a.inputKeys[0]]:n,signal:e.signal},t?.getChild(`step_${r}`)))[a.outputKeys[0]],this.trimOutputs&&(n=n.trim()),await(t?.handleText(n));return{[this.outputKey]:n}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){const t=[],n=e.chains;for(const e of n){const n=await r.BaseChain.deserialize(e);t.push(n)}return new o({chains:t})}serialize(){const e=[];for(const t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}t.SimpleSequentialChain=o},39376:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadSummarizationChain=void 0;const r=n(20447),a=n(91197),i=n(64634),s=n(4559);t.loadSummarizationChain=(e,t={type:"map_reduce"})=>{const{verbose:n}=t;if("stuff"===t.type){const{prompt:s=i.DEFAULT_PROMPT}=t,o=new r.LLMChain({prompt:s,llm:e,verbose:n});return new a.StuffDocumentsChain({llmChain:o,documentVariableName:"text",verbose:n})}if("map_reduce"===t.type){const{combineMapPrompt:s=i.DEFAULT_PROMPT,combinePrompt:o=i.DEFAULT_PROMPT,combineLLM:u,returnIntermediateSteps:l}=t,c=new r.LLMChain({prompt:s,llm:e,verbose:n}),d=new r.LLMChain({prompt:o,llm:u??e,verbose:n}),p=new a.StuffDocumentsChain({llmChain:d,documentVariableName:"text",verbose:n});return new a.MapReduceDocumentsChain({llmChain:c,combineDocumentChain:p,documentVariableName:"text",returnIntermediateSteps:l,verbose:n})}if("refine"===t.type){const{refinePrompt:o=s.REFINE_PROMPT,refineLLM:u,questionPrompt:l=i.DEFAULT_PROMPT}=t,c=new r.LLMChain({prompt:l,llm:e,verbose:n}),d=new r.LLMChain({prompt:o,llm:u??e,verbose:n});return new a.RefineDocumentsChain({llmChain:c,refineLLMChain:d,documentVariableName:"text",verbose:n})}throw new Error(`Invalid _type: ${t.type}`)}},4559:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REFINE_PROMPT=void 0;const r=n(66749);t.REFINE_PROMPT=new r.PromptTemplate({template:'Your job is to produce a final summary\nWe have provided an existing summary up to a certain point: "{existing_answer}"\nWe have the opportunity to refine the existing summary\n(only if needed) with some more context below.\n------------\n"{text}"\n------------\n\nGiven the new context, refine the original summary\nIf the context isn\'t useful, return the original summary.\n\nREFINED SUMMARY:',inputVariables:["existing_answer","text"]})},64634:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PROMPT=void 0;const r=n(66749);t.DEFAULT_PROMPT=new r.PromptTemplate({template:'Write a concise summary of the following:\n\n\n"{text}"\n\n\nCONCISE SUMMARY:',inputVariables:["text"]})},67464:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransformChain=void 0;const r=n(86787);class a extends r.BaseChain{static lc_name(){return"TransformChain"}_chainType(){return"transform"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){super(e),Object.defineProperty(this,"transformFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.transformFunc=e.transform,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables}async _call(e,t){return this.transformFunc(e,t?.getChild("transform"))}}t.TransformChain=a},61167:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorDBQAChain=void 0;const r=n(86787),a=n(10830);class i extends r.BaseChain{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(e){super(e),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}async _call(e,t){if(!(this.inputKey in e))throw new Error(`Question key ${this.inputKey} not found.`);const n=e[this.inputKey],r=await this.vectorstore.similaritySearch(n,this.k,e.filter,t?.getChild("vectorstore")),a={question:n,input_documents:r},i=await this.combineDocumentsChain.call(a,t?.getChild("combine_documents"));return this.returnSourceDocuments?{...i,sourceDocuments:r}:i}_chainType(){return"vector_db_qa"}static async deserialize(e,t){if(!("vectorstore"in t))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:n}=t;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new i({combineDocumentsChain:await r.BaseChain.deserialize(e.combine_documents_chain),k:e.k,vectorstore:n})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,t,n){return new this({vectorstore:t,combineDocumentsChain:(0,a.loadQAStuffChain)(e),...n})}}t.VectorDBQAChain=i},38879:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromptLayerChatOpenAI=t.ChatOpenAI=void 0;const r=n(4627);Object.defineProperty(t,"ChatOpenAI",{enumerable:!0,get:function(){return r.ChatOpenAI}});const a=n(16836);n(66335);class i extends r.ChatOpenAI{constructor(e){super(e),Object.defineProperty(this,"promptLayerApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnPromptLayerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promptLayerApiKey=e?.promptLayerApiKey??("undefined"!=typeof process?process.env?.PROMPTLAYER_API_KEY:void 0),this.plTags=e?.plTags??[],this.returnPromptLayerId=e?.returnPromptLayerId??!1}async _generate(e,t,n){const i=Date.now();let s;s=Array.isArray(t)?{stop:t}:t?.timeout&&!t.signal?{...t,signal:AbortSignal.timeout(t.timeout)}:t??{};const o=await super._generate(e,s,n),u=Date.now(),l=(e,t)=>{const n={...this.invocationParams(),model:this.modelName};if(t?.stop&&Object.keys(n).includes("stop"))throw new Error("`stop` found in both the input and default params.");return e.map((e=>(e=>{let t;if("human"===e._getType())t={role:"user",content:e.content};else if("ai"===e._getType())t={role:"assistant",content:e.content};else if("function"===e._getType())t={role:"assistant",content:e.content};else if("system"===e._getType())t={role:"system",content:e.content};else{if("generic"!==e._getType())throw new Error(`Got unknown type ${e}`);t={role:e.role,content:e.content}}return t})(e)))};for(let t=0;t<o.generations.length;t+=1){const n=o.generations[t],c=l(e,s);let d;const p=[{content:n.text,role:(0,r.messageToOpenAIRole)(n.message)}],h=await(0,a.promptLayerTrackRequest)(this.caller,"langchain.PromptLayerChatOpenAI",{...this._identifyingParams(),messages:c,stream:!1},this.plTags,p,i,u,this.promptLayerApiKey);!0===this.returnPromptLayerId&&(!0===h.success&&(d=h.request_id),n.generationInfo&&"object"==typeof n.generationInfo||(n.generationInfo={}),n.generationInfo.promptLayerRequestId=d)}return o}}t.PromptLayerChatOpenAI=i},22434:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIEmbeddings=void 0,n(66335);var r=n(4627);Object.defineProperty(t,"OpenAIEmbeddings",{enumerable:!0,get:function(){return r.OpenAIEmbeddings}})},5547:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferMemory=void 0;const r=n(6500),a=n(15222);class i extends a.BaseChatMemory{constructor(e){super({chatHistory:e?.chatHistory,returnMessages:e?.returnMessages??!1,inputKey:e?.inputKey,outputKey:e?.outputKey}),Object.defineProperty(this,"humanPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"Human"}),Object.defineProperty(this,"aiPrefix",{enumerable:!0,configurable:!0,writable:!0,value:"AI"}),Object.defineProperty(this,"memoryKey",{enumerable:!0,configurable:!0,writable:!0,value:"history"}),this.humanPrefix=e?.humanPrefix??this.humanPrefix,this.aiPrefix=e?.aiPrefix??this.aiPrefix,this.memoryKey=e?.memoryKey??this.memoryKey}get memoryKeys(){return[this.memoryKey]}async loadMemoryVariables(e){const t=await this.chatHistory.getMessages();return this.returnMessages?{[this.memoryKey]:t}:{[this.memoryKey]:(0,r.getBufferString)(t,this.humanPrefix,this.aiPrefix)}}}t.BufferMemory=i},17772:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoOpOutputParser=void 0;const r=n(58618);class a extends r.BaseOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}t.NoOpOutputParser=a},18764:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonKeyOutputFunctionsParser=t.JsonOutputFunctionsParser=t.OutputFunctionsParser=void 0;const r=n(69920),a=n(58618),i=n(58618);class s extends a.BaseLLMOutputParser{static lc_name(){return"OutputFunctionsParser"}constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"argsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.argsOnly=e?.argsOnly??this.argsOnly}async parseResult(e){if("message"in e[0]){const t=e[0].message.additional_kwargs.function_call;if(!t)throw new Error(`No function_call in message ${JSON.stringify(e)}`);if(!t.arguments)throw new Error(`No arguments in function_call ${JSON.stringify(e)}`);return this.argsOnly?t.arguments:JSON.stringify(t)}throw new Error(`No message in generations ${JSON.stringify(e)}`)}}t.OutputFunctionsParser=s;class o extends a.BaseCumulativeTransformOutputParser{static lc_name(){return"JsonOutputFunctionsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.argsOnly=e?.argsOnly??this.argsOnly,this.outputParser=new s(e)}_diff(e,t){if(t)return(0,r.compare)(e??{},t)}async parsePartialResult(e){const t=e[0];if(!t.message)return;const{message:n}=t,r=n.additional_kwargs.function_call;return r?this.argsOnly?(0,i.parsePartialJson)(r.arguments):{...r,arguments:(0,i.parsePartialJson)(r.arguments)}:void 0}async parseResult(e){const t=await this.outputParser.parseResult(e);if(!t)throw new Error(`No result from "OutputFunctionsParser" ${JSON.stringify(e)}`);return this.parse(t)}async parse(e){const t=JSON.parse(e);return this.argsOnly||(t.arguments=JSON.parse(t.arguments)),t}getFormatInstructions(){return""}}t.JsonOutputFunctionsParser=o;class u extends a.BaseLLMOutputParser{static lc_name(){return"JsonKeyOutputFunctionsParser"}get lc_aliases(){return{attrName:"key_name"}}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_functions"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:new o}),Object.defineProperty(this,"attrName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.attrName=e.attrName}async parseResult(e){return(await this.outputParser.parseResult(e))[this.attrName]}}t.JsonKeyOutputFunctionsParser=u},48347:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RouterOutputParser=void 0;const r=n(58618),a=n(15677);class i extends a.JsonMarkdownStructuredOutputParser{constructor(e,t){super(e),Object.defineProperty(this,"defaultDestination",{enumerable:!0,configurable:!0,writable:!0,value:"DEFAULT"}),this.defaultDestination=t?.defaultDestination??this.defaultDestination}async parse(e){try{const t=await super.parse(e);return t.destination?.toLowerCase()===this.defaultDestination.toLowerCase()&&(t.destination=null),t}catch(t){throw new r.OutputParserException(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}t.RouterOutputParser=i},15677:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsymmetricStructuredOutputParser=t.JsonMarkdownStructuredOutputParser=t.StructuredOutputParser=void 0;const r=n(21614),a=n(39340),i=n(58618);class s extends i.BaseOutputParser{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(r.z.object(Object.fromEntries(Object.entries(e).map((([e,t])=>[e,r.z.string().describe(t)])))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.\n\n"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.\n\nFor example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}\nwould match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.\nThus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.\n\nYour output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!\n\nHere is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:\n\`\`\`json\n${JSON.stringify((0,a.zodToJsonSchema)(this.schema))}\n\`\`\`\n`}async parse(e){try{const t=e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim();return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new i.OutputParserException(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}t.StructuredOutputParser=s;class o extends s{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const t=e?.interpolationDepth??1;if(t<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:\n\`\`\`json\n${this._schemaToInstruction((0,a.zodToJsonSchema)(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}\n\`\`\``}_schemaToInstruction(e,t=2){const n=e;if("type"in n){let e,r=!1;if(Array.isArray(n.type)){const t=n.type.findIndex((e=>"null"===e));-1!==t&&(r=!0,n.type.splice(t,1)),e=n.type.join(" | ")}else e=n.type;if("object"===n.type&&n.properties){const e=n.description?` // ${n.description}`:"";return`{\n${Object.entries(n.properties).map((([e,r])=>{const a=n.required?.includes(e)?"":" (optional)";return`${" ".repeat(t)}"${e}": ${this._schemaToInstruction(r,t+2)}${a}`})).join("\n")}\n${" ".repeat(t-2)}}${e}`}if("array"===n.type&&n.items){const e=n.description?` // ${n.description}`:"";return`array[\n${" ".repeat(t)}${this._schemaToInstruction(n.items,t+2)}\n${" ".repeat(t-2)}] ${e}`}const a=r?" (nullable)":"";return`${e}${n.description?` // ${n.description}`:""}${a}`}if("anyOf"in n)return n.anyOf.map((e=>this._schemaToInstruction(e,t))).join(`\n${" ".repeat(t-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(r.z.object(Object.fromEntries(Object.entries(e).map((([e,t])=>[e,r.z.string().describe(t)])))))}}t.JsonMarkdownStructuredOutputParser=o;class u extends i.BaseOutputParser{constructor({inputSchema:e}){super(...arguments),Object.defineProperty(this,"structuredInputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.structuredInputParser=new o(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(t){throw new i.OutputParserException(`Failed to parse. Text: "${e}". Error: ${t}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}}t.AsymmetricStructuredOutputParser=u},72836:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExampleSelector=t.StringPromptValue=t.BasePromptTemplate=t.BaseStringPromptTemplate=void 0;var r=n(66749);Object.defineProperty(t,"BaseStringPromptTemplate",{enumerable:!0,get:function(){return r.BaseStringPromptTemplate}}),Object.defineProperty(t,"BasePromptTemplate",{enumerable:!0,get:function(){return r.BasePromptTemplate}});var a=n(96803);Object.defineProperty(t,"StringPromptValue",{enumerable:!0,get:function(){return a.StringPromptValue}});var i=n(97345);Object.defineProperty(t,"BaseExampleSelector",{enumerable:!0,get:function(){return i.BaseExampleSelector}})},49549:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPromptValue=t.ChatPromptTemplate=t.SystemMessagePromptTemplate=t.AIMessagePromptTemplate=t.HumanMessagePromptTemplate=t.ChatMessagePromptTemplate=t.BaseChatPromptTemplate=t.BaseMessageStringPromptTemplate=t.MessagesPlaceholder=t.BaseMessagePromptTemplate=void 0;var r=n(66749);Object.defineProperty(t,"BaseMessagePromptTemplate",{enumerable:!0,get:function(){return r.BaseMessagePromptTemplate}}),Object.defineProperty(t,"MessagesPlaceholder",{enumerable:!0,get:function(){return r.MessagesPlaceholder}}),Object.defineProperty(t,"BaseMessageStringPromptTemplate",{enumerable:!0,get:function(){return r.BaseMessageStringPromptTemplate}}),Object.defineProperty(t,"BaseChatPromptTemplate",{enumerable:!0,get:function(){return r.BaseChatPromptTemplate}}),Object.defineProperty(t,"ChatMessagePromptTemplate",{enumerable:!0,get:function(){return r.ChatMessagePromptTemplate}}),Object.defineProperty(t,"HumanMessagePromptTemplate",{enumerable:!0,get:function(){return r.HumanMessagePromptTemplate}}),Object.defineProperty(t,"AIMessagePromptTemplate",{enumerable:!0,get:function(){return r.AIMessagePromptTemplate}}),Object.defineProperty(t,"SystemMessagePromptTemplate",{enumerable:!0,get:function(){return r.SystemMessagePromptTemplate}}),Object.defineProperty(t,"ChatPromptTemplate",{enumerable:!0,get:function(){return r.ChatPromptTemplate}});var a=n(96803);Object.defineProperty(t,"ChatPromptValue",{enumerable:!0,get:function(){return a.ChatPromptValue}})},35738:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FewShotChatMessagePromptTemplate=t.FewShotPromptTemplate=void 0;var r=n(66749);Object.defineProperty(t,"FewShotPromptTemplate",{enumerable:!0,get:function(){return r.FewShotPromptTemplate}}),Object.defineProperty(t,"FewShotChatMessagePromptTemplate",{enumerable:!0,get:function(){return r.FewShotChatMessagePromptTemplate}})},33829:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelinePromptTemplate=t.checkValidTemplate=t.renderTemplate=t.parseTemplate=t.BaseChatPromptTemplate=t.MessagesPlaceholder=t.ChatMessagePromptTemplate=t.SystemMessagePromptTemplate=t.AIMessagePromptTemplate=t.HumanMessagePromptTemplate=t.ChatPromptTemplate=t.FewShotChatMessagePromptTemplate=t.FewShotPromptTemplate=t.SemanticSimilarityExampleSelector=t.LengthBasedExampleSelector=t.isLLM=t.isChatModel=t.ConditionalPromptSelector=t.BasePromptSelector=t.PromptTemplate=t.BaseExampleSelector=t.BaseStringPromptTemplate=t.StringPromptValue=t.BasePromptTemplate=void 0,n(66335);var r=n(72836);Object.defineProperty(t,"BasePromptTemplate",{enumerable:!0,get:function(){return r.BasePromptTemplate}}),Object.defineProperty(t,"StringPromptValue",{enumerable:!0,get:function(){return r.StringPromptValue}}),Object.defineProperty(t,"BaseStringPromptTemplate",{enumerable:!0,get:function(){return r.BaseStringPromptTemplate}}),Object.defineProperty(t,"BaseExampleSelector",{enumerable:!0,get:function(){return r.BaseExampleSelector}});var a=n(37741);Object.defineProperty(t,"PromptTemplate",{enumerable:!0,get:function(){return a.PromptTemplate}});var i=n(92318);Object.defineProperty(t,"BasePromptSelector",{enumerable:!0,get:function(){return i.BasePromptSelector}}),Object.defineProperty(t,"ConditionalPromptSelector",{enumerable:!0,get:function(){return i.ConditionalPromptSelector}}),Object.defineProperty(t,"isChatModel",{enumerable:!0,get:function(){return i.isChatModel}}),Object.defineProperty(t,"isLLM",{enumerable:!0,get:function(){return i.isLLM}});var s=n(63456);Object.defineProperty(t,"LengthBasedExampleSelector",{enumerable:!0,get:function(){return s.LengthBasedExampleSelector}});var o=n(61468);Object.defineProperty(t,"SemanticSimilarityExampleSelector",{enumerable:!0,get:function(){return o.SemanticSimilarityExampleSelector}});var u=n(35738);Object.defineProperty(t,"FewShotPromptTemplate",{enumerable:!0,get:function(){return u.FewShotPromptTemplate}}),Object.defineProperty(t,"FewShotChatMessagePromptTemplate",{enumerable:!0,get:function(){return u.FewShotChatMessagePromptTemplate}});var l=n(49549);Object.defineProperty(t,"ChatPromptTemplate",{enumerable:!0,get:function(){return l.ChatPromptTemplate}}),Object.defineProperty(t,"HumanMessagePromptTemplate",{enumerable:!0,get:function(){return l.HumanMessagePromptTemplate}}),Object.defineProperty(t,"AIMessagePromptTemplate",{enumerable:!0,get:function(){return l.AIMessagePromptTemplate}}),Object.defineProperty(t,"SystemMessagePromptTemplate",{enumerable:!0,get:function(){return l.SystemMessagePromptTemplate}}),Object.defineProperty(t,"ChatMessagePromptTemplate",{enumerable:!0,get:function(){return l.ChatMessagePromptTemplate}}),Object.defineProperty(t,"MessagesPlaceholder",{enumerable:!0,get:function(){return l.MessagesPlaceholder}}),Object.defineProperty(t,"BaseChatPromptTemplate",{enumerable:!0,get:function(){return l.BaseChatPromptTemplate}});var c=n(67829);Object.defineProperty(t,"parseTemplate",{enumerable:!0,get:function(){return c.parseTemplate}}),Object.defineProperty(t,"renderTemplate",{enumerable:!0,get:function(){return c.renderTemplate}}),Object.defineProperty(t,"checkValidTemplate",{enumerable:!0,get:function(){return c.checkValidTemplate}});var d=n(97965);Object.defineProperty(t,"PipelinePromptTemplate",{enumerable:!0,get:function(){return d.PipelinePromptTemplate}})},97965:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelinePromptTemplate=void 0;var r=n(66749);Object.defineProperty(t,"PipelinePromptTemplate",{enumerable:!0,get:function(){return r.PipelinePromptTemplate}})},37741:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromptTemplate=void 0;var r=n(66749);Object.defineProperty(t,"PromptTemplate",{enumerable:!0,get:function(){return r.PromptTemplate}})},63456:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LengthBasedExampleSelector=void 0;var r=n(97345);Object.defineProperty(t,"LengthBasedExampleSelector",{enumerable:!0,get:function(){return r.LengthBasedExampleSelector}})},61468:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(97345),t)},92318:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isChatModel=t.isLLM=t.ConditionalPromptSelector=t.BasePromptSelector=void 0;var r=n(97345);Object.defineProperty(t,"BasePromptSelector",{enumerable:!0,get:function(){return r.BasePromptSelector}}),Object.defineProperty(t,"ConditionalPromptSelector",{enumerable:!0,get:function(){return r.ConditionalPromptSelector}}),Object.defineProperty(t,"isLLM",{enumerable:!0,get:function(){return r.isLLM}}),Object.defineProperty(t,"isChatModel",{enumerable:!0,get:function(){return r.isChatModel}})},67829:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkValidTemplate=t.parseTemplate=t.renderTemplate=t.DEFAULT_PARSER_MAPPING=t.DEFAULT_FORMATTER_MAPPING=t.interpolateFString=t.parseFString=void 0;var r=n(66749);Object.defineProperty(t,"parseFString",{enumerable:!0,get:function(){return r.parseFString}}),Object.defineProperty(t,"interpolateFString",{enumerable:!0,get:function(){return r.interpolateFString}}),Object.defineProperty(t,"DEFAULT_FORMATTER_MAPPING",{enumerable:!0,get:function(){return r.DEFAULT_FORMATTER_MAPPING}}),Object.defineProperty(t,"DEFAULT_PARSER_MAPPING",{enumerable:!0,get:function(){return r.DEFAULT_PARSER_MAPPING}}),Object.defineProperty(t,"renderTemplate",{enumerable:!0,get:function(){return r.renderTemplate}}),Object.defineProperty(t,"parseTemplate",{enumerable:!0,get:function(){return r.parseTemplate}}),Object.defineProperty(t,"checkValidTemplate",{enumerable:!0,get:function(){return r.checkValidTemplate}})},68328:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(50138),t)},66335:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logVersion010MigrationWarning=void 0;const r=n(99947);t.logVersion010MigrationWarning=function({oldEntrypointName:e,newEntrypointName:t,newPackageName:n="@langchain/community"}){let a="";void 0===t?a=`/${e}`:""!==t&&(a=`/${t}`);let i=[`[WARNING]: Importing from "langchain/${e}" is deprecated.`,"",`Instead, please add the "${n}" package to your project with e.g.`,"",`    $ npm install ${n}`,"",`and import from "${n}${a}".`,"",'This will be mandatory after the next "langchain" minor version bump to 0.2.'].join("\n");"@langchain/core"===n&&(i=[`[WARNING]: Importing from "langchain/${e}" is deprecated.`,"",`Instead, please import from "${n}${a}".`,"",'This will be mandatory after the next "langchain" minor version bump to 0.2.'].join("\n")),"true"!==(0,r.getEnvironmentVariable)("LANGCHAIN_SUPPRESS_MIGRATION_WARNINGS")&&console.warn(i)}},99947:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironmentVariable=t.getRuntimeEnvironment=t.getEnv=t.isNode=t.isDeno=t.isJsDom=t.isWebWorker=t.isBrowser=void 0;var r=n(82331);Object.defineProperty(t,"isBrowser",{enumerable:!0,get:function(){return r.isBrowser}}),Object.defineProperty(t,"isWebWorker",{enumerable:!0,get:function(){return r.isWebWorker}}),Object.defineProperty(t,"isJsDom",{enumerable:!0,get:function(){return r.isJsDom}}),Object.defineProperty(t,"isDeno",{enumerable:!0,get:function(){return r.isDeno}}),Object.defineProperty(t,"isNode",{enumerable:!0,get:function(){return r.isNode}}),Object.defineProperty(t,"getEnv",{enumerable:!0,get:function(){return r.getEnv}}),Object.defineProperty(t,"getRuntimeEnvironment",{enumerable:!0,get:function(){return r.getRuntimeEnvironment}}),Object.defineProperty(t,"getEnvironmentVariable",{enumerable:!0,get:function(){return r.getEnvironmentVariable}})},71798:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAPISpec=void 0;const s=i(n(92715));class o{constructor(e){Object.defineProperty(this,"document",{enumerable:!0,configurable:!0,writable:!0,value:e})}get baseUrl(){return this.document.servers?this.document.servers[0].url:void 0}getPathsStrict(){if(!this.document.paths)throw new Error("No paths found in spec");return this.document.paths}getParametersStrict(){if(!this.document.components?.parameters)throw new Error("No parameters found in spec");return this.document.components.parameters}getSchemasStrict(){if(!this.document.components?.schemas)throw new Error("No schemas found in spec.");return this.document.components.schemas}getRequestBodiesStrict(){if(!this.document.components?.requestBodies)throw new Error("No request body found in spec.");return this.document.components.requestBodies}getPathStrict(e){const t=this.getPathsStrict()[e];if(void 0===t)throw new Error(`No path found for "${e}".`);return t}getReferencedParameter(e){const t=e.$ref.split("/"),n=t[t.length-1];if(void 0===this.getParametersStrict()[n])throw new Error(`No parameter found for "${n}".`);return this.getParametersStrict()[n]}getRootReferencedParameter(e){let t=this.getReferencedParameter(e);for(;void 0!==t.$ref;)t=this.getReferencedParameter(t);return t}getReferencedSchema(e){const t=e.$ref.split("/"),n=t[t.length-1],r=this.getSchemasStrict()[n];if(void 0===r)throw new Error(`No schema found for "${n}".`);return r}getSchema(e){return void 0!==e.$ref?this.getReferencedSchema(e):e}getRootReferencedSchema(e){let t=this.getReferencedSchema(e);for(;void 0!==t.$ref;)t=this.getReferencedSchema(t);return t}getReferencedRequestBody(e){const t=e.$ref.split("/"),n=t[t.length-1],r=this.getRequestBodiesStrict();if(void 0===r[n])throw new Error(`No request body found for "${n}"`);return r[n]}getRootReferencedRequestBody(e){let t=this.getReferencedRequestBody(e);for(;void 0!==t.$ref;)t=this.getReferencedRequestBody(t);return t}getMethodsForPath(e){const t=this.getPathStrict(e);return["get","put","post","delete","options","head","patch","trace"].filter((e=>void 0!==t[e]))}getParametersForPath(e){const t=this.getPathStrict(e);return void 0===t.parameters?[]:t.parameters.map((e=>void 0!==e.$ref?this.getRootReferencedParameter(e):e))}getOperation(e,t){const n=this.getPathStrict(e);if(void 0===n[t])throw new Error(`No ${t} method found for "path".`);return n[t]}getParametersForOperation(e){return void 0===e.parameters?[]:e.parameters.map((e=>void 0!==e.$ref?this.getRootReferencedParameter(e):e))}getRequestBodyForOperation(e){const{requestBody:t}=e;return void 0!==t?.$ref?this.getRootReferencedRequestBody(t):t}static getCleanedOperationId(e,t,n){let{operationId:r}=e;if(void 0===r){const e=t.replaceAll(/[^a-zA-Z0-9]/,"_");r=`${e.startsWith("/")?e.slice(1):e}_${n}`}return r.replaceAll("-","_").replaceAll(".","_").replaceAll("/","_")}static alertUnsupportedSpec(e){const t="This may result in degraded performance. Convert your OpenAPI spec to 3.1.0 for better support.",n=e.swagger,r=e.openapi;if(void 0!==r&&"3.1.0"!==r)console.warn(`Attempting to load an OpenAPI ${r} spec. ${t}`);else{if(void 0===n)throw new Error(`Attempting to load an unsupported spec:\n\n${JSON.stringify(e,null,2)}.`);console.warn(`Attempting to load a Swagger ${n} spec. ${t}`)}}static fromObject(e){return o.alertUnsupportedSpec(e),new o(e)}static fromString(e){let t;try{t=JSON.parse(e)}catch(n){t=s.load(e)}return o.fromObject(t)}static async fromURL(e){const t=await fetch(e),n=await t.text();return o.fromString(n)}}t.OpenAPISpec=o},16836:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promptLayerTrackRequest=void 0,t.promptLayerTrackRequest=async(e,t,n,r,a,i,s,o)=>(await e.call(fetch,"https://api.promptlayer.com/track-request",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({function_name:t,provider:"langchain",kwargs:n,tags:r,request_response:a,request_start_time:Math.floor(i/1e3),request_end_time:Math.floor(s/1e3),api_key:o})})).json()},74322:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.difference=t.union=t.intersection=void 0,t.intersection=function(e,t){const n=new Set;for(const r of t)e.has(r)&&n.add(r);return n},t.union=function(e,t){const n=new Set(e);for(const e of t)n.add(e);return n},t.difference=function(e,t){const n=new Set(e);for(const e of t)n.delete(e);return n}},43166:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryVectorStore=void 0;const r=n(31460),a=n(47539),i=n(10338);class s extends a.VectorStore{_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...n}={}){super(e,n),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??r.similarity.cosine}async addDocuments(e){const t=e.map((({pageContent:e})=>e));return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const n=e.map(((e,n)=>({content:t[n].pageContent,embedding:e,metadata:t[n].metadata})));this.memoryVectors=this.memoryVectors.concat(n)}async similaritySearchVectorWithScore(e,t,n){const r=this.memoryVectors.filter((e=>{if(!n)return!0;const t=new i.Document({metadata:e.metadata,pageContent:e.content});return n(t)}));return r.map(((t,n)=>({similarity:this.similarity(e,t.embedding),index:n}))).sort(((e,t)=>e.similarity>t.similarity?-1:0)).slice(0,t).map((e=>[new i.Document({metadata:r[e.index].metadata,pageContent:r[e.index].content}),e.similarity]))}static async fromTexts(e,t,n,r){const a=[];for(let n=0;n<e.length;n+=1){const r=Array.isArray(t)?t[n]:t,s=new i.Document({pageContent:e[n],metadata:r});a.push(s)}return s.fromDocuments(a,n,r)}static async fromDocuments(e,t,n){const r=new this(t,n);return await r.addDocuments(e),r}static async fromExistingIndex(e,t){return new this(e,t)}}t.MemoryVectorStore=s},46115:function(e,t,n){e.exports=n(22434)},40910:function(e,t,n){e.exports=n(33829)},75485:function(e,t,n){e.exports=n(68328)},57459:function(e,t,n){e.exports=n(43166)},71188:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=t.DEFAULT_BATCH_SIZE_LIMIT_BYTES=t.Queue=void 0;const s=i(n(22831)),o=n(69737),u=n(18291),l=n(51400),c=n(33635),d=n(57831);async function p(e){const t=await(0,l.getRuntimeEnvironment)(),n=(0,l.getLangChainEnvVarsMetadata)();return e.map((e=>{const r=e.extra??{},a=r.metadata;return e.extra={...r,runtime:{...t,...r?.runtime},metadata:{...n,...n.revision_id||e.revision_id?{revision_id:e.revision_id??n.revision_id}:{},...a}},e}))}const h=async(e,t)=>{const n=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${n}`)};function f(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const m=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise((e=>setTimeout(e,t))),!0}return!1};class g{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise((t=>{this.items.push([e,t])}))}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const t=[];for(;t.length<e&&this.items.length;){const e=this.items.shift();if(!e)break;t.push(e)}return[t.map((e=>e[0])),()=>t.forEach((e=>e[1]()))]}}t.Queue=g,t.DEFAULT_BATCH_SIZE_LIMIT_BYTES=20971520;class b{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new g}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=b.getDefaultClientConfig();this.tracingSampleRate=(()=>{const e=(0,l.getEnvironmentVariable)("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t})(),this.apiUrl=f(e.apiUrl??t.apiUrl)??"",this.apiKey=f(e.apiKey??t.apiKey),this.webUrl=f(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new o.AsyncCaller(e.callerOptions??{}),this.batchIngestCaller=new o.AsyncCaller({...e.callerOptions??{},onFailedResponseHook:m}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=(0,l.getEnvironmentVariable)("LANGCHAIN_API_KEY");return{apiUrl:(0,l.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===(0,l.getEnvironmentVariable)("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===(0,l.getEnvironmentVariable)("LANGCHAIN_HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(e=>{const t=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t})()?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={"User-Agent":`langsmith-js/${c.__version__}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=t?.toString()??"",r=`${this.apiUrl}${e}?${n}`,a=await this.caller.call(fetch,r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);return a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let n=Number(t.get("offset"))||0;const r=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(r));const a=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);const s=await i.json();if(0===s.length)break;if(yield s,s.length<r)break;n+=s.length}}async*_getCursorPaginatedList(e,t=null,n="POST",r="runs"){const a=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)}),i=await t.json();if(!i)break;if(!i[r])break;yield i[r];const s=i.cursors;if(!s)break;if(!s.next)break;a.cursor=s.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const n of e)this.sampledPostUuids.has(n.id)&&(t.push(n),this.sampledPostUuids.delete(n.id));return t}{const t=[];for(const n of e)Math.random()<this.tracingSampleRate&&(t.push(n),this.sampledPostUuids.add(n.id));return t}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length)return void t();try{await this.batchIngestRuns({runCreates:e.filter((e=>"create"===e.action)).map((e=>e.item)),runUpdates:e.filter((e=>"update"===e.action)).map((e=>e.item))})}finally{t()}}}async processRunOperation(e,t){const n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const r=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout((()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)}),n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),r}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const r=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order)return void this.processRunOperation({action:"create",item:r}).catch(console.error);const a=await p([r]),i=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(a[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await h(i,"create run")}async batchIngestRuns({runCreates:e,runUpdates:n}){if(void 0===e&&void 0===n)return;let r=e?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[],a=n?.map((e=>this.prepareRunCreateOrUpdateInputs(e)))??[];if(r.length>0&&a.length>0){const e=r.reduce(((e,t)=>t.id?(e[t.id]=t,e):e),{}),t=[];for(const n of a)void 0!==n.id&&e[n.id]?e[n.id]={...e[n.id],...n}:t.push(n);r=Object.values(e),a=t}const i={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!i.post.length&&!i.patch.length)return;if(r=await p(r),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const e of i.post)await this.createRun(e);for(const e of i.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}const s=this.serverInfo?.batch_ingest_config?.size_limit_bytes??t.DEFAULT_BATCH_SIZE_LIMIT_BYTES,o={post:[],patch:[]};let u=0;for(const e of["post","patch"]){const t=e,n=i[t].reverse();let r=n.pop();for(;void 0!==r;){const e=JSON.stringify(r);u>0&&u+e.length>s&&(await this._postBatchIngestRuns(JSON.stringify(o)),u=0,o.post=[],o.patch=[]),u+=e.length,o[t].push(r),r=n.pop()}}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(o))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await h(n,"batch create run")}async updateRun(e,t){(0,d.assertUuid)(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order)return void 0!==t.end_time&&void 0===n.parent_run_id?void await this.processRunOperation({action:"update",item:n},!0):void this.processRunOperation({action:"update",item:n}).catch(console.error);const r={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await h(a,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){(0,d.assertUuid)(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(void 0!==t){let e;e=t.session_id?t.session_id:n?.projectName?(await this.readProject({projectName:n?.projectName})).id:n?.projectId?n?.projectId:(await this.readProject({projectName:(0,l.getEnvironmentVariable)("LANGCHAIN_PROJECT")||"default"})).id;const r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.listRuns({id:e.child_run_ids})),n={},r={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in n||(n[e.parent_run_id]=[]),n[e.parent_run_id].push(e),r[e.id]=e}e.child_runs=n[e.id]||[];for(const t in n)t!==e.id&&(r[t].child_runs=n[t]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:r,traceId:a,referenceExampleId:i,startTime:s,executionOrder:o,isRoot:u,runType:l,error:c,id:d,query:p,filter:h,traceFilter:f,treeFilter:m,limit:g,select:b}=e;let y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){const e=Array.isArray(n)?n:[n],t=await Promise.all(e.map((e=>this.readProject({projectName:e}).then((e=>e.id)))));y.push(...t)}const v={session:y.length?y:null,run_type:l,reference_example:i,query:p,filter:h,trace_filter:f,tree_filter:m,execution_order:o,parent_run:r,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:a,select:b||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:u};for await(const e of this._getCursorPaginatedList("/runs/query",v))yield*e}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||s.v4()};(0,d.assertUuid)(e);const r=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();if(null===a||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){(0,d.assertUuid)(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await h(t,"unshare run")}async readRunSharedLink(e){(0,d.assertUuid)(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(null!==n&&"share_token"in n)return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)n.append("id",e);(0,d.assertUuid)(e);const r=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),(0,d.assertUuid)(e);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};(0,d.assertUuid)(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){(0,d.assertUuid)(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await h(t,"unshare dataset")}async readSharedDataset(e){(0,d.assertUuid)(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:r=!1,projectExtra:a=null,referenceDatasetId:i=null}){const s=r?"?upsert=true":"",o=`${this.apiUrl}/sessions${s}`,u=a||{};n&&(u.metadata=n);const l={name:e,extra:u,description:t};null!==i&&(l.reference_dataset_id=i);const c=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await c.json();if(!c.ok)throw new Error(`Failed to create session ${e}: ${c.status} ${c.statusText}`);return d}async updateProject(e,{name:t=null,description:n=null,metadata:r=null,projectExtra:a=null,endTime:i=null}){const s=`${this.apiUrl}/sessions/${e}`;let o=a;r&&(o={...o||{},metadata:r});const u={name:t,extra:o,description:n,end_time:i?new Date(i).toISOString():null},l=await this.caller.call(fetch,s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),c=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return c}async hasProject({projectId:e,projectName:t}){let n="/sessions";const r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)(0,d.assertUuid)(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");r.append("name",t)}const a=await this.caller.call(fetch,`${this.apiUrl}${n}?${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await a.json();return!!a.ok&&(!Array.isArray(e)||e.length>0)}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let r="/sessions";const a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)(0,d.assertUuid)(e),r+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");a.append("name",t)}void 0!==n&&a.append("include_stats",n.toString());const i=await this._get(r,a);let s;if(Array.isArray(i)){if(0===i.length)throw new Error(`Project[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:r,referenceDatasetName:a,referenceFree:i}={}){const s=new URLSearchParams;if(void 0!==e)for(const t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==n&&s.append("name_contains",n),void 0!==r)s.append("reference_dataset",r);else if(void 0!==a){const e=await this.readDataset({datasetName:a});s.append("reference_dataset",e.id)}void 0!==i&&s.append("reference_free",i.toString());for await(const e of this._getPaginated("/sessions",s))yield*e}async deleteProject({projectId:e,projectName:t}){let n;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");n=void 0===e?(await this.readProject({projectName:t})).id:e,(0,d.assertUuid)(n);const r=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await h(r,`delete session ${n} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:r,description:a,dataType:i,name:s}){const o=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),n.forEach((e=>{u.append("input_keys",e)})),r.forEach((e=>{u.append("output_keys",e)})),a&&u.append("description",a),i&&u.append("data_type",i),s&&u.append("name",s);const l=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok){const e=await l.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:n}={}){const r={name:e,description:t};n&&(r.data_type=n);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok){const t=await a.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${a.status} ${a.statusText}`)}return await a.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const r=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)(0,d.assertUuid)(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");r.append("name",t)}const a=await this._get(n,r);let i;if(Array.isArray(a)){if(0===a.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:r}){let a=e;if(void 0===a&&void 0===t)throw new Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:"string"==typeof n?n:n.toISOString(),to_version:"string"==typeof r?r:r.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const n=await this._getResponse(`/datasets/${e}/openai_ft`);return(await n.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:r,datasetNameContains:a}={}){const i=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==n)for(const e of n)i.append("id",e);void 0!==r&&i.append("name",r),void 0!==a&&i.append("name_contains",a);for await(const e of this._getPaginated("/datasets",i))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",r=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(r=(await this.readDataset({datasetName:t})).id),void 0===r)throw new Error("Must provide datasetName or datasetId");(0,d.assertUuid)(r),n+=`/${r}`;const a=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to delete ${n}: ${a.status} ${a.statusText}`);await a.json()}async createExample(e,t,{datasetId:n,datasetName:r,createdAt:a,exampleId:i,metadata:s}){let o=n;if(void 0===o&&void 0===r)throw new Error("Must provide either datasetName or datasetId");if(void 0!==o&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");void 0===o&&(o=(await this.readDataset({datasetName:r})).id);const u=a||new Date,l={dataset_id:o,inputs:e,outputs:t,created_at:u?.toISOString(),id:i,metadata:s},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async createExamples(e){const{inputs:t,outputs:n,metadata:r,sourceRunIds:a,exampleIds:i,datasetId:s,datasetName:o}=e;let u=s;if(void 0===u&&void 0===o)throw new Error("Must provide either datasetName or datasetId");if(void 0!==u&&void 0!==o)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===u){const e=await this.readDataset({datasetName:o});u=e.id}const l=t.map(((e,t)=>({dataset_id:u,inputs:e,outputs:n?n[t]:void 0,metadata:r?r[t]:void 0,id:i?i[t]:void 0,source_run_id:a?a[t]:void 0}))),c=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok)throw new Error(`Failed to create examples: ${c.status} ${c.statusText}`);return await c.json()}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const r=e.map((e=>(0,u.isLangChainMessage)(e)?(0,u.convertLangChainMessageToExample)(e):e)),a=(0,u.isLangChainMessage)(t)?(0,u.convertLangChainMessageToExample)(t):t;return this.createExample({input:r},{output:a},n)}async readExample(e){(0,d.assertUuid)(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:r,inlineS3Urls:a}={}){let i;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)i=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");i=(await this.readDataset({datasetName:t})).id}const s=new URLSearchParams({dataset:i}),o=r?"string"==typeof r?r:r?.toISOString():void 0;o&&s.append("as_of",o);const u=a??!0;if(s.append("inline_s3_urls",u.toString()),void 0!==n)for(const e of n)s.append("id",e);for await(const e of this._getPaginated("/examples",s))yield*e}async deleteExample(e){(0,d.assertUuid)(e);const t=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,t){(0,d.assertUuid)(e);const n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:r,referenceExample:a}={loadChildRuns:!1}){let i;if("string"==typeof e)i=await this.readRun(e,{loadChildRuns:r});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);i=e}null!==i.reference_example_id&&void 0!==i.reference_example_id&&(a=await this.readExample(i.reference_example_id));const s=await t.evaluateRun(i,a);let o=n??{};s.evaluatorInfo&&(o={...o,...s.evaluatorInfo});const u=s.targetRunId??i.id;return await this.createFeedback(u,s.key,{score:s?.score,value:s?.value,comment:s?.comment,correction:s?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:s?.sourceRunId})}async createFeedback(e,t,{score:n,value:r,correction:a,comment:i,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:c,feedbackConfig:p,projectId:f}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const m={type:u??"api",metadata:o??{}};void 0===l||void 0===m?.metadata||m.metadata.__run||(m.metadata.__run={run_id:l}),void 0!==m?.metadata&&void 0!==m.metadata.__run?.run_id&&(0,d.assertUuid)(m.metadata.__run.run_id);const g={id:c??s.v4(),run_id:e,key:t,score:n,value:r,correction:a,comment:i,feedback_source:m,feedbackConfig:p,session_id:f},b=`${this.apiUrl}/feedback`,y=await this.caller.call(fetch,b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await h(y,"create feedback"),g}async updateFeedback(e,{score:t,value:n,correction:r,comment:a}){const i={};null!=t&&(i.score=t),null!=n&&(i.value=n),null!=r&&(i.correction=r),null!=a&&(i.comment=a),(0,d.assertUuid)(e);const s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await h(s,"update feedback")}async readFeedback(e){(0,d.assertUuid)(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){(0,d.assertUuid)(e);const t=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const r=new URLSearchParams;if(e&&r.append("run",e.join(",")),t)for(const e of t)r.append("key",e);if(n)for(const e of n)r.append("source",e);for await(const e of this._getPaginated("/feedback",r))yield*e}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:r}={}){const a={run_id:e,feedback_key:t,feedback_config:r};n?"string"==typeof n?a.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(a.expires_in=n):a.expires_in={hours:3};const i=await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async*listPresignedFeedbackTokens(e){(0,d.assertUuid)(e);const t=new URLSearchParams({run_id:e});for await(const e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return t="results"in e?e.results:[e],t}async logEvaluationFeedback(e,t,n){const r=this._selectEvalResults(e);for(const e of r){let r=n||{};e.evaluatorInfo&&(r={...e.evaluatorInfo,...r});let a=null;e.targetRunId?a=e.targetRunId:t&&(a=t.id),await this.createFeedback(a,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:r,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"})}return r}}t.Client=b},33635:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.__version__=t.RunTree=t.Client=void 0;var r=n(71188);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return r.Client}});var a=n(1626);Object.defineProperty(t,"RunTree",{enumerable:!0,get:function(){return a.RunTree}}),t.__version__="0.1.22"},1626:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.isRunnableConfigLike=t.isRunTree=t.RunTree=t.convertToDottedOrderFormat=void 0;const s=i(n(22831)),o=n(51400),u=n(71188),l={};function c(e,t){return`${new Date(e).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+t}t.convertToDottedOrderFormat=c;class d{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=d.getDefaultConfig(),{metadata:n,...r}=e,a=r.client??new u.Client,i={...n,...r?.extra?.metadata};if(r.extra={...r.extra,metadata:i},Object.assign(this,{...t,...r,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),!this.dotted_order){const e=c(this.start_time,this.id);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}static fromRunnableConfig(e,t){const n=e?.callbacks;let r,a;if(n){const e=n?.getParentRunId?.()??"",t=n?.handlers?.find((e=>"langchain_tracer"==e?.name));r=t?.getRun?.(e),a=t?.projectName}const i=[...new Set((r?.tags??[]).concat(e?.tags??[]))],s={...r?.extra?.metadata,...e?.metadata};return new d({name:t?.name??"<lambda>",parent_run:r,tags:i,extra:{metadata:s},project_name:a})}static getDefaultConfig(){return{id:s.v4(),run_type:"chain",project_name:(0,o.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,o.getEnvironmentVariable)("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:(0,o.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,o.getEnvironmentVariable)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}createChild(e){const t=new d({...e,parent_run:this,project_name:this.project_name,client:this.client});return this.child_runs.push(t),t}async end(e,t,n=Date.now()){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n}async _convertToCreate(e,t=!0){const n=e.extra??{};n.runtime||(n.runtime={});const r=await(0,o.getRuntimeEnvironment)();for(const[e,t]of Object.entries(r))n.runtime[e]||(n.runtime[e]=t);let a,i;return t?(i=e.parent_run?.id,a=[]):(a=await Promise.all(e.child_runs.map((e=>this._convertToCreate(e,t)))),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){const t=await this._convertToCreate(this,!0);if(await this.client.createRun(t),!e){l[n="Posting with excludeChildRuns=false is deprecated and will be removed in a future version."]||(console.warn(n),l[n]=!0);for(const e of this.child_runs)await e.postRun(!1)}var n}async patchRun(){const e={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}}function p(e){return Array.isArray(e)&&e.some((e=>"string"==typeof e.name&&"langchain_tracer"===e.name))}t.RunTree=d,t.isRunTree=function(e){return void 0!==e&&"function"==typeof e.createChild&&"function"==typeof e.postRun},t.isRunnableConfigLike=function(e){return void 0!==e&&"object"==typeof e.callbacks&&(p(e.callbacks?.handlers)||p(e.callbacks))}},57831:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.assertUuid=void 0;const s=i(n(22831));t.assertUuid=function(e){if(!s.validate(e))throw new Error(`Invalid UUID: ${e}`)}},69737:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCaller=void 0;const a=r(n(24116)),i=r(n(73290)),s=[400,401,403,404,405,406,407,408],o=[409];t.AsyncCaller=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in i.default?this.queue=new i.default.default({concurrency:this.maxConcurrency}):this.queue=new i.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add((()=>(0,a.default)((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,r=t?.status;if(r){if(s.includes(+r))throw e;if(o.includes(+r))return;n&&await n(t)}},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},51400:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShas=t.setEnvironmentVariable=t.getEnvironmentVariable=t.getEnvironmentVariables=t.getLangChainEnvVarsMetadata=t.getLangChainEnvVars=t.getRuntimeEnvironment=t.getEnv=t.isNode=t.isDeno=t.isJsDom=t.isWebWorker=t.isBrowser=void 0;const r=n(33635);let a,i,s;function o(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,n])=>(e[t]=String(n),e)),{}):void 0}catch(e){return}}function u(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function l(){if(void 0!==s)return s;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const n of e){const e=u(n);void 0!==e&&(t[n]=e)}return s=t,t}t.isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,t.isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,t.isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),t.isDeno=()=>"undefined"!=typeof Deno,t.isNode=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!(0,t.isDeno)(),t.getEnv=()=>a||(a=(0,t.isBrowser)()?"browser":(0,t.isNode)()?"node":(0,t.isWebWorker)()?"webworker":(0,t.isJsDom)()?"jsdom":(0,t.isDeno)()?"deno":"other",a),t.getRuntimeEnvironment=async function(){if(void 0===i){const e=(0,t.getEnv)(),n=l();i={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:r.__version__,...n}}return i},t.getLangChainEnvVars=function(){const e=o()||{},t={};for(const[n,r]of Object.entries(e))n.startsWith("LANGCHAIN_")&&"string"==typeof r&&(t[n]=r);for(const e in t)if((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&"string"==typeof t[e]){const n=t[e];t[e]=n.slice(0,2)+"*".repeat(n.length-4)+n.slice(-2)}return t},t.getLangChainEnvVarsMetadata=function(){const e=o()||{},t={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,a]of Object.entries(e))!r.startsWith("LANGCHAIN_")||"string"!=typeof a||n.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=a:t[r]=a);return t},t.getEnvironmentVariables=o,t.getEnvironmentVariable=u,t.setEnvironmentVariable=function(e,t){"undefined"!=typeof process&&(process.env[e]=t)},t.getShas=l},18291:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertLangChainMessageToExample=t.isLangChainMessage=void 0,t.isLangChainMessage=function(e){return"function"==typeof e?._getType},t.convertLangChainMessageToExample=function(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}},21210:function(e,t,n){e.exports=n(33635)},24356:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultipartBody=void 0;class n{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}t.MultipartBody=n},78978:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(70331),t)},12212:function(e,t,n){const r=n(83085),a=n(78978);r.kind||r.setShims(a.getRuntime(),{auto:!0});for(const e of Object.keys(r))Object.defineProperty(t,e,{get(){return r[e]}})},83085:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setShims=t.isFsReadStream=t.fileFromPath=t.getDefaultAgent=t.getMultipartRequestOptions=t.ReadableStream=t.File=t.Blob=t.FormData=t.Headers=t.Response=t.Request=t.fetch=t.kind=t.auto=void 0,t.auto=!1,t.kind=void 0,t.fetch=void 0,t.Request=void 0,t.Response=void 0,t.Headers=void 0,t.FormData=void 0,t.Blob=void 0,t.File=void 0,t.ReadableStream=void 0,t.getMultipartRequestOptions=void 0,t.getDefaultAgent=void 0,t.fileFromPath=void 0,t.isFsReadStream=void 0,t.setShims=function(e,n={auto:!1}){if(t.auto)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(t.kind)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${t.kind}'\``);t.auto=n.auto,t.kind=e.kind,t.fetch=e.fetch,t.Request=e.Request,t.Response=e.Response,t.Headers=e.Headers,t.FormData=e.FormData,t.Blob=e.Blob,t.File=e.File,t.ReadableStream=e.ReadableStream,t.getMultipartRequestOptions=e.getMultipartRequestOptions,t.getDefaultAgent=e.getDefaultAgent,t.fileFromPath=e.fileFromPath,t.isFsReadStream=e.isFsReadStream}},70331:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRuntime=void 0;const r=n(24356);t.getRuntime=function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,a,i,s;try{n=fetch,a=Request,i=Response,s=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:a,Response:i,Headers:s,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new r.MultipartBody(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}},88757:function(e,t,n){"use strict";var r,a=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.isObj=t.toBase64=t.getRequiredHeader=t.isHeadersProtocol=t.isRunningInBrowser=t.debug=t.hasOwn=t.isEmptyObj=t.maybeCoerceBoolean=t.maybeCoerceFloat=t.maybeCoerceInteger=t.coerceBoolean=t.coerceFloat=t.coerceInteger=t.readEnv=t.ensurePresent=t.castToError=t.sleep=t.safeJSON=t.isRequestOptions=t.createResponseHeaders=t.PagePromise=t.AbstractPage=t.APIClient=t.APIPromise=t.createForm=t.multipartFormRequestOptions=t.maybeMultipartFormRequestOptions=void 0;const s=n(35392),o=n(6716),u=n(89526),l=n(12212),c=n(64042);var d=n(64042);async function p(e){const{response:t}=e;if(e.options.stream)return I("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):o.Stream.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n?.includes("application/json")||n?.includes("application/vnd.api+json")){const e=await t.json();return I("response",t.status,t.url,t.headers,e),e}const r=await t.text();return I("response",t.status,t.url,t.headers,r),r}Object.defineProperty(t,"maybeMultipartFormRequestOptions",{enumerable:!0,get:function(){return d.maybeMultipartFormRequestOptions}}),Object.defineProperty(t,"multipartFormRequestOptions",{enumerable:!0,get:function(){return d.multipartFormRequestOptions}}),Object.defineProperty(t,"createForm",{enumerable:!0,get:function(){return d.createForm}});class h extends Promise{constructor(e,t=p){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new h(this.responsePromise,(async t=>e(await this.parseResponse(t))))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}t.APIPromise=h,t.APIClient=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:a}){this.baseURL=e,this.maxRetries=O("maxRetries",t),this.timeout=O("timeout",n),this.httpAgent=r,this.fetch=a??l.fetch}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),..._(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${E()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((n=>({method:e,path:t,...n}))))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}return null}buildRequest(e){const{method:t,path:n,query:r,headers:a={}}=e,i=(0,c.isMultipartBody)(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,s=this.calculateContentLength(i),o=this.buildURL(n,r);"timeout"in e&&O("timeout",e.timeout);const u=e.timeout??this.timeout,d=e.httpAgent??this.httpAgent??(0,l.getDefaultAgent)(o),p=u+1e3;return"number"==typeof d?.options?.timeout&&p>(d.options.timeout??0)&&(d.options.timeout=p),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey),{req:{method:t,...i&&{body:i},headers:this.buildHeaders({options:e,headers:a,contentLength:s}),...d&&{agent:d},signal:e.signal??null},url:o,timeout:u}}buildHeaders({options:e,headers:t,contentLength:n}){const r={};return n&&(r["content-length"]=n),T(r,this.defaultHeaders(e)),T(r,t),(0,c.isMultipartBody)(e.body)&&"node"!==l.kind&&delete r["content-type"],this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return u.APIError.generate(e,t,n,r)}request(e,t=null){return new h(this.makeRequest(e,t))}async makeRequest(e,n){const r=await e;null==n&&(n=r.maxRetries??this.maxRetries),await this.prepareOptions(r);const{req:a,url:i,timeout:s}=this.buildRequest(r);if(await this.prepareRequest(a,{url:i,options:r}),I("request",i,r,a.headers),r.signal?.aborted)throw new u.APIUserAbortError;const o=new AbortController,l=await this.fetchWithTimeout(i,a,s,o).catch(t.castToError);if(l instanceof Error){if(r.signal?.aborted)throw new u.APIUserAbortError;if(n)return this.retryRequest(r,n);if("AbortError"===l.name)throw new u.APIConnectionTimeoutError;throw new u.APIConnectionError({cause:l})}const c=(0,t.createResponseHeaders)(l.headers);if(!l.ok){if(n&&this.shouldRetry(l))return I(`response (error; retrying, ${n} attempts remaining)`,l.status,i,c),this.retryRequest(r,n,c);const e=await l.text().catch((e=>(0,t.castToError)(e).message)),a=(0,t.safeJSON)(e),s=a?void 0:e;throw I(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,c,s),this.makeStatusError(l.status,a,s,c)}return{response:l,options:r,controller:o}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new m(this,n,e)}buildURL(e,t){const n=P(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return A(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new u.OpenAIError(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",(()=>r.abort()));const s=setTimeout((()=>r.abort()),n);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...i}).finally((()=>{clearTimeout(s)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,n,r){let a;const i=r?.["retry-after-ms"];if(i){const e=parseFloat(i);Number.isNaN(e)||(a=e)}const s=r?.["retry-after"];if(s&&!a){const e=parseFloat(s);a=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(a&&0<=a&&a<6e4)){const t=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(n,t)}return await(0,t.sleep)(a),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${s.VERSION}`}};class f{constructor(e,t,n,i){r.set(this,void 0),a(this,r,e,"f"),this.options=i,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new u.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await i(this,r,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(r=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}t.AbstractPage=f;class m extends h{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await p(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}t.PagePromise=m,t.createResponseHeaders=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}});const g={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0};t.isRequestOptions=e=>"object"==typeof e&&null!==e&&!A(e)&&Object.keys(e).every((e=>C(g,e)));const b=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",y=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let v;const _=()=>v??(v=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s.VERSION,"X-Stainless-OS":y(Deno.build.os),"X-Stainless-Arch":b(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s.VERSION,"X-Stainless-OS":y(process.platform),"X-Stainless-Arch":b(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":s.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})());t.safeJSON=e=>{try{return JSON.parse(e)}catch(e){return}};const w=new RegExp("^(?:[a-z]+:)?//","i"),P=e=>w.test(e);t.sleep=e=>new Promise((t=>setTimeout(t,e)));const O=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new u.OpenAIError(`${e} must be an integer`);if(t<0)throw new u.OpenAIError(`${e} must be a positive integer`);return t};function A(e){if(!e)return!0;for(const t in e)return!1;return!0}function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function T(e,t){for(const n in t){if(!C(t,n))continue;const r=n.toLowerCase();if(!r)continue;const a=t[n];null===a?delete e[r]:void 0!==a&&(e[r]=a)}}function I(e,...t){"undefined"!=typeof process&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}t.castToError=e=>e instanceof Error?e:new Error(e),t.ensurePresent=e=>{if(null==e)throw new u.OpenAIError(`Expected a value to be given but received ${e} instead.`);return e},t.readEnv=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0,t.coerceInteger=e=>{if("number"==typeof e)return Math.round(e);if("string"==typeof e)return parseInt(e,10);throw new u.OpenAIError(`Could not coerce ${e} (type: ${typeof e}) into a number`)},t.coerceFloat=e=>{if("number"==typeof e)return e;if("string"==typeof e)return parseFloat(e);throw new u.OpenAIError(`Could not coerce ${e} (type: ${typeof e}) into a number`)},t.coerceBoolean=e=>"boolean"==typeof e?e:"string"==typeof e?"true"===e:Boolean(e),t.maybeCoerceInteger=e=>{if(void 0!==e)return(0,t.coerceInteger)(e)},t.maybeCoerceFloat=e=>{if(void 0!==e)return(0,t.coerceFloat)(e)},t.maybeCoerceBoolean=e=>{if(void 0!==e)return(0,t.coerceBoolean)(e)},t.isEmptyObj=A,t.hasOwn=C,t.debug=I;const E=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));t.isRunningInBrowser=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,t.isHeadersProtocol=e=>"function"==typeof e?.get,t.getRequiredHeader=(e,n)=>{const r=n.toLowerCase();if((0,t.isHeadersProtocol)(e)){const t=n[0]?.toUpperCase()+n.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const a of[n,r,n.toUpperCase(),t]){const t=e.get(a);if(t)return t}}for(const[t,a]of Object.entries(e))if(t.toLowerCase()===r)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${n} header, using the first entry.`),a[0]):a;throw new Error(`Could not find ${n} header`)},t.toBase64=e=>{if(!e)return"";if("undefined"!=typeof Buffer)return Buffer.from(e).toString("base64");if("undefined"!=typeof btoa)return btoa(e);throw new u.OpenAIError("Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined")},t.isObj=function(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}},89526:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalServerError=t.RateLimitError=t.UnprocessableEntityError=t.ConflictError=t.NotFoundError=t.PermissionDeniedError=t.AuthenticationError=t.BadRequestError=t.APIConnectionTimeoutError=t.APIConnectionError=t.APIUserAbortError=t.APIError=t.OpenAIError=void 0;const r=n(88757);class a extends Error{}t.OpenAIError=a;class i extends a{constructor(e,t,n,r){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"];const a=t;this.error=a,this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,a){if(!e)return new s({cause:(0,r.castToError)(t)});const m=t?.error;return 400===e?new o(e,m,n,a):401===e?new u(e,m,n,a):403===e?new l(e,m,n,a):404===e?new c(e,m,n,a):409===e?new d(e,m,n,a):422===e?new p(e,m,n,a):429===e?new h(e,m,n,a):e>=500?new f(e,m,n,a):new i(e,m,n,a)}}t.APIError=i,t.APIUserAbortError=class extends i{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}};class s extends i{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}t.APIConnectionError=s,t.APIConnectionTimeoutError=class extends s{constructor({message:e}={}){super({message:e??"Request timed out."})}};class o extends i{constructor(){super(...arguments),this.status=400}}t.BadRequestError=o;class u extends i{constructor(){super(...arguments),this.status=401}}t.AuthenticationError=u;class l extends i{constructor(){super(...arguments),this.status=403}}t.PermissionDeniedError=l;class c extends i{constructor(){super(...arguments),this.status=404}}t.NotFoundError=c;class d extends i{constructor(){super(...arguments),this.status=409}}t.ConflictError=d;class p extends i{constructor(){super(...arguments),this.status=422}}t.UnprocessableEntityError=p;class h extends i{constructor(){super(...arguments),this.status=429}}t.RateLimitError=h;class f extends i{}t.InternalServerError=f},32012:function(e,t,n){"use strict";var r,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.fileFromPath=t.toFile=t.UnprocessableEntityError=t.PermissionDeniedError=t.InternalServerError=t.AuthenticationError=t.BadRequestError=t.RateLimitError=t.ConflictError=t.NotFoundError=t.APIUserAbortError=t.APIConnectionTimeoutError=t.APIConnectionError=t.APIError=t.OpenAIError=t.OpenAI=void 0;const o=s(n(88757)),u=s(n(89526)),l=s(n(64042)),c=s(n(2510)),d=s(n(33946));class p extends o.APIClient{constructor({baseURL:e=o.readEnv("OPENAI_BASE_URL"),apiKey:t=o.readEnv("OPENAI_API_KEY"),organization:n=o.readEnv("OPENAI_ORG_ID")??null,project:r=o.readEnv("OPENAI_PROJECT_ID")??null,...a}={}){if(void 0===t)throw new u.OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&o.isRunningInBrowser())throw new u.OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new d.Completions(this),this.chat=new d.Chat(this),this.embeddings=new d.Embeddings(this),this.files=new d.Files(this),this.images=new d.Images(this),this.audio=new d.Audio(this),this.moderations=new d.Moderations(this),this.models=new d.Models(this),this.fineTuning=new d.FineTuning(this),this.beta=new d.Beta(this),this.batches=new d.Batches(this),this._options=i,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}t.OpenAI=p,r=p,p.OpenAI=r,p.OpenAIError=u.OpenAIError,p.APIError=u.APIError,p.APIConnectionError=u.APIConnectionError,p.APIConnectionTimeoutError=u.APIConnectionTimeoutError,p.APIUserAbortError=u.APIUserAbortError,p.NotFoundError=u.NotFoundError,p.ConflictError=u.ConflictError,p.RateLimitError=u.RateLimitError,p.BadRequestError=u.BadRequestError,p.AuthenticationError=u.AuthenticationError,p.InternalServerError=u.InternalServerError,p.PermissionDeniedError=u.PermissionDeniedError,p.UnprocessableEntityError=u.UnprocessableEntityError,p.toFile=l.toFile,p.fileFromPath=l.fileFromPath,t.OpenAIError=u.OpenAIError,t.APIError=u.APIError,t.APIConnectionError=u.APIConnectionError,t.APIConnectionTimeoutError=u.APIConnectionTimeoutError,t.APIUserAbortError=u.APIUserAbortError,t.NotFoundError=u.NotFoundError,t.ConflictError=u.ConflictError,t.RateLimitError=u.RateLimitError,t.BadRequestError=u.BadRequestError,t.AuthenticationError=u.AuthenticationError,t.InternalServerError=u.InternalServerError,t.PermissionDeniedError=u.PermissionDeniedError,t.UnprocessableEntityError=u.UnprocessableEntityError,t.toFile=l.toFile,t.fileFromPath=l.fileFromPath,function(e){e.Page=c.Page,e.CursorPage=c.CursorPage,e.Completions=d.Completions,e.Chat=d.Chat,e.Embeddings=d.Embeddings,e.Files=d.Files,e.FileObjectsPage=d.FileObjectsPage,e.Images=d.Images,e.Audio=d.Audio,e.Moderations=d.Moderations,e.Models=d.Models,e.ModelsPage=d.ModelsPage,e.FineTuning=d.FineTuning,e.Beta=d.Beta,e.Batches=d.Batches,e.BatchesPage=d.BatchesPage}(p=t.OpenAI||(t.OpenAI={})),(t=e.exports=p).default=p},72124:function(e,t,n){"use strict";var r,a,i,s,o,u,l,c,d,p,h,f,m=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractAssistantStreamRunner=void 0;const b=n(89526);t.AbstractAssistantStreamRunner=class{constructor(){this.controller=new AbortController,r.set(this,void 0),a.set(this,(()=>{})),i.set(this,(()=>{})),s.set(this,void 0),o.set(this,(()=>{})),u.set(this,(()=>{})),l.set(this,{}),c.set(this,!1),d.set(this,!1),p.set(this,!1),h.set(this,!1),f.set(this,(e=>{if(m(this,d,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new b.APIUserAbortError),e instanceof b.APIUserAbortError)return m(this,p,!0,"f"),this._emit("abort",e);if(e instanceof b.OpenAIError)return this._emit("error",e);if(e instanceof Error){const t=new b.OpenAIError(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new b.OpenAIError(String(e)))})),m(this,r,new Promise(((e,t)=>{m(this,a,e,"f"),m(this,i,t,"f")})),"f"),m(this,s,new Promise(((e,t)=>{m(this,o,e,"f"),m(this,u,t,"f")})),"f"),g(this,r,"f").catch((()=>{})),g(this,s,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emit("end")}),g(this,f,"f"))}),0)}_addRun(e){return e}_connected(){this.ended||(g(this,a,"f").call(this),this._emit("connect"))}get ended(){return g(this,c,"f")}get errored(){return g(this,d,"f")}get aborted(){return g(this,p,"f")}abort(){this.controller.abort()}on(e,t){return(g(this,l,"f")[e]||(g(this,l,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=g(this,l,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(g(this,l,"f")[e]||(g(this,l,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{m(this,h,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){m(this,h,!0,"f"),await g(this,s,"f")}_emit(e,...t){if(g(this,c,"f"))return;"end"===e&&(m(this,c,!0,"f"),g(this,o,"f").call(this));const n=g(this,l,"f")[e];if(n&&(g(this,l,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return g(this,h,"f")||n?.length||Promise.reject(e),g(this,i,"f").call(this,e),g(this,u,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];g(this,h,"f")||n?.length||Promise.reject(e),g(this,i,"f").call(this,e),g(this,u,"f").call(this,e),this._emit("end")}}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,a){return await this._createToolAssistantStream(n,e,t,r,a)}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const a=await e.createAndRun({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(a)}async _createToolAssistantStream(e,t,n,r,a){const i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort())));const s=await e.submitToolOutputs(t,n,{...r,stream:!1},{...a,signal:this.controller.signal});return this._connected(),this._addRun(s)}async _createAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const i=await e.create(t,{...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(i)}},r=new WeakMap,a=new WeakMap,i=new WeakMap,s=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,h=new WeakMap,f=new WeakMap},71118:function(e,t,n){"use strict";var r,a,i,s,o,u,l,c,d,p,h,f,m,g,b,y,v,_,w,P,O=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},A=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractChatCompletionRunner=void 0;const C=n(89526),T=n(64691),I=n(46289),E=10;t.AbstractChatCompletionRunner=class{constructor(){r.add(this),this.controller=new AbortController,a.set(this,void 0),i.set(this,(()=>{})),s.set(this,(()=>{})),o.set(this,void 0),u.set(this,(()=>{})),l.set(this,(()=>{})),c.set(this,{}),this._chatCompletions=[],this.messages=[],d.set(this,!1),p.set(this,!1),h.set(this,!1),f.set(this,!1),_.set(this,(e=>{if(O(this,p,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new C.APIUserAbortError),e instanceof C.APIUserAbortError)return O(this,h,!0,"f"),this._emit("abort",e);if(e instanceof C.OpenAIError)return this._emit("error",e);if(e instanceof Error){const t=new C.OpenAIError(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C.OpenAIError(String(e)))})),O(this,a,new Promise(((e,t)=>{O(this,i,e,"f"),O(this,s,t,"f")})),"f"),O(this,o,new Promise(((e,t)=>{O(this,u,e,"f"),O(this,l,t,"f")})),"f"),A(this,a,"f").catch((()=>{})),A(this,o,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),A(this,_,"f"))}),0)}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),((0,I.isFunctionMessage)(e)||(0,I.isToolMessage)(e))&&e.content)this._emit("functionCallResult",e.content);else if((0,I.isAssistantMessage)(e)&&e.function_call)this._emit("functionCall",e.function_call);else if((0,I.isAssistantMessage)(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}_connected(){this.ended||(A(this,i,"f").call(this),this._emit("connect"))}get ended(){return A(this,d,"f")}get errored(){return A(this,p,"f")}get aborted(){return A(this,h,"f")}abort(){this.controller.abort()}on(e,t){return(A(this,c,"f")[e]||(A(this,c,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=A(this,c,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(A(this,c,"f")[e]||(A(this,c,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{O(this,f,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){O(this,f,!0,"f"),await A(this,o,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new C.OpenAIError("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),A(this,r,"m",m).call(this)}async finalMessage(){return await this.done(),A(this,r,"m",g).call(this)}async finalFunctionCall(){return await this.done(),A(this,r,"m",b).call(this)}async finalFunctionCallResult(){return await this.done(),A(this,r,"m",y).call(this)}async totalUsage(){return await this.done(),A(this,r,"m",v).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(A(this,d,"f"))return;"end"===e&&(O(this,d,!0,"f"),A(this,u,"f").call(this));const n=A(this,c,"f")[e];if(n&&(A(this,c,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return A(this,f,"f")||n?.length||Promise.reject(e),A(this,s,"f").call(this,e),A(this,l,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];A(this,f,"f")||n?.length||Promise.reject(e),A(this,s,"f").call(this,e),A(this,l,"f").call(this,e),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=A(this,r,"m",g).call(this);t&&this._emit("finalMessage",t);const n=A(this,r,"m",m).call(this);n&&this._emit("finalContent",n);const a=A(this,r,"m",b).call(this);a&&this._emit("finalFunctionCall",a);const i=A(this,r,"m",y).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",A(this,r,"m",v).call(this))}async _createChatCompletion(e,t,n){const a=n?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort()))),A(this,r,"m",w).call(this,t);const i=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const a="function",{function_call:i="auto",stream:s,...o}=t,u="string"!=typeof i&&i?.name,{maxChatCompletions:l=E}=n||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const d=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new C.OpenAIError("missing message in ChatCompletion response");if(!s.function_call)return;const{name:l,arguments:p}=s.function_call,h=c[l];if(!h){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${d.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:a,name:l,content:e});continue}if(u&&u!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:a,name:l,content:e});continue}let f;try{f=(0,T.isRunnableFunctionWithParse)(h)?await h.parse(p):p}catch(e){this._addMessage({role:a,name:l,content:e instanceof Error?e.message:String(e)});continue}const m=await h.function(f,this),g=A(this,r,"m",P).call(this,m);if(this._addMessage({role:a,name:l,content:g}),u)return}}async _runTools(e,t,n){const a="tool",{tool_choice:i="auto",stream:s,...o}=t,u="string"!=typeof i&&i?.function?.name,{maxChatCompletions:l=E}=n||{},c={};for(const e of t.tools)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);const d="tools"in t?t.tools.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new C.OpenAIError("missing message in ChatCompletion response");if(!s.tool_calls)return;for(const e of s.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:i}=e.function,s=c[n];if(!s){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${d.map((e=>JSON.stringify(e.function.name))).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:t,content:e});continue}if(u&&u!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:a,tool_call_id:t,content:e});continue}let o;try{o=(0,T.isRunnableFunctionWithParse)(s)?await s.parse(i):i}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:a,tool_call_id:t,content:n});continue}const l=await s.function(o,this),p=A(this,r,"m",P).call(this,l);if(this._addMessage({role:a,tool_call_id:t,content:p}),u)return}}}},a=new WeakMap,i=new WeakMap,s=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,h=new WeakMap,f=new WeakMap,_=new WeakMap,r=new WeakSet,m=function(){return A(this,r,"m",g).call(this).content??null},g=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if((0,I.isAssistantMessage)(t))return{...t,content:t.content??null}}throw new C.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},b=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,I.isAssistantMessage)(t)&&t?.function_call)return t.function_call;if((0,I.isAssistantMessage)(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},y=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,I.isFunctionMessage)(t)&&null!=t.content)return t.content;if((0,I.isToolMessage)(t)&&null!=t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},v=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},w=function(e){if(null!=e.n&&e.n>1)throw new C.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},P=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)}},18868:function(e,t,n){"use strict";var r,a,i,s,o,u,l,c,d,p,h,f,m,g,b,y,v,_,w,P,O,A,C=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),T=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),I=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&C(t,e,n);return T(t,e),t},E=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},x=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AssistantStream=void 0;const j=I(n(88757)),M=n(72124),k=n(6716),S=n(89526);class R extends M.AbstractAssistantStreamRunner{constructor(){super(...arguments),r.add(this),a.set(this,[]),i.set(this,{}),s.set(this,{}),o.set(this,void 0),u.set(this,void 0),l.set(this,void 0),c.set(this,void 0),d.set(this,void 0),p.set(this,void 0),h.set(this,void 0),f.set(this,void 0),m.set(this,void 0)}[(a=new WeakMap,i=new WeakMap,s=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,r=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new R;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const a=k.Stream.fromReadableStream(e,this.controller);for await(const e of a)E(this,r,"m",g).call(this,e);if(a.controller.signal?.aborted)throw new S.APIUserAbortError;return this._addRun(E(this,r,"m",b).call(this))}toReadableStream(){return new k.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,a){const i=new R;return i._run((()=>i._runToolAssistantStream(e,t,n,r,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}}))),i}async _createToolAssistantStream(e,t,n,a,i){const s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort())));const o={...a,stream:!0},u=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(const e of u)E(this,r,"m",g).call(this,e);if(u.controller.signal?.aborted)throw new S.APIUserAbortError;return this._addRun(E(this,r,"m",b).call(this))}static createThreadAssistantStream(e,t,n){const r=new R;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const a=new R;return a._run((()=>a._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),a}currentEvent(){return E(this,h,"f")}currentRun(){return E(this,f,"f")}currentMessageSnapshot(){return E(this,o,"f")}currentRunStepSnapshot(){return E(this,m,"f")}async finalRunSteps(){return await this.done(),Object.values(E(this,i,"f"))}async finalMessages(){return await this.done(),Object.values(E(this,s,"f"))}async finalRun(){if(await this.done(),!E(this,u,"f"))throw Error("Final run was not received.");return E(this,u,"f")}async _createThreadAssistantStream(e,t,n){const a=n?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const i={...t,stream:!0},s=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(const e of s)E(this,r,"m",g).call(this,e);if(s.controller.signal?.aborted)throw new S.APIUserAbortError;return this._addRun(E(this,r,"m",b).call(this))}async _createAssistantStream(e,t,n,a){const i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort())));const s={...n,stream:!0},o=await e.create(t,s,{...a,signal:this.controller.signal});this._connected();for await(const e of o)E(this,r,"m",g).call(this,e);if(o.controller.signal?.aborted)throw new S.APIUserAbortError;return this._addRun(E(this,r,"m",b).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else if(j.isObj(t)&&j.isObj(r))t=this.accumulateDelta(t,r);else{if(!Array.isArray(t)||!Array.isArray(r))throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`);if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}}e[n]=t}else e[n]=r;else e[n]=r}return e}}t.AssistantStream=R,g=function(e){if(!this.ended)switch(x(this,h,e,"f"),E(this,r,"m",_).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":E(this,r,"m",A).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":E(this,r,"m",v).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":E(this,r,"m",y).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},b=function(){if(this.ended)throw new S.OpenAIError("stream has ended, this shouldn't happen");if(!E(this,u,"f"))throw Error("Final run has not been received");return E(this,u,"f")},y=function(e){const[t,n]=E(this,r,"m",P).call(this,e,E(this,o,"f"));x(this,o,t,"f"),E(this,s,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=E(this,l,"f")){if(E(this,c,"f"))switch(E(this,c,"f").type){case"text":this._emit("textDone",E(this,c,"f").text,E(this,o,"f"));break;case"image_file":this._emit("imageFileDone",E(this,c,"f").image_file,E(this,o,"f"))}x(this,l,n.index,"f")}x(this,c,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==E(this,l,"f")){const t=e.data.content[E(this,l,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,E(this,o,"f"));break;case"text":this._emit("textDone",t.text,E(this,o,"f"))}}E(this,o,"f")&&this._emit("messageDone",e.data),x(this,o,void 0,"f")}},v=function(e){const t=E(this,r,"m",w).call(this,e);switch(x(this,m,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==E(this,d,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(E(this,p,"f")&&this._emit("toolCallDone",E(this,p,"f")),x(this,d,e.index,"f"),x(this,p,t.step_details.tool_calls[e.index],"f"),E(this,p,"f")&&this._emit("toolCallCreated",E(this,p,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":x(this,m,void 0,"f"),"tool_calls"==e.data.step_details.type&&E(this,p,"f")&&(this._emit("toolCallDone",E(this,p,"f")),x(this,p,void 0,"f")),this._emit("runStepDone",e.data,t)}},_=function(e){E(this,a,"f").push(e),this._emit("event",e)},w=function(e){switch(e.event){case"thread.run.step.created":return E(this,i,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=E(this,i,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=R.accumulateDelta(t,n.delta);E(this,i,"f")[e.data.id]=r}return E(this,i,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":E(this,i,"f")[e.data.id]=e.data}if(E(this,i,"f")[e.data.id])return E(this,i,"f")[e.data.id];throw new Error("No snapshot available")},P=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(const e of a.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=E(this,r,"m",O).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},O=function(e,t){return R.accumulateDelta(t,e)},A=function(e){switch(x(this,f,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":x(this,u,e.data,"f"),E(this,p,"f")&&(this._emit("toolCallDone",E(this,p,"f")),x(this,p,void 0,"f"))}}},44648:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCompletionRunner=void 0;const r=n(71118),a=n(46289);class i extends r.AbstractChatCompletionRunner{static runFunctions(e,t,n){const r=new i,a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,a))),r}static runTools(e,t,n){const r=new i,a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,a))),r}_addMessage(e){super._addMessage(e),(0,a.isAssistantMessage)(e)&&e.content&&this._emit("content",e.content)}}t.ChatCompletionRunner=i},95126:function(e,t,n){"use strict";var r,a,i,s,o,u,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},c=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCompletionStream=void 0;const d=n(89526),p=n(71118),h=n(6716);class f extends p.AbstractChatCompletionRunner{constructor(){super(...arguments),r.add(this),a.set(this,void 0)}get currentChatCompletionSnapshot(){return l(this,a,"f")}static fromReadableStream(e){const t=new f;return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new f;return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){const a=n?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort()))),l(this,r,"m",i).call(this);const u=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of u)l(this,r,"m",s).call(this,e);if(u.controller.signal?.aborted)throw new d.APIUserAbortError;return this._addChatCompletion(l(this,r,"m",o).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),l(this,r,"m",i).call(this),this._connected();const a=h.Stream.fromReadableStream(e,this.controller);let u;for await(const e of a)u&&u!==e.id&&this._addChatCompletion(l(this,r,"m",o).call(this)),l(this,r,"m",s).call(this,e),u=e.id;if(a.controller.signal?.aborted)throw new d.APIUserAbortError;return this._addChatCompletion(l(this,r,"m",o).call(this))}[(a=new WeakMap,r=new WeakSet,i=function(){this.ended||c(this,a,void 0,"f")},s=function(e){if(this.ended)return;const t=l(this,r,"m",u).call(this,e);this._emit("chunk",e,t);const n=e.choices[0]?.delta?.content,a=t.choices[0]?.message;null!=n&&"assistant"===a?.role&&a?.content&&this._emit("content",n,a.content)},o=function(){if(this.ended)throw new d.OpenAIError("stream has ended, this shouldn't happen");const e=l(this,a,"f");if(!e)throw new d.OpenAIError("request ended without sending any chunks");return c(this,a,void 0,"f"),function(e){const{id:t,choices:n,created:r,model:a,system_fingerprint:i,...s}=e;return{...s,id:t,choices:n.map((({message:t,finish_reason:n,index:r,logprobs:a,...i})=>{if(!n)throw new d.OpenAIError(`missing finish_reason for choice ${r}`);const{content:s=null,function_call:o,tool_calls:u,...l}=t,c=t.role;if(!c)throw new d.OpenAIError(`missing role for choice ${r}`);if(o){const{arguments:e,name:t}=o;if(null==e)throw new d.OpenAIError(`missing function_call.arguments for choice ${r}`);if(!t)throw new d.OpenAIError(`missing function_call.name for choice ${r}`);return{...i,message:{content:s,function_call:{arguments:e,name:t},role:c},finish_reason:n,index:r,logprobs:a}}return u?{...i,index:r,finish_reason:n,logprobs:a,message:{...l,role:c,content:s,tool_calls:u.map(((t,n)=>{const{function:a,type:i,id:s,...o}=t,{arguments:u,name:l,...c}=a||{};if(null==s)throw new d.OpenAIError(`missing choices[${r}].tool_calls[${n}].id\n${m(e)}`);if(null==i)throw new d.OpenAIError(`missing choices[${r}].tool_calls[${n}].type\n${m(e)}`);if(null==l)throw new d.OpenAIError(`missing choices[${r}].tool_calls[${n}].function.name\n${m(e)}`);if(null==u)throw new d.OpenAIError(`missing choices[${r}].tool_calls[${n}].function.arguments\n${m(e)}`);return{...o,id:s,type:i,function:{...c,name:l,arguments:u}}}))}}:{...i,message:{...l,content:s,role:c},finish_reason:n,index:r,logprobs:a}})),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}}}(e)},u=function(e){var t,n,r;let i=l(this,a,"f");const{choices:s,...o}=e;i?Object.assign(i,o):i=c(this,a,{...o,choices:[]},"f");for(const{delta:a,finish_reason:s,index:o,logprobs:u=null,...l}of e.choices){let e=i.choices[o];if(e||(e=i.choices[o]={finish_reason:s,index:o,message:{},logprobs:u,...l}),u)if(e.logprobs){const{content:n,...r}=u;Object.assign(e.logprobs,r),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n))}else e.logprobs=Object.assign({},u);if(s&&(e.finish_reason=s),Object.assign(e,l),!a)continue;const{content:c,function_call:d,role:p,tool_calls:h,...f}=a;if(Object.assign(e.message,f),c&&(e.message.content=(e.message.content||"")+c),p&&(e.message.role=p),d&&(e.message.function_call?(d.name&&(e.message.function_call.name=d.name),d.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=d.arguments)):e.message.function_call=d),h){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:a,function:i,...s}of h){const o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,s),n&&(o.id=n),a&&(o.type=a),i&&(o.function??(o.function={arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments)}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new h.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function m(e){return JSON.stringify(e)}t.ChatCompletionStream=f},67730:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCompletionStreamingRunner=void 0;const r=n(95126);class a extends r.ChatCompletionStream{static fromReadableStream(e){const t=new a;return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new a,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,i))),r}static runTools(e,t,n){const r=new a,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,i))),r}}t.ChatCompletionStreamingRunner=a},64691:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParsingToolFunction=t.ParsingFunction=t.isRunnableFunctionWithParse=void 0,t.isRunnableFunctionWithParse=function(e){return"function"==typeof e.parse},t.ParsingFunction=class{constructor(e){this.function=e.function,this.parse=e.parse,this.parameters=e.parameters,this.description=e.description,this.name=e.name}},t.ParsingToolFunction=class{constructor(e){this.type="function",this.function=e}}},73346:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allSettledWithThrow=void 0,t.allSettledWithThrow=async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r}},46289:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPresent=t.isToolMessage=t.isFunctionMessage=t.isAssistantMessage=void 0,t.isAssistantMessage=e=>"assistant"===e?.role,t.isFunctionMessage=e=>"function"===e?.role,t.isToolMessage=e=>"tool"===e?.role,t.isPresent=function(e){return null!=e}},2510:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CursorPage=t.Page=void 0;const r=n(88757);class a extends r.AbstractPage{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}t.Page=a;class i extends r.AbstractPage{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}t.CursorPage=i},32802:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APIResource=void 0,t.APIResource=class{constructor(e){this._client=e}}},1253:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Audio=void 0;const s=n(32802),o=i(n(5113)),u=i(n(33694)),l=i(n(17655));class c extends s.APIResource{constructor(){super(...arguments),this.transcriptions=new u.Transcriptions(this._client),this.translations=new l.Translations(this._client),this.speech=new o.Speech(this._client)}}t.Audio=c,function(e){e.Transcriptions=u.Transcriptions,e.Translations=l.Translations,e.Speech=o.Speech}(c=t.Audio||(t.Audio={}))},5113:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Speech=void 0;const r=n(32802);class a extends r.APIResource{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}t.Speech=a,a=t.Speech||(t.Speech={})},33694:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transcriptions=void 0;const r=n(32802),a=n(88757);class i extends r.APIResource{create(e,t){return this._client.post("/audio/transcriptions",(0,a.multipartFormRequestOptions)({body:e,...t}))}}t.Transcriptions=i,i=t.Transcriptions||(t.Transcriptions={})},17655:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Translations=void 0;const r=n(32802),a=n(88757);class i extends r.APIResource{create(e,t){return this._client.post("/audio/translations",(0,a.multipartFormRequestOptions)({body:e,...t}))}}t.Translations=i,i=t.Translations||(t.Translations={})},32530:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BatchesPage=t.Batches=void 0;const s=n(32802),o=n(88757),u=i(n(32530)),l=n(2510);class c extends s.APIResource{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return(0,o.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/batches",d,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}t.Batches=c;class d extends l.CursorPage{}t.BatchesPage=d,function(e){e.BatchesPage=u.BatchesPage}(c=t.Batches||(t.Batches={}))},92964:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AssistantsPage=t.Assistants=void 0;const s=n(32802),o=n(88757),u=i(n(92964)),l=n(2510);class c extends s.APIResource{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return(0,o.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/assistants",d,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}t.Assistants=c;class d extends l.CursorPage{}t.AssistantsPage=d,function(e){e.AssistantsPage=u.AssistantsPage}(c=t.Assistants||(t.Assistants={}))},6183:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Beta=void 0;const s=n(32802),o=i(n(92964)),u=i(n(41356)),l=i(n(2682)),c=i(n(97734));class d extends s.APIResource{constructor(){super(...arguments),this.vectorStores=new c.VectorStores(this._client),this.chat=new u.Chat(this._client),this.assistants=new o.Assistants(this._client),this.threads=new l.Threads(this._client)}}t.Beta=d,function(e){e.VectorStores=c.VectorStores,e.VectorStoresPage=c.VectorStoresPage,e.Chat=u.Chat,e.Assistants=o.Assistants,e.AssistantsPage=o.AssistantsPage,e.Threads=l.Threads}(d=t.Beta||(t.Beta={}))},41356:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chat=void 0;const s=n(32802),o=i(n(68111));class u extends s.APIResource{constructor(){super(...arguments),this.completions=new o.Completions(this._client)}}t.Chat=u,function(e){e.Completions=o.Completions}(u=t.Chat||(t.Chat={}))},68111:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Completions=t.ChatCompletionStream=t.ParsingToolFunction=t.ParsingFunction=t.ChatCompletionStreamingRunner=t.ChatCompletionRunner=void 0;const r=n(32802),a=n(44648);var i=n(44648);Object.defineProperty(t,"ChatCompletionRunner",{enumerable:!0,get:function(){return i.ChatCompletionRunner}});const s=n(67730);var o=n(67730);Object.defineProperty(t,"ChatCompletionStreamingRunner",{enumerable:!0,get:function(){return o.ChatCompletionStreamingRunner}});var u=n(64691);Object.defineProperty(t,"ParsingFunction",{enumerable:!0,get:function(){return u.ParsingFunction}}),Object.defineProperty(t,"ParsingToolFunction",{enumerable:!0,get:function(){return u.ParsingToolFunction}});const l=n(95126);var c=n(95126);Object.defineProperty(t,"ChatCompletionStream",{enumerable:!0,get:function(){return c.ChatCompletionStream}});class d extends r.APIResource{runFunctions(e,t){return e.stream?s.ChatCompletionStreamingRunner.runFunctions(this._client.chat.completions,e,t):a.ChatCompletionRunner.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?s.ChatCompletionStreamingRunner.runTools(this._client.chat.completions,e,t):a.ChatCompletionRunner.runTools(this._client.chat.completions,e,t)}stream(e,t){return l.ChatCompletionStream.createChatCompletion(this._client.chat.completions,e,t)}}t.Completions=d},96059:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesPage=t.Messages=void 0;const s=n(32802),o=n(88757),u=i(n(96059)),l=n(2510);class c extends s.APIResource{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return(0,o.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,d,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}t.Messages=c;class d extends l.CursorPage{}t.MessagesPage=d,function(e){e.MessagesPage=u.MessagesPage}(c=t.Messages||(t.Messages={}))},41946:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RunsPage=t.Runs=void 0;const s=n(32802),o=n(88757),u=n(18868),l=n(88757),c=i(n(41946)),d=i(n(57733)),p=n(2510);class h extends s.APIResource{constructor(){super(...arguments),this.steps=new d.Steps(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return(0,o.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,f,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return u.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=i.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await(0,l.sleep)(e);break;case"requires_action":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return u.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const a=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,a.id,r)}submitToolOutputsStream(e,t,n,r){return u.AssistantStream.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}t.Runs=h;class f extends p.CursorPage{}t.RunsPage=f,function(e){e.RunsPage=c.RunsPage,e.Steps=d.Steps,e.RunStepsPage=d.RunStepsPage}(h=t.Runs||(t.Runs={}))},57733:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RunStepsPage=t.Steps=void 0;const s=n(32802),o=n(88757),u=i(n(57733)),l=n(2510);class c extends s.APIResource{retrieve(e,t,n,r){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t,n={},r){return(0,o.isRequestOptions)(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,d,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}t.Steps=c;class d extends l.CursorPage{}t.RunStepsPage=d,function(e){e.RunStepsPage=u.RunStepsPage}(c=t.Steps||(t.Steps={}))},2682:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Threads=void 0;const s=n(32802),o=n(88757),u=n(18868),l=i(n(96059)),c=i(n(41946));class d extends s.APIResource{constructor(){super(...arguments),this.runs=new c.Runs(this._client),this.messages=new l.Messages(this._client)}create(e={},t){return(0,o.isRequestOptions)(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return u.AssistantStream.createThreadAssistantStream(e,this._client.beta.threads,t)}}t.Threads=d,function(e){e.Runs=c.Runs,e.RunsPage=c.RunsPage,e.Messages=l.Messages,e.MessagesPage=l.MessagesPage}(d=t.Threads||(t.Threads={}))},33159:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorStoreFilesPage=t.FileBatches=void 0;const r=n(32802),a=n(88757),i=n(88757),s=n(73346),o=n(44113);Object.defineProperty(t,"VectorStoreFilesPage",{enumerable:!0,get:function(){return o.VectorStoreFilesPage}});class u extends r.APIResource{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return(0,a.isRequestOptions)(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,o.VectorStoreFilesPage,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:s}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await(0,i.sleep)(e);break;case"failed":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null===t||0==t.length)throw new Error("No files provided to process.");const a=r?.maxConcurrency??5,i=Math.min(a,t.length),o=this._client,u=t.values(),l=[...n],c=Array(i).fill(u).map((async function(e){for(let t of e){const e=await o.files.create({file:t,purpose:"assistants"},r);l.push(e.id)}}));return await(0,s.allSettledWithThrow)(c),await this.createAndPoll(e,{file_ids:l})}}t.FileBatches=u,u=t.FileBatches||(t.FileBatches={})},44113:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.VectorStoreFilesPage=t.Files=void 0;const s=n(32802),o=n(88757),u=n(88757),l=i(n(44113)),c=n(2510);class d extends s.APIResource{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},n){return(0,o.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,p,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:r}).withResponse(),i=a.data;switch(i.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await(0,u.sleep)(e);break;case"failed":case"completed":return i}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}}t.Files=d;class p extends c.CursorPage{}t.VectorStoreFilesPage=p,function(e){e.VectorStoreFilesPage=l.VectorStoreFilesPage}(d=t.Files||(t.Files={}))},97734:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.VectorStoresPage=t.VectorStores=void 0;const s=n(32802),o=n(88757),u=i(n(97734)),l=i(n(33159)),c=i(n(44113)),d=n(2510);class p extends s.APIResource{constructor(){super(...arguments),this.files=new c.Files(this._client),this.fileBatches=new l.FileBatches(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return(0,o.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/vector_stores",h,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}t.VectorStores=p;class h extends d.CursorPage{}t.VectorStoresPage=h,function(e){e.VectorStoresPage=u.VectorStoresPage,e.Files=c.Files,e.VectorStoreFilesPage=c.VectorStoreFilesPage,e.FileBatches=l.FileBatches}(p=t.VectorStores||(t.VectorStores={}))},76111:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chat=void 0;const s=n(32802),o=i(n(96374));class u extends s.APIResource{constructor(){super(...arguments),this.completions=new o.Completions(this._client)}}t.Chat=u,function(e){e.Completions=o.Completions}(u=t.Chat||(t.Chat={}))},96374:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Completions=void 0;const r=n(32802);class a extends r.APIResource{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}t.Completions=a,a=t.Completions||(t.Completions={})},7949:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chat=t.Completions=void 0;var r=n(96374);Object.defineProperty(t,"Completions",{enumerable:!0,get:function(){return r.Completions}});var a=n(76111);Object.defineProperty(t,"Chat",{enumerable:!0,get:function(){return a.Chat}})},79045:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Completions=void 0;const r=n(32802);class a extends r.APIResource{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}t.Completions=a,a=t.Completions||(t.Completions={})},1242:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Embeddings=void 0;const r=n(32802);class a extends r.APIResource{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}t.Embeddings=a,a=t.Embeddings||(t.Embeddings={})},61461:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FileObjectsPage=t.Files=void 0;const s=n(32802),o=n(88757),u=n(88757),l=n(89526),c=i(n(61461)),d=n(88757),p=n(2510);class h extends s.APIResource{create(e,t){return this._client.post("/files",(0,d.multipartFormRequestOptions)({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return(0,o.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/files",f,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await(0,u.sleep)(t),i=await this.retrieve(e),Date.now()-a>n)throw new l.APIConnectionTimeoutError({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}}t.Files=h;class f extends p.Page{}t.FileObjectsPage=f,function(e){e.FileObjectsPage=c.FileObjectsPage}(h=t.Files||(t.Files={}))},33453:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FineTuning=void 0;const s=n(32802),o=i(n(71718));class u extends s.APIResource{constructor(){super(...arguments),this.jobs=new o.Jobs(this._client)}}t.FineTuning=u,function(e){e.Jobs=o.Jobs,e.FineTuningJobsPage=o.FineTuningJobsPage,e.FineTuningJobEventsPage=o.FineTuningJobEventsPage}(u=t.FineTuning||(t.FineTuning={}))},33955:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FineTuningJobCheckpointsPage=t.Checkpoints=void 0;const s=n(32802),o=n(88757),u=i(n(33955)),l=n(2510);class c extends s.APIResource{list(e,t={},n){return(0,o.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,d,{query:t,...n})}}t.Checkpoints=c;class d extends l.CursorPage{}t.FineTuningJobCheckpointsPage=d,function(e){e.FineTuningJobCheckpointsPage=u.FineTuningJobCheckpointsPage}(c=t.Checkpoints||(t.Checkpoints={}))},71718:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FineTuningJobEventsPage=t.FineTuningJobsPage=t.Jobs=void 0;const s=n(32802),o=n(88757),u=i(n(71718)),l=i(n(33955)),c=n(2510);class d extends s.APIResource{constructor(){super(...arguments),this.checkpoints=new l.Checkpoints(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return(0,o.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",p,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return(0,o.isRequestOptions)(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,h,{query:t,...n})}}t.Jobs=d;class p extends c.CursorPage{}t.FineTuningJobsPage=p;class h extends c.CursorPage{}t.FineTuningJobEventsPage=h,function(e){e.FineTuningJobsPage=u.FineTuningJobsPage,e.FineTuningJobEventsPage=u.FineTuningJobEventsPage,e.Checkpoints=l.Checkpoints,e.FineTuningJobCheckpointsPage=l.FineTuningJobCheckpointsPage}(d=t.Jobs||(t.Jobs={}))},87370:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Images=void 0;const r=n(32802),a=n(88757);class i extends r.APIResource{createVariation(e,t){return this._client.post("/images/variations",(0,a.multipartFormRequestOptions)({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",(0,a.multipartFormRequestOptions)({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}t.Images=i,i=t.Images||(t.Images={})},33946:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Moderations=t.Models=t.ModelsPage=t.Images=t.FineTuning=t.Files=t.FileObjectsPage=t.Embeddings=t.Completions=t.Beta=t.Batches=t.BatchesPage=t.Audio=void 0,a(n(7949),t),a(n(55653),t);var i=n(1253);Object.defineProperty(t,"Audio",{enumerable:!0,get:function(){return i.Audio}});var s=n(32530);Object.defineProperty(t,"BatchesPage",{enumerable:!0,get:function(){return s.BatchesPage}}),Object.defineProperty(t,"Batches",{enumerable:!0,get:function(){return s.Batches}});var o=n(6183);Object.defineProperty(t,"Beta",{enumerable:!0,get:function(){return o.Beta}});var u=n(79045);Object.defineProperty(t,"Completions",{enumerable:!0,get:function(){return u.Completions}});var l=n(1242);Object.defineProperty(t,"Embeddings",{enumerable:!0,get:function(){return l.Embeddings}});var c=n(61461);Object.defineProperty(t,"FileObjectsPage",{enumerable:!0,get:function(){return c.FileObjectsPage}}),Object.defineProperty(t,"Files",{enumerable:!0,get:function(){return c.Files}});var d=n(33453);Object.defineProperty(t,"FineTuning",{enumerable:!0,get:function(){return d.FineTuning}});var p=n(87370);Object.defineProperty(t,"Images",{enumerable:!0,get:function(){return p.Images}});var h=n(99458);Object.defineProperty(t,"ModelsPage",{enumerable:!0,get:function(){return h.ModelsPage}}),Object.defineProperty(t,"Models",{enumerable:!0,get:function(){return h.Models}});var f=n(24975);Object.defineProperty(t,"Moderations",{enumerable:!0,get:function(){return f.Moderations}})},99458:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelsPage=t.Models=void 0;const s=n(32802),o=i(n(99458)),u=n(2510);class l extends s.APIResource{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",c,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}t.Models=l;class c extends u.Page{}t.ModelsPage=c,function(e){e.ModelsPage=o.ModelsPage}(l=t.Models||(t.Models={}))},24975:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Moderations=void 0;const r=n(32802);class a extends r.APIResource{create(e,t){return this._client.post("/moderations",{body:e,...t})}}t.Moderations=a,a=t.Moderations||(t.Moderations={})},55653:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6716:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readableStreamAsyncIterable=t._decodeChunks=t._iterSSEMessages=t.Stream=void 0;const r=n(12212),a=n(89526),i=n(89526);class s{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new s((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of o(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(e&&e.error)throw new i.APIError(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new i.APIError(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new s((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new c,n=d(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new s((()=>r(e)),this.controller),new s((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new r.ReadableStream({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:a}=await t.next();if(a)return e.close();const i=n.encode(JSON.stringify(r)+"\n");e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}async function*o(e,t){if(!e.body)throw t.abort(),new a.OpenAIError("Attempted to iterate over a response with no body");const n=new l,r=new c,i=d(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,a=new Uint8Array(t.length+e.length);for(a.set(t),a.set(e,t.length),t=a;-1!==(r=u(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(i))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}function u(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}t.Stream=s,t._iterSSEMessages=o;class l{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(":");return-1!==n?[e.substring(0,n),":",e.substring(n+1)]:[e,"",""]}(e);return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}class c{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=c.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(c.NEWLINE_REGEXP);return n&&r.pop(),1!==r.length||n?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new a.OpenAIError(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new a.OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new a.OpenAIError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function d(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}c.NEWLINE_CHARS=new Set(["\n","\r"]),c.NEWLINE_REGEXP=/\r\n|[\n\r]/g,t._decodeChunks=function(e){const t=new c,n=[];for(const r of e)n.push(...t.decode(r));return n},t.readableStreamAsyncIterable=d},64042:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createForm=t.multipartFormRequestOptions=t.maybeMultipartFormRequestOptions=t.isMultipartBody=t.toFile=t.isUploadable=t.isBlobLike=t.isFileLike=t.isResponseLike=t.fileFromPath=void 0;const r=n(12212);var a=n(12212);async function i(e,n,a){if(e=await e,a??(a=(0,t.isFileLike)(e)?{lastModified:e.lastModified,type:e.type}:{}),(0,t.isResponseLike)(e)){const t=await e.blob();return n||(n=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new r.File([t],n,a)}const i=await async function(e){let n=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)n.push(e);else if((0,t.isBlobLike)(e))n.push(await e.arrayBuffer());else{if(!o(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const t of e)n.push(t)}return n}(e);if(n||(n=function(e){return s(e.name)||s(e.filename)||s(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!a.type){const e=i[0]?.type;"string"==typeof e&&(a={...a,type:e})}return new r.File(i,n,a)}Object.defineProperty(t,"fileFromPath",{enumerable:!0,get:function(){return a.fileFromPath}}),t.isResponseLike=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,t.isFileLike=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&(0,t.isBlobLike)(e),t.isBlobLike=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,t.isUploadable=e=>(0,t.isFileLike)(e)||(0,t.isResponseLike)(e)||(0,r.isFsReadStream)(e),t.toFile=i;const s=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,o=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator];t.isMultipartBody=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],t.maybeMultipartFormRequestOptions=async e=>{if(!u(e.body))return e;const n=await(0,t.createForm)(e.body);return(0,r.getMultipartRequestOptions)(n,e)},t.multipartFormRequestOptions=async e=>{const n=await(0,t.createForm)(e.body);return(0,r.getMultipartRequestOptions)(n,e)},t.createForm=async e=>{const t=new r.FormData;return await Promise.all(Object.entries(e||{}).map((([e,n])=>l(t,e,n)))),t};const u=e=>{if((0,t.isUploadable)(e))return!0;if(Array.isArray(e))return e.some(u);if(e&&"object"==typeof e)for(const t in e)if(u(e[t]))return!0;return!1},l=async(e,n,r)=>{if(void 0!==r){if(null==r)throw new TypeError(`Received null for "${n}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(n,String(r));else if((0,t.isUploadable)(r)){const t=await i(r);e.append(n,t)}else if(Array.isArray(r))await Promise.all(r.map((t=>l(e,n+"[]",t))));else{if("object"!=typeof r)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`);await Promise.all(Object.entries(r).map((([t,r])=>l(e,`${n}[${t}]`,r))))}}}},35392:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="4.40.2"},92626:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultOptions=t.defaultOptions=t.ignoreOverride=void 0,t.ignoreOverride=Symbol("Let zodToJsonSchema decide on which parser to use"),t.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email",base64Strategy:"contentEncoding:base64"},t.getDefaultOptions=e=>"string"==typeof e?{...t.defaultOptions,name:e}:{...t.defaultOptions,...e}},11076:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRefs=void 0;const r=n(92626);t.getRefs=e=>{const t=(0,r.getDefaultOptions)(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}}},98950:function(e,t){"use strict";function n(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}Object.defineProperty(t,"__esModule",{value:!0}),t.setResponseValueAndErrors=t.addErrorMessage=void 0,t.addErrorMessage=n,t.setResponseValueAndErrors=function(e,t,r,a,i){e[t]=r,n(e,t,a,i)}},39340:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(92626),t),a(n(11076),t),a(n(98950),t),a(n(73524),t),a(n(62909),t),a(n(98598),t),a(n(87236),t),a(n(28147),t),a(n(46163),t),a(n(16260),t),a(n(85187),t),a(n(29606),t),a(n(68385),t),a(n(76750),t),a(n(40686),t),a(n(34836),t),a(n(39137),t),a(n(96773),t),a(n(63237),t),a(n(37294),t),a(n(41854),t),a(n(31114),t),a(n(46172),t),a(n(65867),t),a(n(79225),t),a(n(93858),t),a(n(89729),t),a(n(87054),t),a(n(34519),t),a(n(73178),t),a(n(22793),t),a(n(97987),t),a(n(78348),t),a(n(95973),t),a(n(34633),t);const i=n(34633);t.default=i.zodToJsonSchema},73524:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDef=void 0;const r=n(21614),a=n(62909),i=n(98598),s=n(87236),o=n(28147),u=n(46163),l=n(16260),c=n(85187),d=n(29606),p=n(68385),h=n(76750),f=n(40686),m=n(34836),g=n(39137),b=n(96773),y=n(63237),v=n(37294),_=n(41854),w=n(31114),P=n(46172),O=n(65867),A=n(79225),C=n(93858),T=n(87054),I=n(34519),E=n(73178),x=n(22793),j=n(97987),M=n(78348),k=n(95973),S=n(89729),R=n(92626);function N(e,t,n=!1){const r=t.seen.get(e);if(t.override){const a=t.override?.(e,t,r,n);if(a!==R.ignoreOverride)return a}if(r&&!n){const e=L(r,t);if(void 0!==e)return e}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const i=$(e,e.typeName,t);return i&&F(e,t,i),a.jsonSchema=i,i}t.parseDef=N;const L=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:D(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,n)=>t.currentPath[n]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},D=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},$=(e,t,n)=>{switch(t){case r.ZodFirstPartyTypeKind.ZodString:return(0,E.parseStringDef)(e,n);case r.ZodFirstPartyTypeKind.ZodNumber:return(0,w.parseNumberDef)(e,n);case r.ZodFirstPartyTypeKind.ZodObject:return(0,P.parseObjectDef)(e,n);case r.ZodFirstPartyTypeKind.ZodBigInt:return(0,s.parseBigintDef)(e,n);case r.ZodFirstPartyTypeKind.ZodBoolean:return(0,o.parseBooleanDef)();case r.ZodFirstPartyTypeKind.ZodDate:return(0,c.parseDateDef)(e,n);case r.ZodFirstPartyTypeKind.ZodUndefined:return(0,j.parseUndefinedDef)();case r.ZodFirstPartyTypeKind.ZodNull:return(0,v.parseNullDef)(n);case r.ZodFirstPartyTypeKind.ZodArray:return(0,i.parseArrayDef)(e,n);case r.ZodFirstPartyTypeKind.ZodUnion:case r.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,M.parseUnionDef)(e,n);case r.ZodFirstPartyTypeKind.ZodIntersection:return(0,f.parseIntersectionDef)(e,n);case r.ZodFirstPartyTypeKind.ZodTuple:return(0,x.parseTupleDef)(e,n);case r.ZodFirstPartyTypeKind.ZodRecord:return(0,T.parseRecordDef)(e,n);case r.ZodFirstPartyTypeKind.ZodLiteral:return(0,m.parseLiteralDef)(e,n);case r.ZodFirstPartyTypeKind.ZodEnum:return(0,h.parseEnumDef)(e);case r.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,b.parseNativeEnumDef)(e);case r.ZodFirstPartyTypeKind.ZodNullable:return(0,_.parseNullableDef)(e,n);case r.ZodFirstPartyTypeKind.ZodOptional:return(0,O.parseOptionalDef)(e,n);case r.ZodFirstPartyTypeKind.ZodMap:return(0,g.parseMapDef)(e,n);case r.ZodFirstPartyTypeKind.ZodSet:return(0,I.parseSetDef)(e,n);case r.ZodFirstPartyTypeKind.ZodLazy:return N(e.getter()._def,n);case r.ZodFirstPartyTypeKind.ZodPromise:return(0,C.parsePromiseDef)(e,n);case r.ZodFirstPartyTypeKind.ZodNaN:case r.ZodFirstPartyTypeKind.ZodNever:return(0,y.parseNeverDef)();case r.ZodFirstPartyTypeKind.ZodEffects:return(0,p.parseEffectsDef)(e,n);case r.ZodFirstPartyTypeKind.ZodAny:return(0,a.parseAnyDef)();case r.ZodFirstPartyTypeKind.ZodUnknown:return(0,k.parseUnknownDef)();case r.ZodFirstPartyTypeKind.ZodDefault:return(0,d.parseDefaultDef)(e,n);case r.ZodFirstPartyTypeKind.ZodBranded:return(0,u.parseBrandedDef)(e,n);case r.ZodFirstPartyTypeKind.ZodReadonly:return(0,S.parseReadonlyDef)(e,n);case r.ZodFirstPartyTypeKind.ZodCatch:return(0,l.parseCatchDef)(e,n);case r.ZodFirstPartyTypeKind.ZodPipeline:return(0,A.parsePipelineDef)(e,n);case r.ZodFirstPartyTypeKind.ZodFunction:case r.ZodFirstPartyTypeKind.ZodVoid:case r.ZodFirstPartyTypeKind.ZodSymbol:default:return}},F=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n)},62909:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAnyDef=void 0,t.parseAnyDef=function(){return{}}},98598:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseArrayDef=void 0;const r=n(21614),a=n(98950),i=n(73524);t.parseArrayDef=function(e,t){const n={type:"array"};return e.type?._def?.typeName!==r.ZodFirstPartyTypeKind.ZodAny&&(n.items=(0,i.parseDef)(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(0,a.setResponseValueAndErrors)(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&(0,a.setResponseValueAndErrors)(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&((0,a.setResponseValueAndErrors)(n,"minItems",e.exactLength.value,e.exactLength.message,t),(0,a.setResponseValueAndErrors)(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}},87236:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBigintDef=void 0;const r=n(98950);t.parseBigintDef=function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?(0,r.setResponseValueAndErrors)(n,"minimum",a.value,a.message,t):(0,r.setResponseValueAndErrors)(n,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(n.exclusiveMinimum=!0),(0,r.setResponseValueAndErrors)(n,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?(0,r.setResponseValueAndErrors)(n,"maximum",a.value,a.message,t):(0,r.setResponseValueAndErrors)(n,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(n.exclusiveMaximum=!0),(0,r.setResponseValueAndErrors)(n,"maximum",a.value,a.message,t));break;case"multipleOf":(0,r.setResponseValueAndErrors)(n,"multipleOf",a.value,a.message,t)}return n}},28147:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBooleanDef=void 0,t.parseBooleanDef=function(){return{type:"boolean"}}},46163:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBrandedDef=void 0;const r=n(73524);t.parseBrandedDef=function(e,t){return(0,r.parseDef)(e.type._def,t)}},16260:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCatchDef=void 0;const r=n(73524);t.parseCatchDef=(e,t)=>(0,r.parseDef)(e.innerType._def,t)},85187:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDateDef=void 0;const r=n(98950);t.parseDateDef=function e(t,n,r){const i=r??n.dateStrategy;if(Array.isArray(i))return{anyOf:i.map(((r,a)=>e(t,n,r)))};switch(i){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return a(t,n)}};const a=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const a of e.checks)switch(a.kind){case"min":(0,r.setResponseValueAndErrors)(n,"minimum",a.value,a.message,t);break;case"max":(0,r.setResponseValueAndErrors)(n,"maximum",a.value,a.message,t)}return n}},29606:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDefaultDef=void 0;const r=n(73524);t.parseDefaultDef=function(e,t){return{...(0,r.parseDef)(e.innerType._def,t),default:e.defaultValue()}}},68385:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEffectsDef=void 0;const r=n(73524);t.parseEffectsDef=function(e,t){return"input"===t.effectStrategy?(0,r.parseDef)(e.schema._def,t):{}}},76750:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEnumDef=void 0,t.parseEnumDef=function(e){return{type:"string",enum:e.values}}},40686:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIntersectionDef=void 0;const r=n(73524);t.parseIntersectionDef=function(e,t){const n=[(0,r.parseDef)(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),(0,r.parseDef)(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const i=[];return n.forEach((e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else a=void 0;i.push(t)}else i.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);var t})),i.length?{allOf:i,...a}:void 0}},34836:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseLiteralDef=void 0,t.parseLiteralDef=function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}},39137:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMapDef=void 0;const r=n(73524),a=n(87054);t.parseMapDef=function(e,t){return"record"===t.mapStrategy?(0,a.parseRecordDef)(e,t):{type:"array",maxItems:125,items:{type:"array",items:[(0,r.parseDef)(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},(0,r.parseDef)(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}},96773:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNativeEnumDef=void 0,t.parseNativeEnumDef=function(e){const t=e.values,n=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),r=Array.from(new Set(n.map((e=>typeof e))));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:n}}},63237:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNeverDef=void 0,t.parseNeverDef=function(){return{not:{}}}},37294:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullDef=void 0,t.parseNullDef=function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}},41854:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNullableDef=void 0;const r=n(73524),a=n(78348);t.parseNullableDef=function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:a.primitiveMappings[e.innerType._def.typeName],nullable:!0}:{type:[a.primitiveMappings[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=(0,r.parseDef)(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=(0,r.parseDef)(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}},31114:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNumberDef=void 0;const r=n(98950);t.parseNumberDef=function(e,t){const n={type:"number"};if(!e.checks)return n;for(const a of e.checks)switch(a.kind){case"int":n.type="integer",(0,r.addErrorMessage)(n,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?(0,r.setResponseValueAndErrors)(n,"minimum",a.value,a.message,t):(0,r.setResponseValueAndErrors)(n,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(n.exclusiveMinimum=!0),(0,r.setResponseValueAndErrors)(n,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?(0,r.setResponseValueAndErrors)(n,"maximum",a.value,a.message,t):(0,r.setResponseValueAndErrors)(n,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(n.exclusiveMaximum=!0),(0,r.setResponseValueAndErrors)(n,"maximum",a.value,a.message,t));break;case"multipleOf":(0,r.setResponseValueAndErrors)(n,"multipleOf",a.value,a.message,t)}return n}},46172:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseObjectDef=t.parseObjectDefX=void 0;const r=n(73524);function a(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:(0,r.parseDef)(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:(0,r.parseDef)(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}t.parseObjectDefX=function(e,t){Object.keys(e.shape()).reduce(((n,a)=>{let i=e.shape()[a];const s=i.isOptional();s||(i={...i._def.innerSchema});const o=(0,r.parseDef)(i._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return void 0!==o&&(n.properties[a]=o,s||(n.required||(n.required=[]),n.required.push(a))),n}),{type:"object",properties:{},additionalProperties:a(e,t)});const n={type:"object",...Object.entries(e.shape()).reduce(((e,[n,a])=>{if(void 0===a||void 0===a._def)return e;const i=(0,r.parseDef)(a._def,{...t,currentPath:[...t.currentPath,"properties",n],propertyPath:[...t.currentPath,"properties",n]});return void 0===i?e:{properties:{...e.properties,[n]:i},required:a.isOptional()?e.required:[...e.required,n]}}),{properties:{},required:[]}),additionalProperties:a(e,t)};return n.required.length||delete n.required,n},t.parseObjectDef=function(e,t){const n={type:"object",...Object.entries(e.shape()).reduce(((e,[n,a])=>{if(void 0===a||void 0===a._def)return e;const i=(0,r.parseDef)(a._def,{...t,currentPath:[...t.currentPath,"properties",n],propertyPath:[...t.currentPath,"properties",n]});return void 0===i?e:{properties:{...e.properties,[n]:i},required:a.isOptional()?e.required:[...e.required,n]}}),{properties:{},required:[]}),additionalProperties:a(e,t)};return n.required.length||delete n.required,n}},65867:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseOptionalDef=void 0;const r=n(73524);t.parseOptionalDef=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return(0,r.parseDef)(e.innerType._def,t);const n=(0,r.parseDef)(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}}},79225:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePipelineDef=void 0;const r=n(73524);t.parsePipelineDef=(e,t)=>{if("input"===t.pipeStrategy)return(0,r.parseDef)(e.in._def,t);if("output"===t.pipeStrategy)return(0,r.parseDef)(e.out._def,t);const n=(0,r.parseDef)(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,(0,r.parseDef)(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter((e=>void 0!==e))}}},93858:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePromiseDef=void 0;const r=n(73524);t.parsePromiseDef=function(e,t){return(0,r.parseDef)(e.type._def,t)}},89729:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseReadonlyDef=void 0;const r=n(73524);t.parseReadonlyDef=(e,t)=>(0,r.parseDef)(e.innerType._def,t)},87054:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseRecordDef=void 0;const r=n(21614),a=n(73524),i=n(73178);t.parseRecordDef=function(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===r.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((n,r)=>({...n,[r]:(0,a.parseDef)(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??{}})),{}),additionalProperties:!1};const n={type:"object",additionalProperties:(0,a.parseDef)(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===r.ZodFirstPartyTypeKind.ZodString&&e.keyType._def.checks?.length){const r=Object.entries((0,i.parseStringDef)(e.keyType._def,t)).reduce(((e,[t,n])=>"type"===t?e:{...e,[t]:n}),{});return{...n,propertyNames:r}}return e.keyType?._def.typeName===r.ZodFirstPartyTypeKind.ZodEnum?{...n,propertyNames:{enum:e.keyType._def.values}}:n}},34519:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSetDef=void 0;const r=n(98950),a=n(73524);t.parseSetDef=function(e,t){const n={type:"array",uniqueItems:!0,items:(0,a.parseDef)(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(0,r.setResponseValueAndErrors)(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&(0,r.setResponseValueAndErrors)(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}},73178:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringDef=t.zodPatterns=void 0;const r=n(98950);t.zodPatterns={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$",base64:"^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$",nanoid:"^[a-zA-Z0-9_-]{21}$"},t.parseStringDef=function(e,n){const o={type:"string"};function u(e){return"escape"===n.patternStrategy?a(e):e}if(e.checks)for(const a of e.checks)switch(a.kind){case"min":(0,r.setResponseValueAndErrors)(o,"minLength","number"==typeof o.minLength?Math.max(o.minLength,a.value):a.value,a.message,n);break;case"max":(0,r.setResponseValueAndErrors)(o,"maxLength","number"==typeof o.maxLength?Math.min(o.maxLength,a.value):a.value,a.message,n);break;case"email":switch(n.emailStrategy){case"format:email":i(o,"email",a.message,n);break;case"format:idn-email":i(o,"idn-email",a.message,n);break;case"pattern:zod":s(o,t.zodPatterns.email,a.message,n)}break;case"url":i(o,"uri",a.message,n);break;case"uuid":i(o,"uuid",a.message,n);break;case"regex":s(o,a.regex.source,a.message,n);break;case"cuid":s(o,t.zodPatterns.cuid,a.message,n);break;case"cuid2":s(o,t.zodPatterns.cuid2,a.message,n);break;case"startsWith":s(o,"^"+u(a.value),a.message,n);break;case"endsWith":s(o,u(a.value)+"$",a.message,n);break;case"datetime":i(o,"date-time",a.message,n);break;case"date":i(o,"date",a.message,n);break;case"time":i(o,"time",a.message,n);break;case"duration":i(o,"duration",a.message,n);break;case"length":(0,r.setResponseValueAndErrors)(o,"minLength","number"==typeof o.minLength?Math.max(o.minLength,a.value):a.value,a.message,n),(0,r.setResponseValueAndErrors)(o,"maxLength","number"==typeof o.maxLength?Math.min(o.maxLength,a.value):a.value,a.message,n);break;case"includes":s(o,u(a.value),a.message,n);break;case"ip":"v6"!==a.version&&i(o,"ipv4",a.message,n),"v4"!==a.version&&i(o,"ipv6",a.message,n);break;case"emoji":s(o,t.zodPatterns.emoji,a.message,n);break;case"ulid":s(o,t.zodPatterns.ulid,a.message,n);break;case"base64":switch(n.base64Strategy){case"format:binary":i(o,"binary",a.message,n);break;case"contentEncoding:base64":(0,r.setResponseValueAndErrors)(o,"contentEncoding","base64",a.message,n);break;case"pattern:zod":s(o,t.zodPatterns.base64,a.message,n)}break;case"nanoid":s(o,t.zodPatterns.nanoid,a.message,n)}return o};const a=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),i=(e,t,n,a)=>{e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&a.errorMessages&&{errorMessage:{format:n}}})):(0,r.setResponseValueAndErrors)(e,"format",t,n,a)},s=(e,t,n,a)=>{e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:t,...n&&a.errorMessages&&{errorMessage:{pattern:n}}})):(0,r.setResponseValueAndErrors)(e,"pattern",t,n,a)}},22793:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseTupleDef=void 0;const r=n(73524);t.parseTupleDef=function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,n)=>(0,r.parseDef)(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:(0,r.parseDef)(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,n)=>(0,r.parseDef)(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}},97987:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUndefinedDef=void 0,t.parseUndefinedDef=function(){return{not:{}}}},78348:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnionDef=t.primitiveMappings=void 0;const r=n(73524);t.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},t.parseUnionDef=function(e,n){if("openApi3"===n.target)return a(e,n);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every((e=>e._def.typeName in t.primitiveMappings&&(!e._def.checks||!e._def.checks.length)))){const e=r.reduce(((e,n)=>{const r=t.primitiveMappings[n._def.typeName];return r&&!e.includes(r)?[...e,r]:e}),[]);return{type:e.length>1?e:e[0]}}if(r.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=r.reduce(((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===r.length){const t=e.filter(((e,t,n)=>n.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:r.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(r.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:r.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return a(e,n)};const a=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,n)=>(0,r.parseDef)(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return n.length?{anyOf:n}:void 0}},95973:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnknownDef=void 0,t.parseUnknownDef=function(){return{}}},34633:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zodToJsonSchema=void 0;const r=n(73524),a=n(11076);t.zodToJsonSchema=(e,t)=>{const n=(0,a.getRefs)(t),i="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,a])=>({...e,[t]:(0,r.parseDef)(a._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??{}})),{}):void 0,s="string"==typeof t?t:t?.name,o=(0,r.parseDef)(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??{},u=void 0===s?i?{...o,[n.definitionPath]:i}:o:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...i,[s]:o}};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),u}}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=n,a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,n){return a.f[n](e,t),t}),[]))},a.u=function(e){return e+".js"},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="inqviz-excel:",a.l=function(n,r,i,s){if(e[n])e[n].push(r);else{var o,u;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+i){o=d;break}}o||(u=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",t+i),o.src=n),e[n]=[r];var p=function(t,r){o.onerror=o.onload=null,clearTimeout(h);var a=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach((function(e){return e(r)})),t)return t(r)},h=setTimeout(p.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=p.bind(null,o.onerror),o.onload=p.bind(null,o.onload),u&&document.head.appendChild(o)}},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e}(),function(){a.b=document.baseURI||self.location.href;var e={926:0};a.f.j=function(t,n){var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise((function(n,a){r=e[t]=[n,a]}));n.push(r[2]=i);var s=a.p+a.u(t),o=new Error;a.l(s,(function(n){if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",o.name="ChunkLoadError",o.type=i,o.request=s,r[1](o)}}),"chunk-"+t,t)}};var t=function(t,n){var r,i,s=n[0],o=n[1],u=n[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);u&&u(a)}for(t&&t(n);l<s.length;l++)i=s[l],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkinqviz_excel=self.webpackChunkinqviz_excel||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),a(15797),a(39046)}();
//# sourceMappingURL=taskpane.js.map